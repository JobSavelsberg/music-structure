(function(t){function e(e){for(var a,s,c=e[0],o=e[1],l=e[2],d=0,h=[];d<c.length;d++)s=c[d],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&h.push(i[s][0]),i[s]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);u&&u(e);while(h.length)h.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,c=1;c<n.length;c++){var o=n[c];0!==i[o]&&(a=!1)}a&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},i={app:0},r=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var u=o;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var a=n("85ec"),i=n.n(a);i.a},"1aec":function(t,e,n){"use strict";var a=n("d917"),i=n.n(a);i.a},"2f67":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{attrs:{id:"app",dark:!0}},[n("router-view")],1)},r=[],s={name:"App",components:{},data:function(){return{}},mounted:function(){var t=document.getElementsByTagName("html")[0];t.style.overflowY="auto"},destroyed:function(){var t=document.getElementsByTagName("html")[0];t.style.overflowY=null}},c=s,o=(n("034f"),n("2877")),l=n("6544"),u=n.n(l),d=n("7496"),h=Object(o["a"])(c,i,r,!1,null,null,null),f=h.exports;u()(h,{VApp:d["a"]});var m=n("8c4f"),p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("v-app-bar",{attrs:{dark:""}},[n("v-toolbar-title",[t._v("Music Structure Visualizer")]),n("v-spacer"),n("form",{on:{submit:function(e){return e.preventDefault(),t.search(e)}}},[n("v-text-field",{attrs:{"hide-details":"","append-icon":"mdi-magnify","single-line":"",rounded:"",dense:"",filled:""},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}})],1),n("div",{staticClass:"volumeSlider"},[n("v-container",[n("v-slider",{attrs:{"prepend-icon":t.getVolumeIcon(t.volume),min:0,max:1,step:.02},on:{"click:prepend":t.clickVolume},model:{value:t.volume,callback:function(e){t.volume=e},expression:"volume"}})],1)],1),n("v-btn",{attrs:{icon:""}},[n("v-icon",[t._v("mdi-heart")])],1),n("v-btn",{attrs:{icon:""}},[n("v-icon",[t._v("mdi-dots-vertical")])],1)],1),n("TrackSelector",{attrs:{tracks:t.trackList,"album-size":120}}),n("Player",{attrs:{padding:t.padding}}),n("Visualization",{attrs:{padding:t.padding}})],1)},v=[],g=(n("b0c0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-slide-group",{staticClass:"pt-2",attrs:{"center-active":"",mandatory:""},nativeOn:{scroll:function(e){return t.onScroll(e)}},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},t._l(t.tracks,(function(e,a){return n("v-slide-item",{key:a,staticClass:"mx-2 my-1",scopedSlots:t._u([{key:"default",fn:function(a){var i=a.active,r=a.toggle;return[n("Album",{attrs:{album:e.trackData,imgSize:i?1.5*t.albumSize:t.albumSize,active:i},on:{clicked:r}})]}}],null,!0)})})),1)],1)}),y=[],w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card",{class:t.active?"elevation-3":"elevation-0",style:t.cardStyle},[n("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"track",on:{click:t.clicked}},[n("v-img",{attrs:{height:t.imgSize,width:t.imgSize,src:t.album.album.images[t.imgIndex].url}}),n("v-card-text",{staticClass:"pl-2 py-0 pt-1 ml-0 my-0"},[n("div",{staticClass:"text-subtitle-2 text--primary text-truncate "},[t._v(t._s(t.album.name))])])],1),n("v-card-actions",{staticClass:"pl-0 py-0 ml-0 my-0"},[n("v-btn",{staticClass:"artistButton",attrs:{text:"",color:"grey",small:""}},[n("span",{staticClass:"artistButtonText text-caption text-truncate",style:{"max-width":this.imgSize-12+"px"}},[t._v(" "+t._s(t.album.artists[0].name)+" ")])])],1)],1)},k=[],b={props:["album","imgSize","active"],data:function(){return{}},mounted:function(){},computed:{imgIndex:function(){return this.size<=this.album.album.images[2].height?2:this.size<=this.album.album.images[1].height?1:0},cardStyle:function(){return{width:this.imgSize+"px",height:this.imgSize+55+"px"}}},methods:{clicked:function(){this.$emit("clicked")}}},S=b,x=(n("8ade"),n("8336")),T=n("b0af"),C=n("99d9"),_=n("adda"),V=n("269a"),R=n.n(V),D=n("5607"),I=Object(o["a"])(S,w,k,!1,null,null,null),M=I.exports;u()(I,{VBtn:x["a"],VCard:T["a"],VCardActions:C["a"],VCardText:C["c"],VImg:_["a"]}),R()(I,{Ripple:D["a"]});n("4160"),n("a630"),n("4ec9"),n("d3b7"),n("ac1f"),n("3ca3"),n("841c"),n("159b"),n("ddb0");var O,A,L=n("a34a"),j=n.n(L),P=(n("96cf"),n("1da1")),$=n("be8d"),z=(n("25f0"),n("bc3a")),F=n.n(z),E="https://music-structure.herokuapp.com/api",B=F.a.create({baseURL:E,withCredentials:!1});function W(t){return H.apply(this,arguments)}function H(){return H=Object(P["a"])(j.a.mark((function t(e){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,B.post("spotify/token",{code:e}).then((function(t){O=t.data.access_token,window.sessionStorage.setItem("token",O),t.data.expires_in,window.sessionStorage.setItem("tokenTimestamp",(new Date).getTime().toString()),A=t.data.expires_in,window.sessionStorage.setItem("refreshToken",A)})).catch((function(t){console.log(t)}));case 2:case"end":return t.stop()}}),t)}))),H.apply(this,arguments)}function N(){if(void 0===O){var t=window.sessionStorage.getItem("token");window.sessionStorage.getItem("tokenTimestamp"),window.sessionStorage.getItem("refreshToken");return!!t&&(O=t,!0)}return!0}var G=n("d4ec"),U=n("bee2"),q=n("ade3"),J=function(){function t(e){Object(G["a"])(this,t),Object(q["a"])(this,"trackData",null),Object(q["a"])(this,"analysisData",null),Object(q["a"])(this,"ssm",null),this.trackData=e}return Object(U["a"])(t,[{key:"process",value:function(){this.calculateSSM()}},{key:"calculateSSM",value:function(){var t=this.getSegments().length;this.ssm=new Array(t);for(var e=0;e<t;e++){var n=this.getSegments()[e];this.ssm[e]=new Array(t-e);for(var a=e;a<t;a++)this.ssm[e][a-e]=new Array(2),this.ssm[e][a-e][0]=this.pitchSimilarity(n,this.getSegment(a)),this.ssm[e][a-e][1]=this.timbreSimilarity(n,this.getSegment(a))}}},{key:"segmentSimilarity",value:function(t,e){return this.pitchSimilarity(t,e)*this.timbreSimilarity(t,e)}},{key:"pitchSimilarity",value:function(t,e){for(var n=12,a=0;a<12;a++)n-=Math.abs(t.pitches[a]-e.pitches[a]);return n/12}},{key:"timbreSimilarity",value:function(t,e){for(var n=12,a=0;a<12;a++)n-=Math.abs(t.timbre[a]-e.timbre[a])/200;return n/12}}]),Object(U["a"])(t,[{key:"toJSON",value:function(){return{trackData:this.trackData,analysisData:this.analysisData}}},{key:"getId",value:function(){return this.trackData.id}},{key:"hasAnalysis",value:function(){return null!==this.analysisData}},{key:"getAnalysis",value:function(){return this.analysisData}},{key:"setAnalysis",value:function(t){this.hasAnalysis&&null!==this.ssm||(this.analysisData=t,console.log("processing"),this.process(),console.log("processed"))}},{key:"getName",value:function(){return this.trackData.name}},{key:"getArtist",value:function(){return this.trackData.artist}},{key:"getUri",value:function(){return this.trackData.uri}},{key:"getSegments",value:function(){return this.analysisData.segments}},{key:"getSegment",value:function(t){return this.analysisData.segments[t]}},{key:"getSSM",value:function(){return this.ssm}},{key:"getSSMValue",value:function(t,e){return this.ssm[t][e]}},{key:"getBars",value:function(){return this.analysisData.bars}},{key:"getBeats",value:function(){return this.analysisData.beats}},{key:"getTatums",value:function(){return this.analysisData.tatums}}],[{key:"createWithAnalysis",value:function(e,n){var a=new t(e);a.analysisData=n}},{key:"fromJSON",value:function(t){return this.createWithAnalysis(t.trackData,t.analysisData)}}]),t}(),Q=(n("a434"),n("2f62"));a["a"].use(Q["a"]);var X=new Q["a"].Store({state:{user:Object,trackList:[],selectedIndex:-1,seeker:0,playerState:null,loadingTrack:!0,playerReady:!1,playing:!1},mutations:{setSeeker:function(t,e){t.seeker=e},setUser:function(t,e){console.log("setting user to",e),t.user=e},setPlayerState:function(t,e){t.playerState=e},loadingTrack:function(t,e){t.loadingTrack=e},playerReady:function(t,e){t.playerReady=e},addToTrackList:function(t,e){t.trackList.push(e)},addToTrackListIndex:function(t,e,n){t.trackList.splice(e,0,n)},addToTrackListFront:function(t,e){t.trackList.unshift(e)},clearTrackList:function(t){t.trackList=[]},setSelectedIndex:function(t,e){t.selectedIndex=e},setPlaying:function(t,e){t.playing=e},incrementSeeker:function(t,e){t.seeker+=e}},actions:{},getters:{seeker:function(t){return t.seeker},selectedIndex:function(t){return t.selectedIndex},selectedTrack:function(t){return t.trackList[t.selectedIndex]},user:function(t){return t.user},track:function(t,e){return t.trackList[e]},trackList:function(t){return t.trackList},playerState:function(t){return t.playerState},playing:function(t){return t.playing}},modules:{}}),Y=n("5698"),K=new $,Z=new Map;function tt(){return et.apply(this,arguments)}function et(){return et=Object(P["a"])(j.a.mark((function t(){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:it(),console.log("Got tracks from local storage: ",Z),K.setAccessToken(O),K.getMe().then((function(t){X.commit("setUser",t)})).catch((function(t){We.push("/")})),K.getMyTopTracks({limit:50,offset:0}).then((function(t){rt(t.items,!1),nt(0)})).catch((function(t){return console.log(t)}));case 5:case"end":return t.stop()}}),t)}))),et.apply(this,arguments)}function nt(t){return at.apply(this,arguments)}function at(){return at=Object(P["a"])(j.a.mark((function t(e){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return X.commit("loadingTrack",!0),t.abrupt("return",st(X.getters.trackList[e]).then((function(){console.log("Getting analysis and everything done, now setting selected index"),X.commit("setSelectedIndex",e),X.commit("loadingTrack",!1)})));case 2:case"end":return t.stop()}}),t)}))),at.apply(this,arguments)}function it(){var t=JSON.parse(localStorage.allTracks);t.forEach((function(t){var e=new J(t[1].trackData,t[1].analysisData);Z.set(t[0],e)}))}function rt(t,e){var n=X.getters.selectedTrack;X.commit("clearTrackList"),t.forEach((function(t){if(Z.has(t.id))X.commit("addToTrackList",Z.get(t.id));else{var e=new J(t);Z.set(t.id,e),X.commit("addToTrackList",e)}})),e?(X.commit("addToTrackListFront",n),X.commit("setSelectedIndex",0)):nt(0)}function st(t){return ct.apply(this,arguments)}function ct(){return ct=Object(P["a"])(j.a.mark((function t(e){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.hasAnalysis()){t.next=2;break}return t.abrupt("return",e.getAnalysis());case 2:return t.abrupt("return",K.getAudioAnalysisForTrack(e.getId()).then((function(t){console.log("Got analysis from api"),e.setAnalysis(t),console.log("Track has done everything with analysis")})).catch((function(t){console.log(t)})));case 3:case"end":return t.stop()}}),t)}))),ct.apply(this,arguments)}function ot(t){return lt.apply(this,arguments)}function lt(){return lt=Object(P["a"])(j.a.mark((function t(e){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:K.search(e,["track"]).then((function(t){rt(t.tracks.items,!0)})).catch((function(t){console.log(t)}));case 1:case"end":return t.stop()}}),t)}))),lt.apply(this,arguments)}var ut={name:"TrackSelector",props:["tracks","albumSize"],components:{Album:M},data:function(){return{selected:0}},computed:{selectedFromStore:function(){return this.$store.getters.selectedIndex}},watch:{selected:"selectedChanged",selectedFromStore:"selectedFromStoreChanged"},mounted:function(){},methods:{selectedChanged:function(t,e){nt(t)},selectedFromStoreChanged:function(t,e){this.selected=t}}},dt=ut,ht=n("7efd"),ft=n("9dbe"),mt=Object(o["a"])(dt,g,y,!1,null,null,null),pt=mt.exports;u()(mt,{VSlideGroup:ht["a"],VSlideItem:ft["a"]});var vt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"d-flex pa-2"},[n("v-row",[n("v-layout",{staticClass:"ml-10"},[n("v-switch",{staticClass:"mx-5",attrs:{label:"Raw Pitch Data","hide-details":""},on:{change:t.draw},model:{value:t.drawRawPitch,callback:function(e){t.drawRawPitch=e},expression:"drawRawPitch"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Raw Timbre Data","hide-details":""},on:{change:t.draw},model:{value:t.drawRawTimbre,callback:function(e){t.drawRawTimbre=e},expression:"drawRawTimbre"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Rhythm Data","hide-details":""},on:{change:t.draw},model:{value:t.drawRawRhythm,callback:function(e){t.drawRawRhythm=e},expression:"drawRawRhythm"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Tonality","hide-details":""},on:{change:t.draw},model:{value:t.drawTonality,callback:function(e){t.drawTonality=e},expression:"drawTonality"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Similarity Matrix","hide-details":""},on:{change:t.draw},model:{value:t.drawSSM,callback:function(e){t.drawSSM=e},expression:"drawSSM"}})],1),n("v-spacer"),n("v-btn",{staticClass:"mr-10",attrs:{color:"primary",fab:"",dark:"",small:""},on:{click:t.zoom}},[n("v-icon",[t._v("mdi-magnify-plus-outline")])],1)],1)],1),n("div",{staticClass:"vis",on:{click:t.clickedVis}},[n("canvas",{directives:[{name:"show",rawName:"v-show",value:!t.loadingTrack,expression:"!loadingTrack"}],ref:"visCanvas",staticClass:"visCanvas pa-0 ma-0",attrs:{id:"visCanvas"}}),t.loadingTrack?t._e():n("svg",{staticClass:"svgContainer"},[n("rect",{attrs:{x:this.zoomed?this.padding+this.canvasWidth/2:t.padding+this.seeker/1e3*t.scale-1,y:0,width:2,height:t.canvasHeight,fill:"#ffffff",opacity:.5}})])])])},gt=[],yt=(n("5ce8"),n("5698")),wt=[0,7,2,9,4,11,6,1,8,3,10,5],kt=yt.scaleLinear().domain([0,1/12,2/12,2.8/12,3.8/12,4.3/12,5.3/12,6.8/12,8/12,8.8/12,.775,.875,1]).interpolate(yt.interpolateHcl).range([yt.rgb("#FE0000"),yt.rgb("#FF7300"),yt.rgb("#FFAA01"),yt.rgb("#FFD300"),yt.rgb("#FFFF01"),yt.rgb("#9FEE00"),yt.rgb("#01CC00"),yt.rgb("#009899"),yt.rgb("#1241AB"),yt.rgb("#3914B1"),yt.rgb("#7209AC"),yt.rgb("#CD0174"),yt.rgb("#FE0000")]);Math.PI,Math.PI;var bt=2*Math.PI,St=3*Math.PI/2;function xt(t){for(var e=0,n=0,a=0,i=0,r=0,s=0;s<12;s++)e=-wt[s]/12*bt+St,i=t[s],r+=i,n+=i*Math.cos(e),a+=i*Math.sin(e);e=(Math.atan2(n,a)+Math.PI)/bt,i=Math.sqrt(n*n+a*a);var c=yt.hsl(kt(e)),o=Math.min(3*i/r,1);return c.s=o,c.hex()}function Tt(t){var e=Math.max(0,60+t)/60;return e*e}var Ct,_t=null,Vt=!1,Rt="",Dt=0;function It(t,e){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(P["a"])(j.a.mark((function t(e,n){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:Rt=e,Dt=n;case 2:case"end":return t.stop()}}),t)}))),Mt.apply(this,arguments)}function Ot(t){return At.apply(this,arguments)}function At(){return At=Object(P["a"])(j.a.mark((function t(e){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!_t){t.next=7;break}if(!Vt||""!==Rt){t.next=6;break}return Pt(e),t.abrupt("return",Ct.resume().catch((function(t){console.log(t)})));case 6:return t.abrupt("return",K.play({device_id:_t,uris:[Rt],position_ms:e||Dt}).then((function(){Vt=!0,Rt,Rt="",Dt=0})).catch((function(t){console.log(t)})));case 7:case"end":return t.stop()}}),t)}))),At.apply(this,arguments)}function Lt(){return jt.apply(this,arguments)}function jt(){return jt=Object(P["a"])(j.a.mark((function t(){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!_t||!Vt){t.next=2;break}return t.abrupt("return",Ct.pause().catch((function(t){console.log(t)})));case 2:case"end":return t.stop()}}),t)}))),jt.apply(this,arguments)}function Pt(t){return $t.apply(this,arguments)}function $t(){return $t=Object(P["a"])(j.a.mark((function t(e){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!_t||!Vt){t.next=2;break}return t.abrupt("return",Ct.seek(e).catch((function(t){console.log(t)})));case 2:case"end":return t.stop()}}),t)}))),$t.apply(this,arguments)}function zt(){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(P["a"])(j.a.mark((function t(){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var n=new Date,a=setInterval((function(){null!==_t?(console.log("resolved after",new Date-n,"ms"),clearInterval(a),t()):new Date-n>1e4&&(console.log("rejected after",new Date-n,"ms"),clearInterval(a),e())}),20)})));case 1:case"end":return t.stop()}}),t)}))),Ft.apply(this,arguments)}function Et(t){Ct&&Ct.setVolume(t)}function Bt(){return Wt.apply(this,arguments)}function Wt(){return Wt=Object(P["a"])(j.a.mark((function t(){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("waiting"),t.abrupt("return",new Promise((function(t){window.Spotify?t(window.Spotify):window.onSpotifyWebPlaybackSDKReady=function(){t(window.Spotify)}})));case 2:case"end":return t.stop()}}),t)}))),Wt.apply(this,arguments)}function Ht(t,e){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(P["a"])(j.a.mark((function t(e,n){return j.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Bt();case 2:Ct=new window.Spotify.Player({name:"Music Structure Visualizer",getOAuthToken:function(t){t(e)},volume:.5}),Ct.addListener("initialization_error",(function(t){var e=t.message;console.error(e)})),Ct.addListener("authentication_error",(function(t){var e=t.message;console.error(e)})),Ct.addListener("account_error",(function(t){var e=t.message;console.error(e)})),Ct.addListener("playback_error",(function(t){var e=t.message;console.error(e)})),Ct.addListener("player_state_changed",(function(t){var e=t.position,a=t.duration,i=t.track_window.current_track;n({current_track:i,position:e,duration:a})})),Ct.addListener("ready",(function(t){var e=t.device_id;_t=e,console.log("Ready with Device ID",e)})),Ct.addListener("not_ready",(function(t){var e=t.device_id;console.log("Device ID has gone offline",e)})),Ct.connect().then((function(){console.log("Connected succesfully!!!")})).catch((function(t){console.log("Could not connect")}));case 11:case"end":return t.stop()}}),t)}))),Nt.apply(this,arguments)}var Gt=Y["scaleSequential"]().domain([0,1]).interpolator(Y["interpolateViridis"]),Ut=Gt,qt=Y["scaleSequential"]().domain([1,0]).interpolator(Y["interpolateGreys"]),Jt=Y["scaleSequential"]().domain([-100,100]).interpolator(Y["interpolateViridis"]),Qt=Y["scaleSequential"]().domain([0,11]).interpolator(Y["interpolateRainbow"]);function Xt(t,e,n,a,i,r){var s=n/t.getAnalysis().track.duration;t.getSegments().forEach((function(t){for(var n=0;n<12;n++){var c=e+t.start*s,o=i/12-2,l=a+(11-n)*(o+2),u=t.duration*s;r.fillStyle=Ut(t.pitches[n]),r.fillRect(c,l,u,o)}}))}function Yt(t,e,n,a,i,r){var s=n/t.getAnalysis().track.duration;t.getSegments().forEach((function(t){for(var n=0;n<12;n++){var c=e+t.start*s,o=i/12-2,l=a+(11-n)*(o+2),u=t.duration*s;r.fillStyle=Jt(t.timbre[n]),r.fillRect(c,l,u,o)}}))}function Kt(t,e,n,a,i,r){var s=n/t.getAnalysis().track.duration;t.getBars().forEach((function(t){var n=e+t.start*s,c=a;r.fillStyle=qt(.3+t.confidence),r.fillRect(n,c,1,i/3)})),t.getBeats().forEach((function(t){var n=e+t.start*s,c=a+i/3;r.fillStyle=qt(.3+t.confidence),r.fillRect(n,c,1,i/3)})),t.getTatums().forEach((function(t){var n=e+t.start*s,c=a+i/3*2;r.fillStyle=qt(.3+t.confidence),r.fillRect(n,c,1,i/3)}))}function Zt(t,e,n,a,i,r){var s=n/t.getAnalysis().track.duration;t.getSegments().forEach((function(t){var n=e+t.start*s,c=i,o=a,l=t.duration*s;r.fillStyle=xt(t.pitches),r.fillRect(n,o,l,c)}))}function te(t,e,n,a,i,r){for(var s=i/t.getAnalysis().track.duration,c=t.getSegments().length,o=0;o<c;o++)for(var l=o;l<c;l++){var u=t.getSegment(o),d=t.getSegment(l),h=t.getSSM()[o][l-o][0];r.fillStyle=qt(Math.pow(h,4));var f=e+u.start*s,m=u.duration*s,p=a+d.start*s,v=d.duration*s;r.fillRect(f,p,m,v);var g=t.getSSM()[o][l-o][1];r.fillStyle=qt(Math.pow(g,5)),r.fillRect(p+e-a,f-e+a,v,m)}}var ee={props:["padding"],data:function(){return{canvas:null,ctx:null,hover:0,windowWidth:window.innerWidth,spotifyVisualizer:null,power:1,drawRawPitch:!0,drawRawTimbre:!0,drawSSM:!1,drawTonality:!0,drawRawRhythm:!0,zoomed:!1,scaleX:4}},computed:{track:function(){return this.$store.getters.selectedTrack},analysis:function(){return this.track.getAnalysis()},scale:function(){return this.width/this.analysis.track.duration},width:function(){return this.windowWidth*(this.zoomed?this.scaleX:1)-2*this.padding},canvasWidth:function(){return this.windowWidth-2*this.padding},canvasHeight:function(){return 2500},loadingTrack:function(){return this.$store.state.loadingTrack},duration:function(){return Math.round(1e3*this.track.getAnalysis().track.duration)},seeker:function(){return this.$store.state.seeker}},watch:{loadingTrack:"loadingTrackChanged",seeker:"seekerChanged"},mounted:function(){var t=this;window.addEventListener("resize",(function(){t.windowWidth=window.innerWidth,t.setupCanvas(document.getElementById("visCanvas"))})),this.setupCanvas(document.getElementById("visCanvas"))},methods:{clickedVis:function(t){var e=Math.min(Math.max(0,t.clientX-this.padding)/this.width,1),n=e*this.duration;this.$store.commit("setSeeker",n),Pt(n)},loudness:function(t){return Tt(t)},pitchColorRange:function(t){return Ut(t)},timbreColorRange:function(t){return Jt(t)},rainbowColorRange:function(t){return Qt(t)},loadingTrackChanged:function(t,e){!1===this.loadingTrack&&this.draw(0)},setupCanvas:function(t){if(t){console.log("canvas ready: draw()"),this.canvas=t,this.ctx=t.getContext("2d");t.getBoundingClientRect();this.canvas.width=this.windowWidth*devicePixelRatio,this.canvas.height=this.canvasHeight*devicePixelRatio,this.ctx.scale(devicePixelRatio,devicePixelRatio),this.canvas.style.width=this.windowWidth+"px",this.canvas.style.height=this.canvasHeight+"px",this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}else console.log("canvas not ready")},draw:function(t){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var e=0;this.drawRawPitch&&(Xt(this.track,this.padding-t,this.width,0,150,this.ctx),e+=155),this.drawRawTimbre&&(Yt(this.track,this.padding-t,this.width,e,150,this.ctx),e+=155),this.drawRawRhythm&&(Kt(this.track,this.padding-t,this.width,e,30,this.ctx),e+=35),this.drawTonality&&(Zt(this.track,this.padding-t,this.width,e,25,this.ctx),e+=30),this.drawSSM&&(te(this.track,this.padding-t,this.width,e,this.width,this.ctx),e+=this.width+5)},zoom:function(){console.log("zooming"),this.zoomed=!this.zoomed,this.redraw()},redraw:function(){var t=this.seeker/1e3*this.width/this.analysis.track.duration,e=this.canvasWidth/2;this.draw(this.zoomed?t-e:0)},seekerChanged:function(t,e){this.zoomed&&this.redraw()},transform:function(){this.ctx.save(),this.ctx.translate(.5*this.width,.5*this.canvasHeight),this.ctx.scale(2,2),this.ctx.drawImage(this.canvas,.5*-this.width,.5*-this.canvasHeight),this.ctx.restore()}}},ne=ee,ae=(n("8aeb"),n("132d")),ie=n("a722"),re=n("0fd9"),se=n("2fa4"),ce=n("b73d"),oe=Object(o["a"])(ne,vt,gt,!1,null,null,null),le=oe.exports;u()(oe,{VBtn:x["a"],VIcon:ae["a"],VLayout:ie["a"],VRow:re["a"],VSpacer:se["a"],VSwitch:ce["a"]});var ue=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"player"},[n("div",{staticClass:"d-flex justify-center pa-4"},[t.$store.state.playerReady?n("div",[n("v-hover",{scopedSlots:t._u([{key:"default",fn:function(e){var a=e.hover;return[n("v-btn",{attrs:{elevation:a?5:0,outlined:"",fab:""},on:{click:t.playPause}},[n("v-icon",{attrs:{large:""}},[t._v("mdi-"+t._s(t.playing?"pause":"play"))])],1)]}}],null,!1,2020131878)})],1):t._e(),t.$store.state.playerReady?t._e():n("div",[n("v-progress-circular",{attrs:{indeterminate:"",size:"56"}})],1)]),t.$store.state.loadingTrack?t._e():n("div",{attrs:{id:"timeseeker"}},[n("svg",{staticClass:"waveform",attrs:{height:t.verticalScale},on:{click:t.clickedSVG}},[t._l(t.track.getAnalysis().segments,(function(e,a){return n("rect",{key:a,staticClass:"loudnessBlock",attrs:{width:e.duration*t.scale,height:t.loudness(e.loudness_max)*t.verticalScale,x:t.padding+e.start*t.scale,y:t.verticalScale-t.loudness(e.loudness_max)*t.verticalScale,fill:e.start+e.duration/2<t.$store.state.seeker/1e3?"grey":t.baseColor}})})),n("rect",{attrs:{x:t.padding+t.seeker/1e3*t.scale-1,y:0,width:2,height:t.verticalScale,fill:"#1DB954"}})],2)]),t.$store.state.loadingTrack?n("div",[n("v-progress-linear",{attrs:{indeterminate:"",color:"success"}})],1):t._e()])},de=[],he={inject:["theme"],props:["padding"],data:function(){return{verticalScale:50,windowWidth:window.innerWidth,hover:0,ending:!1}},beforeCreate:function(){var t=this;Ht(O,(function(e){return t.stateChanged(e)})),zt().then((function(){t.$store.commit("playerReady",!0)}))},mounted:function(){},computed:{track:function(){return this.$store.getters.selectedTrack},baseColor:function(){return this.theme.isDark?"white":"black"},scale:function(){return this.width/this.track.getAnalysis().track.duration},width:function(){return this.windowWidth-2*this.padding},duration:function(){return Math.round(1e3*this.track.getAnalysis().track.duration)},playing:function(){return this.$store.getters.playing},seeker:function(){return this.$store.getters.seeker}},watch:{track:"trackChanged"},methods:{clickedSVG:function(t){var e=Math.min(Math.max(0,t.clientX-this.padding)/this.width,1),n=e*this.duration;this.$store.commit("setSeeker",n),Pt(this.seeker)},trackChanged:function(t,e){var n=this;this.reset().then((function(){It(n.track.getUri(),0),n.$store.commit("setSeeker",0)}))},resume:function(){var t=this;this.playing||Ot(this.seeker).then((function(){t.$store.commit("setPlaying",!0),t.interval=setInterval((function(){return t.$store.state.seeker+=33}),33)}))},pause:function(){this.playing&&(Lt(),this.$store.commit("setPlaying",!1),clearInterval(this.interval))},playPause:function(){this.playing?this.pause():this.resume()},reset:function(){var t=this;return Object(P["a"])(j.a.mark((function e(){return j.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.ending=!1,e.abrupt("return",Lt().then((function(){t.$store.commit("setSeeker",0),clearInterval(t.interval),t.$store.commit("setPlaying",!1)})).catch((function(t){return console.log(t)})));case 2:case"end":return e.stop()}}),e)})))()},clickedTimeSeeker:function(){Pt(this.seekTime)},seekerTimer:function(t){var e=new Date,n=t;this.lastTimePoll&&(n=e-this.lastTimePoll),this.lastTimePoll=e,this.seekTime+=n},loudness:function(t){return Tt(t)},stateChanged:function(t){if(this.playing){t.current_track;var e=t.position;t.duration;this.$store.commit("setSeeker",e),this.ending&&0===t.position&&this.reset(),!this.ending&&t.duration-t.position<500&&(this.ending=!0)}}},components:{}},fe=he,me=(n("6131"),n("ce87")),pe=n("490a"),ve=n("8e36"),ge=Object(o["a"])(fe,ue,de,!1,null,null,null),ye=ge.exports;u()(ge,{VBtn:x["a"],VHover:me["a"],VIcon:ae["a"],VProgressCircular:pe["a"],VProgressLinear:ve["a"]});var we={name:"Home",data:function(){return{searchQuery:"",volume:.75,prevVolume:.75,padding:50}},computed:{user:function(){return this.$store.getters.user},trackList:function(){return this.$store.getters.trackList},selectedIndex:function(){return this.$store.getters.selectedIndex},selectedTrack:function(){return this.$store.getters.selectedTrack},seeker:function(){return this.$store.getters.seeker}},watch:{selectedIndex:function(t,e){},selectedTrack:function(t,e){console.log("We have ".concat(t.getName()," selected!"))},volume:function(t,e){Et(Math.pow(this.volume,2))}},components:{TrackSelector:pt,Visualization:le,Player:ye},beforeCreate:function(){tt()},methods:{search:function(){ot(this.searchQuery)},selectedTrackChanged:function(){console.log("selected track",this.trackList[this.selected].name),this.getAnalsysisFor(this.selected)},getAnalsysisFor:function(t){var e=this.trackList[t].id;this.trackAnalysis.has(e)||(this.analysisReady=!1,console.log("Getting analysis for: ",this.trackList[t].name))},getVolumeIcon:function(t){return t>.6?"mdi-volume-high":t>.2?"mdi-volume-medium":t>0?"mdi-volume-low":"mdi-volume-off"},clickVolume:function(){this.volume>0?(this.prevVolume=this.volume,this.volume=0):this.volume=this.prevVolume}}},ke=we,be=(n("cccb"),n("40dc")),Se=n("a523"),xe=n("ba0d"),Te=n("8654"),Ce=n("2a7f"),_e=Object(o["a"])(ke,p,v,!1,null,null,null),Ve=_e.exports;u()(_e,{VAppBar:be["a"],VBtn:x["a"],VContainer:Se["a"],VIcon:ae["a"],VSlider:xe["a"],VSpacer:se["a"],VTextField:Te["a"],VToolbarTitle:Ce["a"]});var Re=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"callback"})},De=[],Ie=(n("2b3d"),{name:"Callback",components:{},beforeCreate:function(){var t=this,e=new URLSearchParams(window.location.search),n=e.get("code");W(n).then((function(){t.$router.push("/home")}))}}),Me=Ie,Oe=(n("1aec"),Object(o["a"])(Me,Re,De,!1,null,null,null)),Ae=Oe.exports,Le=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login"},[n("v-container",{attrs:{"fill-height":""}},[n("v-layout",{attrs:{"align-center":""}},[n("v-card",{staticClass:"mx-auto elevation-15"},[n("v-card-title",{staticClass:"justify-center"},[t._v("Music Structure Visualizer")]),n("v-card-subtitle",{staticClass:"text-center"},[t._v(" Visualize the structure of music in your own library! ")]),n("v-card-text",{staticClass:"text-center"},[t._v(" Logging in with spotify enables the app to play music using your spotify account. ")]),n("v-card-actions",[n("v-btn",{staticClass:"mx-auto",attrs:{color:"success"},on:{click:t.spotifyAuthorize}},[t._v("Log in with Spotify")])],1)],1)],1)],1)],1)},je=[],Pe={name:"Login",components:{},methods:{spotifyAuthorize:function(){window.location.href="https://music-structure.herokuapp.com/api/spotify/login"}}},$e=Pe,ze=(n("d6db"),Object(o["a"])($e,Le,je,!1,null,null,null)),Fe=ze.exports;u()(ze,{VBtn:x["a"],VCard:T["a"],VCardActions:C["a"],VCardSubtitle:C["b"],VCardText:C["c"],VCardTitle:C["d"],VContainer:Se["a"],VLayout:ie["a"]}),a["a"].use(m["a"]);var Ee=[{path:"/",name:"Login",component:Fe},{path:"/home",name:"Home",component:Ve,beforeEnter:function(t,e,n){N()?n():n("/")}},{path:"/callback",name:"Callback",component:Ae}],Be=new m["a"]({mode:"history",base:"/",routes:Ee}),We=Be,He=n("f309");a["a"].use(He["a"]);var Ne=new He["a"]({theme:{dark:!0,themes:{light:{primary:"#1DB954",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#1DB954",warning:"#FFC107"},dark:{primary:"#1DB954",success:"#1DB954"}}}});a["a"].config.productionTip=!1,new a["a"]({router:We,vuetify:Ne,store:X,render:function(t){return t(f)}}).$mount("#app")},"5ced":function(t,e,n){},6131:function(t,e,n){"use strict";var a=n("2f67"),i=n.n(a);i.a},"6e94":function(t,e,n){},"85ec":function(t,e,n){},"8ade":function(t,e,n){"use strict";var a=n("9bd1"),i=n.n(a);i.a},"8aeb":function(t,e,n){"use strict";var a=n("6e94"),i=n.n(a);i.a},"9bd1":function(t,e,n){},cccb:function(t,e,n){"use strict";var a=n("5ced"),i=n.n(a);i.a},d6db:function(t,e,n){"use strict";var a=n("e67a"),i=n.n(a);i.a},d917:function(t,e,n){},e67a:function(t,e,n){}});
//# sourceMappingURL=app.009e631e.js.map