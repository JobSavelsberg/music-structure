{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?0f16","webpack:///./src/components/visualizations/TimbreGraph.vue?8974","webpack:///./src/views/Callback.vue?e81a","webpack:///./src/components/visualizations/GraphSection.vue?fecf","webpack:///./src/components/visualizations/TimbreStructure.vue?343d","webpack:///./src/components/visualizations/Chords.vue?a956","webpack:///./src/components/visualizations/TimbreSegmentedGraph.vue?f13e","webpack:///./src/app/workers/workers.js","webpack:///./src/components/visualizations/Matrixes.vue?bf3e","webpack:///./src/components/visualizations/Events.vue?ddde","webpack:///./src/components/visualizations/Structure.vue?63e0","webpack:///./src/components/visualizations/ScapePlot.vue?2678","webpack:///./src/assets/timbres/7.png","webpack:///./src/assets/timbres/2.png","webpack:///./src/components/visualizations/Section.vue?fd35","webpack:///./src/components/visualizations/Beats.vue?b352","webpack:///./src/dev/log.js","webpack:///./src/assets/timbres/3.png","webpack:///./src/App.vue?569c","webpack:///src/App.vue","webpack:///./src/App.vue?3359","webpack:///./src/App.vue?2667","webpack:///./src/views/Track.vue?ea94","webpack:///./src/components/TrackSelector.vue?1747","webpack:///./src/components/Album.vue?ee9c","webpack:///src/components/Album.vue","webpack:///./src/components/Album.vue?ef28","webpack:///./src/components/Album.vue?aeb0","webpack:///./src/app/authentication.js","webpack:///./src/app/similarity.js","webpack:///./src/store/index.js","webpack:///./src/app/audioUtil.js","webpack:///./src/app/SpotifySegment.js","webpack:///./src/app/chordDetection.js","webpack:///./src/app/filter.js","webpack:///./src/app/noveltyDetection.js","webpack:///./src/app/familyFitness.js","webpack:///./src/app/pathExtraction.js","webpack:///./src/app/mds.js","webpack:///./src/app/SSM.js","webpack:///./src/app/Section.js","webpack:///./src/app/structure.js","webpack:///./src/app/Features.js","webpack:///./src/app/vis.js","webpack:///./src/app/Track.js","webpack:///./src/app/testing.js","webpack:///./src/app/synthesizer.js","webpack:///./src/app/app.js","webpack:///src/components/TrackSelector.vue","webpack:///./src/components/TrackSelector.vue?635c","webpack:///./src/components/TrackSelector.vue","webpack:///./src/components/Visualization.vue?0ef2","webpack:///./src/components/visualizations/Matrixes.vue?3246","webpack:///./src/app/webgl/WebGL.js","webpack:///./src/app/webgl/WebGLMatrixPool.js","webpack:///./src/components/visualizations/Seeker.vue?a08b","webpack:///./src/app/player.js","webpack:///./src/components/visualizations/Markers.vue?c6fe","webpack:///src/components/visualizations/Markers.vue","webpack:///./src/components/visualizations/Markers.vue?2e04","webpack:///./src/components/visualizations/Markers.vue?d7a7","webpack:///src/components/visualizations/Seeker.vue","webpack:///./src/components/visualizations/Seeker.vue?9884","webpack:///./src/components/visualizations/Seeker.vue?9c43","webpack:///src/components/visualizations/Matrixes.vue","webpack:///./src/components/visualizations/Matrixes.vue?4c87","webpack:///./src/components/visualizations/Matrixes.vue?2903","webpack:///./src/components/visualizations/GroundTruth.vue?e575","webpack:///./src/app/visualization/ZoomCanvas.js","webpack:///src/components/visualizations/GroundTruth.vue","webpack:///./src/components/visualizations/GroundTruth.vue?7453","webpack:///./src/components/visualizations/GroundTruth.vue?994e","webpack:///./src/components/visualizations/Graphs.vue?37bc","webpack:///./src/components/visualizations/Graph.vue?5bb8","webpack:///src/components/visualizations/Graph.vue","webpack:///./src/components/visualizations/Graph.vue?98b5","webpack:///./src/components/visualizations/Graph.vue?4b18","webpack:///src/components/visualizations/Graphs.vue","webpack:///./src/components/visualizations/Graphs.vue?d6ed","webpack:///./src/components/visualizations/Graphs.vue?7f85","webpack:///./src/components/visualizations/ScapePlot.vue?ab78","webpack:///src/components/visualizations/ScapePlot.vue","webpack:///./src/components/visualizations/ScapePlot.vue?a2e1","webpack:///./src/components/visualizations/ScapePlot.vue?8fe8","webpack:///./src/components/visualizations/Beats.vue?9555","webpack:///src/components/visualizations/Beats.vue","webpack:///./src/components/visualizations/Beats.vue?2dd7","webpack:///./src/components/visualizations/Beats.vue?f89c","webpack:///./src/components/visualizations/PitchTimbre.vue?548d","webpack:///./src/app/webgl/WebGLPitchTimbre.js","webpack:///src/components/visualizations/PitchTimbre.vue","webpack:///./src/components/visualizations/PitchTimbre.vue?0b12","webpack:///./src/components/visualizations/PitchTimbre.vue?9ff1","webpack:///./src/components/visualizations/Structure.vue?e6af","webpack:///./src/components/visualizations/MDS.vue?0b7a","webpack:///src/components/visualizations/MDS.vue","webpack:///./src/components/visualizations/MDS.vue?8285","webpack:///./src/components/visualizations/MDS.vue","webpack:///src/components/visualizations/Structure.vue","webpack:///./src/components/visualizations/Structure.vue?5f84","webpack:///./src/components/visualizations/Structure.vue?4412","webpack:///./src/components/visualizations/HolisticStructure.vue?e396","webpack:///./src/components/visualizations/Section.vue?8015","webpack:///src/components/visualizations/Section.vue","webpack:///./src/components/visualizations/Section.vue?f63d","webpack:///./src/components/visualizations/Section.vue?70d2","webpack:///./src/components/visualizations/SeparatorBackground.vue?d4df","webpack:///src/components/visualizations/SeparatorBackground.vue","webpack:///./src/components/visualizations/SeparatorBackground.vue?b322","webpack:///./src/components/visualizations/SeparatorBackground.vue","webpack:///./src/components/visualizations/Tooltip.vue?36f3","webpack:///src/components/visualizations/Tooltip.vue","webpack:///./src/components/visualizations/Tooltip.vue?7fee","webpack:///./src/components/visualizations/Tooltip.vue?c9dc","webpack:///src/components/visualizations/HolisticStructure.vue","webpack:///./src/components/visualizations/HolisticStructure.vue?2898","webpack:///./src/components/visualizations/HolisticStructure.vue?6777","webpack:///./src/components/visualizations/TimbreStructure.vue?409b","webpack:///./src/components/visualizations/StructureBackground.vue?1952","webpack:///src/components/visualizations/StructureBackground.vue","webpack:///./src/components/visualizations/StructureBackground.vue?4ebf","webpack:///./src/components/visualizations/StructureBackground.vue","webpack:///src/components/visualizations/TimbreStructure.vue","webpack:///./src/components/visualizations/TimbreStructure.vue?6e43","webpack:///./src/components/visualizations/TimbreStructure.vue?0327","webpack:///./src/components/visualizations/TimbreSegmentedGraph.vue?b0b7","webpack:///./src/components/visualizations/GraphSection.vue?dad4","webpack:///src/components/visualizations/GraphSection.vue","webpack:///./src/components/visualizations/GraphSection.vue?67c7","webpack:///./src/components/visualizations/GraphSection.vue?7fbd","webpack:///./src/components/visualizations/Events.vue?95c3","webpack:///src/components/visualizations/Events.vue","webpack:///./src/components/visualizations/Events.vue?9cca","webpack:///./src/components/visualizations/Events.vue?ac42","webpack:///./src/components/visualizations/ClickableBackground.vue?e93b","webpack:///src/components/visualizations/ClickableBackground.vue","webpack:///./src/components/visualizations/ClickableBackground.vue?4193","webpack:///./src/components/visualizations/ClickableBackground.vue?0092","webpack:///src/components/visualizations/TimbreSegmentedGraph.vue","webpack:///./src/components/visualizations/TimbreSegmentedGraph.vue?82e6","webpack:///./src/components/visualizations/TimbreSegmentedGraph.vue?aafa","webpack:///./src/components/visualizations/Tonality.vue?01c2","webpack:///src/components/visualizations/Tonality.vue","webpack:///./src/components/visualizations/Tonality.vue?8f1e","webpack:///./src/components/visualizations/Tonality.vue?16ef","webpack:///./src/components/visualizations/Chords.vue?51c8","webpack:///src/components/visualizations/Chords.vue","webpack:///./src/components/visualizations/Chords.vue?9131","webpack:///./src/components/visualizations/Chords.vue?8953","webpack:///./src/components/visualizations/Tempo.vue?c664","webpack:///src/components/visualizations/Tempo.vue","webpack:///./src/components/visualizations/Tempo.vue?01a2","webpack:///./src/components/visualizations/Tempo.vue?9932","webpack:///./src/components/visualizations/TimbreGraph.vue?7f71","webpack:///src/components/visualizations/TimbreGraph.vue","webpack:///./src/components/visualizations/TimbreGraph.vue?d392","webpack:///./src/components/visualizations/TimbreGraph.vue?f63e","webpack:///src/components/Visualization.vue","webpack:///./src/components/Visualization.vue?6d7e","webpack:///./src/components/Visualization.vue?0ab9","webpack:///./src/components/Player.vue?7537","webpack:///src/components/Player.vue","webpack:///./src/components/Player.vue?5c64","webpack:///./src/components/Player.vue?d892","webpack:///src/views/Track.vue","webpack:///./src/views/Track.vue?5660","webpack:///./src/views/Track.vue?9607","webpack:///./src/views/Callback.vue?4b7a","webpack:///src/views/Callback.vue","webpack:///./src/views/Callback.vue?2a5f","webpack:///./src/views/Callback.vue?7303","webpack:///./src/views/Login.vue?e598","webpack:///src/views/Login.vue","webpack:///./src/views/Login.vue?3a4e","webpack:///./src/views/Login.vue?0b6d","webpack:///./src/views/Landing.vue?b0de","webpack:///src/views/Landing.vue","webpack:///./src/views/Landing.vue?f974","webpack:///./src/views/Landing.vue?860b","webpack:///./src/router/index.js","webpack:///./src/plugins/vuetify.js","webpack:///./src/main.js","webpack:///./src/components/visualizations/ClickableBackground.vue?a609","webpack:///./src/app/dataStructures/Matrix.js","webpack:///./src/assets/timbres/11.png","webpack:///./src/assets/timbres sync ^\\.\\/.*\\.png$","webpack:///./src/assets/timbres/10.png","webpack:///./src/assets/timbres/8.png","webpack:///./src/app/workers/chordWorker.js?ecd0","webpack:///./src/components/visualizations/Tooltip.vue?36a6","webpack:///./src/components/visualizations/PitchTimbre.vue?3e2d","webpack:///./src/assets/timbres/1.png","webpack:///./src/assets/timbres/0.png","webpack:///./src/app/workers/harmonicStructureWorker.js","webpack:///./src/components/Album.vue?fd95","webpack:///./src/components/Visualization.vue?6ce7","webpack:///./src/components/visualizations/Tonality.vue?0435","webpack:///./src/assets/timbres/6.png","webpack:///./src/components/visualizations/Markers.vue?aed0","webpack:///./src/app/dataStructures/HalfMatrix.js","webpack:///./src/components/visualizations/Tempo.vue?7263","webpack:///./src/app/workers/tsneWorker.js","webpack:///./src/app/dataStructures/NumberType.js","webpack:///./src/views/Track.vue?ea32","webpack:///./src/assets/timbres/5.png","webpack:///./src/app/workers/timbreGraphWorker.js","webpack:///./src/app/workers/harmonicStructureWorker.js?1d1a","webpack:///./src/views/Landing.vue?048c","webpack:///./src/app/workers/ssmWorker.js","webpack:///./src/components/visualizations/Graphs.vue?2834","webpack:///./src/views/Login.vue?b712","webpack:///./src/components/visualizations/Graph.vue?ed18","webpack:///./src/app/workers/clusterWorker.js","webpack:///./src/assets/timbres/9.png","webpack:///./src/components/visualizations/Seeker.vue?b221","webpack:///./src/app/workers/timbreStructureWorker.js","webpack:///./src/components/Player.vue?79ff","webpack:///./src/app/workers/timbreStructureWorker.js?4017","webpack:///./src/app/workers/timbreGraphWorker.js?067c","webpack:///./src/app/workers/chordWorker.js","webpack:///./src/components/visualizations/HolisticStructure.vue?7153","webpack:///./src/assets/timbres/4.png","webpack:///./src/components/visualizations/GroundTruth.vue?be19"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","this","oldJsonpFunction","slice","init","a","timbreGraphWorker","Worker","timbreStructureWorker","harmonicStructureWorker","chordWorker","isCalculating","timbreGraphWorkerBusy","updateTimbreGraphVis","timbreFeatures","timbreSliders","sampleDuration","Promise","resolve","terminate","postMessage","timestamp","Date","onmessage","event","sendBackTime","log","timbreStructureWorkerBusy","computeTimbreStructure","harmonicStructureWorkerBusy","computeHarmonicStructure","options","state","window","eventBus","$emit","ssm","tsneWorker","chordWorkerBusy","computeChords","pitchFeatures","fastSampledPitch","fastSampledPitchDuration","startSSM","trackId","avgLoudness","segmentStartDuration","beatsStartDuration","enhanceBlurLength","threshold","thresholdPercentage","allPitches","tempoRatios","SPminSize","SPstepSize","createScapePlot","synthesized","synthesizedSSMPitch","synthesizedSSMTimbre","sampleAmount","id","messageType","message","scapePlot","HalfMatrix","scapePlotAnchorColor","Float32Array","matrixes","forEach","matrix","buffer","type","Matrix","graphs","graph","clusterWorker","tsneWorkerBusy","tsne","features","clusterWorkerBusy","cluster","debug","info","warn","error","argPlaceholder","navigator","userAgent","indexOf","levels","DEBUG","color","bg","INFO","WARN","ERROR","FATAL","currentLevel","levelStack","updateLogs","console","_vm","_h","$createElement","_c","_self","attrs","staticRenderFns","component","VApp","staticClass","_v","testing","synthesizing","_e","on","$event","preventDefault","search","$store","commit","model","callback","$$v","searchQuery","expression","getVolumeIcon","clickVolume","volume","share","trackList","ref","style","mainContentWidth","showPrototype","staticStyle","readMore","nativeOn","onScroll","selected","_l","track","index","scopedSlots","_u","fn","active","toggle","trackData","albumSize","clickedArtist","class","directives","rawName","clicked","imgSize","album","images","imgIndex","url","_s","artists","VBtn","VCard","VCardActions","VCardText","VImg","Ripple","token","refreshToken","api","axios","baseURL","withCredentials","tokenTimestamp","expiresIn","requestFirstToken","code","post","grant_type","then","res","access_token","sessionStorage","setItem","expires_in","refresh_token","setTimeout","requestRefreshToken","catch","err","getItem","router","isAuthorized","undefined","e","tokenExpired","timeLeftMilliseconds","setInterval","Math","floor","maxEuclidianPitchDistance","sqrt","maxEuclidianTimbreDistance","pow","cosine","b","adotv","amag","bmag","cosineTransposed","transposedI","euclidianDistance","squaredDistance","euclidianDistanceTransposed","squaredDistanceTransposed","euclidianTimbre","euclidianPitchTransposed","dist","diff","Vue","use","Vuex","Store","browser","user","selectedIndex","loadingTrack","playerReady","playing","seeker","seekerUpdateSpeed","isZoomed","zoomScale","playerActive","inputFocus","mutations","setSeeker","time_ms","setUser","setPlayerState","playerState","addToTrackList","addToTrackListIndex","addToTrackListFront","unshift","clearTrackList","setSelectedIndex","setPlaying","incrementSeeker","increment","setZoomed","zoomed","toggleZoomed","setPlayerActive","setInputFocus","focus","actions","getters","selectedTrack","isInputFocused","d3","require","circleOfFifths","keyNames","scaleLinear","domain","interpolate","interpolateHcl","range","rgb","PI","TWO_PI","tonality","pitches","x","y","energy","vangle","vradius","cos","sin","angle","atan2","radius","loudnessPerceived","db","tryRemovePercussion","equalizeBass","SpotifySegment","segment","start","duration","loudness_start","loudness_max","loudness_max_time","loudness_end","processPitch","processPitchEqualizeBass","processedPitch","processedPitchSmooth","Error","pitch","audioUtil","tonalityAngle","tonalityRadius","tonalityEnergy","minDuration","decay","shortness","noise","max","percussiony","min","reduce","sum","val","prevSegment","nextSegment","maxPitch","secondMaxPitch","equalizeAmount","scale","biggest","totalBiggest","processedTimbre","timbre","timbres","timbresScaled","duration_ms","concat","coord","tsneCoord","nextSegmentLoudness","loudnessFeatures","getLoudnessFeatures","end","maxTime","avgFirst","avgSecond","avg","chords","major","weight","template","minor","sus2","sus4","dim","aug","maj7","seven","min7","min6","min7b5","minmaj7","sus27","sus47","dim6","maj7sharp5","pureMajorMinor","majorminor","popchords","getConfidence","chord","bassNote","getBassNote","similarity","maxIndex","getHighestConfidenceChord","chordSet","maxChord","maxConfidence","confidence","getMajorMinorNess","majorness","minorness","getPopChord","generate1DgaussianKernel","size","sigma","kernel","meanIndex","exp","gaussianBlur2DOptimized","matrixSize","getSize","fullKernelSize","kernel1D","blurredMatrix","from","fill","kx","getValueMirrored","blurredMatrixSecondPass","ky","gaussianBlurFeatures","blurredFeatures","featureAmount","newVector","f","kernelSum","k","medianFilterFeatures","resolution","buckets","filteredFeatures","totalValues","valNormalized","middle","median","gaussianBlur1D","array","edgeStrategy","blurredArray","absoluteEuclideanColumnDerivative","ssmSize","width","novelty","differenceSum","currentValue","getValueNormalizedMirrored","nextValue","difference","featureDerivative","derivative","Array","findPeaks","peaks","sample","height","maxima","minima","maxi","leftMinima","rightMinima","smallestMinima","assert","maxPeakHeightDiff","computeFitness","pathFamily","pathScores","score","pathAmount","pathFamilyLength","normalizedScore","coverage","computeInducedCoverage","normalizedCoverage","fitness","prunedPathFamily","pathEndY","pathStartY","abs","createScoreMatrixBuffer","Number","NEGATIVE_INFINITY","knightMoveRatio","knightMoveTweak","computeAccumulatedScoreMatrix","D","getSampleAmount","penalty","penalize","getValueNormalized","down","right","diag","computeOptimalPathFamily","path","predecessors","Uint16Array","predecessorLength","getScoresForPathFamily","scoreMatrix","endX","endY","endValue","startX","startY","startValue","pathScore","visualizationMatrix","scoreMatrixBuffer","P","PScores","familyFitness","maxVal","minVal","POSITIVE_INFINITY","sizeD","numberType","NumberType","UINT8","getValue","setValue","x2","pseudoInverse","inverse","solve","linearDependencies","QrDecomposition","LuDecomposition","CholeskyDecomposition","EigenvalueDecomposition","getMDSFeature","distanceMatrix","feature","lr","maxSteps","minLossDifference","momentum","logEvery","classicalMDS","getNestedArray","map","getMDSCoordinates","strategy","coords","learnRates","best","bestLoss","rate","getMdsCoordinatesWithGradientDescentMatrix","lossPerStep","coordinates","isNaN","getMdsCoordinatesWithGaussNewton","normalize2DCoordinates","distances","numCoordinates","rows","getInitialMdsCoordinates","accumulation","step","loss","getMdsLoss","lossPrev","coordIndex","gradient","getGradientForCoordinate","add","mul","update","updatedCoordinates","sub","getRowVector","setRow","dimensions","columns","getResidualsWithJacobian","residuals","jacobian","mmul","dimension","updateIndex","paramValue","updateDelta","updatedValue","set","seed","randomUniform","rand","random","seedrandom","div","normalizer","coordIndex1","coordIndex2","coord1","coord2","target","predicted","norm","zeros","squaredDifferenceSum","residual","residualWrtPredicted","predictedWrtSquaredDifferenceSum","squaredDifferenceSumWrtCoord1","residualWrtCoord1","rowIndex","columIndex","jacobianEntry","entryUpdated","columnVector","otherCoordIndex","otherCoord","targets","lossWrtPredicted","squaredDifferenceSumWrtCoord","lossWrtCoord","M","numeric","mean","A","rowMeans","colMeans","transpose","totalMean","ret","svd","eigenValues","S","U","row","getAngleAndRadius","mdsCoordinate","centerX","centerY","maxRadius","calculateSSM","similarityFunction","fillFeaturesNormalized","sim","Section","args","startSample","endSample","groupID","mdsFeature","colorAngle","colorRadius","otherSection","_","covers","splits","disjoint","amountOfSectionsAfterSubtract","clipsEnd","clipsStart","left","clone","thisClone","subtract","createSegmentsFromNovelty","noveltyDetection","filter","peak","structureSegments","MDSColorGivenDistanceMatrix","segments","coloringStrategy","coloredSegments","MdsCoordinates","mds","MdsFeature","newSegment","sort","largestGap","largestGapAngle","gap","MDSColorTimbreSegmentsWithFeatures","amount","FLOAT32","segmentVectors","vector","processTimbreSegments","mdsColoredSegments","timbreNormalizationAmount","Features","analysisData","loudness","dynamics","tonalEnergy","tonalRadius","tonalAngle","ceil","samples","sampleBlur","fillBeatsStartDuration","beats","calculateMaxMin","timbreBiggest","timbreTotalBiggest","processSegments","processDirectLoudness","sampleFeatures","processSamples","downSampledTimbre","downSampleTimbre","downsampleAmount","fastSampleDuration","sampled","segmentationSmoothingLength","round","continuousSmoothingLength","ssmTimbre","SSM","blurredTimbreLarge","segmentationSmoothedFeatures","segmentationDerivative","smoothedSegmentationDerivative","structure","segmentedFeatures","featureSegment","smoothedFeatureSegment","frankenFeatures","smoothedTimbre","medianFeatures","timbreMax","getOriginalTimbres","timbreMin","beat","raw","processed","nextSegmentStartLoudness","getAverageLoudness","processTimbre","processPitchSmooth","clusterSelection","tsneSelection","directLoudnessAmount","directLoudnessSampleDuration","directLoudness","segmentIndex","time","isTimeInSegment","getExactLoudness","startTime","chordDetection","smoothedAvgLoudness","averageLoudness","maxLoudness","dynamicsBase","dynamic","sampledFeature","averageFeature","sampleStart","sampleEnd","getEnd","sampleStartDuration","lastSampleStart","initSampleFeatures","blurDuration","blurOutsideSampleDuration","segmentEnd","sampleRangeStartIndex","sampleRangeEndIndex","rangeSize","firstSample","sampleBlurEnd","firstSampleOverlap","addFeaturesScaled","sampleBlurStart","lastSampleOverlap","divideFeatures","downSampleAmount","downSampleRatio","startIndex","endIndex","startSampleWeight","endSampleWeight","summedTimbre","featureName","featureSize","sampleIndex","scalar","divisor","PHI","colorWheel","zeroOneColor","interpolator","zeroOneColorWarm","pitchColor","sinebowColorNormalized","divergingColor","goldenRatioCategoricalColor","offset","opacity","g","categoryColor","categoryColorWithOpacity","sinebowColorNormalizedRadius","colorHSL","circleOfFifthsColor","circleOfFifthsColorBrightness","brightness","renderWaveform","ctx","fillStyle","detailed","beginPath","moveTo","startVolume","maxVolume","lineTo","closePath","fillRect","drawAnchorPoints","canvasWidth","ancholor","anchorAmount","halfWidth","scaleFromTopLeft","anchorX","anchorY","anchorAngle","hex","drawScapePlot","clearRect","minSize","Track","stepSize","forEachCell","anchorColorLerp","rectX","rectY","cellX","cellY","aAngle","bAngle","aDist","Infinity","bDist","closenessToB","angleLerp","angleA","angleB","distClock","distAntiClock","maxTimbreDownSamples","useSampled","harmonicStructureCourse","harmonicStructure","tsneCoords","groundTruth","getName","separators","section","processing","workers","chordsVector","tonalityFeatureSmall","tonalityFeatureLarge","keyFeature","$on","harmonicStructureListener","eventListenerSet","$off","timbreStructure","events","segmentedTimbreGraph","updatingTimbreGraphVis","timbreFeatureGraph","getID","getSegmentStartDuration","diffBack","graphFeatures","structures","structureSections","optimalStructure","courseStructure","fineStructure","strictpath","getMatrixByName","pathExtraction","minK","maxK","tries","clusters","prevCluster","clusterSections","tsneListener","minDist","closestSegment","alreadyPlacedMarkerIndex","markers","findIndex","marker","vis","markersCreated","formatHex","label","String","fromCharCode","toUpperCase","hasVisualization","analysis","process","artist","uri","transpositionInvariantSSM","bars","tatums","setAnalysis","json","createWithAnalysis","namespaces","coarse","function","fine","getAllTestSets","keys","sets","getTracks","setKey","tracks","query","getQuery","file_metadata","title","replace","folder","prefix","Isophonics_1","Isophonics_01","Isophonics_2","Isophonics_02","Isophonics_03","Isophonics_04","Isophonics_05","Isophonics_06","Isophonics_07","Isophonics_08","Isophonics_09","Isophonics_10","Isophonics_11","Isophonics_12","Isophonics_13","Isophonics_14","Isophonics_15","Isophonics_16","Isophonics_17","Isophonics_18","Isophonics_CD1","Isophonics_CD2","templateSegment","templateElement","SynthesizedTrack","synthesizerString","sections","pitchSSM","synthesizeSSMPitch","timbreSSM","synthesizeSSMTimbre","blurTime","getBuffer","preset","split","sectionLength","ySection","yIndex","yOffset","xSection","xIndex","xOffset","setValueNormalizedMirrored","spotify","SpotifyWebApi","allTracks","Map","initialize","setAccessToken","auth","getMe","store","localTrackId","localStorage","firstTrack","getPlaylistTracks","items","getMyTopTracks","limit","topTracks","loadTracksFromSpotify","selectTrackAtIndex","newTrack","deselect","getAnalysis","hasAnalysis","reload","getAudioAnalysisForTrack","keepCurrentTrack","has","results","loadArtistTopTracks","artistID","getArtistTopTracks","loadTestSet","testSetKey","testSetTracks","spotifyTracks","spotifySearches","spotifyTrack","all","synthesize","props","components","Album","computed","selectedFromStore","watch","mounted","methods","selectedChanged","selectedFromStoreChanged","newIndex","VSlideGroup","VSlideItem","tsneReady","tsneSize","tsneCoordX","tsneCoordY","clusterColor","isPlayingSample","tsneDynamics","playingSample","clusterSection","samplePosNormalized","seekerNormalized","selectedTab","selectedStructure","secondsToXPosition","getCategoryColor","showPaths","pathIndex","generateLine","showPathStart","fillSections","webGLCanvas","canvas","useColor","join","gl","getContext","alert","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","vertexShaderTextColor","fragmentShaderTextColor","vertexShaderTextGreyscale","fragmentShaderTextGreyscale","compileShader","getShaderParameter","COMPILE_STATUS","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","validateProgram","VALIDATE_STATUS","translateLoc","getUniformLocation","scaleLoc","getProgramInfoLog","getProgramInfoLof","getShaderInfoLog","viewport","bufferData","bufferSize","verts","rectangleVertexBufferObject","createBuffer","bindBuffer","ARRAY_BUFFER","STATIC_DRAW","colorBufferObject","colors","vertAttribLocation","getAttribLocation","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","enableVertexAttribArray","colorAttribLocation","translateX","translateY","scaleX","scaleY","useProgram","uniform2f","drawArrays","TRIANGLES","WebGLMatrixPool","matrixBufferPool","createDataArray","setBufferData","xCenterPositionNormalized","halfDuration","getAnalysisDuration","st","pos","ssmVertices","isMatrix","v","top","bottom","WebGL","clickedSVG","rightClick","isVertical","useZoom","showMarkerLabel","seekerColor","drawMarkers","markerOpacity","autoConnect","deviceId","player","playedTrackBefore","trackURI","loadTrack","pause","seekMS","getURI","play","uris","position_ms","locallyResumed","resume","locallyPaused","seek","seekS","time_seconds","lastSeekerIntervalPoll","setVolume","stateChangedCallback","newState","current_track","position","performance","now","getMyCurrentPlaybackState","is_playing","startSeekerInterval","elapsed","waitForSpotifyWebPlaybackSDKToLoad","Spotify","Player","getOAuthToken","cb","addListener","track_window","device_id","deviceIdArray","transferMyPlayback","connect","transferPlayback","releasePlayback","getMyDevices","devices","device","is_active","onSpotifyWebPlaybackSDKReady","newSeeker","oldSeeker","newPlaying","oldPlaying","normalizeTime","markerLabelHeight","_k","keyCode","button","clickedMarker","doubleClickMarker","isShowingEdit","blur","$set","VColorPicker","VTextField","VRow","VSelect","VSpacer","VSwitch","VTab","VTabs","ZoomCanvas","trackDuration","applyRenderMode","drawFunction","clearInterval","drawLoop","clearAndDraw","getSeekerNormalized","startNormalized","getOffsetXNormalized","borderSize","borderColor","text","font","fillText","hasFeatures","expanded","parseFloat","toFixed","VExpandTransition","VIcon","featureHeight","WebGLPitchTimbre","featureSelection","pitchTimbreBufferPool","inverseBufferPoolLength","bufferPoolLength","featureObject","createSegmentFeatureDataArray","marginPercentage","startDuration","segmentAmount","vectorSize","inverseVectorSize","centeredRange","featureVertices","separateByGroup","clickStructureUnfold","verticalPosition","showLoudness","clickStructureshowLoudness","clickStructureChangeVertical","vertLayout","layouts","clickStructureChangeColor","colorLayout","refInFor","heightOfStructure","unhover","clickBackground","sectionVerticalPosition","blockHeight","sectionColor","hoverSection","unhoverSection","clickSection","generatePointsForShapedSection","showTooltip","domProps","toolTipText","VTooltip","catColoring","showHelp","sectionHeight","paddingTop","spaceBetweenCourseFine","groupAmount","hasStructure","showMDS","glowOpacity","seekerIsInSection","glowRectSize","shapedSectionPath","hover","click","separator","backgroundColor","separatorColor","_t","VCol","VSkeletonLoader","eventSize","eventHeight","clickEvent","gradientStep","currentColor","colorGradient","currentY","gradientColoring","seekerInEvent","collapsed","clickCanvas","co5Size","keyNumber","keyName","currentAngleSlow","tonalityPointerPath","tonalitySlow","currentAngle","chordGapOffset","clickedChord","isMajor","colorBrightness","chordNameHeight","offsetHeight","avgPos","showPath","showPathGradient","timbreFeatureGraphPath","sampleWidth","sliderValue","disabled","mousedown","timbreSlider","solod","solo","muted","mute","resetSliders","setPreset","presets","test","VSlider","playPause","clickedWaveform","VHover","VProgressCircular","VProgressLinear","VAppBar","VContainer","VToolbarTitle","VToolbar","spotifyAuthorize","VCardSubtitle","VCardTitle","VLayout","VueRouter","routes","Login","beforeEnter","to","next","params","Callback","base","Vuetify","theme","dark","themes","light","primary","secondary","accent","success","warning","config","productionTip","vuetify","render","h","App","$mount","isOpera","opr","addons","opera","isFirefox","InstallTrigger","isSafari","HTMLElement","toString","safari","pushNotification","isIE","document","documentMode","isEdge","StyleMedia","isChrome","chrome","webstore","runtime","getNumberTypeByName","fillByIndex","values","heigth","number","fromHalfMatrix","halfMatrix","timeLagMatrix","lag","halfMatrixLeft","halfMatrixRight","webpackContext","req","webpackContextResolve","cellsBefore","featureIndex","nestedArray","meanSquared","sd","deltaMean","deltaDeviation","getMeanAndStandardDeviation","fromMatrix","freeze","Uint8Array","UINT16","UINT32","Uint32Array","INT8","Int8Array","INT16","Int16Array","INT32","Int32Array","FLOAT64","Float64Array","objectOrString"],"mappings":"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","file":"js/app.4fceca54.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = this[\"webpackJsonp\"] = this[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreGraph.vue?vue&type=style&index=0&id=5c7598a9&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreGraph.vue?vue&type=style&index=0&id=5c7598a9&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Callback.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Callback.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GraphSection.vue?vue&type=style&index=0&id=5c6cc0ec&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GraphSection.vue?vue&type=style&index=0&id=5c6cc0ec&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreStructure.vue?vue&type=style&index=0&id=09646f45&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreStructure.vue?vue&type=style&index=0&id=09646f45&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chords.vue?vue&type=style&index=0&id=77fbb0a5&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chords.vue?vue&type=style&index=0&id=77fbb0a5&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreSegmentedGraph.vue?vue&type=style&index=0&id=56312774&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreSegmentedGraph.vue?vue&type=style&index=0&id=56312774&scoped=true&lang=css&\"","import Matrix from \"../dataStructures/Matrix\";\r\nimport HalfMatrix from \"../dataStructures/HalfMatrix\";\r\nimport * as log from \"../../dev/log\";\r\n\r\nexport async function init() {\r\n    //ssm = new Worker(\"./ssmWorker.js\", { type: \"module\" });\r\n    timbreGraphWorker = new Worker(\"./timbreGraphWorker.js\", { type: \"module\" });\r\n    timbreStructureWorker = new Worker(\"./timbreStructureWorker.js\", { type: \"module\" });\r\n    harmonicStructureWorker = new Worker(\"./harmonicStructureWorker.js\", { type: \"module\" });\r\n    chordWorker = new Worker(\"./chordWorker.js\", { type: \"module\" });\r\n\r\n    //tsneWorker = new Worker(\"./tsneWorker.js\", { type: \"module\" });\r\n    // clusterWorker = new Worker(\"./clusterWorker.js\", { type: \"module\" });\r\n}\r\n\r\nlet isCalculating = false;\r\n\r\nlet timbreGraphWorker;\r\nlet timbreGraphWorkerBusy = false;\r\nexport async function updateTimbreGraphVis(timbreFeatures, timbreSliders, sampleDuration) {\r\n    return new Promise((resolve) => {\r\n        if (timbreGraphWorkerBusy) {\r\n            timbreGraphWorker.terminate();\r\n            timbreGraphWorker = new Worker(\"./timbreGraphWorker.js\", { type: \"module\" });\r\n        }\r\n        timbreGraphWorker.postMessage({\r\n            timbreFeatures,\r\n            timbreSliders,\r\n            sampleDuration,\r\n            timestamp: new Date(),\r\n        });\r\n        timbreGraphWorkerBusy = true;\r\n\r\n        timbreGraphWorker.onmessage = (event) => {\r\n            timbreGraphWorkerBusy = false;\r\n            const sendBackTime = new Date() - event.data.timestamp;\r\n            log.debug(\"Got back from timbreGraphworker\", sendBackTime);\r\n            resolve(event.data.result);\r\n        };\r\n    });\r\n}\r\n\r\nlet timbreStructureWorker;\r\nlet timbreStructureWorkerBusy = false;\r\nexport async function computeTimbreStructure(timbreFeatures, sampleDuration) {\r\n    return new Promise((resolve) => {\r\n        if (timbreStructureWorkerBusy) {\r\n            timbreStructureWorker.terminate();\r\n            timbreStructureWorker = new Worker(\"./timbreStructureWorker.js\", { type: \"module\" });\r\n        }\r\n        timbreStructureWorker.postMessage({\r\n            timbreFeatures,\r\n            sampleDuration,\r\n        });\r\n        timbreStructureWorkerBusy = true;\r\n\r\n        timbreStructureWorker.onmessage = (event) => {\r\n            timbreStructureWorkerBusy = false;\r\n            log.debug(\"Got back from timbreStructureWorker\", event.data);\r\n            resolve(event.data);\r\n        };\r\n    });\r\n}\r\n\r\nlet harmonicStructureWorker;\r\nlet harmonicStructureWorkerBusy = false;\r\nexport async function computeHarmonicStructure(options) {\r\n    return new Promise((resolve) => {\r\n        if (harmonicStructureWorkerBusy) {\r\n            harmonicStructureWorker.terminate();\r\n            harmonicStructureWorker = new Worker(\"./harmonicStructureWorker.js\", { type: \"module\" });\r\n        }\r\n        harmonicStructureWorker.postMessage(options);\r\n        harmonicStructureWorkerBusy = true;\r\n\r\n        harmonicStructureWorker.onmessage = (event) => {\r\n            if (event.data.state === \"done\") {\r\n                harmonicStructureWorkerBusy = false;\r\n\r\n                resolve(event.data);\r\n            }\r\n            if (event.data.state === \"processing\") {\r\n                window.eventBus.$emit(\"harmonicStructure\", event.data);\r\n            }\r\n            //resolve(event.data);\r\n        };\r\n    });\r\n}\r\n\r\nlet chordWorker;\r\nlet chordWorkerBusy = false;\r\nexport async function computeChords(pitchFeatures, fastSampledPitch, sampleDuration, fastSampledPitchDuration) {\r\n    return new Promise((resolve) => {\r\n        if (chordWorkerBusy) {\r\n            chordWorker.terminate();\r\n            chordWorker = new Worker(\"./chordWorker.js\", { type: \"module\" });\r\n        }\r\n        chordWorker.postMessage({\r\n            pitchFeatures,\r\n            fastSampledPitch,\r\n            sampleDuration,\r\n            fastSampledPitchDuration,\r\n        });\r\n        chordWorkerBusy = true;\r\n\r\n        chordWorker.onmessage = (event) => {\r\n            chordWorkerBusy = false;\r\n            log.debug(\"Got back from chordWorker\", event.data);\r\n            resolve(event.data);\r\n        };\r\n    });\r\n}\r\n\r\nlet ssm;\r\n/**\r\n *\r\n * @param {*} trackId\r\n * @param {*} pitchFeatures\r\n * @param {*} timbreFeatures\r\n * @param {*} segmentStartDuration\r\n * @param {*} options {blurTime 4, threshold: 0.5, allPitches: false }\r\n */\r\nexport async function startSSM(\r\n    trackId,\r\n    pitchFeatures,\r\n    timbreFeatures,\r\n    avgLoudness,\r\n    sampleDuration,\r\n    segmentStartDuration,\r\n    beatsStartDuration,\r\n    options = {}\r\n) {\r\n    return new Promise((resolve) => {\r\n        const enhanceBlurLength = options.enhanceBlurLength || 4;\r\n        const threshold = options.threshold || 0.5;\r\n        const thresholdPercentage = options.thresholdPercentage || 0.05;\r\n        const allPitches = options.allPitches || false;\r\n        const tempoRatios = options.tempoRatios || [1];\r\n        const SPminSize = options.SPminSize || 4;\r\n        const SPstepSize = options.SPstepSize || 1;\r\n        const createScapePlot = options.createScapePlot || false;\r\n        const synthesized = options.synthesized || false;\r\n        const synthesizedSSMPitch = options.synthesizedSSMPitch || null;\r\n        const synthesizedSSMTimbre = options.synthesizedSSMTimbre || null;\r\n        const sampleAmount = options.sampleAmount || segmentStartDuration.length;\r\n        if (isCalculating) {\r\n            ssm.terminate();\r\n            ssm = new Worker(\"./ssmWorker.js\", { type: \"module\" });\r\n        }\r\n\r\n        ssm.postMessage({\r\n            pitchFeatures,\r\n            timbreFeatures,\r\n            avgLoudness,\r\n            sampleDuration,\r\n            sampleAmount,\r\n            segmentStartDuration,\r\n            beatsStartDuration,\r\n            id: trackId,\r\n            timestamp: new Date(),\r\n            allPitches,\r\n            enhanceBlurLength,\r\n            tempoRatios,\r\n            threshold,\r\n            thresholdPercentage,\r\n            SPminSize,\r\n            SPstepSize,\r\n            createScapePlot,\r\n            synthesized,\r\n            synthesizedSSMPitch,\r\n            synthesizedSSMTimbre,\r\n        });\r\n        isCalculating = true;\r\n\r\n        ssm.onmessage = (event) => {\r\n            if (event.data.messageType === \"update\") {\r\n                window.eventBus.$emit(\"update\", event.data.message);\r\n            }\r\n            if (event.data.messageType === \"final\") {\r\n                isCalculating = false;\r\n                const result = event.data.message;\r\n                if (result.id === trackId) {\r\n                    if (createScapePlot) {\r\n                        result.scapePlot = new HalfMatrix(result.scapePlot);\r\n                        result.scapePlotAnchorColor = new Float32Array(result.scapePlotAnchorColor);\r\n                    }\r\n\r\n                    result.matrixes.forEach((matrix) => {\r\n                        if (matrix.buffer.type === \"Matrix\") {\r\n                            matrix.matrix = new Matrix(matrix.buffer);\r\n                        } else if (matrix.buffer.type === \"HalfMatrix\") {\r\n                            matrix.matrix = new HalfMatrix(matrix.buffer);\r\n                        }\r\n                        delete matrix.buffer;\r\n                    });\r\n\r\n                    result.graphs.forEach((graph) => {\r\n                        graph.data = new Float32Array(graph.buffer);\r\n                        delete graph.buffer;\r\n                    });\r\n\r\n                    resolve(result);\r\n                }\r\n            }\r\n        };\r\n    });\r\n}\r\n\r\nlet tsneWorker;\r\nlet tsneWorkerBusy = false;\r\nexport async function tsne(features) {\r\n    log.debug(features);\r\n    return new Promise((resolve) => {\r\n        if (tsneWorkerBusy) {\r\n            tsneWorker.terminate();\r\n            tsneWorker = new Worker(\"./tsneWorker.js\", { type: \"module\" });\r\n        }\r\n        tsneWorker.postMessage(features);\r\n        tsneWorkerBusy = true;\r\n\r\n        tsneWorker.onmessage = (event) => {\r\n            if (event.data.state === \"done\") {\r\n                tsneWorkerBusy = false;\r\n                window.eventBus.$emit(\"tsneReady\", event.data.result);\r\n                resolve(event.data.result);\r\n            }\r\n            if (event.data.state === \"processing\") {\r\n                window.eventBus.$emit(\"tsneReady\", event.data.result);\r\n            }\r\n        };\r\n    });\r\n}\r\n\r\nlet clusterWorker;\r\nlet clusterWorkerBusy = false;\r\nexport async function cluster(features) {\r\n    return new Promise((resolve) => {\r\n        if (clusterWorkerBusy) {\r\n            clusterWorker.terminate();\r\n            clusterWorker = new Worker(\"./clusterWorker.js\", { type: \"module\" });\r\n        }\r\n        clusterWorker.postMessage(features);\r\n        clusterWorkerBusy = true;\r\n\r\n        clusterWorker.onmessage = (event) => {\r\n            clusterWorkerBusy = false;\r\n            log.debug(\"Got back from clusterWorker\", event.data);\r\n            resolve(event.data);\r\n        };\r\n    });\r\n}\r\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Matrixes.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Matrixes.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Events.vue?vue&type=style&index=0&id=6ddf69af&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Events.vue?vue&type=style&index=0&id=6ddf69af&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Structure.vue?vue&type=style&index=0&id=7a056106&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Structure.vue?vue&type=style&index=0&id=7a056106&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ScapePlot.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ScapePlot.vue?vue&type=style&index=0&lang=css&\"","module.exports = __webpack_public_path__ + \"img/7.8d926c63.png\";","module.exports = __webpack_public_path__ + \"img/2.195360cd.png\";","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Section.vue?vue&type=style&index=0&id=163b000b&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Section.vue?vue&type=style&index=0&id=163b000b&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Beats.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Beats.vue?vue&type=style&index=0&lang=css&\"","const argPlaceholder = navigator.userAgent.indexOf(\"Chrome\") != -1 ? \"%O\" : \"%O\";\r\nexport const levels = {\r\n    DEBUG: { name: \"Debug\", id: 0, color: \"#40A0EE\", bg: \"#204099\" },\r\n    INFO: { name: \"Info\", id: 1, color: \"#2DE974\", bg: \"#187639\" },\r\n    WARN: { name: \"Warn\", id: 2, color: \"darkorange\", bg: \"darkorange\" },\r\n    ERROR: { name: \"Error\", id: 3, color: \"red\", bg: \"brown\" },\r\n    FATAL: { name: \"Fatal\", id: 4, color: \"white\", bg: \"brown\" },\r\n};\r\n\r\nlet currentLevel = () => levelStack[levelStack.length - 1];\r\nlet levelStack = [levels.INFO];\r\n\r\nexport let debug;\r\nexport let info;\r\nexport let warn;\r\nexport let error;\r\nexport let fatal;\r\nupdateLogs(currentLevel());\r\n\r\nfunction updateLogs(currentLevel) {\r\n    debug =\r\n        currentLevel.id <= levels.DEBUG.id\r\n            ? console.debug.bind(\r\n                  console,\r\n                  `%c Debug %c\\t%c${argPlaceholder}`,\r\n                  `color:white;background:${levels.DEBUG.bg};font-style:italic`,\r\n                  `color:${levels.DEBUG.color}`,\r\n                  `color:${levels.DEBUG.color}`\r\n              )\r\n            : function() {};\r\n\r\n    info =\r\n        currentLevel.id <= levels.INFO.id\r\n            ? console.info.bind(\r\n                  console,\r\n                  `%c Info  %c\\t%c${argPlaceholder}`,\r\n                  `color:white;background:${levels.INFO.bg};font-style:italic`,\r\n                  `color:${levels.INFO.color}`,\r\n                  `color:${levels.INFO.color}`\r\n              )\r\n            : function() {};\r\n\r\n    warn =\r\n        currentLevel.id <= levels.WARN.id\r\n            ? console.warn.bind(\r\n                  console,\r\n                  `%c Warn  %c\\t%c${argPlaceholder}`,\r\n                  `color:white;background:${levels.WARN.bg};font-style:italic`,\r\n                  `color: ${levels.WARN.color}`,\r\n                  `color:${levels.WARN.color}`\r\n              )\r\n            : function() {};\r\n\r\n    error =\r\n        currentLevel.id <= levels.ERROR.id\r\n            ? console.error.bind(\r\n                  console,\r\n                  `%c Error %c\\t%c${argPlaceholder}`,\r\n                  `color:white;background:${levels.ERROR.bg};font-style:italic`,\r\n                  `color: ${levels.ERROR.color}`,\r\n                  `color: ${levels.ERROR.color}`\r\n              )\r\n            : function() {};\r\n\r\n    fatal =\r\n        currentLevel.id <= levels.FATAL.id\r\n            ? console.error.bind(\r\n                  console,\r\n                  `%c Fatal \\t%c${argPlaceholder}`,\r\n                  `color: ${levels.FATAL.color}; background: ${levels.FATAL.bg};font-weight:bold`,\r\n                  `color: ${levels.FATAL.color}; background: ${levels.FATAL.bg};font-weight:bold`\r\n              )\r\n            : function() {};\r\n}\r\n\r\nexport function push(level) {\r\n    levelStack.push(level);\r\n    updateLogs(currentLevel());\r\n}\r\n\r\nexport function pop() {\r\n    levelStack.pop();\r\n    updateLogs(currentLevel());\r\n}\r\n","module.exports = __webpack_public_path__ + \"img/3.f741c501.png\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',{attrs:{\"id\":\"app\",\"dark\":true}},[_c('router-view')],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <v-app id=\"app\" :dark=\"true\">\r\n        <router-view />\r\n    </v-app>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: \"App\",\r\n\r\n    components: {},\r\n    beforeCreate() {\r\n        window.onSpotifyWebPlaybackSDKReady = () => {\r\n            console.log(\"The Web Playback SDK is ready. We have access to Spotify.Player\");\r\n        };\r\n    },\r\n    data: () => ({\r\n        //\r\n    }),\r\n    mounted: function() {\r\n        let elHtml = document.getElementsByTagName(\"html\")[0];\r\n        elHtml.style.overflowY = \"auto\";\r\n    },\r\n    destroyed: function() {\r\n        let elHtml = document.getElementsByTagName(\"html\")[0];\r\n        elHtml.style.overflowY = null;\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\nhtml {\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\nbody {\r\n    overflow: hidden;\r\n}\r\n::-webkit-scrollbar {\r\n    display: none;\r\n}\r\n:not(input):not(textarea),\r\n:not(input):not(textarea)::after,\r\n:not(input):not(textarea)::before {\r\n    -webkit-user-select: none;\r\n    user-select: none;\r\n}\r\ninput,\r\nbutton,\r\ntextarea,\r\n:focus {\r\n    outline: none;\r\n}\r\n\r\nbutton {\r\n    cursor: pointer;\r\n}\r\n</style>\r\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=de1a5a1e&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\ninstallComponents(component, {VApp})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"track\"},[_c('v-app-bar',{attrs:{\"dark\":\"\"}},[_c('v-toolbar-title',[_vm._v(\"Music Structure Visualizer\")]),_c('v-spacer'),(!_vm.testing && !_vm.synthesizing)?_c('form',{on:{\"submit\":function($event){$event.preventDefault();return _vm.search($event)}}},[_c('v-text-field',{attrs:{\"label\":\"Search for songs\",\"hide-details\":\"\",\"append-icon\":\"mdi-magnify\",\"single-line\":\"\",\"rounded\":\"\",\"dense\":\"\",\"filled\":\"\"},on:{\"focus\":function($event){return _vm.$store.commit('setInputFocus', true)},\"blur\":function($event){return _vm.$store.commit('setInputFocus', false)}},model:{value:(_vm.searchQuery),callback:function ($$v) {_vm.searchQuery=$$v},expression:\"searchQuery\"}})],1):_vm._e(),_c('v-spacer'),_c('div',{staticClass:\"volumeSlider\"},[_c('v-container',[_c('v-slider',{attrs:{\"prepend-icon\":_vm.getVolumeIcon(),\"min\":0,\"max\":1,\"step\":0.02},on:{\"click:prepend\":_vm.clickVolume},model:{value:(_vm.volume),callback:function ($$v) {_vm.volume=$$v},expression:\"volume\"}})],1)],1),_c('v-btn',{attrs:{\"icon\":\"\"},on:{\"click\":function($event){return _vm.share()}}},[_c('v-icon',[_vm._v(\"mdi-share-variant\")])],1)],1),(!_vm.synthesizing)?_c('TrackSelector',{attrs:{\"tracks\":_vm.trackList,\"album-size\":120}}):_vm._e(),_c('div',{ref:\"mainContent\",staticClass:\"mainContent\",style:(_vm.mainContentStyle)},[(!_vm.synthesizing)?_c('Player',{attrs:{\"width\":_vm.mainContentWidth}}):_vm._e(),_c('Visualization',{attrs:{\"width\":_vm.mainContentWidth,\"showPrototype\":_vm.showPrototype}}),_c('v-btn',{staticClass:\"readMore\",staticStyle:{\"color\":\"#aaa\"},on:{\"click\":function($event){return _vm.readMore()}}},[_c('v-icon',{staticStyle:{\"margin-right\":\".5em\"}},[_vm._v(\"mdi-book-information-variant\")]),_vm._v(\" Read about this project \")],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('v-slide-group',{staticClass:\"pt-2\",attrs:{\"center-active\":\"\",\"mandatory\":\"\"},nativeOn:{\"scroll\":function($event){return _vm.onScroll($event)}},model:{value:(_vm.selected),callback:function ($$v) {_vm.selected=$$v},expression:\"selected\"}},_vm._l((_vm.tracks),function(track,index){return _c('v-slide-item',{key:index,staticClass:\"mx-2 my-1\",scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar active = ref.active;\nvar toggle = ref.toggle;\nreturn [_c('Album',{attrs:{\"album\":track.trackData,\"imgSize\":active ? _vm.albumSize * 1.5 : _vm.albumSize,\"active\":active},on:{\"clicked\":toggle,\"clickedArtist\":function($event){return _vm.clickedArtist(track)}}})]}}],null,true)})}),1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-card',{class:_vm.active ? 'elevation-3' : 'elevation-0',style:(_vm.cardStyle)},[_c('div',{directives:[{name:\"ripple\",rawName:\"v-ripple\"}],staticClass:\"track\",on:{\"click\":_vm.clicked}},[_c('v-img',{attrs:{\"height\":_vm.imgSize,\"width\":_vm.imgSize,\"src\":_vm.album.album.images[_vm.imgIndex].url}}),_c('v-card-text',{staticClass:\"pl-2 py-0 pt-1 ml-0 my-0\"},[_c('div',{staticClass:\"text-subtitle-2 text--primary text-truncate\"},[_vm._v(\" \"+_vm._s(_vm.album.name)+\" \")])])],1),_c('v-card-actions',{staticClass:\"pl-0 py-0 ml-0 my-0\"},[_c('v-btn',{staticClass:\"artistButton\",attrs:{\"text\":\"\",\"color\":\"grey\",\"small\":\"\"},on:{\"click\":function($event){return _vm.clickedArtist()}}},[_c('span',{staticClass:\"artistButtonText text-caption text-truncate\",style:({ 'max-width': this.imgSize - 12 + 'px' })},[_vm._v(\" \"+_vm._s(_vm.album.artists[0].name)+\" \")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <v-card :style=\"cardStyle\" :class=\"active ? 'elevation-3' : 'elevation-0'\">\r\n        <div class=\"track\" v-ripple @click=\"clicked\">\r\n            <v-img :height=\"imgSize\" :width=\"imgSize\" :src=\"album.album.images[imgIndex].url\"></v-img>\r\n            <v-card-text class=\"pl-2 py-0 pt-1 ml-0 my-0\">\r\n                <div class=\"text-subtitle-2 text--primary text-truncate\">\r\n                    {{ album.name }}\r\n                </div>\r\n            </v-card-text>\r\n        </div>\r\n        <v-card-actions class=\"pl-0 py-0 ml-0 my-0\">\r\n            <v-btn class=\"artistButton\" text color=\"grey\" small @click=\"clickedArtist()\">\r\n                <span\r\n                    class=\"artistButtonText text-caption text-truncate\"\r\n                    :style=\"{ 'max-width': this.imgSize - 12 + 'px' }\"\r\n                >\r\n                    {{ album.artists[0].name }}\r\n                </span>\r\n            </v-btn>\r\n        </v-card-actions>\r\n    </v-card>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    props: [\"album\", \"imgSize\", \"active\"],\r\n    data() {\r\n        return {};\r\n    },\r\n    mounted() {},\r\n    computed: {\r\n        imgIndex() {\r\n            if (this.size <= this.album.album.images[2].height) return 2;\r\n            if (this.size <= this.album.album.images[1].height) return 1;\r\n            return 0;\r\n        },\r\n        cardStyle() {\r\n            return {\r\n                width: this.imgSize + \"px\",\r\n                height: this.imgSize + 55 + \"px\",\r\n            };\r\n        },\r\n    },\r\n    methods: {\r\n        clicked() {\r\n            this.$emit(\"clicked\");\r\n        },\r\n        clickedArtist() {\r\n            this.$emit(\"clickedArtist\");\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.track:hover {\r\n    cursor: pointer;\r\n}\r\n.artistButton {\r\n    text-transform: none !important;\r\n}\r\n.artistButtonText {\r\n    margin-left: -3px;\r\n    margin-right: 0px;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Album.vue?vue&type=template&id=22ff2940&\"\nimport script from \"./Album.vue?vue&type=script&lang=js&\"\nexport * from \"./Album.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Album.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VImg } from 'vuetify/lib/components/VImg';\ninstallComponents(component, {VBtn,VCard,VCardActions,VCardText,VImg})\n\n\n/* vuetify-loader */\nimport installDirectives from \"!../../node_modules/vuetify-loader/lib/runtime/installDirectives.js\"\nimport Ripple from 'vuetify/lib/directives/ripple'\ninstallDirectives(component, {Ripple})\n","import * as log from \"../dev/log\";\r\nimport router from \"../router\";\r\n\r\nimport axios from \"axios\";\r\n\r\nconst port = process.env.SERVER_PORT || 5000;\r\nconst url = (process.env.VUE_APP_HOST_URL || \"http://localhost\" + \":\" + port) + \"/api\";\r\nconst api = axios.create({\r\n    baseURL: url,\r\n    withCredentials: false,\r\n});\r\n\r\nexport let token;\r\nlet tokenTimestamp = new Date();\r\nlet expiresIn = 3600;\r\nlet refreshToken;\r\n\r\nsetInterval(() => {\r\n    log.debug(\"Token expires in\", Math.floor((expiresIn - (new Date() - tokenTimestamp) / 1000) / 60), \"minutes\");\r\n}, 5 * 60000);\r\n\r\nexport async function requestFirstToken(code) {\r\n    await api\r\n        .post(\"spotify/token\", {\r\n            grant_type: \"authorization_code\",\r\n            code: code,\r\n        })\r\n        .then((res) => {\r\n            token = res.data.access_token;\r\n            window.sessionStorage.setItem(\"token\", token);\r\n            expiresIn = res.data.expires_in;\r\n            tokenTimestamp = new Date();\r\n            window.sessionStorage.setItem(\"tokenTimestamp\", new Date());\r\n            refreshToken = res.data.refresh_token;\r\n            window.sessionStorage.setItem(\"refreshToken\", refreshToken);\r\n            setTimeout(requestRefreshToken, expiresIn * 1000);\r\n        })\r\n        .catch((err) => {\r\n            log.error(err);\r\n        });\r\n}\r\n\r\nexport async function requestRefreshToken() {\r\n    if (!refreshToken) {\r\n        refreshToken = window.sessionStorage.getItem(\"refreshToken\");\r\n        if (!refreshToken) {\r\n            router.push(\"/login\");\r\n        }\r\n    }\r\n    await api\r\n        .post(\"spotify/token\", {\r\n            grant_type: \"refresh_token\",\r\n            refresh_token: refreshToken,\r\n        })\r\n        .then((res) => {\r\n            token = res.data.access_token;\r\n            window.sessionStorage.setItem(\"token\", token);\r\n            expiresIn = res.data.expires_in;\r\n            tokenTimestamp = new Date();\r\n            window.sessionStorage.setItem(\"tokenTimestamp\", new Date());\r\n            if (res.data.refresh_token) {\r\n                refreshToken = res.data.refresh_token;\r\n            }\r\n            window.sessionStorage.setItem(\"refreshToken\", refreshToken);\r\n            setTimeout(requestRefreshToken, expiresIn * 1000);\r\n        })\r\n        .catch((err) => {\r\n            log.error(err);\r\n        });\r\n}\r\n\r\nexport function isAuthorized() {\r\n    if (token === undefined) {\r\n        const t = window.sessionStorage.getItem(\"token\");\r\n        const e = window.sessionStorage.getItem(\"tokenTimestamp\");\r\n        const r = window.sessionStorage.getItem(\"refreshToken\");\r\n        if (t) {\r\n            token = t;\r\n            refreshToken = r;\r\n            if (!refreshToken || refreshToken.length <= 0) {\r\n                return false;\r\n            }\r\n            tokenTimestamp = new Date(e);\r\n            if (tokenExpired()) {\r\n                return false;\r\n            }\r\n            setTimeout(requestRefreshToken, timeLeftMilliseconds());\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function tokenExpired() {\r\n    return timeLeftMilliseconds() < 0;\r\n}\r\n\r\nexport function timeLeftMilliseconds() {\r\n    return expiresIn * 1000 - (new Date() - tokenTimestamp) < 0;\r\n}\r\n","import * as log from \"../dev/log\";\r\nexport const measures = {\r\n    EUCLIDIAN: \"euclidian\",\r\n    MANHATTAN: \"manhattan\",\r\n    COSINE: \"cosine\",\r\n};\r\n\r\nconst maxEuclidianPitchDistance = Math.sqrt(12);\r\nconst maxEuclidianTimbreDistance = Math.sqrt(Math.pow(2, 2) * 12);\r\n\r\nexport function cosine(a, b) {\r\n    var adotv = 0;\r\n    var amag = 0;\r\n    var bmag = 0;\r\n    for (var i = 0; i < a.length; i++) {\r\n        adotv += a[i] * b[i];\r\n        amag += a[i] * a[i];\r\n        bmag += b[i] * b[i];\r\n    }\r\n    amag = Math.sqrt(amag);\r\n    bmag = Math.sqrt(bmag);\r\n    return adotv / (amag * bmag);\r\n}\r\n\r\nexport function cosineTransposed(a, b, p) {\r\n    var adotv = 0;\r\n    var amag = 0;\r\n    var bmag = 0;\r\n    for (var i = 0; i < a.length; i++) {\r\n        let transposedI = (i + p) % 12;\r\n        adotv += a[i] * b[transposedI];\r\n        amag += a[i] * a[i];\r\n        bmag += b[transposedI] * b[transposedI];\r\n    }\r\n    amag = Math.sqrt(amag);\r\n    bmag = Math.sqrt(bmag);\r\n    return adotv / (amag * bmag);\r\n}\r\n\r\nexport function manhattanDistance(a, b) {\r\n    let dist = 0;\r\n    for (let i = 0; i < a.length; i++) {\r\n        dist += Math.abs(a[i] - b[i]);\r\n    }\r\n    return dist;\r\n}\r\n// Manhattan distance scaled back to [0,1]\r\nexport function manhattan(a, b, range) {\r\n    return 1 - this.manhattanDistance(a, b) / range;\r\n}\r\n\r\nexport function euclidianDistance(a, b) {\r\n    return Math.sqrt(squaredDistance(a, b));\r\n}\r\n\r\nexport function euclidianDistanceTransposed(a, b, p) {\r\n    return Math.sqrt(squaredDistanceTransposed(a, b, p));\r\n}\r\nexport function maxEuclidianDistance(length, range) {\r\n    return Math.sqrt(range * range * length);\r\n}\r\nexport function euclidian(a, b, maxDist) {\r\n    return 1 - euclidianDistance(a, b) / maxDist;\r\n}\r\n\r\nexport function euclidianTimbre(a, b) {\r\n    return 1 - euclidianDistance(a, b) / maxEuclidianTimbreDistance;\r\n}\r\n\r\nexport function euclidianPitch(a, b) {\r\n    return 1 - euclidianDistance(a, b) / maxEuclidianPitchDistance;\r\n}\r\n\r\nexport function euclidianPitchTransposed(a, b, p) {\r\n    return 1 - euclidianDistanceTransposed(a, b, p) / maxEuclidianPitchDistance;\r\n}\r\n\r\nexport function squaredDistance(a, b) {\r\n    let dist = 0;\r\n    for (let i = 0; i < a.length; i++) {\r\n        const diff = a[i] - b[i];\r\n        dist += diff * diff;\r\n    }\r\n    return dist;\r\n}\r\n\r\nexport function squaredDistanceTransposed(a, b, p) {\r\n    let dist = 0;\r\n    for (let i = 0; i < a.length; i++) {\r\n        let transposedI = (i + p) % 12;\r\n        const diff = a[i] - b[transposedI];\r\n        dist += diff * diff;\r\n    }\r\n    return dist;\r\n}\r\n\r\nexport function correlate(featureA, featureB) {\r\n    const avgA = featureA.reduce((sum, val) => sum + val) / featureA.length;\r\n    const avgB = featureB.reduce((sum, val) => sum + val) / featureB.length;\r\n\r\n    let sum = 0;\r\n    for (let i = 0; i < featureA.length; i++) {\r\n        sum += (featureA[i] - avgA) * (featureB[i] - avgB);\r\n    }\r\n\r\n    const sumSquaresA = featureA.reduce((sum, val) => sum + Math.pow(val - avgA, 2));\r\n    const sumSquaresB = featureB.reduce((sum, val) => sum + Math.pow(val - avgB, 2));\r\n\r\n    return sum / Math.sqrt(sumSquaresA * sumSquaresB);\r\n}\r\n","import { stat } from \"fs\";\nimport Vue from \"vue\";\nimport Vuex from \"vuex\";\nimport Track from \"../app/Track\";\nimport * as log from \"../dev/log\";\n\nVue.use(Vuex);\n\nexport default new Vuex.Store({\n    state: {\n        browser: \"\",\n        user: Object,\n        trackList: [],\n        selectedIndex: 0,\n        loadingTrack: true,\n        // Player global variables\n        playerReady: false,\n        playing: false,\n        seeker: 0,\n        seekerUpdateSpeed: 40, // 100ms\n        isZoomed: false,\n        zoomScale: 10,\n        playerActive: true,\n        inputFocus: false,\n    },\n    mutations: {\n        setSeeker(state, time_ms) {\n            state.seeker = time_ms;\n        },\n        setUser(state, user) {\n            state.user = user;\n        },\n        setPlayerState(state, playerState) {\n            state.playerState = playerState;\n        },\n        loadingTrack(state, loadingTrack) {\n            state.loadingTrack = loadingTrack;\n        },\n        playerReady(state, playerReady) {\n            state.playerReady = playerReady;\n        },\n        addToTrackList(state, track) {\n            state.trackList.push(track);\n        },\n        addToTrackListIndex(state, index, track) {\n            state.trackList.splice(index, 0, track);\n        },\n        addToTrackListFront(state, track) {\n            state.trackList.unshift(track);\n        },\n        clearTrackList(state) {\n            state.trackList = [];\n        },\n        setSelectedIndex(state, index) {\n            state.selectedIndex = index;\n        },\n        setPlaying(state, playing) {\n            state.playing = playing;\n        },\n        incrementSeeker(state, increment) {\n            state.seeker += increment;\n        },\n        setZoomed(state, zoomed) {\n            state.isZoomed = zoomed;\n        },\n        toggleZoomed(state) {\n            state.isZoomed = !state.isZoomed;\n        },\n        setPlayerActive(state, active) {\n            state.playerActive = active;\n        },\n        setInputFocus(state, focus) {\n            state.inputFocus = focus;\n        },\n    },\n    actions: {},\n    getters: {\n        seeker(state) {\n            return state.seeker;\n        },\n        selectedIndex(state) {\n            return state.selectedIndex;\n        },\n        selectedTrack(state) {\n            return state.trackList[state.selectedIndex];\n        },\n        user(state) {\n            return state.user;\n        },\n        track(state, id) {\n            return state.trackList[id];\n        },\n        trackList(state) {\n            return state.trackList;\n        },\n        playerState(state) {\n            return state.playerState;\n        },\n        playerReady(state) {\n            return state.playerReady;\n        },\n        playing(state) {\n            return state.playing;\n        },\n        isZoomed(state) {\n            return state.isZoomed;\n        },\n        zoomScale(state) {\n            return state.zoomScale;\n        },\n        seekerUpdateSpeed(state) {\n            return state.seekerUpdateSpeed;\n        },\n        playerActive(state) {\n            return state.playerActive;\n        },\n        isInputFocused(state) {\n            return state.inputFocus;\n        },\n    },\n    modules: {},\n});\n","import * as log from \"../dev/log\";\r\n\r\nconst d3 = require(\"d3\");\r\nexport const circleOfFifths = [0, 7, 2, 9, 4, 11, 6, 1, 8, 3, 10, 5]; // Starting from C=0\r\nexport const noteNames = [\"C\", \"C\", \"D\", \"D\", \"E\", \"F\", \"F\", \"G\", \"G\", \"A\", \"A\", \"B\"];\r\nexport const keyNames = [\r\n    \"C\",\r\n    \"D\",\r\n    \"D\",\r\n    \"E\",\r\n    \"E\",\r\n    \"F\",\r\n    \"F\",\r\n    \"G\",\r\n    \"A\",\r\n    \"A\",\r\n    \"B\",\r\n    \"B\",\r\n    \"Cm\",\r\n    \"Dm\",\r\n    \"Dm\",\r\n    \"Em\",\r\n    \"Em\",\r\n    \"Fm\",\r\n    \"Fm\",\r\n    \"Gm\",\r\n    \"Am\",\r\n    \"Am\",\r\n    \"Bm\",\r\n    \"Bm\",\r\n];\r\n\r\n//https://www.vectorstock.com/royalty-free-vector/color-wheel-spectrum-scheme-selection-color-vector-25483441\r\nexport const colorWheelOld = d3\r\n    .scaleLinear()\r\n    .domain([\r\n        0,\r\n        1 / 12,\r\n        2 / 12,\r\n        2.8 / 12,\r\n        3.8 / 12,\r\n        4.3 / 12,\r\n        5.3 / 12,\r\n        6.8 / 12,\r\n        8 / 12,\r\n        8.8 / 12,\r\n        9.3 / 12,\r\n        10.5 / 12,\r\n        1,\r\n    ])\r\n    .interpolate(d3.interpolateHcl)\r\n    .range([\r\n        d3.rgb(\"#FE0000\"),\r\n        d3.rgb(\"#FF7300\"),\r\n        d3.rgb(\"#FFAA01\"),\r\n        d3.rgb(\"#FFD300\"),\r\n        d3.rgb(\"#FFFF01\"),\r\n        d3.rgb(\"#9FEE00\"),\r\n        d3.rgb(\"#01CC00\"),\r\n        d3.rgb(\"#009899\"),\r\n        d3.rgb(\"#1241AB\"),\r\n        d3.rgb(\"#3914B1\"),\r\n        d3.rgb(\"#7209AC\"),\r\n        d3.rgb(\"#CD0174\"),\r\n        d3.rgb(\"#FE0000\"),\r\n    ]);\r\nexport const colorWheel = d3\r\n    .scaleLinear()\r\n    .domain([0, 1 / 12, 2 / 12, 3 / 12, 4 / 12, 5 / 12, 6 / 12, 7 / 12, 8 / 12, 9 / 12, 10 / 12, 11 / 12, 1])\r\n    .interpolate(d3.interpolateHcl)\r\n    .range([\r\n        d3.rgb(\"#da321f\"),\r\n        d3.rgb(\"#e06300\"),\r\n        d3.rgb(\"#e89b00\"),\r\n        d3.rgb(\"#ebcb03\"),\r\n        d3.rgb(\"#9fbb04\"),\r\n        d3.rgb(\"#2cbe03\"),\r\n        d3.rgb(\"#03b779\"),\r\n        d3.rgb(\"#06b3bd\"),\r\n        d3.rgb(\"#3875cc\"),\r\n        d3.rgb(\"#7503db\"),\r\n        d3.rgb(\"#c203ae\"),\r\n        d3.rgb(\"#e84b90\"),\r\n        d3.rgb(\"#da321f\"),\r\n    ]);\r\n\r\nexport function getNoteName(i) {\r\n    return noteNames[i];\r\n}\r\n\r\nvar DEGREES_PER_RADIAN = 180 / Math.PI;\r\nvar RADIANS_PER_DEGREE = Math.PI / 180;\r\nexport const TWO_PI = 2 * Math.PI;\r\nexport const OFFSET = Math.PI / 2; // (3 * Math.PI) / 2; // full cycle is 2pi\r\n\r\nfunction sortWithIndeces(toSort) {\r\n    const toSortValIndex = [];\r\n    for (var i = 0; i < toSort.length; i++) {\r\n        toSortValIndex.push([toSort[i], i]);\r\n    }\r\n    toSortValIndex.sort(function(left, right) {\r\n        return left[0] < right[0] ? -1 : 1;\r\n    });\r\n    const toSortIndex = [];\r\n    for (var j = 0; j < toSort.length; j++) {\r\n        toSortIndex.push(toSortValIndex[j][1]);\r\n    }\r\n    return toSortIndex;\r\n}\r\n\r\nexport function tonality(pitches) {\r\n    let x = 0;\r\n    let y = 0;\r\n    let energy = 0;\r\n    for (let i = 0; i < 12; i++) {\r\n        const vangle = (circleOfFifths[i] / 12.0) * TWO_PI;\r\n        const vradius = pitches[i]; // Between 0 and 1\r\n        energy += vradius / 12;\r\n        x += vradius * Math.cos(vangle);\r\n        y += vradius * Math.sin(vangle);\r\n    }\r\n    const angle = (1 + Math.atan2(y, x) / TWO_PI) % 1;\r\n    const radius = Math.sqrt(x * x + y * y) / (energy * 12);\r\n    //return tonalityThirds(pitches);\r\n    return [angle, radius, energy];\r\n}\r\n\r\nexport function tonalityThirds(pitches) {\r\n    let x = 0;\r\n    let y = 0;\r\n    let energy = 0;\r\n\r\n    const sortedPitchIndexes = sortWithIndeces(pitches).reverse();\r\n    for (let i = 0; i < pitches.length; i++) {\r\n        const index = sortedPitchIndexes[i];\r\n        if (index === -1) continue;\r\n        sortedPitchIndexes[i] = -1;\r\n        const vangle = -(circleOfFifths[index] / 12.0) * TWO_PI + OFFSET;\r\n        const vradius = pitches[index]; // Between 0 and 1\r\n        energy += vradius / 12;\r\n        x += vradius * Math.cos(vangle);\r\n        y += vradius * Math.sin(vangle);\r\n\r\n        const majThirdIndex = (index + 4) % 12;\r\n        if (sortedPitchIndexes.includes(majThirdIndex)) {\r\n            const vangle = -(((12 + circleOfFifths[majThirdIndex] - 3.5) % 12) / 12.0) * TWO_PI + OFFSET;\r\n            const vradius = pitches[majThirdIndex]; // Between 0 and 1\r\n            energy += vradius / 12;\r\n            x += vradius * Math.cos(vangle);\r\n            y += vradius * Math.sin(vangle);\r\n            sortedPitchIndexes[sortedPitchIndexes.indexOf(majThirdIndex)] = -1;\r\n        }\r\n    }\r\n    const angle = (1 - Math.atan2(x, y) / TWO_PI + 0.25) % 1;\r\n    const radius = Math.sqrt(x * x + y * y) / (energy * 12);\r\n    return [angle, radius, energy];\r\n}\r\n\r\nexport function tonalityThird(pitches) {\r\n    let x = 0;\r\n    let y = 0;\r\n    let energy = 0;\r\n\r\n    let maxIndex = -1;\r\n    let max = -1;\r\n    let secondMaxIndex = -1;\r\n    let secondMax = -1;\r\n\r\n    for (let i = 0; i < 12; i++) {\r\n        if (pitches[i] > max) {\r\n            max = pitches[i];\r\n            maxIndex = i;\r\n        }\r\n        if (pitches[i] >= secondMax && i !== maxIndex) {\r\n            secondMax = pitches[i];\r\n            secondMaxIndex = i;\r\n        }\r\n    }\r\n    // major third apart\r\n    if ((12 + secondMaxIndex - maxIndex) % 12 !== 4) {\r\n        secondMaxIndex = -1;\r\n    }\r\n\r\n    for (let i = 0; i < 12; i++) {\r\n        let vangle = -(circleOfFifths[i] / 12.0) * TWO_PI + OFFSET;\r\n\r\n        if (i === secondMaxIndex) {\r\n            // add differently\r\n            vangle = -(((12 + circleOfFifths[i] - 3.5) % 12) / 12.0) * TWO_PI + OFFSET;\r\n        }\r\n\r\n        const vradius = pitches[i]; // Between 0 and 1\r\n        energy += vradius / 12;\r\n        x += vradius * Math.cos(vangle);\r\n        y += vradius * Math.sin(vangle);\r\n    }\r\n    const angle = (1 - Math.atan2(x, y) / TWO_PI + 0.25) % 1;\r\n    const radius = Math.sqrt(x * x + y * y) / (energy * 12);\r\n    return [angle, radius, energy];\r\n}\r\n\r\nexport function tonalVectorColor(pitches) {\r\n    const [angle, radius, energy] = tonality(pitches);\r\n\r\n    //const color = d3.color(d3.interpolateSinebow((angle+OFFSET)%1.0));\r\n    const color = d3.hsl(colorWheel(angle));\r\n    const saturation = Math.min((radius * 3) / (energy * 12), 1); // 3 because chord usually minimally 3 tones\r\n    color.s = saturation;\r\n    return color.hex();\r\n}\r\nexport function loudness(db) {\r\n    return Math.max(0, 60 + db) / 60;\r\n}\r\n\r\nexport function loudnessPerceived(db) {\r\n    return Math.pow(2, db / 10);\r\n}\r\n\r\nexport function logCompression(value, gamma = 1) {\r\n    return Math.log(1 + gamma * value) / Math.log(gamma);\r\n}\r\n","import * as log from \"../dev/log\";\r\nimport * as audioUtil from \"./audioUtil\";\r\n\r\nconst tryRemovePercussion = false;\r\nconst equalizeBass = false;\r\n\r\nexport default class SpotifySegment {\r\n    segment = null;\r\n    start = 0;\r\n    duration = 0;\r\n    loudness_start = 0;\r\n    loudness_max_time = 0;\r\n    loudness_max = 0;\r\n    loudness_end = 0;\r\n\r\n    pitches = [];\r\n    noise = [];\r\n    timbres = [];\r\n    timbresScaled = [];\r\n\r\n    cluster = -1;\r\n    tsneCoord = [0, 0];\r\n\r\n    tonalityAngle = 0; // [0,1] Angle of vector on circle of fifths\r\n    tonalityRadius = 0; // [0,1] Radius of vector on circle of fifths, low value means very dissonant or atonal\r\n    tonalityEnergy = 0; // [0,1] Total energy of all the pitches, high energy means lots of notes played at the same time\r\n\r\n    percussiony = 0; // [0,1] segments larger than .15\r\n\r\n    constructor(segment) {\r\n        this.segment = segment;\r\n        this.start = segment.start;\r\n        this.duration = segment.duration;\r\n        this.loudness_start = segment.loudness_start;\r\n        this.loudness_max = segment.loudness_max;\r\n        this.loudness_max_time = segment.loudness_max_time;\r\n        this.loudness_end = segment.loudness_end;\r\n        this.processPitch();\r\n        this.processPitchEqualizeBass();\r\n    }\r\n\r\n    processedPitch = false;\r\n    processPitch() {\r\n        if (this.processedPitch) return;\r\n        if (this.processedPitchSmooth) throw Error(\"processed pitchSmooth before setting initial pitch\");\r\n        this.segment.pitches.forEach((pitch, i) => {\r\n            this.pitches.push(pitch); //audioUtil.logCompression(pitch, GAMMA));\r\n        });\r\n        [this.tonalityAngle, this.tonalityRadius, this.tonalityEnergy] = audioUtil.tonality(this.pitches);\r\n\r\n        const minDuration = 0.2;\r\n        const decay = 0.5;\r\n        const shortness = this.duration < minDuration ? 1 : decay - (this.duration - 0.15);\r\n\r\n        for (let p = 0; p < 12; p++) {\r\n            this.noise.push(\r\n                Math.max(0, this.pitches[(p + 11) % 12] + this.pitches[p] + this.pitches[(p + 1) % 12] - 2)\r\n            );\r\n        }\r\n\r\n        this.percussiony = Math.max(Math.min(1, (1 - this.tonalityRadius) * this.tonalityEnergy * 2) * shortness, 0);\r\n        this.percussiony = Math.max(0, Math.min(1, 1 - this.tonalityRadius * 6));\r\n        this.percussiony = Math.max(0, Math.min(1, (1 - this.tonalityRadius) * this.tonalityEnergy));\r\n        this.percussiony = this.noise.reduce((sum, val) => sum + val / 12) * 2;\r\n        this.processedPitch = true;\r\n    }\r\n\r\n    processedPitchSmooth = false;\r\n    processPitchSmooth(prevSegment, nextSegment) {\r\n        if (!tryRemovePercussion) return;\r\n        if (this.processedPitchSmooth) return;\r\n        if (!this.processedPitch) throw Error(\"processed pitchSmooth called before setting initial pitch\");\r\n\r\n        for (let p = 0; p < this.pitches.length; p++) {\r\n            this.pitches[p] =\r\n                (1 - this.percussiony) * this.pitches[p] +\r\n                (this.percussiony *\r\n                    (prevSegment.pitches[p] * this.pitches[p] + nextSegment.pitches[p] * this.pitches[p])) /\r\n                    2;\r\n        }\r\n\r\n        //this.pitches[11] = this.percussiony;\r\n        //this.pitches[10] = 1 - this.tonalityRadius;\r\n        //this.pitches[9] = this.tonalityEnergy;\r\n\r\n        this.processedPitchSmooth = true;\r\n    }\r\n\r\n    processPitchEqualizeBass() {\r\n        if (equalizeBass) {\r\n            let maxPitch = 0;\r\n            this.pitches.forEach((pitch) => {\r\n                if (pitch > maxPitch) {\r\n                    maxPitch = pitch;\r\n                }\r\n            });\r\n\r\n            let secondMaxPitch = 0;\r\n            this.pitches.forEach((pitch) => {\r\n                if (pitch < maxPitch && pitch > secondMaxPitch) {\r\n                    secondMaxPitch = pitch;\r\n                }\r\n            });\r\n\r\n            const equalizeAmount = 0; // 1 is full equalize: loudest is same as second loudest, 0 is none\r\n            const scale = 1 / (1 - (maxPitch - secondMaxPitch) * equalizeAmount);\r\n            for (let p = 0; p < this.pitches.length; p++) {\r\n                this.pitches[p] = Math.min(1, this.pitches[p] * scale);\r\n            }\r\n        }\r\n    }\r\n\r\n    processedTimbre = false;\r\n    processTimbre(min, max, biggest, totalBiggest) {\r\n        if (this.processedTimbre) return;\r\n        this.segment.timbre.forEach((timbre, i) => {\r\n            this.timbres.push(timbre / totalBiggest);\r\n        });\r\n        this.segment.timbre.forEach((timbre, i) => {\r\n            this.timbresScaled.push(timbre / biggest[i]);\r\n        });\r\n        this.processedTimbre = true;\r\n    }\r\n\r\n    getPitches() {\r\n        return this.pitches;\r\n    }\r\n    getTimbres() {\r\n        return this.timbres;\r\n    }\r\n    getDuration() {\r\n        return this.duration_ms;\r\n    }\r\n    getStart() {\r\n        return this.start;\r\n    }\r\n    getEnd() {\r\n        return this.start + this.duration;\r\n    }\r\n    getOriginalTimbres() {\r\n        return this.segment.timbre;\r\n    }\r\n    getFeatures() {\r\n        return this.pitches.concat(this.timbres);\r\n    }\r\n    setCluster(i) {\r\n        this.cluster = i;\r\n    }\r\n    setTSNECoord(coord) {\r\n        this.tsneCoord = coord;\r\n    }\r\n    getTonalEnergy() {\r\n        return this.tonalityEnergy;\r\n    }\r\n    getTonalAngle() {\r\n        return this.tonalityAngle;\r\n    }\r\n    getLoudnessFeatures() {\r\n        return [\r\n            audioUtil.loudnessPerceived(this.loudness_start),\r\n            audioUtil.loudnessPerceived(this.loudness_max),\r\n            this.loudness_max_time,\r\n            audioUtil.loudnessPerceived(this.loudness_end),\r\n        ];\r\n    }\r\n    getAverageLoudness(nextSegmentLoudness) {\r\n        const loudnessFeatures = this.getLoudnessFeatures();\r\n        const start = loudnessFeatures[0];\r\n        const end = nextSegmentLoudness;\r\n        const max = loudnessFeatures[1];\r\n        const maxTime = loudnessFeatures[2];\r\n\r\n        const avgFirst = (max + start) / 2;\r\n        const avgSecond = (max + end) / 2;\r\n        const avg = avgFirst * maxTime + avgSecond * (1 - maxTime);\r\n        return avg;\r\n    }\r\n}\r\n","import * as similarity from \"./similarity\";\r\nimport * as audioUtil from\"./audioUtil\";\r\nimport * as log from \"../dev/log\";\r\nconst d3 = require(\"d3\");\r\n\r\nexport const notes = [\"C\", \"C\", \"D\", \"E\", \"E\", \"F\", \"F\", \"G\", \"G\", \"A\", \"B\", \"B\"];\r\nexport const circleOfFifths = [0, 7, 2, 9, 4, 11, 6, 1, 8, 3, 10, 5]; // Starting from C=0\r\n\r\nexport const chords = {\r\n    major: { name: \"Major\", weight: 1, template: [1, 0, 0, 0, 0.8, 0, 0, 0.5, 0, 0, 0, 0] },\r\n    minor: { name: \"minor\", weight: 1, template: [1, 0, 0, 0.8, 0, 0, 0, 0.5, 0, 0, 0, 0] },\r\n    sus2: { name: \"Sus2\", weight: 0.9, template: [1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0] },\r\n    sus4: { name: \"Sus4\", weight: 0.9, template: [1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0] },\r\n    dim: { name: \"Dim\", weight: 0.9, template: [1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0] },\r\n    aug: { name: \"Aug\", weight: 0.9, template: [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0] },\r\n    maj7: { name: \"Maj7\", weight: 0.7, template: [1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1] },\r\n    seven: { name: \"7\", weight: 0.7, template: [1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0] },\r\n    min7: { name: \"min7\", weight: 0.7, template: [1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0] },\r\n    min6: { name: \"min6\", weight: 0.7, template: [1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0] },\r\n    min7b5: { name: \"min7/b5\", weight: 0.7, template: [1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0] },\r\n    minmaj7: { name: \"minMaj7\", weight: 0.7, template: [1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1] },\r\n    sus27: { name: \"Sus2/7\", weight: 0.7, template: [1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1] },\r\n    sus47: { name: \"Sus4/7\", weight: 0.7, template: [1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1] },\r\n    dim6: { name: \"Dim6\", weight: 0.7, template: [1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0] },\r\n    maj7sharp5: { name: \"Maj7/#5\", weight: 0.7, template: [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1] },\r\n};\r\nconst scales = {\r\n    major: { name: \"Major\", weight: 1, template: [1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1] },\r\n    minor: { name: \"minor\", weight: 1, template: [1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0] },\r\n};\r\n\r\nconst pureMajorMinor = {\r\n    major: { name: \"Major\", weight: 1, template: [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0] },\r\n    minor: { name: \"minor\", weight: 1, template: [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0] },\r\n};\r\n\r\nexport const majorminor = [chords.major, chords.minor];\r\nexport const popchords = [...majorminor, chords.dim, chords.aug, chords.seven, chords.maj7, chords.min7];\r\nexport const allchords = [\r\n    ...popchords,\r\n    chords.sus2,\r\n    chords.sus4,\r\n    chords.sus27,\r\n    chords.sus47,\r\n    chords.min6,\r\n    chords.min7b5,\r\n    chords.minmaj7,\r\n    chords.dim6,\r\n    chords.maj7sharp5,\r\n];\r\n\r\nexport function getConfidence(pitches, chord, bassNote) {\r\n    if (bassNote === undefined) {\r\n        bassNote = getBassNote(pitches);\r\n    }\r\n    return chord.weight * similarity.cosineTransposed(pitches, chord.template, 12 - bassNote);\r\n}\r\n\r\nexport function getMajorMinorChordVectors(pitchFeatures) {\r\n    const chordFeatures = [];\r\n    pitchFeatures.forEach((pitchVector) => {\r\n        chordFeatures.push(getMajorMinorChordVector(pitchVector));\r\n    });\r\n    return chordFeatures;\r\n}\r\n\r\nexport function getMajorMinorChordVector(pitches) {\r\n    const vector = [];\r\n    for (let i = 0; i < 12; i++) {\r\n        vector.push(similarity.cosineTransposed(pitches, chords.major.template, 12 - i));\r\n    }\r\n    for (let i = 0; i < 12; i++) {\r\n        vector.push(similarity.cosineTransposed(pitches, chords.minor.template, 12 - i));\r\n    }\r\n    return vector;\r\n}\r\n\r\nexport function maxChordFeatures(vectors, windowSize) {\r\n    const maxChordFeatures = [];\r\n    const vectorSize = vectors[0].length;\r\n    const totalWindowSize = windowSize * 2 + 1;\r\n    for (let i = 0; i < vectors.length; i++) {\r\n        const averagedVector = new Float32Array(vectorSize);\r\n\r\n        for (let w = -windowSize; w <= windowSize; w++) {\r\n            if (i + w >= 0 && i + w < vectors.length) {\r\n                const vector = vectors[i + w];\r\n                for (let f = 0; f < vectorSize; f++) {\r\n                    averagedVector[f] += vector[f] / totalWindowSize;\r\n                }\r\n            }\r\n        }\r\n        let max = 0;\r\n        let maxIndex = 0;\r\n        for (let f = 0; f < vectorSize; f++) {\r\n            if (averagedVector[f] > max) {\r\n                max = averagedVector[f];\r\n                maxIndex = f;\r\n            }\r\n        }\r\n\r\n        for (let f = 0; f < vectorSize; f++) {\r\n            if (f !== maxIndex) averagedVector[f] = 0;\r\n        }\r\n        maxChordFeatures.push(averagedVector);\r\n    }\r\n    return maxChordFeatures;\r\n}\r\n\r\nexport function getChordIndexes(maxChordFeatures) {\r\n    const chordIndexes = [];\r\n    for (let i = 0; i < maxChordFeatures.length; i++) {\r\n        chordIndexes.push(maxChordFeatures[i].findIndex((val) => val !== 0));\r\n    }\r\n    return chordIndexes;\r\n}\r\n\r\nexport function getChords(chordIndexes) {\r\n    const chords = [];\r\n    let prevChordIndex = 0;\r\n    for (let i = 0; i < chordIndexes.length; i++) {\r\n        const chordIndex = chordIndexes[i];\r\n        if (chordIndex !== prevChordIndex) {\r\n            prevChordIndex = chordIndex;\r\n            if (chords.length > 0) chords[chords.length - 1].endSample = i;\r\n            chords.push({\r\n                name: getChordName(chordIndex),\r\n                index: chordIndex,\r\n                angle: chordAngle(chordIndex),\r\n                startSample: i,\r\n            });\r\n        }\r\n    }\r\n    chords[chords.length - 1].endSample = chordIndexes.length;\r\n    return chords;\r\n}\r\n\r\nexport function chordAngle(chordIndex) {\r\n    const posZeroEleven = chordIndex >= 12 ? (chordIndex + 3) % 12 : chordIndex;\r\n    const angle = circleOfFifths[posZeroEleven] / 12;\r\n    return angle;\r\n}\r\n\r\nvar TWO_PI = 2 * Math.PI;\r\nvar OFFSET = (3 * Math.PI) / 2; // full cycle is 2pi\r\n\r\nexport function tonality(pitches) {\r\n    let x = 0;\r\n    let y = 0;\r\n    let energy = 0;\r\n    for (let i = 0; i < 12; i++) {\r\n        const angle = (-circleOfFifths[i] / 12.0) * TWO_PI + OFFSET;\r\n        const radius = pitches[i]; // Between 0 and 1\r\n        energy += radius / 12;\r\n        x += radius * Math.cos(angle);\r\n        y += radius * Math.sin(angle);\r\n    }\r\n\r\n    const angle = (Math.atan2(x, y) + Math.PI) / TWO_PI;\r\n    const radius = Math.sqrt(x * x + y * y);\r\n    return [angle, radius, energy];\r\n}\r\n\r\nexport function tonalVectorColor(pitches) {\r\n    const [angle, radius, energy] = tonality(pitches);\r\n\r\n    //const color = d3.color(d3.interpolateSinebow((angle+OFFSET)%1.0));\r\n    const color = d3.hsl(audioUtil.colorWheel(angle));\r\n    const saturation = Math.min((radius * 3) / (energy * 12), 1); // 3 because chord usually minimally 3 tones\r\n    color.s = saturation;\r\n    return color.hex();\r\n}\r\n\r\nexport function getChordName(chordIndex) {\r\n    return `${notes[chordIndex % 12]}${chordIndex >= 12 ? \"m\" : \"\"}`;\r\n}\r\n\r\n// Is it more Major than minor ?\r\nexport function isMajor(pitches) {\r\n    return getConfidence(pitches, chords.major) >= getConfidence(pitches, chords.minor);\r\n}\r\n\r\n// Is it more minor than Major ?\r\nexport function isMinor(pitches) {\r\n    return !isMajor(pitches);\r\n}\r\n\r\nexport function getBassNote(pitches) {\r\n    let maxPitch = 0;\r\n    let maxIndex = 0;\r\n    for (let i = 0; i < 12; i++) {\r\n        if (pitches[i] > maxPitch) {\r\n            maxPitch = pitches[i];\r\n            maxIndex = i;\r\n        }\r\n    }\r\n    return maxIndex;\r\n}\r\n\r\nexport function getHighestConfidenceChord(pitches, chordSet) {\r\n    const bassNote = getBassNote(pitches);\r\n\r\n    let maxChord = null;\r\n    let maxConfidence = 0;\r\n    chordSet.forEach((chord) => {\r\n        const confidence = getConfidence(pitches, chord, bassNote);\r\n        if (confidence > maxConfidence) {\r\n            maxConfidence = confidence;\r\n            maxChord = chord;\r\n        }\r\n    });\r\n    return maxChord;\r\n}\r\n\r\nexport function getMajorMinor(pitches) {\r\n    return getHighestConfidenceChord(pitches, majorminor);\r\n}\r\n\r\nexport function getMajorMinorNess(pitches) {\r\n    const majorness = getConfidence(pitches, pureMajorMinor.major);\r\n    const minorness = getConfidence(pitches, pureMajorMinor.minor);\r\n    return Math.max(-1, Math.min(1, (majorness - minorness) * 12));\r\n}\r\n\r\nexport function getPopChord(pitches) {\r\n    return getHighestConfidenceChord(pitches, popchords);\r\n}\r\n\r\nexport function getChord(pitches) {\r\n    return getHighestConfidenceChord(pitches, allchords);\r\n}\r\n","import * as log from \"../dev/log\";\r\nimport Matrix from \"./dataStructures/Matrix\";\r\nimport HalfMatrix from \"./dataStructures/HalfMatrix\";\r\n\r\nexport function generate1DgaussianKernel(size, sigma = size / 2) {\r\n    const kernel = new Float32Array(size);\r\n    const meanIndex = (size - 1) / 2;\r\n    let sum = 0; // For accumulating the kernel values\r\n    for (let x = 0; x < size; x++) {\r\n        kernel[x] = Math.exp(-0.5 * Math.pow((x - meanIndex) / sigma, 2.0));\r\n        // Accumulate the kernel values\r\n        sum += kernel[x];\r\n    }\r\n\r\n    // Normalize the kernel\r\n    for (let x = 0; x < size; x++) {\r\n        kernel[x] /= sum;\r\n    }\r\n    return kernel;\r\n}\r\n\r\nexport function generate1DlinearKernel(size) {\r\n    const kernel = new Float32Array(size);\r\n    const meanIndex = (size - 1) / 2;\r\n    let sum = 0; // For accumulating the kernel values\r\n    for (let x = 0; x < size; x++) {\r\n        kernel[x] = 1 - Math.abs((x - meanIndex) / (size / 2));\r\n        // Accumulate the kernel values\r\n        sum += kernel[x];\r\n    }\r\n\r\n    // Normalize the kernel\r\n    for (let x = 0; x < size; x++) {\r\n        kernel[x] /= sum;\r\n    }\r\n    return kernel;\r\n}\r\n\r\nexport function linearBlur2DOptimized(matrix, size) {\r\n    log.debug(\"Performing 2D linear\", size);\r\n    const matrixSize = matrix.getSize();\r\n    const fullKernelSize = size * 2 + 1;\r\n    const kernel1D = generate1DlinearKernel(fullKernelSize);\r\n    const blurredMatrix = Matrix.from(matrix);\r\n\r\n    // Smear horizontal\r\n    blurredMatrix.fill((x, y) => {\r\n        let sum = 0;\r\n        for (let kx = -size; kx <= size; kx++) {\r\n            if (x + kx >= 0 && x + kx < matrixSize) {\r\n                sum += matrix.getValueMirrored(x + kx, y) * kernel1D[kx + size];\r\n            } else if (x + kx < 0) {\r\n                sum += matrix.getValueMirrored(0, y) * kernel1D[kx + size];\r\n            } else if (x + kx >= matrixSize) {\r\n                sum += matrix.getValueMirrored(matrixSize - 1, y) * kernel1D[kx + size];\r\n            }\r\n        }\r\n        return sum;\r\n    });\r\n    const blurredMatrixSecondPass = Matrix.from(matrix);\r\n\r\n    // Smear vertical\r\n    blurredMatrixSecondPass.fill((x, y) => {\r\n        let sum = 0;\r\n        for (let ky = -size; ky <= size; ky++) {\r\n            if (y + ky >= 0 && y + ky < matrixSize) {\r\n                sum += blurredMatrix.getValueMirrored(x, y + ky) * kernel1D[ky + size];\r\n            } else if (y + ky < 0) {\r\n                sum += blurredMatrix.getValueMirrored(x, 0) * kernel1D[ky + size];\r\n            } else if (y + ky >= matrixSize) {\r\n                sum += blurredMatrix.getValueMirrored(x, matrixSize - 1) * kernel1D[ky + size];\r\n            }\r\n        }\r\n        return sum;\r\n    });\r\n    return blurredMatrixSecondPass;\r\n}\r\n\r\nexport function gaussianBlur2DOptimized(matrix, size) {\r\n    const matrixSize = matrix.getSize();\r\n    const fullKernelSize = size * 2 + 1;\r\n    const kernel1D = generate1DgaussianKernel(fullKernelSize, size / 2);\r\n    const blurredMatrix = Matrix.from(matrix);\r\n\r\n    // Smear horizontal\r\n    blurredMatrix.fill((x, y) => {\r\n        let sum = 0;\r\n        for (let kx = -size; kx <= size; kx++) {\r\n            if (x + kx >= 0 && x + kx < matrixSize) {\r\n                sum += matrix.getValueMirrored(x + kx, y) * kernel1D[kx + size];\r\n            } else if (x + kx < 0) {\r\n                sum += matrix.getValueMirrored(0, y) * kernel1D[kx + size];\r\n            } else if (x + kx >= matrixSize) {\r\n                sum += matrix.getValueMirrored(matrixSize - 1, y) * kernel1D[kx + size];\r\n            }\r\n        }\r\n\r\n        return sum;\r\n    });\r\n    const blurredMatrixSecondPass = Matrix.from(matrix);\r\n\r\n    // Smear vertical\r\n    blurredMatrixSecondPass.fill((x, y) => {\r\n        let sum = 0;\r\n        for (let ky = -size; ky <= size; ky++) {\r\n            if (y + ky >= 0 && y + ky < matrixSize) {\r\n                sum += blurredMatrix.getValueMirrored(x, y + ky) * kernel1D[ky + size];\r\n            } else if (y + ky < 0) {\r\n                sum += blurredMatrix.getValueMirrored(x, 0) * kernel1D[ky + size];\r\n            } else if (y + ky >= matrixSize) {\r\n                sum += blurredMatrix.getValueMirrored(x, matrixSize - 1) * kernel1D[ky + size];\r\n            }\r\n        }\r\n        return sum;\r\n    });\r\n    return blurredMatrixSecondPass;\r\n}\r\nexport function gaussianBlurFeatures(features, size) {\r\n    const blurredFeatures = [];\r\n    const fullKernelSize = size * 2 + 1;\r\n    const kernel = generate1DgaussianKernel(fullKernelSize, size / 2);\r\n    const featureAmount = features[0].length;\r\n\r\n    for (let i = 0; i < features.length; i++) {\r\n        const newVector = new Float32Array(featureAmount);\r\n        for (let f = 0; f < featureAmount; f++) {\r\n            let sum = 0;\r\n            let kernelSum = 0;\r\n            for (let k = -size; k <= size; k++) {\r\n                if (i + k >= 0 && i + k < features.length) {\r\n                    sum += features[i + k][f] * kernel[k + size];\r\n                    kernelSum += kernel[k + size];\r\n                }\r\n            }\r\n            newVector[f] = sum / kernelSum;\r\n        }\r\n        blurredFeatures.push(newVector);\r\n    }\r\n\r\n    return blurredFeatures;\r\n}\r\n\r\nexport function medianFilterFeatures(features, size) {\r\n    const resolution = 256;\r\n    const buckets = new Float32Array(resolution);\r\n\r\n    const filteredFeatures = [];\r\n    const featureAmount = features[0].length;\r\n\r\n    for (let i = 0; i < features.length; i++) {\r\n        const newVector = new Float32Array(featureAmount);\r\n        for (let f = 0; f < featureAmount; f++) {\r\n            let totalValues = 0;\r\n            for (let k = -size; k <= size; k++) {\r\n                if (i + k >= 0 && i + k < features.length) {\r\n                    const val = features[i + k][f];\r\n                    const valNormalized = val * 0.5 + 0.5;\r\n                    buckets[Math.floor(valNormalized * (resolution - 1))]++;\r\n                    totalValues++;\r\n                }\r\n            }\r\n            let middle = totalValues / 2;\r\n            //Both check middle and clear buckets\r\n            let median = -1;\r\n            for (let i = 0; i < resolution; i++) {\r\n                middle -= buckets[i];\r\n                if (middle < 0 && median === -1) {\r\n                    median = i / (resolution - 1);\r\n                }\r\n                buckets[i] = 0;\r\n            }\r\n            newVector[f] = 2 * (median - 0.5);\r\n        }\r\n        filteredFeatures.push(newVector);\r\n    }\r\n    return filteredFeatures;\r\n}\r\n\r\nexport function splitGaussianBlurFeatures(features, size, offset = 0) {\r\n    const leftBlur = [];\r\n    const rightBlur = [];\r\n\r\n    const fullKernelSize = size * 2 + 1;\r\n    const kernel = generate1DgaussianKernel(fullKernelSize, size / 2);\r\n    const featureAmount = features[0].length;\r\n\r\n    for (let i = 0; i < features.length; i++) {\r\n        const newTimbreLeft = new Float32Array(featureAmount);\r\n        const newTimbreRight = new Float32Array(featureAmount);\r\n\r\n        for (let f = 0; f < featureAmount; f++) {\r\n            let leftSum = 0;\r\n            let leftKernelSum = 0;\r\n            let rightSum = 0;\r\n            let rightKernelSum = 0;\r\n\r\n            // Left\r\n            for (let k = -size - offset; k <= -1 - offset; k++) {\r\n                if (i + k >= 0 && i + k < features.length) {\r\n                    leftSum += features[i + k][f] * kernel[k + size + offset];\r\n                    leftKernelSum += kernel[k + size + offset];\r\n                }\r\n            }\r\n            // Right\r\n            for (let k = 1 + offset; k <= size + offset; k++) {\r\n                if (i + k >= 0 && i + k < features.length) {\r\n                    rightSum += features[i + k][f] * kernel[k + size - offset];\r\n                    rightKernelSum += kernel[k + size - offset];\r\n                }\r\n            }\r\n            newTimbreLeft[f] = leftSum / leftKernelSum;\r\n            newTimbreRight[f] = rightSum / rightKernelSum;\r\n        }\r\n        if (i <= offset) {\r\n            leftBlur.push(features[i]);\r\n        } else {\r\n            leftBlur.push(newTimbreLeft);\r\n        }\r\n        if (i >= features.length - 1 - offset) {\r\n            rightBlur.push(features[i]);\r\n        } else {\r\n            rightBlur.push(newTimbreRight);\r\n        }\r\n    }\r\n    return [leftBlur, rightBlur];\r\n}\r\n\r\nexport function gaussianBlur1D(array, size, edgeStrategy = \"zeropad\") {\r\n    const fullKernelSize = size * 2 + 1;\r\n    const kernel = generate1DgaussianKernel(fullKernelSize, size / 2);\r\n    const blurredArray = new Float32Array(array.length);\r\n\r\n    for (let i = 0; i < array.length; i++) {\r\n        let sum = 0;\r\n        for (let k = -size; k <= size; k++) {\r\n            if (i + k >= 0 && i + k < array.length) {\r\n                sum += array[i + k] * kernel[k + size];\r\n            } else {\r\n                switch (edgeStrategy) {\r\n                    case \"zeropad\":\r\n                        break;\r\n                    case \"mirror\":\r\n                        if (i - k >= 0 && i - k < array.length) {\r\n                            sum += array[i - k] * kernel[k + size];\r\n                        }\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        blurredArray[i] = sum;\r\n    }\r\n\r\n    return blurredArray;\r\n}\r\n\r\nexport function createFades(feature, padding) {\r\n    for (let i = 0; i < feature.length; i++) {\r\n        if (i < padding) {\r\n            feature[i] *= i / padding;\r\n        }\r\n        if (i >= feature.length - padding) {\r\n            feature[i] *= (feature.length - 1 - i) / padding;\r\n        }\r\n    }\r\n    return feature;\r\n}\r\n\r\nexport function maxFrequencyFilter(feature, resolution, size) {\r\n    const buckets = new Int32Array(resolution);\r\n\r\n    const blurredFeature = [];\r\n\r\n    feature.forEach((val, i) => {\r\n        for (let o = -size; o <= size; o++) {\r\n            if (i + o >= 0 && i + o < feature.length) {\r\n                buckets[feature[i + o]]++;\r\n            }\r\n        }\r\n\r\n        let maxFrequency = -1;\r\n        let maxValue = -1;\r\n        for (let i = 0; i < resolution; i++) {\r\n            if (buckets[i] > maxFrequency) {\r\n                maxFrequency = buckets[i];\r\n                maxValue = i;\r\n            }\r\n            buckets[i] = 0;\r\n        }\r\n        blurredFeature.push(maxValue);\r\n    });\r\n\r\n    return blurredFeature;\r\n}\r\n\r\nexport function median2D(matrix, resolution, width, height) {\r\n    const buckets = new Float32Array(resolution);\r\n\r\n    const w = Math.floor((width - 1) / 2);\r\n    const h = Math.floor((height - 1) / 2);\r\n\r\n    const filteredMatrix = Matrix.from(matrix, { numberType: Matrix.NumberType.FLOAT32 });\r\n\r\n    filteredMatrix.fill((x, y) => {\r\n        let totalValues = 0;\r\n        for (let xOffset = -w; xOffset <= w; xOffset++) {\r\n            for (let yOffset = -h; yOffset <= h; yOffset++) {\r\n                if (matrix.hasCell(x + xOffset, y + yOffset)) {\r\n                    const value = matrix.getValueNormalized(x + xOffset, y + yOffset);\r\n                    buckets[Math.floor(value * (resolution - 1))]++;\r\n                    totalValues++;\r\n                }\r\n            }\r\n        }\r\n        let middle = totalValues / 2;\r\n\r\n        //Both check middle and clear buckets\r\n        let mean = -1;\r\n        for (let i = 0; i < resolution; i++) {\r\n            middle -= buckets[i];\r\n            if (middle < 0 && mean === -1) {\r\n                mean = i / (resolution - 1);\r\n            }\r\n            buckets[i] = 0;\r\n        }\r\n        return mean;\r\n    });\r\n\r\n    return filteredMatrix;\r\n}\r\n","import * as filter from \"./filter\";\r\nimport Matrix from \"./dataStructures/Matrix\";\r\nimport assert from \"assert\";\r\nimport * as similarity from \"./similarity\";\r\nimport * as log from \"../dev/log\";\r\n\r\n/**\r\n * Convolve checkerboard kernel along main diagonal\r\n * @param {*} ssm half matrix\r\n */\r\nexport function detect(ssm, size) {\r\n    const kernel = createKernel(size);\r\n    const halfSize = Math.floor(size / 2);\r\n    const ssmSize = ssm.size || ssm.width;\r\n    const novelty = new Float32Array(ssmSize);\r\n    for (let i = 0; i < ssmSize; i++) {\r\n        let kernelSum = 0;\r\n        let cell = 0;\r\n        for (let y = 0; y < size; y++) {\r\n            for (let x = 0; x <= y; x++) {\r\n                const ssmX = i - (size - halfSize) + x;\r\n                const ssmY = i - (size - halfSize + 1) + y;\r\n                if (ssmX >= 0 && ssmX < ssmSize && ssmY >= 0 && ssmY < ssmSize) {\r\n                    kernelSum += ssm.getValueNormalizedMirrored(ssmX, ssmY) * kernel[cell];\r\n                }\r\n                cell++;\r\n            }\r\n        }\r\n        novelty[i] = kernelSum;\r\n    }\r\n    return novelty;\r\n}\r\n\r\nexport function createKernel(size) {\r\n    const kernelSize = (size * size + size) / 2;\r\n    const kernel = new Float32Array(kernelSize).fill(0); // Don't need the diagonal itself\r\n    /**   \r\n     *     subsize is the filled in size\r\n     */\r\n    const subSize = size / 2;\r\n    const taper = 2 / size;\r\n\r\n    let cell = 0;\r\n    let sum = 0;\r\n    for (let y = 0; y < size; y++) {\r\n        for (let x = 0; x <= y; x++) {\r\n            let sign;\r\n            if (y >= subSize && x < size - subSize) {\r\n                sign = -1;\r\n            } else {\r\n                sign = 1;\r\n            }\r\n            const gauss = Math.exp(\r\n                -Math.pow(taper, 2) * (Math.pow(x - (size - subSize) + 0.5, 2) + Math.pow(y - subSize + 0.5, 2))\r\n            );\r\n            kernel[cell] = sign * gauss;\r\n            sum += Math.abs(kernel[cell]);\r\n            cell++;\r\n        }\r\n    }\r\n    for (let i = 0; i < kernelSize; i++) {\r\n        kernel[i] /= sum;\r\n    }\r\n\r\n    return kernel;\r\n}\r\n\r\nexport function computeNoveltyFromTimeLag(timeLagMatrix) {\r\n    return absoluteEuclideanColumnDerivative(timeLagMatrix);\r\n}\r\n\r\n// Detects amount of change in ssm for column n and column n+1\r\nexport function absoluteEuclideanColumnDerivative(ssm) {\r\n    const ssmSize = ssm.size || ssm.width;\r\n    const novelty = new Float32Array(ssmSize);\r\n    // sqrt of all distances\r\n    for (let x = 0; x < ssmSize; x++) {\r\n        let differenceSum = 0;\r\n        for (let y = 0; y < ssmSize; y++) {\r\n            const currentValue = ssm.getValueNormalizedMirrored(x, y);\r\n            if (x < ssmSize - 1) {\r\n                const nextValue = ssm.getValueNormalizedMirrored(x + 1, y);\r\n                const difference = nextValue - currentValue;\r\n                differenceSum += difference * difference;\r\n            } else {\r\n                differenceSum = novelty[x - 1] * novelty[x - 1]; // Last value just repeats the second to last\r\n            }\r\n        }\r\n        novelty[x] = Math.sqrt(differenceSum);\r\n    }\r\n    return novelty;\r\n}\r\n\r\nexport function featureDerivative(features) {\r\n    const derivative = new Float32Array(features.length);\r\n    const zeroFeature = Array(features[0].length).fill(0);\r\n    derivative[0] = 1 - similarity.euclidianTimbre(features[0], features[1]);\r\n    for (let i = 1; i < features.length; i++) {\r\n        derivative[i] = 1 - similarity.euclidianTimbre(features[i - 1], features[i]);\r\n    }\r\n    return derivative;\r\n}\r\n\r\n// Basically sums / averages in the direction of paths\r\nexport function computePriorLag(timeLagMatrix, fades = 0) {\r\n    const ssmSize = timeLagMatrix.size || timeLagMatrix.width;\r\n    const novelty = new Float32Array(ssmSize);\r\n    for (let y = 0; y < ssmSize; y++) {\r\n        for (let x = 0; x < ssmSize; x++) {\r\n            novelty[y] += timeLagMatrix.getValueNormalizedMirrored(x, y);\r\n        }\r\n        novelty[y] /= ssmSize;\r\n    }\r\n    const fadedNovelty = filter.createFades(novelty, fades);\r\n    return fadedNovelty;\r\n}\r\n\r\n// Basically sums / averages in the direction of paths\r\nexport function computePriorLagHalf(timeLagMatrix, fades = 0) {\r\n    const ssmSize = timeLagMatrix.size || timeLagMatrix.width;\r\n    const novelty = new Float32Array(ssmSize);\r\n    for (let y = 0; y < ssmSize; y++) {\r\n        for (let x = 0; x < ssmSize - y; x++) {\r\n            novelty[y] += timeLagMatrix.getValueNormalizedMirrored(x, y);\r\n        }\r\n        novelty[y] /= ssmSize - y;\r\n    }\r\n    const fadedNovelty = filter.createFades(novelty, fades);\r\n    return fadedNovelty;\r\n}\r\n\r\nexport function findLocalMaxima(novelty, threshold = 0) {\r\n    const max = Math.max.apply(Math, novelty);\r\n    const maximaIndexes = [0];\r\n    for (let i = 1; i < novelty.length - 1; i++) {\r\n        const val = novelty[i];\r\n        // prefers first index if maxima spans multiple samples\r\n        if (novelty[i - 1] < val && val >= novelty[i + 1] && val > threshold * max) {\r\n            maximaIndexes.push(i);\r\n        }\r\n    }\r\n    return maximaIndexes;\r\n}\r\n\r\nexport function findPeaks(novelty) {\r\n    const peaks = [];\r\n    peaks.push({ sample: 0, height: 0, confidence: 1 });\r\n    const max = Math.max.apply(Math, novelty);\r\n\r\n    const maxima = [];\r\n    const minima = [];\r\n\r\n    for (let i = 1; i < novelty.length - 1; i++) {\r\n        const val = novelty[i];\r\n        // prefers first index if maxima spans multiple samples\r\n        if (novelty[i - 1] < val && val >= novelty[i + 1]) {\r\n            maxima.push({ sample: i, height: val });\r\n        }\r\n        if (novelty[i - 1] > val && val <= novelty[i + 1]) {\r\n            minima.push({ sample: i, height: val });\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < maxima.length; i++) {\r\n        const maxi = maxima[i];\r\n        const leftMinima = i === 0 ? { sample: 0, height: 0 } : minima[i - 1];\r\n        const rightMinima = i >= minima.length ? { sample: novelty.length - 1, height: 0 } : minima[i];\r\n        let smallestMinima;\r\n        if (leftMinima.height < rightMinima.height) {\r\n            smallestMinima = leftMinima;\r\n        } else {\r\n            smallestMinima = rightMinima;\r\n        }\r\n        assert(smallestMinima, \"No minima assigned as smallest\");\r\n        const maxPeakHeightDiff = maxi.height - smallestMinima.height;\r\n        const confidence = maxPeakHeightDiff / max;\r\n        peaks.push({ sample: maxi.sample, height: maxi.height, confidence });\r\n    }\r\n    return peaks;\r\n}\r\n\r\nexport function columnDensity(matrix) {\r\n    const ssmSize = matrix.size || matrix.width;\r\n    const novelty = new Float32Array(ssmSize);\r\n    for (let i = 0; i < ssmSize; i++) {\r\n        novelty[i] = 0;\r\n        for (let j = 0; j < ssmSize; j++) {\r\n            novelty[i] += matrix.getValueNormalizedMirrored(i, j);\r\n        }\r\n        novelty[i] /= ssmSize;\r\n    }\r\n    return novelty;\r\n}\r\n\r\nexport function normalizeByColumnDensity(matrix) {\r\n    const ssmSize = matrix.size || matrix.width;\r\n    const density = columnDensity(matrix);\r\n    const normalizedMatrix = Matrix.from(matrix, { numberType: Matrix.NumberType.FLOAT32 });\r\n    let max = 0;\r\n    normalizedMatrix.fill((x, y) => {\r\n        let colDensity = density[x];\r\n        if (colDensity === 0) {\r\n            colDensity = 1 / ssmSize;\r\n        }\r\n        const val = matrix.getValueNormalizedMirrored(x, y) / (ssmSize * colDensity);\r\n        if (val > max) max = val;\r\n        return val;\r\n    });\r\n    normalizedMatrix.divide(max);\r\n\r\n    return normalizedMatrix;\r\n}\r\n","export function computeFitness(pathFamily, pathScores, score, sampleAmount, width) {\r\n    const pathAmount = pathFamily.length;\r\n    const error = 1e-16;\r\n\r\n    // normalized score\r\n    // we subtract the given self similarity path, and divide by total length of all paths (+ error to prevent divide by 0)\r\n    let pathFamilyLength = 0;\r\n    for (let p = 0; p < pathAmount; p++) {\r\n        pathFamilyLength += pathFamily[p].length / 2; // /2 because we store x and y flat\r\n    }\r\n    const normalizedScore = Math.max(0, (score - width) / (pathFamilyLength + error));\r\n\r\n    // normalized coverage\r\n    const coverage = computeInducedCoverage(pathFamily);\r\n    const normalizedCoverage = (coverage - width) / (sampleAmount + error);\r\n\r\n    // fitness\r\n    let fitness = (2 * normalizedScore * normalizedCoverage) / (normalizedScore + normalizedCoverage + error);\r\n\r\n    return { fitness, normalizedScore, coverage, normalizedCoverage, pathFamilyLength, prunedPathFamily: pathFamily };\r\n}\r\n\r\nexport function computeCustomFitness(pathFamily, pathScores, score, sampleAmount, width) {\r\n    const pathAmount = pathFamily.length;\r\n    const error = 1e-16;\r\n    const normalizedPathAmount = pathAmount - 1;\r\n\r\n    // normalized score\r\n    // we subtract the given self similarity path, and divide by total length of all paths (+ error to prevent divide by 0)\r\n    let pathFamilyLength = 0;\r\n    for (let p = 0; p < pathAmount; p++) {\r\n        pathFamilyLength += pathFamily[p].length / 2; // /2 because we store x and y flat\r\n    }\r\n    const normalizedScore = Math.max(0, (score - width) / (pathFamilyLength + error));\r\n\r\n    // normalized coverage\r\n    const coverage = computeInducedCoverage(pathFamily);\r\n    let normalizedCoverage = (coverage - width) / (sampleAmount + error);\r\n\r\n    // fitness\r\n    let fitness = (2 * normalizedScore * normalizedCoverage) / (normalizedScore + normalizedCoverage + error);\r\n    //fitness = (3 * normalizedScore * normalizedCoverage* normalizedPathAmount )/ (normalizedScore * normalizedCoverage + normalizedCoverage * normalizedPathAmount + normalizedPathAmount * normalizedScore);\r\n    fitness *= normalizedPathAmount;\r\n\r\n    return { fitness, normalizedScore, coverage, normalizedCoverage, pathFamilyLength, prunedPathFamily: pathFamily };\r\n}\r\n\r\nexport function computeFineFitness(pathFamily, pathScores, score, sampleAmount, width) {\r\n    const pathAmount = pathFamily.length;\r\n    const error = 1e-16;\r\n    const normalizedPathAmount = pathAmount - 1;\r\n\r\n    // normalized score\r\n    // we subtract the given self similarity path, and divide by total length of all paths (+ error to prevent divide by 0)\r\n    let pathFamilyLength = 0;\r\n    for (let p = 0; p < pathAmount; p++) {\r\n        pathFamilyLength += pathFamily[p].length / 2; // /2 because we store x and y flat\r\n    }\r\n    const normalizedScore = Math.max(0, (score - width) / (pathFamilyLength + error));\r\n\r\n    // normalized coverage\r\n    const coverage = computeInducedCoverage(pathFamily);\r\n    let normalizedCoverage = (coverage - width) / (sampleAmount + error);\r\n\r\n    // fitness\r\n    //let fitness = (2 * normalizedScore * pathAmount) / (normalizedScore + pathAmount + error);\r\n    let fitness =\r\n        (3 * normalizedScore * normalizedCoverage * pathAmount) /\r\n        (normalizedScore * normalizedCoverage + normalizedCoverage * pathAmount + pathAmount * normalizedScore);\r\n\r\n    return { fitness, normalizedScore, coverage, normalizedCoverage, pathFamilyLength, prunedPathFamily: pathFamily };\r\n}\r\n\r\nexport function computeCustomPrunedFitness(pathFamily, pathScores, score, sampleAmount, width) {\r\n    const [prunedPathFamily, prunedPathScores, totalScore] = prunePathFamily(pathFamily, pathScores, width, 0.25, 0.05);\r\n    pathFamily = prunedPathFamily;\r\n    pathScores = prunedPathScores;\r\n    score = totalScore;\r\n    const error = 1e-16;\r\n\r\n    // normalize pathAmount\r\n    const pathAmount = pathFamily.length;\r\n    const normalizedPathAmount = pathAmount - 1;\r\n\r\n    // normalized score\r\n    // we subtract the given self similarity path, and divide by total length of all paths (+ error to prevent divide by 0)\r\n    let pathFamilyLength = 0;\r\n    for (let p = 0; p < pathAmount; p++) {\r\n        pathFamilyLength += pathFamily[p].length / 2; // /2 because we store x and y flat\r\n    }\r\n    const normalizedScore = Math.max(0, (score - width) / (pathFamilyLength + error));\r\n\r\n    // normalized coverage\r\n    const coverage = computeInducedCoverage(pathFamily);\r\n    let normalizedCoverage = (coverage - width) / (sampleAmount + error);\r\n    //normalizedCoverage *= (normalizedPathAmount);\r\n\r\n    // fitness\r\n    let fitness = (2 * normalizedScore * normalizedCoverage) / (normalizedScore + normalizedCoverage + error);\r\n    fitness *= Math.log(normalizedPathAmount);\r\n    //fitness =  Math.sqrt(normalizedPathAmount*normalizedScore*normalizedCoverage);\r\n    //fitness = normalizedPathAmount*normalizedCoverage*normalizedScore;\r\n\r\n    return { fitness, normalizedScore, coverage, normalizedCoverage, pathFamilyLength, prunedPathFamily: pathFamily };\r\n}\r\n\r\nexport function computePrunedFitness(pathFamily, pathScores, score, sampleAmount, width) {\r\n    const [prunedPathFamily, prunedPathScores, totalScore] = prunePathFamily(pathFamily, pathScores, width, 0.5, 0.4);\r\n    pathFamily = prunedPathFamily;\r\n    pathScores = prunedPathScores;\r\n    score = totalScore;\r\n\r\n    const pathAmount = pathFamily.length;\r\n    const error = 1e-16;\r\n\r\n    // normalized score\r\n    // we subtract the given self similarity path, and divide by total length of all paths (+ error to prevent divide by 0)\r\n    let pathFamilyLength = width * pathAmount;\r\n    const normalizedScore = Math.max(0, (score - width) / (pathFamilyLength + error));\r\n\r\n    // normalized coverage\r\n    const coverage = computeInducedCoverage(pathFamily, pathScores);\r\n    const normalizedCoverage = (coverage - width) / (sampleAmount + error);\r\n    const normalizedNonInducedCoverage = (pathFamilyLength - width) / (sampleAmount + error);\r\n\r\n    // fitness\r\n    let fitness =\r\n        (2 * normalizedScore * normalizedNonInducedCoverage) / (normalizedScore + normalizedNonInducedCoverage + error);\r\n\r\n    //fitness = (2 * normalizedScore * pathFamilyLength) / (normalizedScore + pathFamilyLength + error);\r\n\r\n    return {\r\n        fitness,\r\n        normalizedScore,\r\n        coverage,\r\n        normalizedCoverage,\r\n        pathFamilyLength,\r\n        prunedPathFamily,\r\n        prunedPathScores,\r\n    };\r\n}\r\n\r\nexport function computeInducedCoverage(pathFamily) {\r\n    const pathAmount = pathFamily.length;\r\n    let coverage = 0;\r\n    if (pathAmount > 0) {\r\n        for (let p = 0; p < pathAmount; p++) {\r\n            // paths stored in reverse due to backtracking\r\n            const pathEndY = pathFamily[p][1];\r\n            const pathStartY = pathFamily[p][pathFamily[p].length - 1];\r\n            coverage += Math.abs(pathEndY - pathStartY);\r\n        }\r\n    }\r\n\r\n    return coverage;\r\n}\r\n\r\nexport function prunePathFamily(pathFamily, pathScores, width, smallestRatio = 0.3, smallestScore = 0.3) {\r\n    const totalScore = pathScores.reduce((a, b) => a + b, 0);\r\n    const normalizedTotalScore = totalScore - width;\r\n    const pathLength = pathFamily.length;\r\n    const averageScore = normalizedTotalScore / (pathLength - 1);\r\n    let bestScore = 0;\r\n    let secondBestScore = 0;\r\n    pathScores.forEach((score) => {\r\n        if (score > bestScore) {\r\n            bestScore = score;\r\n        }\r\n    });\r\n    pathScores.forEach((score) => {\r\n        if (score > secondBestScore && score < bestScore) {\r\n            secondBestScore = score;\r\n        }\r\n    });\r\n\r\n    const prunedPathFamily = [];\r\n    const prunedPathScores = [];\r\n    for (let p = 0; p < pathLength; p++) {\r\n        const path = pathFamily[p];\r\n        const score = pathScores[p];\r\n        if (score > smallestRatio * secondBestScore && score / width > smallestScore) {\r\n            prunedPathFamily.push(path);\r\n            prunedPathScores.push(score);\r\n        }\r\n    }\r\n    return [prunedPathFamily, prunedPathScores, totalScore];\r\n}\r\n","import * as log from \"../dev/log\";\r\nimport Matrix from \"./dataStructures/Matrix\";\r\nimport HalfMatrix from \"./dataStructures/HalfMatrix\";\r\nimport * as familyFitness from \"./familyFitness\";\r\n\r\nexport function createScoreMatrixBuffer(sampleAmount) {\r\n    return new Float32Array(sampleAmount * sampleAmount).fill(Number.NEGATIVE_INFINITY);\r\n}\r\n\r\nexport function extractPathFamily(ssm, start, end) {\r\n    const { D, width, height, score } = computeAccumulatedScoreMatrix(ssm, start, end, D);\r\n    const pathFamily = computeOptimalPathFamily(D, width, height);\r\n    //const pathScores = getScoresForPathFamily(D, width, pathFamily);\r\n    const pathScores = getBrightnessForPathFamily(ssm, pathFamily, start);\r\n\r\n    return [pathFamily, pathScores, score, width];\r\n}\r\n\r\n// The ratio between the length of the knight move vs length of a diagonal move\r\nconst knightMoveRatio = 1; //Math.sqrt(10) / 2 + .01 ; // plus slight offset to favour diagonal moves when going through penalties\r\nconst knightMoveTweak = 1; //0.99; //Also favouring diagonal moves when accumulating score\r\nexport function computeAccumulatedScoreMatrix(ssm, start, end, D) {\r\n    const sampleAmount = ssm.getSampleAmount();\r\n    if (start < 0) log.error(\"start below 0: \", start);\r\n    if (end > sampleAmount) log.error(\"end above sampleAmount: \", sampleAmount, \"end\", end);\r\n\r\n    const length = end - start;\r\n\r\n    const width = length + 1;\r\n    const height = sampleAmount;\r\n    // accumulatedScoreMatrix length + 1 for elevator\r\n    if (!D) {\r\n        D = new Float32Array(height * width).fill(Number.NEGATIVE_INFINITY);\r\n    }\r\n\r\n    const penalty = -2;\r\n    const penalize = (value) => {\r\n        return value <= 0 ? penalty : value; //(value-thresh)*(1/(1-thresh));\r\n        //return value < thresh ?  (thresh-value)*(1/thresh)*penalty : (value-thresh)*(1/thresh);\r\n        /*if(value <= 0.5){\r\n             return penalty;\r\n        }else if(value < thresh){\r\n            return  (-thresh+value);\r\n        }else{\r\n            return (value - thresh);\r\n        }*/\r\n    };\r\n\r\n    D[0] = 0;\r\n    D[1] = penalize(ssm.getValueNormalized(start, 0));\r\n\r\n    for (let y = 1; y < height; y++) {\r\n        D[y * width + 0] = Math.max(D[(y - 1) * width + 0], D[(y - 1) * width + width - 1]);\r\n        D[y * width + 1] = D[y * width + 0] + penalize(ssm.getValueNormalized(start, y));\r\n        for (let x = 2; x < width; x++) {\r\n            let down;\r\n            if (y === 1) {\r\n                down = Number.NEGATIVE_INFINITY;\r\n            } else {\r\n                down = D[(y - 2) * width + x - 1];\r\n            }\r\n            if (down < 0) {\r\n                down *= knightMoveRatio;\r\n            } else {\r\n                down *= knightMoveTweak;\r\n            }\r\n            let right = D[(y - 1) * width + x - 2]; //|| Number.NEGATIVE_INFINITY; // in case undefined\r\n            if (right < 0) {\r\n                right *= knightMoveRatio;\r\n            } else {\r\n                right *= knightMoveTweak;\r\n            }\r\n            const diag = D[(y - 1) * width + x - 1]; //|| Number.NEGATIVE_INFINITY; // in case undefined\r\n\r\n            D[y * width + x] = penalize(ssm.getValueNormalized(start + x - 1, y)) + Math.max(diag, right, down);\r\n        }\r\n    }\r\n\r\n    const score = Math.max(D[(height - 1) * width + 0], D[(height - 1) * width + width - 1]);\r\n\r\n    return { D, width, height, score };\r\n}\r\n\r\nexport function computeOptimalPathFamily(D, width, height) {\r\n    const pathFamily = [];\r\n    let path = [];\r\n\r\n    let y = height - 1;\r\n    let x;\r\n    if (D[y * width + width - 1] < D[y * width + 0]) {\r\n        x = 0;\r\n    } else {\r\n        x = width - 1;\r\n        path.push(x - 1, y);\r\n    }\r\n\r\n    // Declaring globally for improved running time\r\n    let predecessors = new Uint16Array(6);\r\n    let predecessorLength = 0; // in pairs, so max would be 3\r\n\r\n    while (y > 0 || x > 0) {\r\n        // obtaining the set of possible predecesors given our current position\r\n        predecessors[0] = y - 1;\r\n        predecessors[1] = x - 1;\r\n        if (y <= 2 && x <= 2) {\r\n            predecessorLength = 1;\r\n        } else if (y <= 2 && x > 2) {\r\n            predecessors[2] = y - 1;\r\n            predecessors[3] = x - 2;\r\n            predecessorLength = 2;\r\n        } else if (y > 2 && x <= 2) {\r\n            predecessors[2] = y - 2;\r\n            predecessors[3] = x - 1;\r\n            predecessorLength = 2;\r\n        } else {\r\n            predecessors[2] = y - 2;\r\n            predecessors[3] = x - 1;\r\n            predecessors[4] = y - 1;\r\n            predecessors[5] = x - 2;\r\n            predecessorLength = 3;\r\n        }\r\n\r\n        if (y === 0) {\r\n            // case for the first row, only horizontal movements are allowed\r\n            x--;\r\n        } else if (x === 0) {\r\n            // case for the elevator column: we can keep going down the column or jumping to the end of the next row\r\n            if (D[(y - 1) * width + width - 1] > D[(y - 1) * width + 0]) {\r\n                y--;\r\n                x = width - 1;\r\n                if (path.length > 0) {\r\n                    pathFamily.push(path);\r\n                }\r\n                path = [x - 1, y];\r\n            } else {\r\n                y--;\r\n                x = 0;\r\n            }\r\n        } else if (x === 1) {\r\n            // case for x=1, only horizontal steps to the elevator column are allowed\r\n            x = 0;\r\n        } else {\r\n            // regular case, obtain best of predecessors\r\n            let max = Number.NEGATIVE_INFINITY;\r\n            for (let i = 0; i < predecessorLength; i++) {\r\n                let val = D[predecessors[i * 2 + 0] * width + predecessors[i * 2 + 1]]; // value in D of predecessor\r\n                if (val > max) {\r\n                    max = val;\r\n                    y = predecessors[i * 2 + 0];\r\n                    x = predecessors[i * 2 + 1];\r\n                }\r\n            }\r\n            path.push(x - 1, y);\r\n        }\r\n    }\r\n    // add last path to family\r\n    pathFamily.push(path);\r\n    return pathFamily;\r\n}\r\n\r\nexport function getScoresForPathFamily(scoreMatrix, width, pathFamily) {\r\n    let pathScores = [];\r\n    pathFamily.forEach((path) => {\r\n        const endX = path[0];\r\n        const endY = path[0 + 1];\r\n        const endValue = scoreMatrix[endY * width + endX];\r\n        const startX = path[path.length - 2];\r\n        const startY = path[path.length - 2 + 1];\r\n        const startValue = scoreMatrix[startY * width + startX];\r\n        const pathScore = endValue - startValue;\r\n\r\n        pathScores.push(pathScore / width);\r\n    });\r\n    return pathScores;\r\n}\r\n\r\nlet deb = 0;\r\nexport function getBrightnessForPathFamily(pathSSM, pathFamily, start) {\r\n    deb++;\r\n    let pathScores = [];\r\n    pathFamily.forEach((path) => {\r\n        let sum = 0;\r\n        for (let i = 0; i < path.length; i += 2) {\r\n            const x = start + path[i + 0];\r\n            const y = path[i + 1];\r\n            const val = pathSSM.getValueNormalized(x, y);\r\n            sum += val;\r\n        }\r\n        const average = sum / (path.length / 2);\r\n        pathScores.push(average);\r\n    });\r\n    return pathScores;\r\n}\r\n\r\nexport function getInducedSegments(pathFamily) {\r\n    const pathAmount = pathFamily.length;\r\n    const inducedSegments = new Uint16Array(pathAmount * 2);\r\n\r\n    if (pathAmount > 0) {\r\n        for (let p = 0; p < pathAmount; p++) {\r\n            // paths stored in reverse due to backtracking\r\n            const pathEndY = pathFamily[p][1];\r\n            const pathStartY = pathFamily[p][pathFamily[p].length - 1];\r\n            inducedSegments[p * 2] = pathStartY;\r\n            inducedSegments[p * 2 + 1] = pathEndY;\r\n        }\r\n    }\r\n\r\n    return inducedSegments;\r\n}\r\n\r\nexport function visualizationMatrix(ssm, sampleAmount, start, end) {\r\n    const scoreMatrixBuffer = createScoreMatrixBuffer(sampleAmount);\r\n    const { D, width, height, score } = computeAccumulatedScoreMatrix(ssm, start, end, scoreMatrixBuffer);\r\n    const P = computeOptimalPathFamily(D, width, height);\r\n    const PScores = getScoresForPathFamily(D, width, P);\r\n    const { fitness, normalizedScore, coverage, normalizedCoverage, pathFamilyLength } = familyFitness.computeFitness(\r\n        P,\r\n        PScores,\r\n        score,\r\n        sampleAmount,\r\n        width\r\n    );\r\n\r\n    let maxVal = Number.NEGATIVE_INFINITY;\r\n    let minVal = Number.POSITIVE_INFINITY;\r\n    const sizeD = width * height;\r\n    for (let i = 0; i < sizeD; i++) {\r\n        if (D[i] > maxVal) {\r\n            maxVal = D[i];\r\n        }\r\n\r\n        if (i % width === 0 && D[i] !== Number.NEGATIVE_INFINITY && D[i] < minVal) {\r\n            minVal = D[i];\r\n        }\r\n    }\r\n    minVal = 0;\r\n\r\n    const length = end - start + 1;\r\n    const visualizationMatrix = new Matrix({\r\n        width: sampleAmount,\r\n        height: sampleAmount,\r\n        numberType: Matrix.NumberType.UINT8,\r\n    });\r\n\r\n    visualizationMatrix.fill((x, y) => {\r\n        if (x >= length * 3 && x < length * 4) {\r\n            return ssm.getValue(start + x - length * 3, y);\r\n        } else if (x >= length * 2) {\r\n            return 0; // Paths will be set from looping over paths\r\n        } else if (x >= length) {\r\n            return (Math.max(0, D[y * width + x - length] - minVal) / (maxVal - minVal)) * 255; // +1 to remove elevator, * 255 sinze value is\r\n        } else {\r\n            return ssm.getValue(start + x, y);\r\n        }\r\n    });\r\n\r\n    for (const path of P) {\r\n        for (let i = 0; i < path.length / 2; i++) {\r\n            const x = length * 2 + path[i * 2];\r\n            const y = path[i * 2 + 1];\r\n            visualizationMatrix.setValue(x, y, 255);\r\n            const x2 = length * 3 + path[i * 2];\r\n            visualizationMatrix.setValue(x2, y, 0);\r\n        }\r\n    }\r\n\r\n    return visualizationMatrix;\r\n}\r\n\r\nexport function getInducedSegmentsFromSampleRange(start, end, pathSSM) {\r\n    const { D, width, height, score } = computeAccumulatedScoreMatrix(pathSSM, start, end);\r\n    const pathFamily = computeOptimalPathFamily(D, width, height);\r\n    const inducedSegments = getInducedSegments(pathFamily);\r\n    return inducedSegments;\r\n}\r\n\r\nexport function getDistanceBetween(segmentA, segmentB, pathSSM) {\r\n    const startSampleA = Math.floor(segmentA.start / pathSSM.getSampleDuration());\r\n    const endSampleA = Math.floor(segmentA.end / pathSSM.getSampleDuration());\r\n\r\n    const startSampleB = Math.floor(segmentB.start / pathSSM.getSampleDuration());\r\n    const endSampleB = Math.floor(segmentB.end / pathSSM.getSampleDuration());\r\n\r\n    const inducedSegmentsA = getInducedSegmentsFromSampleRange(startSampleA, endSampleA, pathSSM);\r\n    const inducedSegmentsB = getInducedSegmentsFromSampleRange(startSampleB, endSampleB, pathSSM);\r\n\r\n    return segmentDistanceOverlap(inducedSegmentsA, inducedSegmentsB);\r\n}\r\n\r\nexport function segmentSimilarityDTW(segmentA, segmentB, ssm) {\r\n    const startSampleA = Math.floor(segmentA.start / ssm.getSampleDuration());\r\n    const endSampleA = Math.floor(segmentA.end / ssm.getSampleDuration());\r\n    const height = endSampleA - startSampleA + 1;\r\n\r\n    const startSampleB = Math.floor(segmentB.start / ssm.getSampleDuration());\r\n    const endSampleB = Math.floor(segmentB.end / ssm.getSampleDuration());\r\n    const width = endSampleB - startSampleB + 1;\r\n\r\n    const D = new Float32Array(height * width).fill(Number.NEGATIVE_INFINITY);\r\n\r\n    const penalty = 0;\r\n    const penalize = (value) => {\r\n        return value <= 0 ? penalty : value;\r\n    };\r\n\r\n    D[0] = penalize(ssm.getValueNormalized(startSampleA, startSampleB));\r\n\r\n    for (let y = 0; y < height; y++) {\r\n        for (let x = 0; x < width; x++) {\r\n            if (y === 0 && x === 0) continue;\r\n            let down = y - 2 >= 0 && x - 1 >= 0 ? D[(y - 2) * width + x - 1] : Number.NEGATIVE_INFINITY;\r\n            let right = y - 1 >= 0 && x - 2 >= 0 ? D[(y - 1) * width + x - 2] : Number.NEGATIVE_INFINITY;\r\n            let diag = y - 1 >= 0 && x - 1 >= 0 ? D[(y - 1) * width + x - 1] : Number.NEGATIVE_INFINITY;\r\n\r\n            D[y * width + x] =\r\n                penalize(ssm.getValueNormalized(startSampleB + x, startSampleA + y)) + Math.max(diag, right, down);\r\n        }\r\n    }\r\n\r\n    const score = D[D.length - 1];\r\n    if (score <= 0) return 0;\r\n\r\n    let x = width - 1;\r\n    let y = height - 1;\r\n    let pathLength = 1;\r\n    while (x > 0 || y > 0) {\r\n        let down = y - 2 >= 0 && x - 1 >= 0 ? D[(y - 2) * width + x - 1] : Number.NEGATIVE_INFINITY;\r\n        let right = y - 1 >= 0 && x - 2 >= 0 ? D[(y - 1) * width + x - 2] : Number.NEGATIVE_INFINITY;\r\n        let diag = y - 1 >= 0 && x - 1 >= 0 ? D[(y - 1) * width + x - 1] : Number.NEGATIVE_INFINITY;\r\n\r\n        if (x === 0) {\r\n            x--;\r\n        } else if (y === 0) {\r\n            y--;\r\n        } else if (down >= right && down >= diag) {\r\n            y -= 2;\r\n            x -= 1;\r\n        } else if (right >= down && right >= diag) {\r\n            y -= 1;\r\n            x -= 2;\r\n        } else if (diag >= down && diag >= right) {\r\n            y -= 1;\r\n            x -= 1;\r\n        }\r\n        pathLength++;\r\n    }\r\n    const similarity = score / pathLength;\r\n\r\n    return similarity;\r\n}\r\n\r\n/**\r\n * Similar if they are aproximately repetitions of each other (overlap)\r\n * @param inducedSegmentsA in the form of a flat Uint16Array with pairs of start and end position of segments\r\n */\r\nexport function segmentDistanceOverlap(inducedSegmentsA, inducedSegmentsB) {\r\n    let maxSimilarity = 0;\r\n    for (let a = 0; a < inducedSegmentsA.length; a += 2) {\r\n        for (let b = 0; b < inducedSegmentsB.length; b += 2) {\r\n            const startA = inducedSegmentsA[a];\r\n            const endA = inducedSegmentsA[a + 1];\r\n            const startB = inducedSegmentsB[b];\r\n            const endB = inducedSegmentsB[b + 1];\r\n\r\n            const disjoint = endA <= startB || endB <= startA;\r\n            if (disjoint) continue;\r\n\r\n            const smallestStart = Math.min(startA, startB);\r\n            const largestEnd = Math.max(endA, endB);\r\n            const union = largestEnd - smallestStart;\r\n\r\n            const smallestEnd = Math.min(endA, endB);\r\n            const largestStart = Math.max(startA, startB);\r\n            const overlap = smallestEnd - largestStart;\r\n            const similarity = overlap / union;\r\n\r\n            if (similarity > maxSimilarity) {\r\n                maxSimilarity = similarity;\r\n            }\r\n        }\r\n    }\r\n    return 1 - maxSimilarity;\r\n}\r\n\r\nlet logi = 0;\r\nexport function computeSegmentPathFamilyInfo(pathSSM, startInSamples, endInSamples, scoreMatrixBuffer, strategy) {\r\n    logi++;\r\n    const sampleAmount = pathSSM.getSampleAmount();\r\n    if (!scoreMatrixBuffer) {\r\n        scoreMatrixBuffer = createScoreMatrixBuffer(sampleAmount);\r\n    }\r\n    const [P, pathScores, score, width] = extractPathFamily(pathSSM, startInSamples, endInSamples, scoreMatrixBuffer);\r\n\r\n    const fitnessFunction = (strategy, P, pathScores, score, sampleAmount, width) => {\r\n        switch (strategy) {\r\n            case \"classic\":\r\n                return familyFitness.computeFitness(P, pathScores, score, sampleAmount, width);\r\n            case \"fine\":\r\n                return familyFitness.computeFineFitness(P, pathScores, score, sampleAmount, width);\r\n            case \"pruned\":\r\n                return familyFitness.computePrunedFitness(P, pathScores, score, sampleAmount, width);\r\n            case \"custom\":\r\n                return familyFitness.computeCustomFitness(P, pathScores, score, sampleAmount, width);\r\n            case \"customPruned\":\r\n                return familyFitness.computeCustomPrunedFitness(P, pathScores, score, sampleAmount, width);\r\n            default:\r\n                log.error(\"No fitness strategy given, falling back to classic\");\r\n                return familyFitness.computeFitness(P, pathScores, score, sampleAmount, width);\r\n        }\r\n    };\r\n\r\n    const {\r\n        fitness,\r\n        normalizedScore,\r\n        coverage,\r\n        normalizedCoverage,\r\n        pathFamilyLength,\r\n        prunedPathFamily,\r\n        prunedPathScores,\r\n    } = fitnessFunction(strategy, P, pathScores, score, sampleAmount, width);\r\n\r\n    const pathFamily = [];\r\n    prunedPathFamily.forEach((path) => {\r\n        const pathCoords = [];\r\n        for (let i = 0; i < path.length; i += 2) {\r\n            const x = startInSamples + path[i];\r\n            const y = path[i + 1];\r\n            pathCoords.push([x, y]);\r\n        }\r\n        pathFamily.push(pathCoords);\r\n    });\r\n\r\n    return {\r\n        score: score,\r\n        pathScores: pathScores,\r\n        normalizedScore: normalizedScore,\r\n        coverage: coverage,\r\n        normalizedCoverage: normalizedCoverage,\r\n        fitness: fitness,\r\n        pathFamily: pathFamily,\r\n    };\r\n}\r\n\r\nexport function simplePathDetect(pathSSM, threshold = 0.1) {\r\n    const size = pathSSM.getSize();\r\n    const paths = [];\r\n\r\n    for (let y = 0; y < size; y++) {\r\n        let path = [];\r\n        for (let i = 0; i + y < size; i++) {\r\n            const value = pathSSM.getValueNormalized(i, i + y);\r\n            if (value > threshold) {\r\n                path.push(i, i + y);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function getDistanceMatrix(segments, pathSSM, strategy, kappa = 0.7) {\r\n    const amount = segments.length;\r\n    const distanceMatrix = new HalfMatrix({ size: amount, numberType: HalfMatrix.NumberType.FLOAT32 });\r\n\r\n    const segmentInducedSegments = [];\r\n\r\n    segments.forEach((segment) => {\r\n        const sampleStart = Math.floor(segment.start / pathSSM.getSampleDuration());\r\n        const sampleEnd = Math.floor(segment.end / pathSSM.getSampleDuration());\r\n        const inducedSegments = getInducedSegmentsFromSampleRange(sampleStart, sampleEnd, pathSSM);\r\n        segmentInducedSegments.push(inducedSegments);\r\n    });\r\n    distanceMatrix.fill((x, y) => {\r\n        let dist = 0;\r\n        const sameGroup = segments[x].groupID === segments[y].groupID;\r\n        switch (strategy) {\r\n            case \"DTW\":\r\n                dist = (1 - segmentSimilarityDTW(segments[x], segments[y], pathSSM)) * (sameGroup ? kappa : 1);\r\n                //dist = Math.max(0, (1 - segmentSimilarityDTW(segments[x], segments[y], pathSSM) - 0.5) * 2);\r\n                //dist = 1 / (1 + segmentSimilarityDTW(segments[x], segments[y], pathSSM));\r\n                break;\r\n            case \"overlap\":\r\n                dist = segmentDistanceOverlap(segmentInducedSegments[x], segmentInducedSegments[y]);\r\n                break;\r\n        }\r\n        return dist;\r\n    });\r\n    return distanceMatrix;\r\n}\r\n","//import Matrix from \"ml-matrix\";\r\nimport HalfMatrix from \"./dataStructures/HalfMatrix\";\r\nimport * as similarity from \"./similarity\";\r\n\r\nimport * as log from \"../dev/log\";\r\nimport seedrandom from \"seedrandom\";\r\nimport numeric from \"numeric\";\r\nimport { features } from \"process\";\r\nconst {\r\n    Matrix,\r\n    inverse,\r\n    solve,\r\n    linearDependencies,\r\n    QrDecomposition,\r\n    LuDecomposition,\r\n    CholeskyDecomposition,\r\n    EigenvalueDecomposition,\r\n    pseudoInverse,\r\n} = require(\"ml-matrix\");\r\nexport function getMDSFeature(\r\n    distanceMatrix,\r\n    { lr = 40, maxSteps = 20, minLossDifference = 1e-6, momentum = 0, logEvery = 5 } = {}\r\n) {\r\n    let feature = classicalMDS(distanceMatrix.getNestedArray(), 1);\r\n    feature = feature.map((val) => val[0]);\r\n\r\n    //normalize to [0, 1]\r\n\r\n    let max = Math.max(...feature);\r\n    let min = Math.min(...feature);\r\n\r\n    feature = feature.map((val) => (val - min) / (max - min));\r\n\r\n    return feature;\r\n}\r\n\r\nexport function getMDSCoordinatesSamples(features, strategy) {\r\n    log.debug(\"CalculatingMDSSamples\");\r\n    const amount = features.length;\r\n    const distanceMatrix = new HalfMatrix({ size: amount, numberType: HalfMatrix.NumberType.FLOAT32 });\r\n    distanceMatrix.fill((x, y) => {\r\n        return 1 - similarity.cosine(features[x], features[y]);\r\n    });\r\n    let coords = [];\r\n    switch (strategy) {\r\n        case \"Classic\":\r\n            coords = classicalMDS(distanceMatrix.getNestedArray(), 1);\r\n            break;\r\n        case \"GD\":\r\n            coords = getMdsCoordinatesWithGradientDescentMatrix(new Matrix(distanceMatrix.getNestedArray()), {\r\n                lr: 5,\r\n            }).coordinates.data;\r\n            break;\r\n    }\r\n\r\n    return normalize1DCoordinates(coords);\r\n}\r\n\r\nexport function getMDSCoordinates(\r\n    distanceMatrix,\r\n    strategy = \"Classic\",\r\n    { lr = 40, maxSteps = 20, minLossDifference = 1e-6, momentum = 0, logEvery = 5 } = {}\r\n) {\r\n    log.debug(\"CalculatingMDS\");\r\n\r\n    // transform matrix to Matrix\r\n    const mlDistanceMatrix = new Matrix(distanceMatrix.getNestedArray());\r\n    /*const mlCoordinates = getMdsCoordinatesWithGradientDescentMatrix(mlDistanceMatrix, {\r\n        lr,\r\n        maxSteps,\r\n        minLossDifference,\r\n        momentum,\r\n        logEvery,\r\n    });*/\r\n\r\n    /*const mlCoordinates = getMdsCoordinatesWithGaussNewton(mlDistanceMatrix, {\r\n        lr: 2,\r\n        maxSteps: 200,\r\n        minLossDifference,\r\n        logEvery,\r\n    });*/\r\n\r\n    //const coordsOld = classicalMDS(distanceMatrix.getNestedArray(), 2);\r\n    //log.debug(\"oldcoords\", coordsOld);\r\n    const learnRates = [13];\r\n    let best = null;\r\n    let bestLoss = 1;\r\n    let coords;\r\n    switch (strategy) {\r\n        case \"Classic\":\r\n            coords = classicalMDS(distanceMatrix.getNestedArray(), 2);\r\n            break;\r\n        case \"GDTries\":\r\n            learnRates.push(0.5, 1, 2, 4, 8);\r\n            for (let r = 0; r < learnRates.length; r++) {\r\n                const rate = learnRates[r];\r\n                coords = getMdsCoordinatesWithGradientDescentMatrix(new Matrix(distanceMatrix.getNestedArray()), {\r\n                    lr: rate,\r\n                });\r\n                if (coords.lossPerStep[coords.lossPerStep.length - 1] < bestLoss) {\r\n                    best = coords;\r\n                    log.debug(\"Best is\", rate);\r\n                    bestLoss = coords.lossPerStep[coords.lossPerStep.length - 1];\r\n                }\r\n            }\r\n            coords = best.coordinates.data;\r\n            break;\r\n        case \"GD\":\r\n            for (let r = 0; r < learnRates.length; r++) {\r\n                const rate = learnRates[r];\r\n                coords = getMdsCoordinatesWithGradientDescentMatrix(new Matrix(distanceMatrix.getNestedArray()), {\r\n                    lr: rate,\r\n                });\r\n                if (isNaN(coords.lossPerStep[coords.lossPerStep.length - 1])) {\r\n                    learnRates.push(learnRates[learnRates.length - 1] / 2);\r\n                    log.debug(\"Changing rate to\", learnRates[learnRates.length - 1]);\r\n                } else if (coords.lossPerStep[coords.lossPerStep.length - 1] < bestLoss) {\r\n                    best = coords;\r\n                    log.debug(\"Best is\", rate);\r\n                    bestLoss = coords.lossPerStep[coords.lossPerStep.length - 1];\r\n                }\r\n            }\r\n            coords = best.coordinates.data;\r\n            break;\r\n        case \"GN\":\r\n            coords = getMdsCoordinatesWithGaussNewton(new Matrix(distanceMatrix.getNestedArray())).coordinates.data;\r\n            break;\r\n    }\r\n\r\n    return normalize2DCoordinates(coords);\r\n}\r\n\r\n/**\r\n * @fileoverview Functions for solving a Multidimensional Scaling problem with\r\n * gradient descent (optionally with momentum) or the Gauss-Newton algorithm.\r\n *\r\n * The two central functions are getMdsCoordinatesWithGradientDescent(...) and\r\n * getMdsCoordinatesWithGaussNewton(...).\r\n *\r\n * Dependencies:\r\n * - The ml-matrix library for computing matrix manipulations, see\r\n *   https://github.com/mljs/matrix.\r\n *   Version used: 6.4.1\r\n * - seedrandom, see https://github.com/davidbau/seedrandom.\r\n *   Version used: 3.0.5\r\n */\r\n\r\n/**\r\n * Solves a Multidimensional Scaling problem with gradient descent.\r\n *\r\n * If momentum is != 0, the update is:\r\n *\r\n * accumulation = momentum * accumulation + gradient\r\n * parameters -= learning_rate * accumulation\r\n *\r\n * like in TensorFlow and PyTorch.\r\n *\r\n * In the returned object, coordinates is a matrix of shape (n, 2) containing\r\n * the solution.\r\n *\r\n * @param {!Matrix} distances - matrix of shape (n, n) containing the\r\n *   distances between n points.\r\n * @param {!number} lr - learning rate to use.\r\n * @param {!number} maxSteps - maximum number of update steps.\r\n * @param {!number} minLossDifference - if the absolute difference between the\r\n *   losses of the current and the previous optimization step is smaller than\r\n *   this value, the function will return early.\r\n * @param {!number} momentum - momentum of the gradient descent. Set this value\r\n *   to zero to disable momentum.\r\n * @param {!number} logEvery - if larger than zero, this value determines the\r\n *   steps between logs to the console.\r\n * @returns {{coordinates: Matrix, lossPerStep: number[]}}\r\n */\r\nfunction getMdsCoordinatesWithGradientDescentMatrix(\r\n    distances,\r\n    { lr = 7, maxSteps = 500, minLossDifference = 1e-9, momentum = 0, logEvery = 0 } = {}\r\n) {\r\n    const numCoordinates = distances.rows;\r\n    let coordinates = getInitialMdsCoordinates(numCoordinates);\r\n\r\n    const lossPerStep = [];\r\n    let accumulation = null;\r\n\r\n    for (let step = 0; step < maxSteps; step++) {\r\n        const loss = getMdsLoss(distances, coordinates);\r\n        lossPerStep.push(loss);\r\n\r\n        // Check if we should early stop.\r\n        if (lossPerStep.length > 1) {\r\n            const lossPrev = lossPerStep[lossPerStep.length - 2];\r\n            if (Math.abs(lossPrev - loss) < minLossDifference || isNaN(loss) || loss > 10) {\r\n                return { coordinates: coordinates, lossPerStep: lossPerStep };\r\n            }\r\n        }\r\n\r\n        if (logEvery > 0 && step % logEvery === 0) {\r\n            console.log(`Step: ${step}, loss: ${loss}`);\r\n        }\r\n\r\n        // Apply the gradient for each coordinate.\r\n        for (let coordIndex = 0; coordIndex < numCoordinates; coordIndex++) {\r\n            const gradient = getGradientForCoordinate(distances, coordinates, coordIndex);\r\n\r\n            if (momentum === 0 || accumulation == null) {\r\n                accumulation = gradient;\r\n            } else {\r\n                accumulation = Matrix.add(Matrix.mul(accumulation, momentum), gradient);\r\n            }\r\n            const update = Matrix.mul(accumulation, lr);\r\n            const updatedCoordinates = Matrix.sub(coordinates.getRowVector(coordIndex), update);\r\n            coordinates.setRow(coordIndex, updatedCoordinates);\r\n        }\r\n    }\r\n\r\n    return { coordinates: coordinates, lossPerStep: lossPerStep };\r\n}\r\n\r\n/**\r\n * Solves a Multidimensional Scaling problem with the Gauss-Newton algorithm.\r\n *\r\n * In the returned object, coordinates is a matrix of shape (n, 2) containing\r\n * the solution.\r\n *\r\n * @param {!Matrix} distances - matrix of shape (n, n) containing the\r\n *   distances between n points.\r\n * @param {!number} lr - learning rate / alpha to use.\r\n * @param {!number} maxSteps - maximum number of update steps.\r\n * @param {!number} minLossDifference - if the absolute difference between the\r\n *   losses of the current and the previous optimization step is smaller than\r\n *   this value, the function will return early.\r\n * @param {!number} logEvery - if larger than zero, this value determines the\r\n *   steps between logs to the console.\r\n * @returns {{coordinates: Matrix, lossPerStep: number[]}}\r\n * { lr = 0.1, maxSteps = 200, minLossDifference = 1e-7, logEvery = 0 }\r\n */\r\nfunction getMdsCoordinatesWithGaussNewton(\r\n    distances,\r\n    { lr = 0.7, maxSteps = 100, minLossDifference = 0.0001, logEvery = 5 } = {}\r\n) {\r\n    const numCoordinates = distances.rows;\r\n    let coordinates = getInitialMdsCoordinates(numCoordinates);\r\n    const dimensions = coordinates.columns;\r\n\r\n    const lossPerStep = [];\r\n\r\n    for (let step = 0; step < maxSteps; step++) {\r\n        const loss = getMdsLoss(distances, coordinates);\r\n        lossPerStep.push(loss);\r\n\r\n        // Check if we should early stop.\r\n        if (lossPerStep.length > 1) {\r\n            const lossPrev = lossPerStep[lossPerStep.length - 2];\r\n            if (Math.abs(lossPrev - loss) < minLossDifference) {\r\n                return { coordinates: coordinates, lossPerStep: lossPerStep };\r\n            }\r\n        }\r\n\r\n        if (logEvery > 0 && step % logEvery === 0) {\r\n            console.log(`Step: ${step}, loss: ${loss}`);\r\n        }\r\n\r\n        // Apply the update.\r\n        const { residuals, jacobian } = getResidualsWithJacobian(distances, coordinates);\r\n        const update = pseudoInverse(jacobian).mmul(residuals);\r\n        for (let coordIndex = 0; coordIndex < numCoordinates; coordIndex++) {\r\n            for (let dimension = 0; dimension < dimensions; dimension++) {\r\n                const updateIndex = coordIndex * dimensions + dimension;\r\n                const paramValue = coordinates.get(coordIndex, dimension);\r\n                const updateDelta = lr * update.get(updateIndex, 0);\r\n                const updatedValue = paramValue - updateDelta;\r\n                coordinates.set(coordIndex, dimension, updatedValue);\r\n            }\r\n        }\r\n    }\r\n\r\n    return { coordinates: coordinates, lossPerStep: lossPerStep };\r\n}\r\n\r\n/**\r\n * Initializes the solution by sampling from a uniform distribution, which\r\n * only allows distances in [0, 1].\r\n *\r\n * @param {!number} numCoordinates - the number of points in the solution.\r\n * @param {!number} dimensions - the number of dimensions of each point.\r\n * @param {!number} seed - seed for the random number generator.\r\n * @returns {Matrix}\r\n */\r\nfunction getInitialMdsCoordinates(numCoordinates, dimensions = 2, seed = 1) {\r\n    const randomUniform = Matrix.rand(numCoordinates, dimensions, { random: new seedrandom(seed) });\r\n    return Matrix.div(randomUniform, Math.sqrt(dimensions));\r\n}\r\n\r\n/**\r\n * Returns the loss of a given solution to the Multidimensional Scaling\r\n * problem by computing the mean squared difference between target distances\r\n * and distances between points in the solution.\r\n *\r\n * @param {!Matrix} distances - matrix of shape (n, n) containing the\r\n *   distances between n points, defining the MDS problem.\r\n * @param {!Matrix} coordinates - a matrix of shape (n, d) containing\r\n *   the solution, for example given by getMdsCoordinatesWithGaussNewton(...).\r\n *   d is the number of dimensions.\r\n * @returns {number}\r\n */\r\nfunction getMdsLoss(distances, coordinates) {\r\n    // Average the squared differences of target distances and predicted\r\n    // distances.\r\n    let loss = 0;\r\n    const normalizer = Math.pow(coordinates.rows, 2);\r\n    for (let coordIndex1 = 0; coordIndex1 < coordinates.rows; coordIndex1++) {\r\n        for (let coordIndex2 = 0; coordIndex2 < coordinates.rows; coordIndex2++) {\r\n            if (coordIndex1 === coordIndex2) continue;\r\n\r\n            const coord1 = coordinates.getRowVector(coordIndex1);\r\n            const coord2 = coordinates.getRowVector(coordIndex2);\r\n            const target = distances.get(coordIndex1, coordIndex2);\r\n            const predicted = Matrix.sub(coord1, coord2).norm();\r\n            loss += Math.pow(target - predicted, 2) / normalizer;\r\n        }\r\n    }\r\n    return loss;\r\n}\r\n\r\n/**\r\n * Returns the residuals and the Jacobian matrix for performing one step of the\r\n * Gauss-Newton algorithm.\r\n *\r\n * The residuals are returned in a flattened vector as (target - predicted) /\r\n * numCoordinates. The flattened vector is ordered based on iterating the\r\n * matrix given by distances in row-major order. We divide by coordinates.rows,\r\n * so that the sum of squared residuals equals the MDS loss, which involves a\r\n * division by coordinates.rows ** 2.\r\n *\r\n * The element of the Jacobian at row i and column j should contain the\r\n * partial derivative of the i-th residual w.r.t. the j-th coordinate. The\r\n * coordinates are indexed in row-major order, such that in two dimensions,\r\n * the 5th zero-based index corresponds to the second coordinate of the third\r\n * point.\r\n *\r\n * @param {!Matrix} distances - matrix of shape (n, n) containing the\r\n *   distances between n points, defining the MDS problem.\r\n * @param {!Matrix} coordinates - a matrix of shape (n, d) containing\r\n *   the current solution, where d is the number of dimensions.\r\n * @returns {{jacobian: Matrix, residuals: Matrix}}\r\n */\r\nfunction getResidualsWithJacobian(distances, coordinates) {\r\n    const residuals = [];\r\n    const numCoordinates = coordinates.rows;\r\n    const dimensions = coordinates.columns;\r\n    const jacobian = Matrix.zeros(numCoordinates * numCoordinates, numCoordinates * dimensions);\r\n\r\n    for (let coordIndex1 = 0; coordIndex1 < numCoordinates; coordIndex1++) {\r\n        for (let coordIndex2 = 0; coordIndex2 < numCoordinates; coordIndex2++) {\r\n            if (coordIndex1 === coordIndex2) {\r\n                residuals.push(0);\r\n                // The gradient for all coordinates is zero, so we can skip\r\n                // this row of the Jacobian.\r\n                continue;\r\n            }\r\n\r\n            // Compute the residual.\r\n            const coord1 = coordinates.getRowVector(coordIndex1);\r\n            const coord2 = coordinates.getRowVector(coordIndex2);\r\n            const squaredDifferenceSum = Matrix.sub(coord1, coord2)\r\n                .pow(2)\r\n                .sum();\r\n            const predicted = Math.sqrt(squaredDifferenceSum);\r\n            const target = distances.get(coordIndex1, coordIndex2);\r\n            const residual = (target - predicted) / numCoordinates;\r\n            residuals.push(residual);\r\n\r\n            // Compute the gradient w.r.t. the first coordinate only. The\r\n            // second coordinate is seen as a constant.\r\n            const residualWrtPredicted = -1 / numCoordinates;\r\n            const predictedWrtSquaredDifferenceSum = 0.5 / Math.sqrt(squaredDifferenceSum);\r\n            const squaredDifferenceSumWrtCoord1 = Matrix.mul(Matrix.sub(coord1, coord2), 2);\r\n            const residualWrtCoord1 = Matrix.mul(\r\n                squaredDifferenceSumWrtCoord1,\r\n                residualWrtPredicted * predictedWrtSquaredDifferenceSum\r\n            );\r\n\r\n            // Set the corresponding indices in the Jacobian.\r\n            const rowIndex = numCoordinates * coordIndex1 + coordIndex2;\r\n            for (let dimension = 0; dimension < dimensions; dimension++) {\r\n                const columIndex = dimensions * coordIndex1 + dimension;\r\n                const jacobianEntry = jacobian.get(rowIndex, columIndex);\r\n                const entryUpdated = jacobianEntry + residualWrtCoord1.get(0, dimension);\r\n                jacobian.set(rowIndex, columIndex, entryUpdated);\r\n            }\r\n        }\r\n    }\r\n    return {\r\n        residuals: Matrix.columnVector(residuals),\r\n        jacobian: jacobian,\r\n    };\r\n}\r\n\r\n/**\r\n * Returns the gradient of the loss w.r.t. to a specific point in the\r\n * given solution.\r\n *\r\n * The returned matrix has the shape (1, d), where d is the number of\r\n * dimensions.\r\n *\r\n * @param {!Matrix} distances - matrix of shape (n, n) containing the\r\n *   distances between n points, defining the MDS problem.\r\n * @param {!Matrix} coordinates - a matrix of shape (n, d) containing\r\n *   the current solution, where d is the number of dimensions.\r\n * @param {!number} coordIndex - index of the point for which the gradient\r\n *   shall be computed.\r\n * @returns {Matrix}\r\n */\r\nfunction getGradientForCoordinate(distances, coordinates, coordIndex) {\r\n    const coord = coordinates.getRowVector(coordIndex);\r\n    const normalizer = Math.pow(coordinates.rows, 2);\r\n    let gradient = Matrix.zeros(1, coord.columns);\r\n\r\n    for (let otherCoordIndex = 0; otherCoordIndex < coordinates.rows; otherCoordIndex++) {\r\n        if (coordIndex === otherCoordIndex) continue;\r\n\r\n        const otherCoord = coordinates.getRowVector(otherCoordIndex);\r\n        const squaredDifferenceSum = Matrix.sub(coord, otherCoord)\r\n            .pow(2)\r\n            .sum();\r\n        const predicted = Math.sqrt(squaredDifferenceSum);\r\n        const targets = [distances.get(coordIndex, otherCoordIndex), distances.get(otherCoordIndex, coordIndex)];\r\n\r\n        for (const target of targets) {\r\n            const lossWrtPredicted = (-2 * (target - predicted)) / normalizer;\r\n            const predictedWrtSquaredDifferenceSum = 0.5 / Math.sqrt(squaredDifferenceSum);\r\n            const squaredDifferenceSumWrtCoord = Matrix.mul(Matrix.sub(coord, otherCoord), 2);\r\n            const lossWrtCoord = Matrix.mul(\r\n                squaredDifferenceSumWrtCoord,\r\n                lossWrtPredicted * predictedWrtSquaredDifferenceSum\r\n            );\r\n            gradient = Matrix.add(gradient, lossWrtCoord);\r\n        }\r\n    }\r\n\r\n    return gradient;\r\n}\r\n\r\nfunction classicalMDS(distances, dimensions) {\r\n    dimensions = dimensions || 2;\r\n\r\n    // square distances\r\n    var M = numeric.mul(-0.5, numeric.pow(distances, 2));\r\n\r\n    // double centre the rows/columns\r\n    function mean(A) {\r\n        return numeric.div(numeric.add.apply(null, A), A.length);\r\n    }\r\n    var rowMeans = mean(M),\r\n        colMeans = mean(numeric.transpose(M)),\r\n        totalMean = mean(rowMeans);\r\n\r\n    for (var i = 0; i < M.length; ++i) {\r\n        for (var j = 0; j < M[0].length; ++j) {\r\n            M[i][j] += totalMean - rowMeans[i] - colMeans[j];\r\n        }\r\n    }\r\n\r\n    // take the SVD of the double centred matrix, and return the\r\n    // points from it\r\n    var ret = numeric.svd(M),\r\n        eigenValues = numeric.sqrt(ret.S);\r\n    return ret.U.map(function(row) {\r\n        return numeric.mul(row, eigenValues).splice(0, dimensions);\r\n    });\r\n}\r\n\r\nexport function getAngleAndRadius(mdsCoordinate) {\r\n    const x = mdsCoordinate[0];\r\n    const y = mdsCoordinate[1];\r\n    let angle = Math.atan2(y, x) / (2 * Math.PI);\r\n    angle = angle < 0 ? 1 + angle : angle;\r\n    const radius = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));\r\n    return [angle, radius];\r\n}\r\nexport function normalize1DCoordinates(coords) {\r\n    coords = coords.map((coord) => coord[0]);\r\n    let min = Number.POSITIVE_INFINITY;\r\n    let max = Number.NEGATIVE_INFINITY;\r\n    for (let i = 0; i < coords.length; i++) {\r\n        if (coords[i] < min) min = coords[i];\r\n        if (coords[i] > max) max = coords[i];\r\n    }\r\n    for (let i = 0; i < coords.length; i++) {\r\n        coords[i] = (coords[i] - min) / (max - min);\r\n    }\r\n    log.debug(\"minmax\", min, max, coords);\r\n    return coords;\r\n}\r\nexport function normalize2DCoordinates(coords) {\r\n    let centerX = 0;\r\n    let centerY = 0;\r\n\r\n    for (let i = 0; i < coords.length; i++) {\r\n        centerX += coords[i][0];\r\n        centerY += coords[i][1];\r\n    }\r\n    centerX /= coords.length;\r\n    centerY /= coords.length;\r\n    for (let i = 0; i < coords.length; i++) {\r\n        coords[i][0] -= centerX;\r\n        coords[i][1] -= centerY;\r\n    }\r\n\r\n    // scale by largest\r\n    let maxRadius = 0;\r\n    for (let i = 0; i < coords.length; i++) {\r\n        const coord = coords[i];\r\n        const radius = Math.sqrt(coord[0] * coord[0] + coord[1] * coord[1]);\r\n        if (radius > maxRadius) maxRadius = radius;\r\n    }\r\n\r\n    for (let i = 0; i < coords.length; i++) {\r\n        coords[i] = [coords[i][0] / maxRadius, coords[i][1] / maxRadius];\r\n    }\r\n    return coords;\r\n}\r\n","import * as sim from \"./similarity\";\r\nimport * as audioUtil from \"./audioUtil\";\r\nimport * as log from \"../dev/log\";\r\nimport Matrix from \"./dataStructures/Matrix\";\r\nimport HalfMatrix from \"./dataStructures/HalfMatrix\";\r\nimport { NumberType } from \"./dataStructures/NumberType\";\r\nimport asciichart from \"asciichart\";\r\n\r\nexport function calculateSSM(\r\n    features,\r\n    sampleDuration,\r\n    allPitches = false,\r\n    threshold = 0,\r\n    similarityFunction = \"cosine\"\r\n) {\r\n    const ssm = new HalfMatrix({\r\n        size: features.length,\r\n        numberType: HalfMatrix.NumberType.UINT8,\r\n        sampleDuration: sampleDuration,\r\n        featureAmount: allPitches ? 12 : 1,\r\n    });\r\n    ssm.fillFeaturesNormalized((x, y, f) => {\r\n        if (similarityFunction === \"cosine\") {\r\n            return Math.max(0, sim.cosineTransposed(features[x], features[y], f) - threshold) / (1 - threshold);\r\n        } else if (similarityFunction === \"euclidean\") {\r\n            const val = sim.euclidianPitchTransposed(features[x], features[y], f);\r\n            if (val < 0 || val > 1) {\r\n                log.debug(x, y, val, features[x], features[y]);\r\n            }\r\n            return (\r\n                Math.max(0, Math.min(1, sim.euclidianPitchTransposed(features[x], features[y], f) - threshold)) /\r\n                (1 - threshold)\r\n            );\r\n        } else if (similarityFunction === \"euclideanTimbre\") {\r\n            return (\r\n                Math.max(0, Math.min(1, sim.euclidianTimbre(features[x], features[y]) - threshold)) / (1 - threshold)\r\n            );\r\n        }\r\n    });\r\n    return ssm;\r\n}\r\n\r\n/**\r\n * Diagonal smoothing of ssm, keeps paths but removes noise\r\n * @param {*} ssm\r\n * @param {*} options {`strategy`: choice of `onedir, linear, gauss, linmed`,`blurTime`: length in seconds, `blurLength`: length in samples, `tempoRatios`: array of ratios (e.g. [1.5] blurs paths that denote segment similarity with speed difference of 1.5)}\r\n */\r\nexport function enhanceSSM(ssm, options, allPitches = false) {\r\n    const blurLength = options.blurLength || Math.round(options.blurTime / ssm.sampleDuration) || 4;\r\n    const tempoRatios = options.tempoRatios || [1];\r\n    const strategy = options.strategy || \"linmed\";\r\n\r\n    const enhancementPasses = [];\r\n    for (const tempoRatio of tempoRatios) {\r\n        if (strategy === \"onedir\")\r\n            enhancementPasses.push(onedirectionalSmoothing(ssm, 1, Math.floor(blurLength / 2), tempoRatio));\r\n        if (strategy === \"onedir\")\r\n            enhancementPasses.push(onedirectionalSmoothing(ssm, -1, Math.floor(blurLength / 2), tempoRatio));\r\n        if (strategy === \"linear\" || strategy === \"lin\")\r\n            enhancementPasses.push(linearSmoothing(ssm, blurLength, tempoRatio));\r\n        if (strategy === \"gaussian\" || strategy === \"gauss\")\r\n            enhancementPasses.push(gaussianSmoothing(ssm, blurLength, tempoRatio));\r\n        if (strategy === \"onedirmed\")\r\n            enhancementPasses.push(\r\n                medianSmoothing(\r\n                    onedirectionalSmoothing(ssm, 1, Math.floor(blurLength / 2), tempoRatio),\r\n                    blurLength,\r\n                    tempoRatio\r\n                )\r\n            );\r\n        if (strategy === \"onedirmed\")\r\n            enhancementPasses.push(\r\n                medianSmoothing(\r\n                    onedirectionalSmoothing(ssm, -1, Math.floor(blurLength / 2), tempoRatio),\r\n                    blurLength,\r\n                    tempoRatio\r\n                )\r\n            );\r\n        if (strategy === \"linmed\")\r\n            enhancementPasses.push(\r\n                medianSmoothing(linearSmoothing(ssm, blurLength, tempoRatio), blurLength * 1.5, tempoRatio)\r\n            );\r\n        if (strategy === \"gaussmed\")\r\n            enhancementPasses.push(\r\n                medianSmoothing(gaussianSmoothing(ssm, blurLength, tempoRatio), blurLength * 1.5, tempoRatio)\r\n            );\r\n        if (strategy === \"med\") enhancementPasses.push(medianSmoothing(ssm, blurLength, tempoRatio));\r\n    }\r\n\r\n    const enhancedSSM = HalfMatrix.from(ssm);\r\n    enhancedSSM.fillByIndex((i) => {\r\n        let max = 0;\r\n        for (const enhancementPass of enhancementPasses) {\r\n            if (enhancementPass.data[i] > max) {\r\n                max = enhancementPass.data[i];\r\n            }\r\n        }\r\n        return max;\r\n    });\r\n    return enhancedSSM;\r\n}\r\n\r\nexport function onedirectionalSmoothing(ssm, direction, length, tempoRatio) {\r\n    const smoothedSSM = HalfMatrix.from(ssm);\r\n\r\n    const tempos = new Int8Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n        tempos[i] = Math.round(i * tempoRatio);\r\n    }\r\n\r\n    smoothedSSM.fillFeatures((x, y, f) => {\r\n        let sum = 0;\r\n        for (let i = 0; i !== direction * length; i += direction) {\r\n            if (ssm.hasCell(x + i, y + direction * tempos[Math.abs(i)])) {\r\n                sum += ssm.getValue(x + i, y + direction * tempos[Math.abs(i)], f);\r\n            }\r\n        }\r\n        return sum / length;\r\n    });\r\n    return smoothedSSM;\r\n}\r\n\r\nfunction linearSmoothing(ssm, length, tempoRatio) {\r\n    const smoothedSSM = HalfMatrix.from(ssm);\r\n\r\n    const blur = Math.round(length / 2); //Math.floor(length / 2);\r\n    const total = Math.pow(blur + 1, 2);\r\n    const tempos = new Int8Array(blur * 2 + 1);\r\n    for (let i = -blur; i < 1 + blur; i++) {\r\n        tempos[i + blur] = Math.round(i * tempoRatio);\r\n    }\r\n\r\n    smoothedSSM.fillFeatures((x, y, f) => {\r\n        let sum = 0;\r\n        for (let i = -blur; i < 1 + blur; i++) {\r\n            if (ssm.hasCell(x + i, y + tempos[i + blur])) {\r\n                sum += ssm.getValue(x + i, y + tempos[i + blur], f) * (blur + 1 - Math.abs(i));\r\n            }\r\n        }\r\n        return sum / total;\r\n    });\r\n    return smoothedSSM;\r\n}\r\n\r\nfunction medianSmoothing(ssm, length, tempoRatio, resolution = 128) {\r\n    const buckets = new Float32Array(resolution);\r\n\r\n    const l = Math.floor((length - 1) / 2);\r\n\r\n    const tempos = new Int8Array(l * 2 + 1);\r\n    for (let i = -l; i < 1 + l; i++) {\r\n        tempos[i + l] = Math.round(i * tempoRatio);\r\n    }\r\n    const smoothedSSM = HalfMatrix.from(ssm);\r\n\r\n    smoothedSSM.fillFeaturesNormalized((x, y, f) => {\r\n        let totalValues = l * 2 + 1;\r\n        for (let offset = -l; offset <= l; offset++) {\r\n            if (ssm.hasCell(x + offset, y + tempos[offset + l])) {\r\n                const value = ssm.getValueNormalized(x + offset, y + tempos[offset + l], f);\r\n                buckets[Math.floor(value * (resolution - 1))]++;\r\n            } else {\r\n                buckets[0]++;\r\n            }\r\n        }\r\n        let middle = totalValues / 2;\r\n\r\n        //Both check middle and clear buckets\r\n        let mean = -1;\r\n        for (let i = 0; i < resolution; i++) {\r\n            middle -= buckets[i];\r\n            if (middle < 0 && mean === -1) {\r\n                mean = i / (resolution - 1);\r\n            }\r\n            buckets[i] = 0;\r\n        }\r\n        return mean;\r\n    });\r\n\r\n    return smoothedSSM;\r\n}\r\n\r\nfunction gaussianSmoothing(ssm, length, tempoRatio) {\r\n    const smoothedSSM = HalfMatrix.from(ssm);\r\n\r\n    const blur = Math.round(length / 2); //Math.floor(length / 2);\r\n    const tempos = new Int8Array(blur * 2 + 1);\r\n    const gaussianKernel = gauss(blur);\r\n    for (let i = -blur; i < 1 + blur; i++) {\r\n        tempos[i + blur] = Math.round(i * tempoRatio);\r\n    }\r\n    //const lengthRatio = 1/Math.sqrt(1+tempoRatio);\r\n\r\n    smoothedSSM.fillFeatures((x, y, f) => {\r\n        let sum = 0;\r\n        for (let i = -blur; i < 1 + blur; i++) {\r\n            if (ssm.hasCell(x + i, y + tempos[i + blur])) {\r\n                sum += ssm.getValue(x + i, y + tempos[i + blur], f) * gaussianKernel[i + blur];\r\n            }\r\n        }\r\n        return sum;\r\n    });\r\n    return smoothedSSM;\r\n}\r\n\r\nfunction gauss(blur, sigma = 2) {\r\n    const gauss = new Float32Array(blur * 2 + 1);\r\n    for (let i = -blur; i < 1 + blur; i++) {\r\n        gauss[i + blur] = (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-Math.pow(i, 2) / (2 * Math.pow(sigma, 2)));\r\n    }\r\n    return gauss;\r\n}\r\n\r\nexport function makeTranspositionInvariant(ssm) {\r\n    const lengthWithoutFeatures = ssm.length / ssm.featureAmount;\r\n    const transpositionInvariantSSM = new HalfMatrix({\r\n        size: ssm.size,\r\n        numberType: HalfMatrix.NumberType.UINT8,\r\n        sampleDuration: ssm.sampleDuration,\r\n    });\r\n\r\n    let i = 0;\r\n    while (i < lengthWithoutFeatures) {\r\n        let max = 0;\r\n        for (let f = 0; f < ssm.featureAmount; f++) {\r\n            if (ssm.data[i * ssm.featureAmount + f] > max) {\r\n                max = ssm.data[i * ssm.featureAmount + f];\r\n            }\r\n        }\r\n        transpositionInvariantSSM.data[i] = max;\r\n        i++;\r\n    }\r\n    return transpositionInvariantSSM;\r\n}\r\n\r\nexport function autoThreshold(ssm, percentage) {\r\n    const typeScale = ssm.numberType.scale;\r\n\r\n    let frequencies = new Uint32Array(typeScale + 1).fill(0);\r\n    let totalCells = 0;\r\n    let zeros = 0;\r\n    let tff = 0;\r\n    ssm.forEach((cell) => {\r\n        if (cell === 0) zeros++;\r\n        if (cell === 255) tff++;\r\n        frequencies[Math.floor(cell)] = frequencies[Math.floor(cell)] + 1;\r\n        totalCells++;\r\n    });\r\n\r\n    let percentagePosition = totalCells - totalCells * percentage;\r\n    let thresholdValue;\r\n    for (let i = 0; i < typeScale + 1; i++) {\r\n        percentagePosition -= frequencies[i];\r\n        if (percentagePosition <= 0) {\r\n            thresholdValue = i / typeScale;\r\n            break;\r\n        }\r\n    }\r\n    let thresholdSSM;\r\n    if (ssm instanceof Matrix) {\r\n        thresholdSSM = Matrix.from(ssm);\r\n    } else {\r\n        thresholdSSM = HalfMatrix.from(ssm);\r\n    }\r\n    for (let i = 0; i < ssm.length; i++) {\r\n        thresholdSSM.data[i] =\r\n            Math.min(Math.max(ssm.data[i] / typeScale - thresholdValue, 0) / (1 - thresholdValue), 1) * typeScale;\r\n    }\r\n    return thresholdSSM;\r\n}\r\n\r\nexport function multiply(ssm, factor) {\r\n    let multSSM;\r\n    if (ssm instanceof Matrix) {\r\n        multSSM = Matrix.from(ssm);\r\n    } else {\r\n        multSSM = HalfMatrix.from(ssm);\r\n    }\r\n\r\n    multSSM.fillNormalized((x, y) => {\r\n        const val = factor * ssm.getValueNormalizedMirrored(x, y);\r\n        if (val < 0) {\r\n            return 0;\r\n        } else if (val > 1) {\r\n            return 1;\r\n        } else {\r\n            return val;\r\n        }\r\n    });\r\n\r\n    return multSSM;\r\n}\r\n\r\nexport function threshold(ssm, threshold) {\r\n    let thresholdSSM;\r\n    if (ssm instanceof Matrix) {\r\n        thresholdSSM = Matrix.from(ssm);\r\n    } else {\r\n        thresholdSSM = HalfMatrix.from(ssm);\r\n    }\r\n\r\n    thresholdSSM.fillNormalized((x, y) => {\r\n        const originalValue = ssm.getValueNormalizedMirrored(x, y);\r\n        if (originalValue <= threshold) {\r\n            return 0;\r\n        } else {\r\n            return (originalValue - threshold) / (1 - threshold);\r\n        }\r\n    });\r\n\r\n    return thresholdSSM;\r\n}\r\nexport function rowColumnAutoThresholdBinary(ssm, percentageRow, percentageCol = percentageRow) {\r\n    const typeScale = ssm.numberType.scale;\r\n\r\n    const rowBinaryMatrix = new HalfMatrix({ size: ssm.size, numberType: NumberType.UINT8 });\r\n    const colBinaryMatrix = new HalfMatrix({ size: ssm.size, numberType: NumberType.UINT8 });\r\n    let frequencies = new Uint16Array(typeScale + 1);\r\n\r\n    for (let row = 0; row < ssm.size; row++) {\r\n        frequencies.fill(0);\r\n        for (let col = 0; col < ssm.size; col++) {\r\n            frequencies[ssm.getValueMirrored(col, row)]++;\r\n        }\r\n        let stopPosition = ssm.size * percentageRow;\r\n        let thresholdValue = 0;\r\n        for (let i = typeScale; i > 0; i--) {\r\n            stopPosition -= frequencies[i];\r\n            if (stopPosition <= 0) {\r\n                thresholdValue = i;\r\n                break;\r\n            }\r\n        }\r\n        for (let col = 0; col <= row; col++) {\r\n            if (ssm.getValue(col, row) >= thresholdValue) {\r\n                rowBinaryMatrix.setValue(col, row, 1);\r\n            } else {\r\n                rowBinaryMatrix.setValue(col, row, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    for (let col = 0; col < ssm.size; col++) {\r\n        frequencies.fill(0);\r\n        for (let row = 0; row < ssm.size; row++) {\r\n            frequencies[ssm.getValueMirrored(col, row)]++;\r\n        }\r\n        let stopPosition = ssm.size * percentageCol;\r\n        let thresholdValue = 0;\r\n        for (let i = typeScale; i > 0; i--) {\r\n            stopPosition -= frequencies[i];\r\n            if (stopPosition <= 0) {\r\n                thresholdValue = i;\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let row = col; row <= ssm.size; row++) {\r\n            if (ssm.getValue(col, row) >= thresholdValue) {\r\n                colBinaryMatrix.setValue(col, row, 1);\r\n            } else {\r\n                colBinaryMatrix.setValue(col, row, 0);\r\n            }\r\n        }\r\n    }\r\n    const thresholdSSM = HalfMatrix.from(ssm);\r\n    thresholdSSM.fill((x, y) => {\r\n        if (rowBinaryMatrix.getValue(x, y) > 0 && colBinaryMatrix.getValue(x, y) > 0) {\r\n            return ssm.getValueMirrored(x, y);\r\n        } else {\r\n            return ssm.getValueMirrored(x, y);\r\n        }\r\n    });\r\n\r\n    return thresholdSSM;\r\n}\r\n\r\nexport function rowColumnAutoThreshold(ssm, percentageRow, percentageCol = percentageRow) {\r\n    const typeScale = ssm.numberType.scale;\r\n\r\n    const rowBinaryMatrix = new HalfMatrix({ size: ssm.size, numberType: NumberType.UINT8 });\r\n    const colBinaryMatrix = new HalfMatrix({ size: ssm.size, numberType: NumberType.UINT8 });\r\n    let frequencies = new Uint16Array(typeScale + 1);\r\n\r\n    for (let row = 0; row < ssm.size; row++) {\r\n        frequencies.fill(0);\r\n        for (let col = 0; col < ssm.size; col++) {\r\n            frequencies[ssm.getValueMirrored(col, row)]++;\r\n        }\r\n        let stopPosition = ssm.size * percentageRow;\r\n        let thresholdValue = 0;\r\n        for (let i = typeScale; i > 0; i--) {\r\n            stopPosition -= frequencies[i];\r\n            if (stopPosition <= 0) {\r\n                thresholdValue = i;\r\n                break;\r\n            }\r\n        }\r\n        for (let col = 0; col <= row; col++) {\r\n            if (ssm.getValue(col, row) >= thresholdValue) {\r\n                rowBinaryMatrix.setValue(\r\n                    col,\r\n                    row,\r\n                    Math.min(\r\n                        (Math.max(ssm.getValue(col, row) - thresholdValue, 0) / (typeScale - thresholdValue)) *\r\n                            typeScale,\r\n                        typeScale\r\n                    )\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    for (let col = 0; col < ssm.size; col++) {\r\n        frequencies.fill(0);\r\n        for (let row = 0; row < ssm.size; row++) {\r\n            frequencies[ssm.getValueMirrored(col, row)]++;\r\n        }\r\n        let stopPosition = ssm.size * percentageCol;\r\n        let thresholdValue = 0;\r\n        for (let i = typeScale; i > 0; i--) {\r\n            stopPosition -= frequencies[i];\r\n            if (stopPosition <= 0) {\r\n                thresholdValue = i;\r\n                break;\r\n            }\r\n        }\r\n\r\n        for (let row = col; row <= ssm.size; row++) {\r\n            if (ssm.getValue(col, row) >= thresholdValue) {\r\n                colBinaryMatrix.setValue(\r\n                    col,\r\n                    row,\r\n                    Math.min(\r\n                        (Math.max(ssm.getValue(col, row) - thresholdValue, 0) / (typeScale - thresholdValue)) *\r\n                            typeScale,\r\n                        typeScale\r\n                    )\r\n                );\r\n            }\r\n        }\r\n    }\r\n    const thresholdSSM = HalfMatrix.from(ssm);\r\n    thresholdSSM.fill((x, y) => {\r\n        return (rowBinaryMatrix.getValue(x, y) + colBinaryMatrix.getValue(x, y)) / 2;\r\n    });\r\n\r\n    return thresholdSSM;\r\n}\r\n\r\nexport function binarize(matrix, threshold = 0.5) {\r\n    let binaryMatrix;\r\n    if (matrix instanceof Matrix) {\r\n        binaryMatrix = Matrix.from(matrix, { numberType: Matrix.NumberType.UINT8 });\r\n    } else {\r\n        binaryMatrix = HalfMatrix.from(matrix, { numberType: Matrix.NumberType.UINT8 });\r\n    }\r\n    binaryMatrix.fill((x, y) => {\r\n        if (matrix.getValueNormalized(x, y) > threshold) {\r\n            return 255;\r\n        } else {\r\n            return 0;\r\n        }\r\n    });\r\n\r\n    return binaryMatrix;\r\n}\r\n\r\nexport function soloOr(ssm, sectionsInSamples) {\r\n    let soloSSM;\r\n    if (ssm instanceof Matrix) {\r\n        soloSSM = Matrix.from(ssm);\r\n    } else {\r\n        soloSSM = HalfMatrix.from(ssm);\r\n    }\r\n\r\n    soloSSM.fill((x, y) => {\r\n        if (x === y) return soloSSM.numberType.max;\r\n        const inSelection = sectionsInSamples.some((section) => {\r\n            return (section.start <= x && x < section.end) || (section.start <= y && y < section.end);\r\n        });\r\n        return inSelection ? ssm.getValueMirrored(x, y) : 0;\r\n    });\r\n\r\n    return soloSSM;\r\n}\r\n\r\nexport function showInner(ssm, sectionsInSamples) {\r\n    const chosenSectionsSSM = soloAnd(ssm, sectionsInSamples);\r\n    const allContainedSectionsSSM = soloOr(ssm, sectionsInSamples);\r\n\r\n    let otherSectionsSSM;\r\n    if (allContainedSectionsSSM instanceof Matrix) {\r\n        otherSectionsSSM = Matrix.from(allContainedSectionsSSM);\r\n    } else {\r\n        otherSectionsSSM = HalfMatrix.from(allContainedSectionsSSM);\r\n    }\r\n\r\n    chosenSectionsSSM.forEachCell((x, y, value) => {\r\n        if (x !== y && value > 0) {\r\n            allContainedSectionsSSM.setValue(x, y, 0);\r\n        }\r\n    });\r\n\r\n    return allContainedSectionsSSM;\r\n}\r\n\r\nexport function soloAnd(ssm, sectionsInSamples, rowcol = \"rowcol\") {\r\n    let soloSSM;\r\n    if (ssm instanceof Matrix) {\r\n        soloSSM = Matrix.from(ssm);\r\n    } else {\r\n        soloSSM = HalfMatrix.from(ssm);\r\n    }\r\n\r\n    const row = rowcol.includes(\"row\");\r\n    const col = rowcol.includes(\"col\");\r\n\r\n    soloSSM.fill((x, y) => {\r\n        if (x === y) return soloSSM.numberType.max;\r\n        let inSelectionX = sectionsInSamples.some((section) => {\r\n            return section.start <= x && x < section.end;\r\n        });\r\n        let inSelectionY = sectionsInSamples.some((section) => {\r\n            return section.start <= y && y < section.end;\r\n        });\r\n        return (inSelectionX || !col) && (inSelectionY || !row) ? ssm.getValueMirrored(x, y) : 0;\r\n    });\r\n\r\n    return soloSSM;\r\n}\r\n\r\nexport function muteAnd(ssm, sectionsInSamples) {\r\n    let soloSSM;\r\n    if (ssm instanceof Matrix) {\r\n        soloSSM = Matrix.from(ssm);\r\n    } else {\r\n        soloSSM = HalfMatrix.from(ssm);\r\n    }\r\n\r\n    soloSSM.fill((x, y) => {\r\n        if (x === y) return soloSSM.numberType.max;\r\n        const inSelectionX = sectionsInSamples.some((section) => {\r\n            return section.start <= x && x < section.end;\r\n        });\r\n        const inSelectionY = sectionsInSamples.some((section) => {\r\n            return section.start <= y && y < section.end;\r\n        });\r\n        return inSelectionX && inSelectionY ? 0 : ssm.getValueMirrored(x, y);\r\n    });\r\n\r\n    return soloSSM;\r\n}\r\n\r\nexport function muteOr(ssm, sectionsInSamples) {\r\n    let soloSSM;\r\n    if (ssm instanceof Matrix) {\r\n        soloSSM = Matrix.from(ssm);\r\n    } else {\r\n        soloSSM = HalfMatrix.from(ssm);\r\n    }\r\n\r\n    soloSSM.fill((x, y) => {\r\n        if (x === y) return soloSSM.numberType.max;\r\n        const inSelection = sectionsInSamples.some((section) => {\r\n            return (section.start <= x && x < section.end) || (section.start <= y && y < section.end);\r\n        });\r\n        return inSelection ? 0 : ssm.getValueMirrored(x, y);\r\n    });\r\n\r\n    return soloSSM;\r\n}\r\n\r\nexport function removeSections(ssm, sectionsInSamples) {\r\n    let newSSM = ssm.clone();\r\n\r\n    sectionsInSamples.forEach((sectionA) => {\r\n        sectionsInSamples.forEach((sectionB) => {\r\n            if (sectionA !== sectionB) {\r\n                const startX = sectionA.start;\r\n                const startY = sectionB.start;\r\n                const endX = sectionA.end;\r\n                const endY = sectionB.end;\r\n                const xDuration = endX - startX;\r\n                const yDuration = endY - startY;\r\n\r\n                const duratio = yDuration / xDuration;\r\n                for (let i = 0; i < xDuration; i++) {\r\n                    const x = startX + i;\r\n                    const y = startY + i * duratio;\r\n                    newSSM.setValue(x + 2, y - 2, 0);\r\n                    newSSM.setValue(x + 1, y - 1, 0);\r\n                    newSSM.setValue(x, y, 0);\r\n                    newSSM.setValue(x - 1, y + 1, 0);\r\n                    newSSM.setValue(x - 2, y + 2, 0);\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    return newSSM;\r\n}\r\n\r\n// subtract b from a\r\nexport function subtract(a, b) {\r\n    const newSSM = Matrix.from(a);\r\n\r\n    newSSM.fillByIndex((i) => {\r\n        const value = a.data[i] - b.data[i];\r\n        return Math.max(0, value);\r\n    });\r\n\r\n    return newSSM;\r\n}\r\n","import assert from \"assert\";\r\nimport * as log from \"../dev/log\";\r\nimport * as audioUtil from \"./audioUtil\";\r\n\r\nimport * as _ from \"lodash\";\r\n/*\r\n *   Everything is defined in seconds; it is samplerate agnostic\r\n */\r\nexport default class Section {\r\n    start;\r\n    end;\r\n    startSample;\r\n    endSample;\r\n\r\n    confidence = 1;\r\n    groupID = 0;\r\n\r\n    key = -1;\r\n\r\n    mdsFeature;\r\n\r\n    // family variables\r\n    parent = false;\r\n    pathFamily;\r\n    pathFamilyScores;\r\n    score;\r\n    normalizedScore;\r\n    coverage;\r\n    normalizedCoverage;\r\n    fitness;\r\n\r\n    constructor(args) {\r\n        this.start = args.start;\r\n        this.end = args.end;\r\n        this.startSample = args.startSample;\r\n        this.endSample = args.endSample;\r\n        if (args.groupID !== undefined) {\r\n            this.groupID = args.groupID;\r\n        }\r\n        if (args.confidence !== undefined) {\r\n            this.confidence = args.confidence;\r\n        }\r\n        if (args.mdsFeature !== undefined) {\r\n            this.mdsFeature = args.mdsFeature;\r\n        }\r\n        if (args.colorAngle !== undefined) {\r\n            this.colorAngle = args.colorAngle;\r\n        }\r\n        if (args.colorRadius !== undefined) {\r\n            this.colorRadius = args.colorRadius;\r\n        }\r\n    }\r\n\r\n    //label;\r\n\r\n    getDuration() {\r\n        return this.end - this.start;\r\n    }\r\n\r\n    getVerticalPosition() {}\r\n\r\n    overlaps(otherSection) {\r\n        return (\r\n            (this.start <= otherSection.start && this.end > otherSection.start) ||\r\n            (this.start < otherSection.start && this.end >= otherSection.end) ||\r\n            (otherSection.start <= this.start && otherSection.end > this.start) ||\r\n            (otherSection.start < this.start && otherSection.end >= this.end) ||\r\n            (this.start >= otherSection.start && this.end <= otherSection.end) ||\r\n            (otherSection.start >= this.start && otherSection.end <= this.end)\r\n        );\r\n    }\r\n\r\n    splits(otherSection) {\r\n        return otherSection.start < this.start && otherSection.end > this.end;\r\n    }\r\n\r\n    covers(otherSection) {\r\n        return this.start <= otherSection.start && this.end >= otherSection.end;\r\n    }\r\n\r\n    clipsStart(otherSection) {\r\n        return this.end > otherSection.start && this.end < otherSection.end && this.start <= otherSection.start;\r\n    }\r\n\r\n    clipsEnd(otherSection) {\r\n        return this.start > otherSection.start && this.start < otherSection.end && this.end >= otherSection.end;\r\n    }\r\n\r\n    disjoint(otherSection) {\r\n        return this.end <= otherSection.start || this.start >= otherSection.end;\r\n    }\r\n\r\n    clone() {\r\n        return _.cloneDeep(this);\r\n    }\r\n\r\n    amountOfSectionsAfterSubtract(otherSection) {\r\n        if (otherSection.covers(this)) return 0;\r\n        if (otherSection.splits(this)) return 2;\r\n        return 1;\r\n    }\r\n\r\n    subtract(otherSection) {\r\n        if (otherSection.disjoint(this)) return this;\r\n\r\n        assert(\r\n            this.amountOfSectionsAfterSubtract(otherSection) === 1,\r\n            `Won't subtract, subtraction yields ${this.amountOfSectionsAfterSubtract(otherSection)} sections [${\r\n                this.start\r\n            }, ${this.end}] - [${otherSection.start}, ${otherSection.end}]`\r\n        );\r\n\r\n        if (otherSection.clipsEnd(this)) {\r\n            this.end = otherSection.start;\r\n        } else if (otherSection.clipsStart(this)) {\r\n            this.start = otherSection.end;\r\n        }\r\n\r\n        if (this.end <= this.start) {\r\n            throw new Error(\"Section end is before start\");\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    subtractAndCreateNew(otherSection) {\r\n        if (otherSection.covers(this)) return [];\r\n        if (otherSection.splits(this)) {\r\n            const left = this.clone();\r\n            left.end = otherSection.start;\r\n            const right = this.clone();\r\n            right.start = otherSection.end;\r\n            return [left, right];\r\n        }\r\n\r\n        const thisClone = this.clone();\r\n        return [thisClone.subtract(otherSection)];\r\n    }\r\n\r\n    getKeyName() {\r\n        return audioUtil.keyNames[this.key];\r\n    }\r\n}\r\n","import * as noveltyDetection from \"./noveltyDetection\";\r\nimport * as log from \"../dev/log\";\r\nimport * as pathExtraction from \"./pathExtraction\";\r\nimport * as similarity from \"./similarity\";\r\nimport * as mds from \"./mds\";\r\nimport * as clustering from \"./clustering\";\r\nimport * as SSM from \"./SSM\";\r\nimport * as _ from \"lodash\";\r\nimport HalfMatrix from \"./dataStructures/HalfMatrix\";\r\nimport Section from \"./Section\";\r\n\r\nexport function createFixedDurationStructureSegments(sampleAmount, sampleDuration, duration) {\r\n    const structureSegments = [];\r\n    let start = 0;\r\n    while (start + duration < sampleAmount) {\r\n        structureSegments.push(\r\n            new Section({ start: start * sampleDuration, end: (start + duration) * sampleDuration })\r\n        );\r\n        start += duration;\r\n    }\r\n    return structureSegments;\r\n}\r\n\r\nexport function createSegmentsFromNovelty(novelty, sampleDuration, threshold = 0.1) {\r\n    //const maxima = noveltyDetection.findLocalMaxima(novelty, threshold);\r\n    let peaks = noveltyDetection.findPeaks(novelty);\r\n    peaks = peaks.filter((peak) => peak.confidence > threshold);\r\n    const structureSegments = [];\r\n\r\n    for (let i = 0; i < peaks.length; i++) {\r\n        const peak = peaks[i];\r\n        const start = peak.sample * sampleDuration;\r\n        const startSample = peak.sample;\r\n        const end = i < peaks.length - 1 ? sampleDuration * peaks[i + 1].sample : sampleDuration * novelty.length;\r\n        const endSample = i < peaks.length - 1 ? peaks[i + 1].sample : novelty.length;\r\n        const confidence = peak.confidence;\r\n        const groupID = structureSegments.length;\r\n        structureSegments.push(\r\n            new Section({\r\n                start,\r\n                end,\r\n                confidence,\r\n                groupID,\r\n                startSample,\r\n                endSample,\r\n            })\r\n        );\r\n    }\r\n    return structureSegments;\r\n}\r\n\r\nexport function computeStructureCandidates(\r\n    pathSSM,\r\n    structureSegments,\r\n    minDurationSeconds = 1,\r\n    maxRatio = 0.4,\r\n    strategy\r\n) {\r\n    const sampleAmount = pathSSM.getSampleAmount();\r\n    const segmentAmount = structureSegments.length;\r\n    const sampleDuration = pathSSM.sampleDuration;\r\n    const maxLength = maxRatio * sampleAmount * sampleDuration;\r\n    const scoreMatrixBuffer = pathExtraction.createScoreMatrixBuffer(sampleAmount);\r\n    const candidates = [];\r\n\r\n    for (let start = 0; start < segmentAmount; start++) {\r\n        for (let end = start; end < segmentAmount; end++) {\r\n            const startInSeconds = structureSegments[start].start;\r\n            const endInSeconds = structureSegments[end].end;\r\n            const segmentLengthInSeconds = endInSeconds - startInSeconds;\r\n            if (segmentLengthInSeconds < minDurationSeconds || segmentLengthInSeconds > maxLength) continue;\r\n            const startInSamples = Math.floor(startInSeconds / sampleDuration);\r\n            const endInSamples = Math.floor(endInSeconds / sampleDuration);\r\n\r\n            candidates.push(\r\n                createCandidate(pathSSM, startInSamples, endInSamples, scoreMatrixBuffer, strategy, candidates.length)\r\n            );\r\n        }\r\n    }\r\n\r\n    return candidates;\r\n}\r\n\r\nexport function computeSeparateStructureCandidates(\r\n    pathSSM,\r\n    separateSegmentSets,\r\n    strategy,\r\n    minDurationSeconds = 1,\r\n    maxRatio = 0.25\r\n) {\r\n    const separateCandidateSets = [];\r\n    separateSegmentSets.forEach((segments) => {\r\n        const candidates = computeStructureCandidates(pathSSM, segments, minDurationSeconds, maxRatio, strategy);\r\n        separateCandidateSets.push(candidates);\r\n    });\r\n\r\n    return separateCandidateSets;\r\n}\r\n\r\nexport function findFittestSections(ssm, segments, strategy = \"classic\") {\r\n    const size = ssm.getSize();\r\n    const sampleDuration = ssm.getSampleDuration();\r\n    const scoreMatrixBuffer = pathExtraction.createScoreMatrixBuffer(size);\r\n\r\n    const candidates = [];\r\n    segments.forEach((segment) => {\r\n        const startInSamples = Math.floor(segment.start / sampleDuration);\r\n        const endInSamples = Math.floor(segment.end / sampleDuration);\r\n        candidates.push(\r\n            createCandidate(ssm, startInSamples, endInSamples, scoreMatrixBuffer, strategy, candidates.length)\r\n        );\r\n    });\r\n    const sortedCandidates = candidates.sort(fitnessSort);\r\n    const sections = [];\r\n\r\n    let repeats = 0;\r\n    while (sortedCandidates.length > 0 && repeats < segments.length) {\r\n        repeats++;\r\n\r\n        const bestSection = sortedCandidates.shift();\r\n        bestSection.groupID = repeats;\r\n\r\n        const pathFamily = getPathFamily(bestSection, sampleDuration, bestSection.groupID);\r\n        const extendedPathFamily = getExtendedPathFamily(\r\n            bestSection,\r\n            sampleDuration,\r\n            bestSection.groupID,\r\n            ssm,\r\n            strategy\r\n        );\r\n        const nonOverlappingExtendedPathFamily = addNonOverlapping(pathFamily, extendedPathFamily);\r\n        const prunedPaths = pruneLowConfidence(nonOverlappingExtendedPathFamily, 0.15);\r\n        prunedPaths.forEach((path) => {\r\n            path.normalizedScore = bestSection.normalizedScore;\r\n            path.normalizedCoverage = bestSection.normalizedCoverage;\r\n            path.fitness = bestSection.fitness;\r\n        });\r\n        sections.push(...prunedPaths);\r\n    }\r\n\r\n    return sections;\r\n}\r\n\r\nconst allowOverlap = true;\r\nexport function findMuteDecomposition(\r\n    pathSSM,\r\n    structureSegments,\r\n    sampleDuration,\r\n    strategy = \"classic\",\r\n    muteType = \"or\",\r\n    updateCallback,\r\n    comparisonProperty = \"fitness\",\r\n    minDurationSeconds = 2,\r\n    minFitness = 0.02\r\n) {\r\n    const trackEnd = structureSegments[structureSegments.length - 1].end;\r\n    let structureSections = [];\r\n    let sortedStructureSections = [];\r\n    const segments = [];\r\n\r\n    let separateSegmentSets = [structureSegments];\r\n\r\n    let ssm = pathSSM;\r\n\r\n    let i = 0;\r\n    const maxRepeats = 14;\r\n    while (separateSegmentSets.length > 0 && i < maxRepeats) {\r\n        let separateCandidateSets = computeSeparateStructureCandidates(\r\n            ssm,\r\n            separateSegmentSets,\r\n            strategy,\r\n            minDurationSeconds\r\n        );\r\n        const allCandidates = [].concat.apply([], separateCandidateSets);\r\n        if (allCandidates.length === 0) {\r\n            break;\r\n        }\r\n        const allCandidatesSorted = allCandidates.sort((a, b) => {\r\n            if (a[comparisonProperty] < b[comparisonProperty]) {\r\n                return 1;\r\n            }\r\n            if (a[comparisonProperty] > b[comparisonProperty]) {\r\n                return -1;\r\n            }\r\n            return 0;\r\n        });\r\n\r\n        let best = allCandidatesSorted.shift();\r\n        const initialFitness = best.fitness;\r\n        if (wiggle) {\r\n            best = findBetterFit(\r\n                ssm,\r\n                best,\r\n                wiggleSize,\r\n                comparisonProperty,\r\n                strategy,\r\n                sortedStructureSections,\r\n                minDurationSeconds,\r\n                allowOverlap\r\n            );\r\n        }\r\n        if (best === null || best[comparisonProperty] <= minFitness || isNaN(best[comparisonProperty])) {\r\n            break;\r\n        }\r\n        const groupID = i;\r\n        best.groupID = groupID;\r\n\r\n        const pathFamily = getPathFamily(best, sampleDuration, groupID);\r\n        const extendedPathFamily = getExtendedPathFamily(best, sampleDuration, groupID, pathSSM, strategy);\r\n        const nonOverlappingExtendedPathFamily = addNonOverlapping(pathFamily, extendedPathFamily);\r\n        const prunedPaths = pruneLowConfidence(nonOverlappingExtendedPathFamily, 0.1);\r\n        prunedPaths.forEach((path) => {\r\n            path.normalizedScore = best.normalizedScore;\r\n            path.normalizedCoverage = best.normalizedCoverage;\r\n            path.fitness = best.fitness;\r\n            path.initFitness = initialFitness;\r\n        });\r\n        sortedStructureSections.push(...prunedPaths);\r\n        structureSections.push(...prunedPaths);\r\n        const prunedPathsInSamples = prunedPaths.map((section) => {\r\n            const clone = section.clone();\r\n            clone.start = Math.floor(clone.start / sampleDuration);\r\n            clone.end = Math.floor(clone.end / sampleDuration);\r\n            return clone;\r\n        });\r\n        if (muteType === \"and\") {\r\n            ssm = SSM.muteAnd(ssm, prunedPathsInSamples);\r\n        } else if (muteType === \"remove\") {\r\n            ssm = SSM.removeSections(ssm, prunedPathsInSamples);\r\n        } else {\r\n            ssm = SSM.muteOr(ssm, prunedPathsInSamples);\r\n        }\r\n\r\n        sortedStructureSections = sortedStructureSections.sort((a, b) => (a.start > b.start ? 1 : -1));\r\n        if (updateCallback) {\r\n            updateCallback(structureSections);\r\n        }\r\n\r\n        separateSegmentSets = subtractStructureFromSegments(\r\n            _.cloneDeep(separateSegmentSets),\r\n            sortedStructureSections,\r\n            trackEnd,\r\n            minDurationSeconds\r\n        );\r\n        const allSegments = [].concat.apply([], separateSegmentSets);\r\n        allSegments.forEach((segment) => (segment.groupID = i));\r\n        segments.push(...allSegments);\r\n        i++;\r\n    }\r\n    return [sortedStructureSections, i, segments];\r\n}\r\n\r\nexport function findSubDecomposition(\r\n    pathSSM,\r\n    structureSections,\r\n    minDurationSeconds = 2,\r\n    strategy = \"fine\",\r\n    minFitness = 0.15\r\n) {\r\n    const sampleDuration = pathSSM.getSampleDuration();\r\n    const minDurationSamples = Math.ceil(minDurationSeconds / sampleDuration);\r\n\r\n    let subStructureSections = [];\r\n\r\n    let ID = 0;\r\n    for (let i = 0; i < 20; i++) {\r\n        let groupSections = structureSections.filter((section) => section.groupID === i);\r\n        const smallestSize = groupSections.reduce((min, section) => {\r\n            const size = section.end - section.start;\r\n            return size < min ? size : min;\r\n        }, Number.POSITIVE_INFINITY);\r\n        const maxDurationSeconds = Math.ceil(smallestSize / 2);\r\n\r\n        if (groupSections.length === 0) break;\r\n        groupSections = subtractSegments(groupSections, subStructureSections);\r\n        groupSections = groupSections.filter((section) => section.end - section.start >= minDurationSeconds);\r\n        let subStructureSection;\r\n        let j = 0;\r\n        do {\r\n            subStructureSection = findSubstructure(\r\n                pathSSM,\r\n                groupSections,\r\n                maxDurationSeconds,\r\n                minDurationSeconds,\r\n                minFitness,\r\n                strategy\r\n            );\r\n            if (subStructureSection) {\r\n                const subPathFamily = getPathFamily(subStructureSection, sampleDuration, ID);\r\n                const extendedSubPathFamily = getExtendedPathFamily(\r\n                    subStructureSection,\r\n                    sampleDuration,\r\n                    ID,\r\n                    pathSSM,\r\n                    strategy\r\n                );\r\n                const nonOverlappingExtendedSubPathFamily = addNonOverlapping(subPathFamily, extendedSubPathFamily);\r\n                const subFamily = pruneLowConfidence(nonOverlappingExtendedSubPathFamily, 0.1);\r\n\r\n                subStructureSections.push(...subFamily);\r\n                groupSections = subtractSegments(groupSections, subStructureSections);\r\n                groupSections = groupSections.filter((section) => section.end - section.start >= minDurationSeconds);\r\n                ID++;\r\n                j++;\r\n            } else {\r\n                // no more fit sections, use up remaining sections?\r\n                let remainingSections = groupSections.filter(\r\n                    (section) => section.end - section.start >= minDurationSeconds\r\n                );\r\n                if (remainingSections.length > 0) {\r\n                    remainingSections = remainingSections.map((s) => {\r\n                        const newSection = s.clone();\r\n                        newSection.groupID = ID;\r\n                        return newSection;\r\n                    });\r\n                    if (j > 0) {\r\n                        const candidates = [];\r\n                        const scoreMatrixBuffer = pathExtraction.createScoreMatrixBuffer(pathSSM.getSampleAmount());\r\n                        remainingSections.forEach((section) => {\r\n                            const startInSamples = Math.floor(section.start / pathSSM.sampleDuration);\r\n                            const endInSamples = Math.floor(section.end / pathSSM.sampleDuration);\r\n                            candidates.push(\r\n                                createCandidate(pathSSM, startInSamples, endInSamples, scoreMatrixBuffer, strategy, ID)\r\n                            );\r\n                        });\r\n                        candidates.sort((a, b) => b.fitness - a.fitness);\r\n\r\n                        let repeats = 0;\r\n                        while (remainingSections.length > 0 && repeats < 1) {\r\n                            repeats++;\r\n                            const candidate = candidates.shift();\r\n                            const subPathFamily = getPathFamily(candidate, sampleDuration, ID);\r\n                            const extendedSubPathFamily = getExtendedPathFamily(\r\n                                candidate,\r\n                                sampleDuration,\r\n                                ID,\r\n                                pathSSM,\r\n                                strategy\r\n                            );\r\n                            const nonOverlappingExtendedSubPathFamily = addNonOverlapping(\r\n                                subPathFamily,\r\n                                extendedSubPathFamily\r\n                            );\r\n                            const subFamily = pruneLowConfidence(nonOverlappingExtendedSubPathFamily, 0.1);\r\n\r\n                            subStructureSections.push(...subFamily);\r\n                            remainingSections = subtractSegments(remainingSections, subStructureSections);\r\n                            remainingSections = remainingSections.filter(\r\n                                (section) => section.end - section.start >= minDurationSeconds\r\n                            );\r\n                        }\r\n                    } else {\r\n                        subStructureSections.push(...remainingSections);\r\n                    }\r\n\r\n                    ID++;\r\n                }\r\n                break;\r\n            }\r\n        } while (subStructureSection && j < 10);\r\n    }\r\n    subStructureSections = sortGroupByCoverage(subStructureSections);\r\n    return [subStructureSections, ID];\r\n}\r\n\r\nexport function findSubstructure(\r\n    pathSSM,\r\n    courseSections,\r\n    maxDurationSeconds,\r\n    minDurationSeconds,\r\n    minFitness,\r\n    strategy = \"fine\"\r\n) {\r\n    const soloSSM = SSM.muteAnd(pathSSM, courseSections);\r\n\r\n    const maxSubSizeSamples = Math.floor(maxDurationSeconds / pathSSM.sampleDuration);\r\n    const minSubSizeSamples = Math.floor(minDurationSeconds / pathSSM.sampleDuration);\r\n    if (maxSubSizeSamples < minSubSizeSamples) return;\r\n    const step = 1;\r\n\r\n    const scoreMatrixBuffer = pathExtraction.createScoreMatrixBuffer(pathSSM.getSampleAmount());\r\n\r\n    const candidates = [];\r\n    courseSections.forEach((section) => {\r\n        const startInSamples = Math.floor(section.start / pathSSM.sampleDuration);\r\n        const endInSamples = Math.floor(section.end / pathSSM.sampleDuration);\r\n\r\n        for (let start = startInSamples; start < endInSamples - maxSubSizeSamples; start += step) {\r\n            for (let duration = 1; duration < maxSubSizeSamples; duration += step) {\r\n                candidates.push(\r\n                    createCandidate(soloSSM, start, start + duration, scoreMatrixBuffer, strategy, section.groupID)\r\n                );\r\n            }\r\n        }\r\n    });\r\n    // Assume that if the groupsections are same amount as subfamily, the subfamily is just pointing out largest fraction of groupsection\r\n    const candidatesFiltered = candidates.filter(\r\n        (c) => c.pathFamily.length !== courseSections.length && c.fitness >= minFitness\r\n    );\r\n    const candidatesSorted = candidatesFiltered.sort(fitnessSort);\r\n    let best = candidatesSorted.shift();\r\n    if (best === undefined) {\r\n        return null;\r\n    }\r\n    if (best.end - best.start < minDurationSeconds) {\r\n        return null;\r\n    }\r\n\r\n    return best;\r\n}\r\n\r\n// Structure is not sorted, structuresegments is\r\nconst wiggle = true;\r\nconst wiggleSize = 3;\r\nexport function findGreedyDecomposition(\r\n    pathSSM,\r\n    structureSegments,\r\n    sampleDuration,\r\n    strategy = \"classic\",\r\n    comparisonProperty = \"fitness\",\r\n    minDurationSeconds = 2,\r\n    minFitness = 0.1\r\n) {\r\n    const trackEnd = structureSegments[structureSegments.length - 1].end;\r\n    let structureSections = [];\r\n    const segments = [];\r\n    let separateSegmentSets = [structureSegments];\r\n\r\n    let i = 0;\r\n    const maxRepeats = 14;\r\n    while (separateSegmentSets.length > 0 && i < maxRepeats) {\r\n        let separateCandidateSets = computeSeparateStructureCandidates(\r\n            pathSSM,\r\n            separateSegmentSets,\r\n            strategy,\r\n            minDurationSeconds\r\n        );\r\n        const allCandidates = [].concat.apply([], separateCandidateSets);\r\n        if (allCandidates.length === 0) {\r\n            break;\r\n        }\r\n        const allCandidatesSorted = allCandidates.sort(fitnessSort);\r\n\r\n        let best = allCandidatesSorted.shift();\r\n        const initialFitness = best.fitness;\r\n        if (wiggle) {\r\n            best = findBetterFit(\r\n                pathSSM,\r\n                best,\r\n                wiggleSize,\r\n                comparisonProperty,\r\n                strategy,\r\n                structureSections,\r\n                minDurationSeconds\r\n            );\r\n        }\r\n        if (best === null || best[comparisonProperty] <= minFitness || isNaN(best[comparisonProperty])) {\r\n            break;\r\n        }\r\n        const groupID = i;\r\n        best.groupID = groupID;\r\n\r\n        const pathFamily = getPathFamily(best, sampleDuration, groupID);\r\n        const extendedPathFamily = getExtendedPathFamily(best, sampleDuration, groupID, pathSSM, strategy);\r\n        const nonOverlappingExtendedPathFamily = addNonOverlapping(pathFamily, extendedPathFamily);\r\n        const prunedPaths = pruneLowConfidence(nonOverlappingExtendedPathFamily, 0.1);\r\n        prunedPaths.forEach((path) => {\r\n            path.normalizedScore = best.normalizedScore;\r\n            path.normalizedCoverage = best.normalizedCoverage;\r\n            path.fitness = best.fitness;\r\n            path.initFitness = initialFitness;\r\n        });\r\n        structureSections.push(...prunedPaths);\r\n\r\n        // sort structuresections\r\n        structureSections = structureSections.sort((a, b) => (a.start > b.start ? 1 : -1));\r\n\r\n        separateSegmentSets = subtractStructureFromSegments(\r\n            _.cloneDeep(separateSegmentSets),\r\n            structureSections,\r\n            trackEnd,\r\n            minDurationSeconds\r\n        );\r\n        const allSegments = [].concat.apply([], separateSegmentSets);\r\n        allSegments.forEach((segment) => (segment.groupID = i));\r\n        segments.push(...allSegments);\r\n        i++;\r\n    }\r\n    return [structureSections, i, segments];\r\n}\r\n\r\nfunction getPathFamily(section, sampleDuration, groupID) {\r\n    const pathFamilySections = [];\r\n    if (!section.pathFamily) return [];\r\n    section.pathFamily.forEach((path, index) => {\r\n        const start = path[path.length - 1][1] * sampleDuration;\r\n        const end = (path[0][1] + 1) * sampleDuration;\r\n        const pathConfidence = section.pathFamilyScores ? section.pathFamilyScores[index] : section.pathScores[index];\r\n        const newSection = new Section({ start, end, groupID, confidence: pathConfidence });\r\n        /*if (!isSameSectionWithinError(best, section, 2)) {\r\n        // This is debatable, we might want to show this (why it got high fitness to begin with)\r\n        //if (!overlapWithStructureSections(section, structureSections)) {\r\n        structureSections.push(section);\r\n        //}\r\n    } else {\r\n        // It's the best path itself, but use the segment defined by the coverage in the path family\r\n        best.start = start;\r\n        best.end = end;\r\n        best.confidence = 1;\r\n        structureSections.push(best);\r\n    }*/\r\n        newSection.pathFamily = section.pathFamily;\r\n        pathFamilySections.push(newSection);\r\n    });\r\n    return pathFamilySections;\r\n}\r\n\r\n// multiply confidence?\r\n// includes regular family\r\nfunction getExtendedPathFamily(section, sampleDuration, groupID, pathSSM, strategy) {\r\n    const scoreMatrixBuffer = pathExtraction.createScoreMatrixBuffer(pathSSM.getSampleAmount());\r\n\r\n    const pathFamilySections = [];\r\n    section.pathFamily.forEach((path, index) => {\r\n        const start = path[path.length - 1][1] * sampleDuration;\r\n        const end = (path[0][1] + 1) * sampleDuration;\r\n        const pathConfidence = section.pathFamilyScores ? section.pathFamilyScores[index] : section.pathScores[index];\r\n\r\n        const newSection = new Section({ start, end, groupID, confidence: pathConfidence });\r\n\r\n        newSection.pathFamily = section.pathFamily;\r\n        pathFamilySections.push(newSection);\r\n    });\r\n\r\n    pathFamilySections.forEach((familySection) => {\r\n        const startInSamples = Math.floor(familySection.start / sampleDuration);\r\n        const endInSamples = Math.floor(familySection.end / sampleDuration);\r\n\r\n        const pathFamilyInfo = pathExtraction.computeSegmentPathFamilyInfo(\r\n            pathSSM,\r\n            startInSamples,\r\n            endInSamples,\r\n            scoreMatrixBuffer,\r\n            strategy\r\n        );\r\n        pathFamilyInfo.pathFamily.forEach((path, index) => {\r\n            const start = path[path.length - 1][1] * sampleDuration;\r\n            const end = (path[0][1] + 1) * sampleDuration;\r\n\r\n            const newSection = new Section({\r\n                start,\r\n                end,\r\n                groupID,\r\n                confidence: familySection.confidence * pathFamilyInfo.pathScores[index],\r\n            });\r\n\r\n            newSection.pathFamily = section.pathFamily;\r\n            pathFamilySections.push(newSection);\r\n        });\r\n    });\r\n\r\n    return pathFamilySections;\r\n}\r\n\r\nfunction pruneLowConfidence(sections, minConfidence) {\r\n    const prunedSections = [];\r\n    sections.forEach((section) => {\r\n        if (section.confidence >= minConfidence) prunedSections.push(section);\r\n    });\r\n    return prunedSections;\r\n}\r\n\r\nfunction addNonOverlapping(sectionsA, sectionsB, overlapRatioThreshold = 0) {\r\n    const allSections = [...sectionsA];\r\n\r\n    const sortedSectionsB = sectionsB.sort((a, b) => (a.confidence > b.confidence ? 1 : -1));\r\n\r\n    sortedSectionsB.forEach((sectionB) => {\r\n        let mostOverlapRatio = 0;\r\n        allSections.forEach((sectionA) => {\r\n            if (sectionA.overlaps(sectionB)) {\r\n                const durationA = sectionA.end - sectionA.start;\r\n                const durationB = sectionB.end - sectionB.start;\r\n                const overlap = computeOverlapSize(sectionA, sectionB);\r\n                const overlapRatio = overlap / (durationA + durationB);\r\n                if (overlapRatio > mostOverlapRatio) {\r\n                    mostOverlapRatio = overlapRatio;\r\n                }\r\n            }\r\n        });\r\n        if (mostOverlapRatio > 0 && mostOverlapRatio < overlapRatioThreshold) {\r\n            allSections.push(sectionB);\r\n        } else if (mostOverlapRatio <= 0) {\r\n            allSections.push(sectionB);\r\n        }\r\n    });\r\n\r\n    return allSections;\r\n}\r\n\r\nfunction mergeOverlap(sections) {\r\n    const mergedSections = [];\r\n\r\n    sections.forEach((section) => {\r\n        let indexToMergeWith = 0;\r\n        const hasToMerge = mergedSections.some((mergedSection, index) => {\r\n            // merge if middle is in section?\r\n            if (section.overlaps(mergedSection)) {\r\n                indexToMergeWith = index;\r\n                return true;\r\n            }\r\n        });\r\n        if (hasToMerge) {\r\n            mergedSections[indexToMergeWith] = mergeSection(mergedSections[indexToMergeWith], section);\r\n        } else {\r\n            mergedSections.push(section);\r\n        }\r\n    });\r\n\r\n    let overlapFound = true;\r\n    let timeout = 1000;\r\n    while (overlapFound || timeout < 0) {\r\n        let overlapIndexA = 0;\r\n        let overlapIndexB = 0;\r\n        overlapFound = mergedSections.some((sectionA, indexA) => {\r\n            return mergedSections.some((sectionB, indexB) => {\r\n                if (sectionA.overlaps(sectionB) && sectionA !== sectionB) {\r\n                    overlapIndexA = indexA;\r\n                    overlapIndexB = indexB;\r\n                    return true;\r\n                }\r\n            });\r\n        });\r\n        if (overlapFound) {\r\n            const sectionA = mergedSections[overlapIndexA];\r\n            const sectionB = mergedSections[overlapIndexB];\r\n            const mergedSection = mergeSection(sectionA, sectionB);\r\n            mergedSections.splice(overlapIndexB, 1);\r\n            mergedSections[overlapIndexA] = mergedSection;\r\n        }\r\n        timeout--;\r\n    }\r\n\r\n    return mergedSections;\r\n}\r\n\r\nfunction mergeSection(sectionA, sectionB) {\r\n    const start = Math.min(sectionA.start, sectionB.start);\r\n    const end = Math.max(sectionA.end, sectionB.end);\r\n    return new Section({ start, end, groupID: sectionA.groupID, confidence: sectionA.confidence });\r\n}\r\n\r\nfunction findBetterFit(\r\n    pathSSM,\r\n    section,\r\n    sampleOffset = 4,\r\n    comparisonProperty,\r\n    strategy,\r\n    structureSections = [],\r\n    minDurationSeconds\r\n) {\r\n    const sampleAmount = pathSSM.getSampleAmount();\r\n    const sampleDuration = pathSSM.sampleDuration;\r\n\r\n    const startInSamples = Math.floor(section.start / sampleDuration);\r\n    const endInSamples = Math.floor(section.end / sampleDuration);\r\n\r\n    const scoreMatrixBuffer = pathExtraction.createScoreMatrixBuffer(sampleAmount);\r\n    let max = section[comparisonProperty];\r\n    let bestFit = section;\r\n\r\n    for (let startOffset = -sampleOffset; startOffset < sampleOffset; startOffset++) {\r\n        for (let endOffset = -sampleOffset; endOffset < sampleOffset; endOffset++) {\r\n            const start = startInSamples + startOffset;\r\n            const end = endInSamples + endOffset;\r\n\r\n            const startInSeconds = start * sampleDuration;\r\n            const endInSeconds = end * sampleDuration;\r\n            // TODO: also check for overlap with existing sections\r\n\r\n            if (\r\n                start >= 0 &&\r\n                end < sampleAmount &&\r\n                endInSeconds - startInSeconds >= minDurationSeconds &&\r\n                (allowOverlap ||\r\n                    !overlapWithStructureSections({ start: startInSeconds, end: endInSeconds }, structureSections))\r\n            ) {\r\n                const segmentPathFamilyInfo = pathExtraction.computeSegmentPathFamilyInfo(\r\n                    pathSSM,\r\n                    start,\r\n                    end,\r\n                    scoreMatrixBuffer,\r\n                    strategy\r\n                );\r\n\r\n                segmentPathFamilyInfo.start = start * sampleDuration;\r\n                segmentPathFamilyInfo.end = end * sampleDuration;\r\n\r\n                if (segmentPathFamilyInfo[comparisonProperty] > max) {\r\n                    // TODO: log how the max moves (maybe it needs more offset to reach optimum)\r\n                    bestFit = segmentPathFamilyInfo;\r\n                    max = segmentPathFamilyInfo[comparisonProperty];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return bestFit;\r\n}\r\n\r\nfunction overlapWithStructureSections(section, structureSections) {\r\n    return structureSections.some((structureSection) => {\r\n        if (section.overlaps(structureSection)) return true;\r\n    });\r\n}\r\n\r\nfunction subtractStructureFromSegments(separateSegmentSets, sortedStructureSections, trackEnd, smallestAllowedSize) {\r\n    let newSeparateSegmentSets = [];\r\n    const allSegments = [].concat.apply([], separateSegmentSets);\r\n\r\n    const freeRanges = getFreeRanges(sortedStructureSections, trackEnd, smallestAllowedSize);\r\n    freeRanges.forEach((range) => {\r\n        const rangeStart = range[0];\r\n        const rangeEnd = range[1];\r\n        let segmentSet = [];\r\n\r\n        let previousBorder = rangeStart;\r\n        allSegments.forEach((segment) => {\r\n            if (segment.start > previousBorder && segment.start < rangeEnd) {\r\n                segmentSet.push(\r\n                    new Section({\r\n                        start: previousBorder,\r\n                        end: segment.start,\r\n                    })\r\n                );\r\n                previousBorder = segment.start;\r\n            }\r\n        });\r\n        segmentSet.push(\r\n            new Section({\r\n                start: previousBorder,\r\n                end: rangeEnd,\r\n            })\r\n        );\r\n        newSeparateSegmentSets.push(segmentSet);\r\n    });\r\n\r\n    return newSeparateSegmentSets;\r\n}\r\n\r\nfunction getFreeRangesNonOverlapping(structureSections, trackEnd, smallestAllowedSize) {\r\n    const freeRanges = [];\r\n    let previousEnd = 0;\r\n    structureSections.forEach((section) => {\r\n        freeRanges.push([previousEnd, section.start]);\r\n        previousEnd = section.end;\r\n    });\r\n    freeRanges.push([previousEnd, trackEnd]);\r\n    return freeRanges.filter((range) => range[1] - range[0] >= smallestAllowedSize);\r\n}\r\n\r\nfunction getFreeRanges(structureSections, trackEnd, smallestAllowedSize) {\r\n    const freeRanges = [[0, trackEnd]];\r\n    structureSections.forEach((section) => {\r\n        freeRanges.forEach((range, rangeIndex) => {\r\n            const rangeStart = range[0];\r\n            const rangeEnd = range[1];\r\n            // if range is encapsulated by section, remove\r\n            if (rangeStart >= section.start && rangeEnd <= section.end) {\r\n                freeRanges.splice(rangeIndex, 1);\r\n                return;\r\n            }\r\n            // if range overlaps section on left, cut range short, clip end\r\n            if (rangeStart <= section.start && rangeEnd > section.start && rangeEnd <= section.end) {\r\n                range[1] = section.start;\r\n                return;\r\n            }\r\n            // if range overlaps section on right, cut range short, clip start\r\n            if (rangeStart < section.end && rangeEnd >= section.start && rangeStart >= section.start) {\r\n                range[0] = section.end;\r\n                return;\r\n            }\r\n            // if range encapsulates section, cut range in half\r\n            if (rangeStart < section.start && rangeEnd > section.end) {\r\n                freeRanges.push([rangeStart, section.start]);\r\n                freeRanges.push([section.end, rangeEnd]);\r\n                freeRanges.splice(rangeIndex, 1);\r\n                return;\r\n            }\r\n        });\r\n    });\r\n    return freeRanges.filter((range) => range[1] - range[0] >= smallestAllowedSize);\r\n}\r\n\r\n/**\r\n * Picks highest similarity pair, groupIDs segments not yet groupIDed, repeat\r\n * @param {*} segments\r\n */\r\nexport function groupSimilarSegments(segments, pathSSM, maxDistance = 0.8) {\r\n    const groupedSegments = _.cloneDeep(segments);\r\n    groupedSegments.forEach((segment) => {\r\n        delete segment.groupID;\r\n        segment.confidence = 1;\r\n    });\r\n\r\n    let groupIDed = 0;\r\n    let newGroupID = 0;\r\n    while (groupIDed < segments.length) {\r\n        let minDistance = Number.POSITIVE_INFINITY;\r\n        let bestSegmentA = null;\r\n        let bestSegmentB = null;\r\n        groupedSegments.forEach((segmentA) => {\r\n            groupedSegments.forEach((segmentB) => {\r\n                if ((segmentA.groupID === undefined || segmentB.groupID === undefined) && segmentA !== segmentB) {\r\n                    const distance = pathExtraction.getDistanceBetween(segmentA, segmentB, pathSSM);\r\n                    if (distance < minDistance) {\r\n                        minDistance = distance;\r\n                        bestSegmentA = segmentA;\r\n                        bestSegmentB = segmentB;\r\n                    }\r\n                }\r\n            });\r\n        });\r\n        if (!bestSegmentA || !bestSegmentB) {\r\n            break;\r\n        }\r\n        if (minDistance > maxDistance) {\r\n            if (bestSegmentA.groupID === undefined && bestSegmentB.groupID === undefined) {\r\n                bestSegmentA.groupID = newGroupID;\r\n                newGroupID++;\r\n                bestSegmentB.groupID = newGroupID;\r\n            } else if (bestSegmentA.groupID === undefined) {\r\n                bestSegmentA.groupID = newGroupID;\r\n            } else if (bestSegmentB.groupID === undefined) {\r\n                bestSegmentB.groupID = newGroupID;\r\n            }\r\n            newGroupID++;\r\n        } else {\r\n            if (bestSegmentA.groupID === undefined && bestSegmentB.groupID === undefined) {\r\n                bestSegmentA.groupID = newGroupID;\r\n                bestSegmentB.groupID = newGroupID;\r\n                newGroupID++;\r\n            } else if (bestSegmentA.groupID === undefined) {\r\n                bestSegmentA.groupID = bestSegmentB.groupID;\r\n                bestSegmentA.confidence = 1 - minDistance;\r\n            } else if (bestSegmentB.groupID === undefined) {\r\n                bestSegmentB.groupID = bestSegmentA.groupID;\r\n                bestSegmentB.confidence = 1 - minDistance;\r\n            }\r\n        }\r\n    }\r\n    return groupedSegments;\r\n}\r\n\r\nexport function MDSColorSegments(segments, pathSSM, strategy = \"overlap\", coloringStrategy, colorBoth = false) {\r\n    if (segments.length === 0) return segments;\r\n\r\n    const distanceMatrix = pathExtraction.getDistanceMatrix(segments, pathSSM, strategy);\r\n    const segmentsColored = MDSColorGivenDistanceMatrix(segments, distanceMatrix, coloringStrategy);\r\n\r\n    if (colorBoth) {\r\n        const distanceMatrixCategorical = pathExtraction.getDistanceMatrix(segments, pathSSM, strategy, 0);\r\n        const segmentsColoredCategorical = MDSColorGivenDistanceMatrix(\r\n            segments,\r\n            distanceMatrixCategorical,\r\n            coloringStrategy\r\n        );\r\n\r\n        for (let i = 0; i < segmentsColored.length; i++) {\r\n            segmentsColored[i].catColorAngle = segmentsColoredCategorical[i].colorAngle;\r\n            segmentsColored[i].catColorRadius = segmentsColoredCategorical[i].colorRadius;\r\n            segmentsColored[i].catMdsFeature = segmentsColoredCategorical[i].mdsFeature;\r\n        }\r\n    }\r\n\r\n    return segmentsColored;\r\n}\r\n\r\nexport function MDSColorSegmentsPerGroup(segments, pathSSM, strategy = \"overlap\", coloringStrategy) {\r\n    if (segments.length === 0) return segments;\r\n\r\n    const segmentGroups = [];\r\n    segments.forEach((segment) => {\r\n        if (!segmentGroups[segment.groupID]) {\r\n            segmentGroups[segment.groupID] = [];\r\n        }\r\n        segmentGroups[segment.groupID].push(segment);\r\n    });\r\n\r\n    const coloredSegments = [];\r\n    segmentGroups.forEach((segmentGroup) => {\r\n        const distanceMatrix = pathExtraction.getDistanceMatrix(segmentGroup, pathSSM, strategy);\r\n        const distanceMatrixPlus = new HalfMatrix({\r\n            size: segmentGroup.length + 1,\r\n            numberType: HalfMatrix.NumberType.FLOAT32,\r\n        });\r\n        distanceMatrixPlus.fill((x, y) => {\r\n            if (x >= segmentGroup.length || y >= segmentGroup.length) {\r\n                if (x === y) {\r\n                    return 0;\r\n                }\r\n                return 1;\r\n            }\r\n            return Math.pow(distanceMatrix.getValue(x, y), 4);\r\n        });\r\n        const groupSegmentsColored = MDSColorGivenDistanceMatrix(segmentGroup, distanceMatrix, coloringStrategy);\r\n        coloredSegments.push(...groupSegmentsColored);\r\n    });\r\n    return coloredSegments;\r\n}\r\n\r\nexport function MDSColorGivenDistanceMatrix(segments, distanceMatrix, coloringStrategy) {\r\n    const coloredSegments = [];\r\n    const MdsCoordinates = mds.getMDSCoordinates(distanceMatrix, coloringStrategy);\r\n\r\n    const MdsFeature = mds.getMDSFeature(distanceMatrix);\r\n\r\n    segments.forEach((segment, index) => {\r\n        const [angle, radius] = mds.getAngleAndRadius(MdsCoordinates[index]);\r\n        const newSegment = segment.clone();\r\n        newSegment.colorAngle = angle;\r\n        newSegment.colorRadius = radius;\r\n        newSegment.mdsFeature = MdsFeature[index];\r\n        coloredSegments.push(newSegment);\r\n    });\r\n\r\n    // sort from small to high\r\n    coloredSegments.sort((a, b) => {\r\n        return a.colorAngle > b.colorAngle ? 1 : b.colorAngle > a.colorAngle ? -1 : 0;\r\n    });\r\n\r\n    let largestGap = 1 - coloredSegments[coloredSegments.length - 1].colorAngle + coloredSegments[0].colorAngle;\r\n    let largestGapAngle = coloredSegments[0].colorAngle;\r\n    for (let i = 1; i < coloredSegments.length; i++) {\r\n        const gap = coloredSegments[i].colorAngle - coloredSegments[i - 1].colorAngle;\r\n        if (gap > largestGap) {\r\n            largestGap = gap;\r\n            largestGapAngle = coloredSegments[i].colorAngle;\r\n        }\r\n    }\r\n\r\n    coloredSegments.forEach((segment) => {\r\n        segment.colorAngle = (1 + (segment.colorAngle - largestGapAngle)) % 1;\r\n    });\r\n\r\n    // sort by family and start time\r\n    coloredSegments.sort((a, b) => {\r\n        return a.groupID > b.groupID ? 1 : b.groupID > a.groupID ? -1 : a.start - b.start;\r\n    });\r\n\r\n    return coloredSegments;\r\n}\r\n\r\nexport function MDSIntuitionFlip(coloredSamples, timbreFeatures) {\r\n    const loudness = similarity.correlate(\r\n        coloredSamples,\r\n        timbreFeatures.map((val) => val[0])\r\n    );\r\n    const darkness = similarity.correlate(\r\n        coloredSamples,\r\n        timbreFeatures.map((val) => val[1])\r\n    );\r\n    const mids = similarity.correlate(\r\n        coloredSamples,\r\n        timbreFeatures.map((val) => val[2])\r\n    );\r\n    const attack = similarity.correlate(\r\n        coloredSamples,\r\n        timbreFeatures.map((val) => val[3])\r\n    );\r\n\r\n    log.debug(\"loudness\", loudness, \"darkness\", darkness, \"mids\", mids, \"attack\", attack);\r\n\r\n    if (Math.sign(loudness) < 0) {\r\n        return coloredSamples;\r\n    }\r\n\r\n    // By default the graph should display high loudness as high value\r\n    if (Math.sign(loudness) > 0) {\r\n        return coloredSamples.map((val) => 1 - val);\r\n    }\r\n\r\n    // If graph depicts mostly darkness, we want bright sounds to have a high value\r\n    /*if (Math.sign(darkness) > 0 && Math.abs(darkness) > 2 * Math.abs(loudness)) {\r\n        return coloredSamples.map((val) => 1 - val);\r\n    }*/\r\n\r\n    return coloredSamples;\r\n}\r\n\r\nexport function computeOverlapSize(a, b) {\r\n    if (a.start <= b.start && a.end > b.start) return a.end - b.start;\r\n    if (b.start <= a.start && b.end > a.start) return b.end - a.start;\r\n    if (a.start < b.start && a.end >= b.end) return b.end - b.start;\r\n    if (b.start < a.start && b.end >= a.end) return a.end - a.start;\r\n    if (a.start >= b.start && a.end <= b.end) return a.end - a.start;\r\n    if (b.start >= a.start && b.end <= a.end) return b.end - b.start;\r\n    return 0;\r\n}\r\n\r\nexport function disjoint(a, b) {\r\n    return a.start >= b.end || a.end <= b.start;\r\n}\r\n\r\nexport function isSameSectionWithinError(a, b, errorInSamples) {\r\n    const middleA = a.start + a.getDuration() / 2;\r\n    const middleB = b.start + b.getDuration() / 2;\r\n    return Math.abs(middleB - middleA) < errorInSamples;\r\n}\r\n\r\nexport function fillGapSingle(squashedSections, section) {\r\n    let newSection = section.clone();\r\n\r\n    // If any of the squashed sections will split or completely cover the section, don't add it\r\n    squashedSections.forEach((squashedSection) => {\r\n        if (squashedSection.splits(section)) return squashedSections;\r\n        if (squashedSection.covers(section)) return squashedSections;\r\n    });\r\n\r\n    // Cut off the ends\r\n    squashedSections.forEach((squashedSection) => {\r\n        if (squashedSection.splits(newSection)) return squashedSections;\r\n        if (squashedSection.covers(newSection)) return squashedSections;\r\n        newSection = newSection.subtract(squashedSection);\r\n    });\r\n\r\n    squashedSections.push(newSection);\r\n    return squashedSections;\r\n}\r\n\r\nexport function squash(strategy, sections, groupAmount, minSize = 2) {\r\n    const squashed = [];\r\n    const maxGroups = 10;\r\n\r\n    for (let i = 0; i < groupAmount && i < maxGroups; i++) {\r\n        const groupIDSections = sections.filter((section) => section.groupID === i);\r\n        groupIDSections.forEach((groupSection) => {\r\n            if (strategy === \"no-overlap\") {\r\n                const overlap = squashed.some((squashedSection) => {\r\n                    if (groupSection.overlaps(squashedSection)) return true;\r\n                });\r\n                if (!overlap) {\r\n                    squashed.push(groupSection);\r\n                }\r\n            } else if (strategy === \"overwrite\") {\r\n                let overlap = false;\r\n                squashed.forEach((squashedSection, index) => {\r\n                    if (groupSection.overlaps(squashedSection) && squashedSection !== groupSection) {\r\n                        overlap = true;\r\n                        if (\r\n                            squashedSection.start < groupSection.start &&\r\n                            squashedSection.end > groupSection.end &&\r\n                            groupSection.confidence > squashedSection.confidence\r\n                        ) {\r\n                            // split squashed\r\n                            const squashedSectionBefore = squashedSection.clone();\r\n                            const squashedSectionAfter = squashedSection.clone();\r\n                            squashedSectionBefore.end = groupSection.start;\r\n                            squashedSectionAfter.start = groupSection.end;\r\n                            squashed[index] = squashedSectionBefore;\r\n                            squashed.push(squashedSectionAfter);\r\n                            squashed.push(groupSection.clone());\r\n                        } else if (\r\n                            squashedSection.start < groupSection.start &&\r\n                            squashedSection.end > groupSection.start &&\r\n                            squashedSection.end <= groupSection.end &&\r\n                            groupSection.confidence > squashedSection.confidence\r\n                        ) {\r\n                            // groupID cuts off squashed end\r\n                            squashedSection.end = groupSection.start;\r\n                            squashed.push(groupSection.clone());\r\n                        } else if (\r\n                            groupSection.start <= squashedSection.start &&\r\n                            groupSection.end > squashedSection.start &&\r\n                            groupSection.end < squashedSection.end &&\r\n                            groupSection.confidence > squashedSection.confidence\r\n                        ) {\r\n                            // groupID cuts off squashed start\r\n                            squashedSection.start = groupSection.end;\r\n                            squashed.push(groupSection.clone());\r\n                        } else if (\r\n                            groupSection.start < squashedSection.start &&\r\n                            groupSection.end > squashedSection.end\r\n                        ) {\r\n                            // groupID is bigger than squashed  TBD\r\n                        }\r\n                    }\r\n                });\r\n                if (!overlap) {\r\n                    squashed.push(groupSection.clone());\r\n                }\r\n            } else if (strategy === \"smart-overwrite\") {\r\n                squashed.forEach((squashedSection) => {\r\n                    if (groupSection.overlaps(squashedSection)) {\r\n                        // align ends\r\n                        if (squashedSection.start < groupSection.start && squashedSection.end > groupSection.end) {\r\n                            // split squashed\r\n                        }\r\n                    }\r\n                });\r\n            } else if (strategy === \"fill-gap\") {\r\n                fillGapSingle(squashed, groupSection);\r\n            } else if (strategy === \"fill-gap-old\") {\r\n                let thereIsSpace = true;\r\n                const newGroupSection = groupSection.clone();\r\n                squashed.forEach((squashedSection, index) => {\r\n                    if (groupSection.overlaps(squashedSection) && squashedSection !== groupSection) {\r\n                        if (squashedSection.start < groupSection.start && squashedSection.end > groupSection.end) {\r\n                            // no gap\r\n                            thereIsSpace = false;\r\n                        } else if (\r\n                            squashedSection.start < groupSection.start &&\r\n                            squashedSection.end > groupSection.start &&\r\n                            squashedSection.end <= groupSection.end\r\n                        ) {\r\n                            // groupID is cut off by squashed end\r\n                            newGroupSection.start = squashedSection.end;\r\n                        } else if (\r\n                            groupSection.start <= squashedSection.start &&\r\n                            groupSection.end > squashedSection.start &&\r\n                            groupSection.end < squashedSection.end\r\n                        ) {\r\n                            // groupID is cut off by squashed start\r\n                            newGroupSection.end = squashedSection.start;\r\n                        } else if (\r\n                            groupSection.start < squashedSection.start &&\r\n                            groupSection.end > squashedSection.end\r\n                        ) {\r\n                            // groupID is bigger than squashed  TBD\r\n                            thereIsSpace = false;\r\n                        }\r\n                    }\r\n                    if (newGroupSection.end <= newGroupSection.start) {\r\n                        thereIsSpace = false;\r\n                    }\r\n                });\r\n                if (thereIsSpace && newGroupSection.end - newGroupSection.start > minSize) {\r\n                    squashed.push(newGroupSection);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    return squashed;\r\n}\r\n\r\nexport function MDSColorTimbreSegmentsWithSSM(blurredTimbreSSM, segments) {\r\n    const amount = segments.length;\r\n    const distanceMatrix = new HalfMatrix({ size: amount, numberType: HalfMatrix.NumberType.FLOAT32 });\r\n\r\n    const segmentVectors = [];\r\n    segments.forEach((segment) => {\r\n        const middleSeconds = segment.start + segment.getDuration() / 2;\r\n        const middleSample = Math.floor(middleSeconds / blurredTimbreSSM.getSampleDuration());\r\n        const segmentVector = blurredTimbreSSM.getColumnNormalized(middleSample);\r\n        segmentVectors.push(segmentVector);\r\n    });\r\n\r\n    distanceMatrix.fill((x, y) => {\r\n        return similarity.euclidianTimbre(segmentVectors[x], segmentVectors[y]);\r\n    });\r\n\r\n    return MDSColorGivenDistanceMatrix(segments, distanceMatrix);\r\n}\r\n\r\nexport function MDSColorTimbreSegmentsWithFeatures(timbreFeatures, segments, sampleDuration, strategy) {\r\n    const amount = segments.length;\r\n    const distanceMatrix = new HalfMatrix({ size: amount, numberType: HalfMatrix.NumberType.FLOAT32 });\r\n\r\n    const segmentVectors = [];\r\n    segments.forEach((segment) => {\r\n        const vector = new Float32Array(12).fill(0);\r\n\r\n        const startSample = Math.floor(segment.start / sampleDuration);\r\n        const endSample = Math.floor(segment.end / sampleDuration);\r\n        const sampleAmount = endSample - startSample;\r\n        for (let i = startSample; i < endSample; i++) {\r\n            for (let f = 0; f < 12; f++) {\r\n                vector[f] += timbreFeatures[i][f];\r\n            }\r\n        }\r\n        for (let f = 0; f < 12; f++) {\r\n            vector[f] /= sampleAmount;\r\n        }\r\n        segmentVectors.push(vector);\r\n    });\r\n\r\n    distanceMatrix.fill((x, y) => {\r\n        return 1 - similarity.cosine(segmentVectors[x], segmentVectors[y]);\r\n    });\r\n\r\n    return MDSColorGivenDistanceMatrix(segments, distanceMatrix, strategy);\r\n}\r\n\r\nexport function MDSColorTimbreSamples(timbreFeatures) {\r\n    const amount = timbreFeatures.length;\r\n    const distanceMatrix = new HalfMatrix({ size: amount, numberType: HalfMatrix.NumberType.FLOAT32 });\r\n    distanceMatrix.fill((x, y) => {\r\n        return 1 - similarity.euclidianTimbre(timbreFeatures[x], timbreFeatures[y]);\r\n    });\r\n    //const MdsCoordinates = mds.getMdsCoordinates(distanceMatrix);\r\n    const MdsFeature = mds.getMDSFeature(distanceMatrix);\r\n\r\n    const coloredSamples = [];\r\n\r\n    for (let i = 0; i < amount; i++) {\r\n        coloredSamples.push(MdsFeature[i]);\r\n    }\r\n\r\n    return coloredSamples;\r\n}\r\n\r\nexport function clusterTimbreSegmentsWithFeatures(timbreFeatures, segments, sampleDuration) {\r\n    const coloredSegments = [];\r\n\r\n    const segmentVectors = [];\r\n    segments.forEach((segment) => {\r\n        const vector = new Float32Array(12).fill(0);\r\n\r\n        const startSample = Math.floor(segment.start / sampleDuration);\r\n        const endSample = Math.floor(segment.end / sampleDuration);\r\n        const sampleAmount = endSample - startSample;\r\n        for (let i = startSample; i < endSample; i++) {\r\n            for (let f = 0; f < 12; f++) {\r\n                vector[f] += timbreFeatures[i][f];\r\n            }\r\n        }\r\n        for (let f = 0; f < 12; f++) {\r\n            vector[f] /= sampleAmount;\r\n        }\r\n        segmentVectors.push(vector);\r\n    });\r\n    const clusteringResult = clustering.kMeansSearch(segmentVectors, 1, 10, 5);\r\n\r\n    segments.forEach((segment, index) => {\r\n        const cluster = clusteringResult.idxs[index];\r\n        const newSegment = segment.clone();\r\n        newSegment.groupID = cluster;\r\n        newSegment.confidence = 1;\r\n        coloredSegments.push(newSegment);\r\n    });\r\n\r\n    return coloredSegments;\r\n}\r\nexport function processTimbreSegments(timbreFeatures, segments, sampleDuration, strategy) {\r\n    const mdsColoredSegments = MDSColorTimbreSegmentsWithFeatures(timbreFeatures, segments, sampleDuration, strategy);\r\n    //log.debug(\"Clustering timbre segments\")\r\n    //const clusteredSegments = clusterTimbreSegmentsWithFeatures(timbreFeatures, mdsColoredSegments, sampleDuration);\r\n    //log.debug(\"Clustered timbre segments\")\r\n    return mdsColoredSegments;\r\n}\r\n\r\nfunction fitnessSort(a, b) {\r\n    if (a.fitness < b.fitness) {\r\n        return 1;\r\n    }\r\n    if (a.fitness > b.fitness) {\r\n        return -1;\r\n    }\r\n    return 0;\r\n}\r\n\r\nfunction createCandidate(pathSSM, start, end, scoreMatrixBuffer, strategy, groupID) {\r\n    const segmentPathFamilyInfo = pathExtraction.computeSegmentPathFamilyInfo(\r\n        pathSSM,\r\n        start,\r\n        end,\r\n        scoreMatrixBuffer,\r\n        strategy\r\n    );\r\n    const startInSeconds = start * pathSSM.sampleDuration;\r\n    const endInSeconds = end * pathSSM.sampleDuration;\r\n    const candidate = new Section({ start: startInSeconds, end: endInSeconds, groupID: groupID });\r\n    candidate.pathFamily = segmentPathFamilyInfo.pathFamily;\r\n    candidate.pathFamilyScores = segmentPathFamilyInfo.pathScores;\r\n    candidate.score = segmentPathFamilyInfo.score;\r\n    candidate.normalizedScore = segmentPathFamilyInfo.normalizedScore;\r\n    candidate.coverage = segmentPathFamilyInfo.coverage;\r\n    candidate.normalizedCoverage = segmentPathFamilyInfo.normalizedCoverage;\r\n    candidate.fitness = segmentPathFamilyInfo.fitness;\r\n    return candidate;\r\n}\r\n\r\n// Remove B from A\r\n// Creates new array, doesn't edit A\r\nexport function subtractSegments(segmentsA, segmentsB) {\r\n    const newSegmentsA = segmentsA.map((a) => a.clone());\r\n\r\n    segmentsB.forEach((b) => {\r\n        let i = 0;\r\n        while (i < newSegmentsA.length) {\r\n            const a = newSegmentsA[i];\r\n            if (a.overlaps(b)) {\r\n                if (b.start > a.start && b.end < a.end) {\r\n                    const leftSize = b.start - a.start;\r\n                    const rightSize = a.end - b.end;\r\n                    const keepLeft = leftSize > 0;\r\n                    const keepRight = rightSize > 0;\r\n                    if (keepLeft && keepRight) {\r\n                        const clonedGroupSection = a.clone();\r\n                        a.end = b.start;\r\n                        clonedGroupSection.start = b.end;\r\n                        newSegmentsA.push(clonedGroupSection);\r\n                    } else if (keepLeft) {\r\n                        newSegmentsA[i].end = b.start;\r\n                    } else if (keepRight) {\r\n                        newSegmentsA[i].start = b.end;\r\n                    }\r\n                } else if (b.start > a.start && b.end >= a.end) {\r\n                    newSegmentsA[i].end = b.start;\r\n                } else if (b.start <= a.start && b.end < a.end) {\r\n                    newSegmentsA[i].start = b.end;\r\n                }\r\n            }\r\n\r\n            if (b.start <= a.start && b.end >= a.end) {\r\n                newSegmentsA.splice(i, 1);\r\n            } else {\r\n                i++;\r\n            }\r\n        }\r\n    });\r\n\r\n    return newSegmentsA;\r\n}\r\n\r\nexport function sortGroupByCoverage(sections) {\r\n    const newSections = [];\r\n\r\n    let groupCoverage = [];\r\n    sections.forEach((section) => {\r\n        if (groupCoverage[section.groupID] === undefined) {\r\n            groupCoverage[section.groupID] = { groupID: section.groupID, coverage: section.end - section.start };\r\n        } else {\r\n            groupCoverage[section.groupID].coverage += section.end - section.start;\r\n        }\r\n    });\r\n\r\n    groupCoverage = groupCoverage.sort((a, b) => b.coverage - a.coverage);\r\n    sections.forEach((section) => {\r\n        const newGroup = groupCoverage.findIndex((group) => group.groupID === section.groupID);\r\n        const newSection = section.clone();\r\n        newSection.groupID = newGroup;\r\n        newSections.push(newSection);\r\n    });\r\n\r\n    return newSections;\r\n}\r\n\r\nfunction sortGroupByFirstOccuring(sections) {\r\n    const newSections = [];\r\n    sections = sections.sort((a, b) => (a.start > b.start ? 1 : -1));\r\n\r\n    // index is groupID of new sections\r\n    const mapping = [];\r\n    sections.forEach((section) => {\r\n        let newGroup = mapping.indexOf(section.groupID);\r\n        if (newGroup === -1) {\r\n            mapping.push(section.groupID);\r\n            newGroup = mapping.length - 1;\r\n        }\r\n        const newSection = section.clone();\r\n        newSection.groupID = newGroup;\r\n        newSections.push(newSection);\r\n    });\r\n\r\n    return newSections;\r\n}\r\n\r\nexport function createSeparators(coloredSegments, pathSSM) {\r\n    const coloredSegmentsSorted = coloredSegments.sort((a, b) => a.start - b.start);\r\n    const separators = [];\r\n\r\n    for (let i = 0; i < coloredSegments.length; i++) {\r\n        const segment = coloredSegmentsSorted[i];\r\n\r\n        let distanceFromPreviousSegment = 1;\r\n        if (i > 0) {\r\n            distanceFromPreviousSegment = pathExtraction.getDistanceBetween(\r\n                segment,\r\n                coloredSegmentsSorted[i - 1],\r\n                pathSSM\r\n            );\r\n            const angleDistance = Math.abs(segment.colorAngle - coloredSegmentsSorted[i - 1].colorAngle);\r\n            distanceFromPreviousSegment = Math.min(angleDistance, 1 - angleDistance) * 2;\r\n        }\r\n\r\n        const separator = {\r\n            start: segment.start,\r\n            end: segment.end,\r\n            duration: segment.end - segment.start,\r\n            colorAngle: segment.colorAngle,\r\n            colorRadius: segment.colorRadius,\r\n            confidence: distanceFromPreviousSegment,\r\n        };\r\n        separators.push(separator);\r\n    }\r\n\r\n    return separators;\r\n}\r\n","import * as log from \"../dev/log\";\r\nimport SpotifySegment from \"./SpotifySegment\";\r\nimport * as chordDetection from \"./chordDetection\";\r\nimport * as filter from \"./filter\";\r\nimport { lowerFirst } from \"lodash\";\r\nimport * as structure from \"./structure\";\r\nimport * as SSM from \"./SSM\";\r\nimport * as noveltyDetection from \"./noveltyDetection\";\r\n\r\nconst timbreNormalizationAmount = 0.2;\r\n\r\nexport default class Features {\r\n    timbreMax = new Array(12).fill(0);\r\n    timbreMin = new Array(12).fill(0);\r\n    timbreBiggest = new Array(12).fill(0);\r\n    timbreTotalBiggest = 0;\r\n\r\n    duration = 0;\r\n    length = 0;\r\n    segments = [];\r\n    segmentStartDuration = [];\r\n    beatsStartDuration = [];\r\n    raw = { pitches: [], timbres: [], loudness: [] };\r\n    processed = {\r\n        pitches: [],\r\n        noise: [],\r\n        timbres: [],\r\n        loudness: [],\r\n        avgLoudness: [],\r\n        dynamics: [],\r\n        tonalEnergy: [],\r\n        tonalRadius: [],\r\n        tonalAngle: [],\r\n    };\r\n\r\n    clusterSelection = [];\r\n    tsneSelection = [];\r\n\r\n    sampleDuration = 0;\r\n    sampleAmount = 0;\r\n    sampled = {};\r\n    sampleStartDuration = [];\r\n    sampleBlur = 0; // in proportion to duration (<1 is no blur, 2 is blur of twice duration)\r\n\r\n    fastSampledPitch = [];\r\n    fastSampleDuration = 0.1;\r\n\r\n    downSampledTimbre = [];\r\n\r\n    directLoudnessSampleDuration = 0.25;\r\n    directLoudnessAmount;\r\n    directLoudness;\r\n\r\n    maxLoudness;\r\n    averageLoudness;\r\n\r\n    dynamicsBase = 0.12;\r\n\r\n    constructor(analysisData, options = {}) {\r\n        this.duration = analysisData.track.duration;\r\n        analysisData.segments.forEach((segment) => {\r\n            this.segments.push(new SpotifySegment(segment));\r\n            this.segmentStartDuration.push([segment.start, segment.duration]);\r\n        });\r\n        this.length = this.segments.length;\r\n        this.sampleAmount = Math.min(Math.ceil(this.duration / options.sampleDuration), options.samples);\r\n        this.sampleDuration = analysisData.track.duration / this.sampleAmount;\r\n        log.info(\"Sampling, Amount:\", this.sampleAmount, \"Duration: \", this.sampleDuration);\r\n        this.sampleBlur = options.sampleBlur || 1;\r\n        this.fillBeatsStartDuration(analysisData.beats);\r\n        this.calculateMaxMin();\r\n        log.debug(this.timbreBiggest);\r\n        log.debug(\"total biggest timbre\", this.timbreTotalBiggest);\r\n        this.processSegments();\r\n        if (this.segments.length) this.processDirectLoudness();\r\n        this.sampleFeatures();\r\n        this.processSamples();\r\n        this.downSampledTimbre = this.downSampleTimbre(options.downsampleAmount);\r\n        this.fastSampledPitch = this.sample(\"pitches\", { sampleDuration: this.fastSampleDuration });\r\n\r\n        const features = this.sampled.timbres;\r\n        const segmentationSmoothingLength = Math.round(5);\r\n        const continuousSmoothingLength = Math.round(10);\r\n\r\n        const ssmTimbre = SSM.calculateSSM(features, this.sampleDuration);\r\n        const blurredTimbreLarge = filter.gaussianBlur2DOptimized(ssmTimbre, 5);\r\n        const timbreNoveltyColumn = noveltyDetection.absoluteEuclideanColumnDerivative(blurredTimbreLarge);\r\n\r\n        const segmentationSmoothedFeatures = filter.gaussianBlurFeatures(features, segmentationSmoothingLength);\r\n        const segmentationDerivative = noveltyDetection.featureDerivative(segmentationSmoothedFeatures);\r\n        const smoothedSegmentationDerivative = filter.gaussianBlur1D(segmentationDerivative, 5);\r\n        const segments = structure.createSegmentsFromNovelty(smoothedSegmentationDerivative, this.sampleDuration, 0.2);\r\n        const averagedColouredSegments = structure.processTimbreSegments(features, segments, this.sampleDuration);\r\n\r\n        const segmentedFeatures = [];\r\n        segments.forEach((segment) => {\r\n            const featureSegment = features.slice(segment.startSample, segment.endSample);\r\n            const smoothedFeatureSegment = filter.gaussianBlurFeatures(featureSegment, continuousSmoothingLength);\r\n            segmentedFeatures.push(smoothedFeatureSegment);\r\n        });\r\n\r\n        log.debug(\"segmentedFeatures\", segmentedFeatures);\r\n\r\n        const frankenFeatures = [];\r\n        segmentedFeatures.forEach((featureSegment) => {\r\n            frankenFeatures.push(...featureSegment);\r\n        });\r\n        this.sampled.smoothedTimbre = segmentationSmoothedFeatures;\r\n        const medianFeatures = filter.medianFilterFeatures(this.sampled.timbres, 1);\r\n\r\n        this.sampled.frankenFeatures = medianFeatures;\r\n    }\r\n\r\n    /**\r\n     * The values calculated in this function are used to scale the raw features\r\n     */\r\n    calculateMaxMin() {\r\n        this.segments.forEach((segment, index) => {\r\n            for (let i = 0; i < 12; i++) {\r\n                this.timbreMax[i] = Math.max(this.timbreMax[i], segment.getOriginalTimbres()[i]);\r\n                this.timbreMin[i] = Math.min(this.timbreMin[i], segment.getOriginalTimbres()[i]);\r\n            }\r\n        });\r\n        for (let i = 0; i < 12; i++) {\r\n            this.timbreBiggest[i] = Math.max(Math.abs(this.timbreMax[i]), Math.abs(this.timbreMin[i]));\r\n            this.timbreTotalBiggest = Math.max(this.timbreTotalBiggest, this.timbreBiggest[i]);\r\n        }\r\n    }\r\n\r\n    fillBeatsStartDuration(beats) {\r\n        beats.forEach((beat) => {\r\n            this.beatsStartDuration.push([beat.start, beat.duration]);\r\n        });\r\n    }\r\n\r\n    processSegments() {\r\n        this.segments.forEach((s, i) => {\r\n            this.raw.pitches[i] = s.segment.pitches;\r\n            this.raw.timbres[i] = s.segment.timbre;\r\n            this.raw.loudness[i] = s.getLoudnessFeatures();\r\n            s.processPitch();\r\n\r\n            this.processed.pitches.push(s.pitches);\r\n            this.processed.noise.push(s.noise);\r\n\r\n            this.processed.loudness.push(s.getLoudnessFeatures());\r\n            const nextSegmentStartLoudness =\r\n                i + 1 < this.segments.length ? this.segments[i + 1].getLoudnessFeatures()[0] : 0;\r\n            this.processed.avgLoudness.push(s.getAverageLoudness(nextSegmentStartLoudness));\r\n            this.processed.dynamics.push(s.getAverageLoudness(nextSegmentStartLoudness));\r\n\r\n            s.processTimbre(this.timbreMin, this.timbreMax, this.timbreBiggest, this.timbreTotalBiggest);\r\n            const timbres = [];\r\n            for (let t = 0; t < 12; t++) {\r\n                if (t === 0) {\r\n                    // replace by loudnes\r\n                    const timbre = this.processed.avgLoudness[this.processed.avgLoudness.length - 1] - 0.5;\r\n                    timbres.push(timbre);\r\n                } else {\r\n                    const timbre =\r\n                        (1 - timbreNormalizationAmount) * s.timbres[t] + timbreNormalizationAmount * s.timbresScaled[t];\r\n                    timbres.push(timbre);\r\n                }\r\n            }\r\n            this.processed.timbres.push(timbres);\r\n\r\n            this.processed.tonalEnergy.push(s.tonalityEnergy);\r\n            this.processed.tonalRadius.push(s.tonalityRadius);\r\n            this.processed.tonalAngle.push(s.tonalityAngle);\r\n        });\r\n\r\n        for (let i = 0; i < this.segments.length; i++) {\r\n            // Try to remove percussion from pitch features\r\n            if (i > 0 && i < this.segments.length - 1) {\r\n                this.segments[i].processPitchSmooth(this.segments[i - 1], this.segments[i + 1]);\r\n            }\r\n\r\n            // Create feature selections\r\n            this.clusterSelection.push([\r\n                ...this.processed.timbres[i],\r\n                this.processed.tonalEnergy[i],\r\n                this.processed.tonalRadius[i],\r\n                ...this.processed.loudness[i],\r\n            ]);\r\n            this.tsneSelection.push([\r\n                ...this.processed.timbres[i],\r\n                this.processed.tonalEnergy[i],\r\n                this.processed.tonalRadius[i],\r\n                ...this.processed.loudness[i],\r\n            ]);\r\n        }\r\n    }\r\n\r\n    processDirectLoudness() {\r\n        this.directLoudnessAmount = Math.floor(this.duration / this.directLoudnessSampleDuration);\r\n        this.directLoudness = new Float32Array(this.directLoudnessAmount);\r\n\r\n        log.info(\r\n            \"Process direct loudness\",\r\n            \"duration\",\r\n            this.duration,\r\n            \"segmentAmount\",\r\n            this.segmentStartDuration.length,\r\n            \"amount\",\r\n            this.directLoudnessAmount\r\n        );\r\n\r\n        let segmentIndex = 0;\r\n        for (let i = 0; i < this.directLoudnessAmount; i++) {\r\n            const time = this.directLoudnessSampleDuration * i;\r\n            while (!this.isTimeInSegment(segmentIndex, time)) {\r\n                segmentIndex++;\r\n            }\r\n            this.directLoudness[i] = this.getExactLoudness(segmentIndex, time);\r\n        }\r\n    }\r\n\r\n    isTimeInSegment(index, time) {\r\n        const start = this.segmentStartDuration[index][0];\r\n        const end = start + this.segmentStartDuration[index][1];\r\n        return time >= start && time < end;\r\n    }\r\n\r\n    getExactLoudness(index, time) {\r\n        const startLoudness = this.raw.loudness[index][0];\r\n        const endLoudness = index + 1 < this.segmentStartDuration.length ? this.raw.loudness[index + 1][0] : 0;\r\n        const startTime = this.segmentStartDuration[index][0];\r\n        const fraction = (time - startTime) / this.segmentStartDuration[index][1];\r\n        //return fraction * endLoudness + (1 - fraction) * startLoudness;\r\n        return this.raw.loudness[index][1];\r\n    }\r\n\r\n    processSamples() {\r\n        this.sampled.pitches;\r\n        this.sampled.timbres;\r\n\r\n        //this.sampled.pitches = filter.gaussianBlurFeatures(this.sampled.pitches, 4);\r\n\r\n        this.sampled.chords = [];\r\n        this.sampled.majorminor = [];\r\n        for (let i = 0; i < this.sampleAmount; i++) {\r\n            this.sampled.chords[i] = chordDetection.getPopChord(this.sampled.pitches[i]);\r\n            this.sampled.majorminor[i] = chordDetection.getMajorMinorNess(this.sampled.pitches[i]);\r\n        }\r\n\r\n        this.sampled.smoothedAvgLoudness = filter.gaussianBlur1D(this.sampled.avgLoudness, 1);\r\n        this.averageLoudness = 0;\r\n        this.maxLoudness = 0;\r\n        this.sampled.smoothedAvgLoudness.forEach((loudness) => {\r\n            this.averageLoudness += loudness;\r\n            if (loudness > this.maxLoudness) {\r\n                this.maxLoudness = loudness;\r\n            }\r\n        });\r\n        log.debug(\"Maxloudness\", this.maxLoudness);\r\n        log.debug(this.sampled.dynamics[0]);\r\n        log.debug(this.sampled.dynamics[0] / this.maxLoudness);\r\n        log.debug((this.sampled.dynamics[0] / this.maxLoudness) * (1 - this.dynamicsBase) + this.dynamicsBase);\r\n\r\n        this.processed.dynamics = this.processed.dynamics.map((dynamic) => {\r\n            return (dynamic / this.maxLoudness) * (1 - this.dynamicsBase) + this.dynamicsBase;\r\n        });\r\n        this.sampled.dynamics = this.sampled.dynamics.map((dynamic) => {\r\n            return (dynamic / this.maxLoudness) * (1 - this.dynamicsBase) + this.dynamicsBase;\r\n        });\r\n        log.debug(this.sampled.dynamics[0]);\r\n\r\n        this.averageLoudness /= this.sampled.smoothedAvgLoudness.length;\r\n    }\r\n\r\n    sample(feature, options) {\r\n        const sampledFeature = [];\r\n\r\n        let sampleAmount = 0;\r\n        let sampleDuration = 0;\r\n        if (options.sampleDuration) {\r\n            // make sure the length of the track is divisble by sampleDuration\r\n            sampleAmount = Math.round(this.duration / options.sampleDuration);\r\n            sampleDuration = this.duration / sampleAmount;\r\n        }\r\n        if (options.sampleAmount) {\r\n            sampleAmount = options.sampleAmount;\r\n            sampleDuration = this.duration / sampleAmount;\r\n        }\r\n\r\n        let i = 0;\r\n        for (let s = 0; s < sampleAmount; s++) {\r\n            const averageFeature = new Float32Array(12).fill(0);\r\n\r\n            const sampleStart = s * sampleDuration;\r\n            const sampleEnd = (s + 1) * sampleDuration;\r\n\r\n            // Sample is contained in segment, simply copy pitch from segment and go to next sample\r\n            if (this.segments[i].getEnd() > sampleEnd) {\r\n                averageFeature.forEach((val, f) => (averageFeature[f] = val + this.segments[i][feature][f]));\r\n                sampledFeature.push(averageFeature);\r\n                continue;\r\n            }\r\n\r\n            // add part of first segment\r\n            if (this.segments[i].getEnd() > sampleStart) {\r\n                const weight = (this.segments[i].getEnd() - sampleStart) / sampleDuration;\r\n                averageFeature.forEach((val, f) => (averageFeature[f] = val + weight * this.segments[i][feature][f]));\r\n                i++;\r\n            }\r\n\r\n            // while entire segment is contained in sample\r\n            while (i < this.segments.length && this.segments[i].getEnd() < sampleEnd) {\r\n                const weight = this.segments[i].duration / sampleDuration;\r\n                averageFeature.forEach((val, f) => (averageFeature[f] = val + weight * this.segments[i][feature][f]));\r\n                i++;\r\n            }\r\n\r\n            // add part of last segment\r\n            if (i < this.segments.length) {\r\n                const weight = (sampleEnd - this.segments[i].start) / sampleDuration;\r\n                averageFeature.forEach((val, f) => (averageFeature[f] = val + weight * this.segments[i][feature][f]));\r\n            }\r\n\r\n            sampledFeature.push(averageFeature);\r\n        }\r\n        return sampledFeature;\r\n    }\r\n\r\n    /**\r\n     * Turn processed features into evenly discretized features int\r\n     */\r\n    sampleFeatures() {\r\n        // Fill sample start duration\r\n        for (let i = 0; i < this.sampleAmount - 1; i++) {\r\n            this.sampleStartDuration.push([i * this.sampleDuration, this.sampleDuration]);\r\n        }\r\n        // Last sample is shorter\r\n        const lastSampleStart = (this.sampleAmount - 1) * this.sampleDuration;\r\n        this.sampleStartDuration.push([lastSampleStart, this.duration - lastSampleStart]);\r\n        this.initSampleFeatures();\r\n\r\n        const blurDuration = this.sampleBlur * this.sampleDuration;\r\n\r\n        const blurOutsideSampleDuration = (blurDuration - this.sampleDuration) / 2;\r\n\r\n        this.segments.forEach((segment, segmentIndex) => {\r\n            const segmentEnd = segment.start + segment.duration;\r\n\r\n            // calculate range of samples e.g. [2,6] clip by 0 and size\r\n            const sampleRangeStartIndex = Math.max(\r\n                0,\r\n                Math.floor((segment.start - blurOutsideSampleDuration) / this.sampleDuration)\r\n            );\r\n            const sampleRangeEndIndex = Math.min(\r\n                this.sampleAmount - 1,\r\n                Math.floor((segmentEnd + blurOutsideSampleDuration) / this.sampleDuration)\r\n            );\r\n\r\n            const rangeSize = sampleRangeEndIndex - sampleRangeStartIndex;\r\n            if (rangeSize >= 1) {\r\n                // first sample in range\r\n                const firstSample = this.sampleStartDuration[sampleRangeStartIndex];\r\n                const sampleBlurEnd = firstSample[0] + firstSample[1] + blurOutsideSampleDuration;\r\n                const firstSampleOverlap = sampleBlurEnd - segment.start;\r\n                // firstSampleValue += firstSampleOverlap*segment.value;\r\n                this.addFeaturesScaled(sampleRangeStartIndex, segmentIndex, firstSampleOverlap);\r\n            }\r\n            if (rangeSize >= 1) {\r\n                // last sample in range\r\n                const sampleBlurStart = this.sampleStartDuration[sampleRangeEndIndex][0] - blurOutsideSampleDuration;\r\n                const lastSampleOverlap = segmentEnd - sampleBlurStart;\r\n                //lastSampleValue += lastSampleOverlap*segment.value;\r\n                this.addFeaturesScaled(sampleRangeEndIndex, segmentIndex, lastSampleOverlap);\r\n            }\r\n            if (rangeSize >= 2) {\r\n                // every middle sample\r\n                for (let i = sampleRangeStartIndex + 1; i < sampleRangeEndIndex; i++) {\r\n                    //sampleValue += segment.duration*segment.value\r\n                    this.addFeaturesScaled(i, segmentIndex, blurDuration);\r\n                }\r\n            }\r\n            if (rangeSize === 0) {\r\n                this.addFeaturesScaled(sampleRangeStartIndex, segmentIndex, segment.duration);\r\n            }\r\n        });\r\n\r\n        // First sample has only blur on right\r\n        //this.samples[0] /= this.sampleDuration + blurOutsideSampleDuration;\r\n        this.divideFeatures(0, this.sampleDuration + blurOutsideSampleDuration);\r\n\r\n        // Last sample has shorter duration and only blur on left\r\n        //this.samples[this.sampleAmount-1] /= this.sampleStartDuration[this.sampleAmount-1].duration + blurOutsideSampleDuration;\r\n        this.divideFeatures(\r\n            this.sampleAmount - 1,\r\n            this.sampleStartDuration[this.sampleAmount - 1][1] + blurOutsideSampleDuration\r\n        );\r\n\r\n        for (let i = 1; i < this.sampleAmount - 1; i++) {\r\n            //this.samples[i] /= blurDuration\r\n            this.divideFeatures(i, blurDuration);\r\n        }\r\n    }\r\n\r\n    downSampleTimbre(amount) {\r\n        const downSampleAmount = amount;\r\n        const downSampleRatio = this.sampleAmount / (downSampleAmount + 1);\r\n        const downSampledTimbre = [];\r\n        for (let i = 0; i < downSampleAmount; i++) {\r\n            const startIndex = i * downSampleRatio;\r\n            const endIndex = (i + 1) * downSampleRatio;\r\n\r\n            const startSample = Math.floor(startIndex);\r\n            const startSampleWeight = 1 - (startIndex - startSample);\r\n            const endSample = Math.floor(endIndex);\r\n            const endSampleWeight = endIndex - endSample;\r\n\r\n            let summedTimbre = new Float32Array(12).fill(0);\r\n\r\n            for (let f = 0; f < 12; f++) {\r\n                summedTimbre[f] += this.sampled.timbres[startSample][f] * startSampleWeight;\r\n                summedTimbre[f] += this.sampled.timbres[endSample][f] * endSampleWeight;\r\n            }\r\n\r\n            for (let s = startSample + 1; s < endSample; s++) {\r\n                for (let f = 0; f < 12; f++) {\r\n                    summedTimbre[f] += this.sampled.timbres[s][f];\r\n                }\r\n            }\r\n\r\n            for (let f = 0; f < 12; f++) {\r\n                summedTimbre[f] /= downSampleRatio;\r\n            }\r\n\r\n            downSampledTimbre.push(summedTimbre);\r\n        }\r\n        return downSampledTimbre;\r\n    }\r\n\r\n    initSampleFeatures() {\r\n        for (const featureName in this.processed) {\r\n            this.sampled[featureName] = new Array(this.sampleAmount).fill(0);\r\n            const featureSize = this.processed[featureName][0].length;\r\n\r\n            if (featureSize) {\r\n                for (let s = 0; s < this.sampleAmount; s++) {\r\n                    this.sampled[featureName][s] = new Array(this.processed[featureName][0].length).fill(0);\r\n                }\r\n            } else {\r\n                for (let s = 0; s < this.sampleAmount; s++) {\r\n                    this.sampled[featureName][s] = 0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    setFeaturesScaled(sampleIndex, segmentIndex, scalar) {\r\n        for (const featureName in this.processed) {\r\n            const featureSize = this.processed[featureName][0].length;\r\n            if (featureSize) {\r\n                for (let i = 0; i < featureSize; i++) {\r\n                    this.sampled[featureName][sampleIndex][i] = this.processed[featureName][segmentIndex][i] * scalar;\r\n                }\r\n            } else {\r\n                this.sampled[featureName][sampleIndex] = this.processed[featureName][segmentIndex] * scalar;\r\n            }\r\n        }\r\n    }\r\n\r\n    addFeaturesScaled(sampleIndex, segmentIndex, scalar) {\r\n        for (const featureName in this.processed) {\r\n            const featureSize = this.processed[featureName][0].length;\r\n            if (featureSize) {\r\n                for (let i = 0; i < featureSize; i++) {\r\n                    this.sampled[featureName][sampleIndex][i] += this.processed[featureName][segmentIndex][i] * scalar;\r\n                }\r\n            } else {\r\n                this.sampled[featureName][sampleIndex] += this.processed[featureName][segmentIndex] * scalar;\r\n            }\r\n        }\r\n    }\r\n\r\n    divideFeatures(sampleIndex, divisor) {\r\n        for (const featureName in this.sampled) {\r\n            const featureSize = this.processed[featureName][0].length;\r\n            if (featureSize) {\r\n                for (let i = 0; i < featureSize; i++) {\r\n                    this.sampled[featureName][sampleIndex][i] /= divisor;\r\n                }\r\n            } else {\r\n                this.sampled[featureName][sampleIndex] /= divisor;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function downSample(features, sampleAmount) {\r\n    const ratio = features.length / sampleAmount;\r\n    const newFeatures = [];\r\n    for (let i = 0; i < sampleAmount; i++) {\r\n        const average = new Float32Array(12);\r\n        const firstIndex = Math.floor(i * ratio);\r\n        const firstWeight = 1 - (i * ratio - firstIndex);\r\n        const lastIndex = Math.floor((i + 1) * ratio);\r\n        const lastWeight = (i + 1) * ratio - lastIndex;\r\n\r\n        if (firstWeight > 0) {\r\n            for (let f = 0; f < 12; f++) {\r\n                average[f] += (features[firstIndex][f] * firstWeight) / ratio;\r\n            }\r\n        }\r\n        if (lastWeight > 0) {\r\n            for (let f = 0; f < 12; f++) {\r\n                average[f] += (features[lastIndex][f] * lastWeight) / ratio;\r\n            }\r\n        }\r\n\r\n        //middle\r\n        for (let j = firstIndex + 1; j < lastIndex; j++) {\r\n            for (let f = 0; f < 12; f++) {\r\n                average[f] += features[j][f] / ratio;\r\n            }\r\n        }\r\n        newFeatures.push(average);\r\n    }\r\n    return newFeatures;\r\n}\r\n","import * as log from \"../dev/log\";\r\nimport * as d3 from \"d3\";\r\nimport * as audioUtil from \"./audioUtil\";\r\n\r\nimport * as Track from \"./Track\";\r\n\r\nconst PHI = (1 + Math.sqrt(5)) / 2;\r\n\r\nexport const colorWheel = d3\r\n    .scaleLinear()\r\n    .domain([0, 1 / 12, 2 / 12, 3 / 12, 4 / 12, 5 / 12, 6 / 12, 7 / 12, 8 / 12, 9 / 12, 10 / 12, 11 / 12, 1])\r\n    .interpolate(d3.interpolateHcl)\r\n    .range([\r\n        d3.rgb(\"#da321f\"),\r\n        d3.rgb(\"#e06300\"),\r\n        d3.rgb(\"#e89b00\"),\r\n        d3.rgb(\"#ebcb03\"),\r\n        d3.rgb(\"#9fbb04\"),\r\n        d3.rgb(\"#2cbe03\"),\r\n        d3.rgb(\"#03b779\"),\r\n        d3.rgb(\"#06b3bd\"),\r\n        d3.rgb(\"#3875cc\"),\r\n        d3.rgb(\"#7503db\"),\r\n        d3.rgb(\"#c203ae\"),\r\n        d3.rgb(\"#e84b90\"),\r\n        d3.rgb(\"#da321f\"),\r\n    ]);\r\n\r\nexport const zeroOneColor = d3\r\n    .scaleSequential()\r\n    .domain([0, 1])\r\n    .interpolator(d3.interpolateViridis);\r\nexport const zeroOneColorGreys = d3\r\n    .scaleSequential()\r\n    .domain([0, 1])\r\n    .interpolator(d3.interpolateGreys);\r\nexport const zeroOneColorGreysDark = d3\r\n    .scaleLinear()\r\n    .domain([0, 1])\r\n    .range([d3.rgb(\"#444444\"), d3.rgb(\"#ffffff\")]);\r\nexport const zeroOneColorGreysLight = d3\r\n    .scaleLinear()\r\n    .domain([0, 1])\r\n    .range([d3.rgb(\"#000000\"), d3.rgb(\"#cccccc\")]);\r\nexport const zeroOneColorWarm = d3\r\n    .scaleSequential()\r\n    .domain([0, 1])\r\n    .interpolator(d3.interpolateWarm);\r\nexport const zeroOneColorCool = d3\r\n    .scaleSequential()\r\n    .domain([0, 1])\r\n    .interpolator(d3.interpolateCool);\r\nexport const zeroOneColorTurbo = d3\r\n    .scaleSequential()\r\n    .domain([0, 1])\r\n    .interpolator(d3.interpolateTurbo);\r\nexport const pitchColor = zeroOneColor;\r\nexport const greyScaleColor = d3\r\n    .scaleSequential()\r\n    .domain([1, 0])\r\n    .interpolator(d3.interpolateGreys);\r\nexport const rainbowColor = d3\r\n    .scaleSequential()\r\n    .domain([0, 11])\r\n    .interpolator(d3.interpolateRainbow);\r\nexport const sinebowColorNormalized = d3\r\n    .scaleSequential()\r\n    .domain([0, 1])\r\n    .interpolator(d3.interpolateSinebow);\r\nexport const rawTimbreColor = d3\r\n    .scaleDiverging()\r\n    .domain([-300, 0, 300])\r\n    .interpolator(d3.interpolateRdBu);\r\nexport const divergingColor = d3\r\n    .scaleDiverging()\r\n    .domain([-1, 0, 1])\r\n    .interpolator(d3.interpolateRdBu);\r\n\r\nexport function goldenRatioCategoricalColor(i, offset, opacity) {\r\n    const angle = (offset - i * PHI) % 1;\r\n    const c = d3.rgb(sinebowColorNormalized(angle));\r\n    return `rgba(${c.r},${c.g},${c.b},${opacity})`;\r\n}\r\n\r\nexport const categoryColor = d3.scaleOrdinal().range(d3.schemeCategory10);\r\nexport function categoryColorWithOpacity(color, opacity) {\r\n    const c = d3.rgb(categoryColor(color));\r\n    return `rgba(${c.r},${c.g},${c.b},${opacity})`;\r\n}\r\nexport function lightness(color, lightness) {\r\n    const hslColor = d3.hsl(color);\r\n    hslColor.l = lightness;\r\n    return hslColor.hex();\r\n}\r\n\r\nexport function sinebowColorNormalizedRadius(angle, radius, confidence = 1) {\r\n    const color = sinebowColorNormalized(angle);\r\n    const colorHSL = d3.hsl(color);\r\n    colorHSL.s = radius; //Math.pow(radius, 0.2);\r\n    colorHSL.l = (colorHSL.l - 0.5) * radius + 0.5;\r\n    const c = d3.rgb(colorHSL);\r\n    return `rgba(${c.r},${c.g},${c.b},${confidence})`;\r\n}\r\n\r\nexport function circleOfFifthsColor(angle, radius, confidence = 1) {\r\n    const color = colorWheel(angle);\r\n    const colorHSL = d3.hsl(color);\r\n    colorHSL.s = radius; //Math.pow(radius, 0.2);\r\n    colorHSL.l = (colorHSL.l - 0.5) * radius + 0.5;\r\n    const c = d3.rgb(colorHSL);\r\n    return `rgba(${c.r},${c.g},${c.b},${confidence})`;\r\n}\r\n\r\nexport function circleOfFifthsColorBrightness(angle, radius, brightness = 1) {\r\n    const color = colorWheel(angle);\r\n    const colorHSL = d3.hsl(color);\r\n    colorHSL.s = radius; //Math.pow(radius, 0.2);\r\n    colorHSL.l = brightness;\r\n    return d3.rgb(colorHSL);\r\n}\r\n\r\nexport function renderRawPitch(track, left, width, yOffset, height, ctx) {\r\n    const scale = width / track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment) => {\r\n        for (let i = 0; i < 12; i++) {\r\n            const x = left + segment.start * scale;\r\n            const segmentHeight = height / 12 - 2;\r\n            const y = yOffset + (11 - i) * (segmentHeight + 2);\r\n            const segmentWidth = segment.duration * scale;\r\n            ctx.fillStyle = pitchColor(segment.segment.pitches[i]);\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        }\r\n    });\r\n}\r\n\r\nexport function renderPercussionPitch(track, left, width, yOffset, height, ctx) {\r\n    const scale = width / track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment, segmentIndex) => {\r\n        const x = left + segment.start * scale;\r\n        const segmentHeight = height / 3 - 2;\r\n        let y = yOffset + 0 * (segmentHeight + 2);\r\n        const segmentWidth = segment.duration * scale;\r\n        ctx.fillStyle = pitchColor(segment.tonalityEnergy * 2 - 0.5);\r\n        ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        y = yOffset + 1 * (segmentHeight + 2);\r\n        ctx.fillStyle = pitchColor(1 - segment.tonalityRadius);\r\n        ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        y = yOffset + 2 * (segmentHeight + 2);\r\n        ctx.fillStyle = segment.duration > 0.15 ? pitchColor(0) : pitchColor(segment.percussiony);\r\n        ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n    });\r\n}\r\n\r\nexport function renderProcessedPitch(track, left, width, yOffset, height, ctx) {\r\n    const scale = width / track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment) => {\r\n        for (let i = 0; i < 12; i++) {\r\n            const x = left + segment.start * scale;\r\n            const segmentHeight = height / 12 - 2;\r\n            const y = yOffset + (11 - i) * (segmentHeight + 2);\r\n            const segmentWidth = segment.duration * scale;\r\n            ctx.fillStyle = pitchColor(segment.pitches[i]);\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        }\r\n    });\r\n}\r\nexport function renderRawTimbre(track, left, width, yOffset, height, ctx) {\r\n    const scale = width / track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment, segmentIndex) => {\r\n        for (let i = 0; i < 12; i++) {\r\n            const x = left + segment.start * scale;\r\n            const segmentHeight = height / 12 - 2;\r\n            const y = yOffset + (11 - i) * (segmentHeight + 2);\r\n            const segmentWidth = segment.duration * scale;\r\n            ctx.fillStyle = divergingColor(track.getProcessedTimbre(segmentIndex)[i]);\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        }\r\n    });\r\n}\r\n\r\nexport function renderRawRhythm(track, left, width, yOffset, height, ctx) {\r\n    const scale = width / track.getAnalysis().track.duration;\r\n    track.getBars().forEach((bar) => {\r\n        const x = left + bar.start * scale;\r\n        const y = yOffset;\r\n        ctx.fillStyle = greyScaleColor(0.3 + bar.confidence);\r\n        ctx.fillRect(x, y, 1, height / 3);\r\n    });\r\n    track.getBeats().forEach((beat) => {\r\n        const x = left + beat.start * scale;\r\n        const y = yOffset + height / 3;\r\n        ctx.fillStyle = greyScaleColor(0.3 + beat.confidence);\r\n        ctx.fillRect(x, y, 1, height / 3);\r\n    });\r\n    track.getTatums().forEach((tatum) => {\r\n        const x = left + tatum.start * scale;\r\n        const y = yOffset + (height / 3) * 2;\r\n        ctx.fillStyle = greyScaleColor(0.3 + tatum.confidence);\r\n        ctx.fillRect(x, y, 1, height / 3);\r\n    });\r\n}\r\n\r\nexport function renderTonality(track, left, width, yOffset, height, ctx) {\r\n    const scale = width / track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment) => {\r\n        const x = left + segment.start * scale;\r\n        const segmentHeight = height;\r\n        const y = yOffset;\r\n        const segmentWidth = segment.duration * scale;\r\n        ctx.fillStyle = audioUtil.tonalVectorColor(segment.pitches);\r\n        ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n    });\r\n}\r\n\r\nexport function renderSSM(track, left, width, yOffset, height, ctx) {\r\n    const scale = height / track.getAnalysis().track.duration;\r\n    const size = track.getSegments().length;\r\n    for (let i = 0; i < size; i++) {\r\n        for (let j = i; j < size; j++) {\r\n            const segmentA = track.getSegment(i);\r\n            const segmentB = track.getSegment(j);\r\n\r\n            const pitch = track.getSSM()[i][j - i][0];\r\n\r\n            ctx.fillStyle = greyScaleColor(Math.pow(pitch, 4));\r\n\r\n            const x = left + segmentA.start * scale;\r\n            const segmentWidth = segmentA.duration * scale;\r\n\r\n            const y = yOffset + segmentB.start * scale;\r\n            const segmentHeight = segmentB.duration * scale;\r\n            if (!segmentHeight) {\r\n                return;\r\n            }\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n\r\n            const timbre = track.getSSM()[i][j - i][1];\r\n\r\n            ctx.fillStyle = greyScaleColor(Math.pow(timbre, 5));\r\n            ctx.fillRect(y + left - yOffset, x - left + yOffset, segmentHeight, segmentWidth);\r\n        }\r\n    }\r\n}\r\n\r\nexport function renderWaveform(ctx, x, y, width, height, track, options = {}) {\r\n    const segments = track.features.segments;\r\n    const scale = width / track.features.duration;\r\n    ctx.fillStyle = \"#bbbbbb\";\r\n    if (options.detailed) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, height);\r\n        segments.forEach((segment) => {\r\n            const startTime = segment.start * scale;\r\n            const startVolume = audioUtil.loudnessPerceived(segment.loudness_start) * height;\r\n            const maxTime = (segment.start + segment.loudness_max_time) * scale;\r\n            const maxVolume = audioUtil.loudnessPerceived(segment.loudness_max) * height;\r\n\r\n            ctx.lineTo(startTime, height - startVolume);\r\n            ctx.lineTo(maxTime, height - maxVolume);\r\n        });\r\n        ctx.lineTo(width, height);\r\n\r\n        ctx.closePath();\r\n        ctx.fill();\r\n    } else {\r\n        segments.forEach((segment) => {\r\n            ctx.fillRect(\r\n                segment.start * scale,\r\n                y + (1 - audioUtil.loudnessPerceived(segment.loudness_max)) * height,\r\n                segment.duration * scale,\r\n                y + height\r\n            );\r\n        });\r\n    }\r\n}\r\n\r\nexport function drawAnchorPoints(track, ctx, canvasWidth) {\r\n    const ancholor = track.scapePlotAnchorColor;\r\n    const anchorAmount = ancholor.length / 5;\r\n    const halfWidth = canvasWidth / 2;\r\n    const scale = halfWidth * 0.95;\r\n    const size = 6;\r\n    const scaleFromTopLeft = 0.35;\r\n    for (let i = 0; i < anchorAmount; i++) {\r\n        const anchorX = ancholor[i * 5 + 2];\r\n        const anchorY = ancholor[i * 5 + 3];\r\n        const anchorAngle = ancholor[i * 5 + 4];\r\n\r\n        const color = d3.hsl(d3.interpolateSinebow(anchorAngle));\r\n        color.l = 0.6;\r\n        ctx.fillStyle = color.hex();\r\n\r\n        const x = halfWidth + anchorX * scale;\r\n        const y = halfWidth + anchorY * scale;\r\n        ctx.fillRect(\r\n            (x - size / 2) * scaleFromTopLeft,\r\n            (y - size / 2) * scaleFromTopLeft,\r\n            size * scaleFromTopLeft,\r\n            size * scaleFromTopLeft\r\n        );\r\n    }\r\n}\r\n\r\nexport function drawScapePlot(track, ctx, canvasWidth, color = true) {\r\n    ctx.clearRect(0, 0, canvasWidth, canvasWidth);\r\n    // eslint-disable-next-line no-unreachable\r\n    const scapePlot = track.scapePlot;\r\n    const scapePlotAnchorColor = track.scapePlotAnchorColor;\r\n    const minSize = Track.SPminSize;\r\n    const stepSize = Track.SPstepSize;\r\n    const sampleAmount = track.features.sampleAmount;\r\n    const scale = canvasWidth / sampleAmount;\r\n\r\n    //const size = Math.ceil((sampleAmount - minSize) / stepSize);\r\n    const sqrt2 = Math.sqrt(2);\r\n\r\n    scapePlot.forEachCell((x, y, value) => {\r\n        //ctx.fillStyle = greyScaleColor(value);\r\n        if (color) {\r\n            ctx.fillStyle = anchorColorLerp(x, y, scapePlotAnchorColor, value);\r\n        } else {\r\n            ctx.fillStyle = zeroOneColor(value);\r\n\r\n            if (value > 0.95) {\r\n                ctx.fillStyle = \"red\";\r\n            }\r\n        }\r\n\r\n        const start = x * stepSize;\r\n        const size = (scapePlot.size - 1 - y) * stepSize;\r\n\r\n        const rectX = start + size / 2;\r\n        const rectY = sampleAmount - size - minSize;\r\n        const width = stepSize;\r\n        const height = stepSize;\r\n        ctx.fillRect(rectX * scale, rectY * scale, width * scale * 1.1, height * scale * 1.1);\r\n    });\r\n    drawAnchorPoints(track, ctx, canvasWidth);\r\n}\r\n\r\nfunction anchorColorLerp(cellX, cellY, ancholor, value) {\r\n    const anchorAmount = ancholor.length / 5;\r\n\r\n    let aDist = Infinity;\r\n    let aAngle;\r\n    let bDist = Infinity;\r\n    let bAngle;\r\n    for (let i = 0; i < anchorAmount; i++) {\r\n        const anchorX = ancholor[i * 5];\r\n        const anchorY = ancholor[i * 5 + 1];\r\n        const anchorAngle = ancholor[i * 5 + 4];\r\n        const dist = Math.pow(anchorX - cellX, 2) + Math.pow(anchorY - cellY, 2);\r\n        if (dist < aDist || dist < bDist) {\r\n            if (aDist > bDist) {\r\n                aDist = dist;\r\n                aAngle = anchorAngle;\r\n            } else {\r\n                bDist = dist;\r\n                bAngle = anchorAngle;\r\n            }\r\n        }\r\n    }\r\n    const closenessToB = aDist / (aDist + bDist);\r\n    const angle = angleLerp(aAngle, bAngle, closenessToB);\r\n    //const color = d3.hsl(audioUtil.colorWheel(angle));\r\n    const color = d3.hsl(d3.interpolateSinebow(angle));\r\n    color.l = value * 0.9; // values that are 1 need to be a little darker for the color to\r\n    color.s = 0.3 + value / 2;\r\n    //const fitnessColor = d3.hsl(zeroOneColor(Math.pow(value, 1.5)));\r\n    //fitnessColor.l = value < 0.5 ? fitnessColor.l * (value / 0.5) : fitnessColor.l;\r\n    return color.hex();\r\n}\r\n\r\nfunction angleLerp(angleA, angleB, val) {\r\n    if (angleB > angleA) {\r\n        const distClock = angleB - angleA;\r\n        const distAntiClock = angleA + (1 - angleB);\r\n        if (distClock < distAntiClock) {\r\n            return (angleA + distClock * val) % 1;\r\n        } else {\r\n            return (angleB + distAntiClock * (1 - val)) % 1;\r\n        }\r\n    } else if (angleA > angleB) {\r\n        const distClock = angleA - angleB;\r\n        const distAntiClock = angleB + (1 - angleA);\r\n        if (distClock < distAntiClock) {\r\n            return (angleB + distClock * (1 - val)) % 1;\r\n        } else {\r\n            return (angleA + distAntiClock * val) % 1;\r\n        }\r\n    } else {\r\n        return angleA;\r\n    }\r\n}\r\n\r\nexport function createCanvasContext(canvas, type = \"2d\") {\r\n    if (!canvas) {\r\n        log.error(\"canvas not ready\");\r\n        return;\r\n    }\r\n    const ctx = canvas.getContext(type);\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    return ctx;\r\n}\r\n","import * as sim from \"./similarity\";\r\nimport store from \"../store\";\r\nimport Features from \"./Features\";\r\nimport * as workers from \"./workers/workers\";\r\nimport * as log from \"../dev/log\";\r\nimport * as audioUtil from \"./audioUtil\";\r\nimport * as vis from \"./vis\";\r\nimport * as filter from \"./filter\";\r\nimport * as structure from \"./structure\";\r\nimport * as SSM from \"./SSM\";\r\nimport * as events from \"./events\";\r\nimport * as noveltyDetection from \"./noveltyDetection\";\r\nimport Section from \"./Section\";\r\nimport * as mds from \"./mds\";\r\nimport * as pathExtraction from \"./pathExtraction\";\r\nimport * as d3 from \"d3\";\r\n\r\nexport const GAMMA = 1.7;\r\nexport const CLUSTERAMOUNT = 10;\r\nexport const samples = 600;\r\nexport const sampleDuration = 0.33;\r\nexport const sampleBlur = 1; // smaller than 1 => no blur, e.g. when 2 every sample is blurred over duration of 2 samples\r\n\r\nexport const enhanceBlurLength = 6;\r\nexport const threshold = 0.65;\r\nexport const thresholdPercentage = 0.5;\r\nexport const tempoRatios = [0.66, 0.81, 1, 1.22, 1.5];\r\n\r\nexport const SPminSize = 2; // Minimal size of segment in scape plot\r\nexport const SPstepSize = 2; // Size of the step between segment start and size in scape plot\r\nexport const createScapePlot = false;\r\n\r\nexport const averageLoudnessBlur = 3;\r\n\r\nexport const maxTimbreDownSamples = 200;\r\n\r\nconst useSampled = true;\r\nconst allPitches = false;\r\nexport default class Track {\r\n    eventListenerSet = false;\r\n\r\n    trackData = null;\r\n    analysisData = null;\r\n    groundTruth = null;\r\n\r\n    markers = []; // {time, color, label}\r\n    markersCreated = 0;\r\n\r\n    matrixes = []; // {name, matrix}\r\n    scapePlot = null;\r\n    scapePlotAnchorColor = null;\r\n    graphFeatures = []; // {name, data};\r\n    structures = []; // {name, data: [{start, duration, label}]}\r\n\r\n    separators = [];\r\n    courseStructure = [];\r\n    fineStructure = [];\r\n\r\n    harmonicStructureCourse = [];\r\n    harmonicStructureFine = [];\r\n\r\n    chordsVector = [];\r\n    chords = [];\r\n    tonalityFeatureSmall = [];\r\n    tonalityFeatureLarge = [];\r\n\r\n    keyFeature = [];\r\n\r\n    //tempoFeature = { data: [], min: 0, max: 0, avg: 0 };\r\n\r\n    events = [];\r\n    timbreStructure = [];\r\n    timbreFeatureGraph;\r\n    segmentedTimbreGraph = [];\r\n\r\n    features;\r\n\r\n    processed = false;\r\n    processing = false;\r\n\r\n    smoothedTimbre = [];\r\n    tsneCoords = [];\r\n    clusters = [];\r\n    clusterSections;\r\n\r\n    constructor(trackData) {\r\n        this.trackData = trackData;\r\n\r\n        if (trackData.groundTruth) {\r\n            log.debug(\"Ground truth for\", this.getName());\r\n            this.groundTruth = trackData.groundTruth;\r\n        }\r\n    }\r\n\r\n    separatorGenerator() {\r\n        log.debug(\"GENERATING SEPARATORS\");\r\n        const separators = [];\r\n        if (!this.harmonicStructureCourse) return separators;\r\n        for (const section of this.harmonicStructureCourse) {\r\n            separators.push({\r\n                start: section.start,\r\n                end: section.end,\r\n                colorAngle: section.colorAngle,\r\n                confidence: 1,\r\n                groupID: section.groupID,\r\n            });\r\n        }\r\n        return separators;\r\n    }\r\n\r\n    process() {\r\n        this.processing = true;\r\n        log.info(\"Processing Track\", this.getName());\r\n        log.debug(\"Analysis File\", this.analysisData);\r\n        this.features = new Features(this.analysisData, {\r\n            samples: samples,\r\n            sampleDuration: sampleDuration,\r\n            sampleBlur: sampleBlur,\r\n            downsampleAmount: maxTimbreDownSamples,\r\n        });\r\n\r\n        const segmentationSmoothingLength = Math.round(10);\r\n        const continuousSmoothingLength = Math.round(10);\r\n\r\n        const ssmTimbre = SSM.calculateSSM(\r\n            this.features.sampled.timbres,\r\n            this.features.sampleDuration,\r\n            false,\r\n            0,\r\n            \"cosine\"\r\n        );\r\n        const blurredTimbreLarge = filter.gaussianBlur2DOptimized(ssmTimbre, 5);\r\n        const timbreNoveltyColumn = noveltyDetection.absoluteEuclideanColumnDerivative(blurredTimbreLarge);\r\n\r\n        const segmentationSmoothedFeatures = filter.gaussianBlurFeatures(\r\n            this.features.sampled.timbres,\r\n            segmentationSmoothingLength\r\n        );\r\n        const segmentationDerivative = noveltyDetection.featureDerivative(segmentationSmoothedFeatures);\r\n        const smoothedSegmentationDerivative = filter.gaussianBlur1D(segmentationDerivative, 5);\r\n        const segments = structure.createSegmentsFromNovelty(\r\n            smoothedSegmentationDerivative,\r\n            this.features.sampleDuration,\r\n            0.2\r\n        );\r\n        const averagedColouredSegments = structure.processTimbreSegments(\r\n            this.features.sampled.timbres,\r\n            segments,\r\n            this.features.sampleDuration\r\n        );\r\n\r\n        const segmentedFeatures = [];\r\n        segments.forEach((segment) => {\r\n            const featureSegment = this.features.sampled.timbres.slice(segment.startSample, segment.endSample);\r\n            const smoothedFeatureSegment = filter.gaussianBlurFeatures(featureSegment, 5);\r\n            segmentedFeatures.push(smoothedFeatureSegment);\r\n        });\r\n\r\n        const frankenFeatures = [];\r\n        segmentedFeatures.forEach((featureSegment) => {\r\n            frankenFeatures.push(...featureSegment);\r\n        });\r\n        const downSampleAmount = 200;\r\n        //this.smoothedTimbre = Features.downSample(frankenFeatures, downSampleAmount);\r\n        this.smoothedTimbre = frankenFeatures;\r\n        //this.smoothedTimbre = filter.gaussianBlurFeatures(this.features.sampled.timbres, 4);\r\n        log.debug(\"Emit features processed\");\r\n\r\n        /*let beatIndex = 0;\r\n        const tempoSampleAmount = 350;\r\n        const tempoSampleDuration = this.features.duration / tempoSampleAmount;\r\n        this.tempoFeature.min = 500;\r\n        this.tempoFeature.max = 0;\r\n        this.tempoFeature.avg = 0;\r\n        for (let i = 0; i < tempoSampleAmount; i++) {\r\n            let [start, duration] = this.features.beatsStartDuration[beatIndex];\r\n            while (start + duration < tempoSampleDuration * i) {\r\n                beatIndex++;\r\n                [start, duration] = this.features.beatsStartDuration[beatIndex];\r\n            }\r\n            const bpm = 60 / duration;\r\n            this.tempoFeature.data.push(bpm);\r\n            this.tempoFeature.avg += bpm / tempoSampleAmount;\r\n            this.tempoFeature.min = Math.min(this.tempoFeature.min, bpm);\r\n            this.tempoFeature.max = Math.max(this.tempoFeature.max, bpm);\r\n        }\r\n        this.tempoFeature.data = filter.gaussianBlur1D(\r\n            this.tempoFeature.data,\r\n            Math.round(10 / tempoSampleDuration),\r\n            \"mirror\"\r\n        );*/\r\n\r\n        //log.debug(\"Tempofeature\", this.tempoFeature);\r\n        window.eventBus.$emit(\"featuresProcessed\");\r\n\r\n        //this.tsne();\r\n        //this.cluster();\r\n        //this.calculateSSM();\r\n        this.computeChords();\r\n        this.computeHarmonicStructure();\r\n        this.computeTimbreStructure();\r\n\r\n        this.processed = true;\r\n        this.processing = false;\r\n    }\r\n\r\n    computeChords() {\r\n        workers\r\n            .computeChords(\r\n                this.features.sampled.pitches,\r\n                this.features.fastSampledPitch,\r\n                this.features.sampleDuration,\r\n                this.features.fastSampleDuration\r\n            )\r\n            .then((result) => {\r\n                this.chordsVector = result.chordsVector;\r\n                this.chords = result.chords;\r\n                this.key = result.key;\r\n                this.tonalityFeatureSmall = result.tonalityFeatureSmall;\r\n                this.tonalityFeatureLarge = result.tonalityFeatureLarge;\r\n\r\n                this.keyFeature = result.keyFeature;\r\n                log.debug(\r\n                    \"Key comparison: mine:\",\r\n                    result.key,\r\n                    \"spotify:\",\r\n                    audioUtil.keyNames[this.analysisData.track.key],\r\n                    this.analysisData.track.mode === 1 ? \"major\" : \"minor\"\r\n                );\r\n            });\r\n    }\r\n\r\n    computeHarmonicStructure() {\r\n        workers\r\n            .computeHarmonicStructure({\r\n                pitchFeatures: this.features.sampled.pitches,\r\n                sampleDuration: this.features.sampleDuration,\r\n                allPitches,\r\n                enhanceBlurLength,\r\n                tempoRatios,\r\n            })\r\n            .then((result) => {\r\n                this.harmonicStructureCourse = result.harmonicStructure;\r\n            });\r\n        window.eventBus.$on(\"harmonicStructure\", this.harmonicStructureListener);\r\n        this.eventListenerSet = true;\r\n    }\r\n\r\n    harmonicStructureListener = (result) => {\r\n        this.harmonicStructureCourse = result.harmonicStructure;\r\n    };\r\n\r\n    deselect() {\r\n        if (this.eventListenerSet) {\r\n            window.eventBus.$off(\"harmonicStructure\", this.harmonicStructureListener);\r\n            window.eventBus.$off(\"tsneReady\", this.harmonicStructureListener);\r\n\r\n            this.eventListenerSet = false;\r\n        }\r\n    }\r\n\r\n    computeTimbreStructure() {\r\n        workers.computeTimbreStructure(this.features.sampled.timbres, this.features.sampleDuration).then((result) => {\r\n            this.timbreStructure = result.timbreStructure;\r\n            this.events = result.events;\r\n            this.segmentedTimbreGraph = result.segmentedTimbreGraph;\r\n        });\r\n    }\r\n\r\n    updatingTimbreGraphVis = false;\r\n    updateTimbreVis(timbreSliders) {\r\n        if (!this.processed) return;\r\n        this.updatingTimbreGraphVis = true;\r\n        workers\r\n            .updateTimbreGraphVis(this.features.downSampledTimbre, timbreSliders, this.features.sampleDuration)\r\n            .then((result) => {\r\n                this.timbreFeatureGraph = result;\r\n                this.updatingTimbreGraphVis = false;\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Self similarity matrix, takes a few seconds so async is needed\r\n     */\r\n    calculateSSM() {\r\n        const time = new Date();\r\n\r\n        let features = this.features.processed;\r\n        if (useSampled) {\r\n            features = this.features.sampled;\r\n        }\r\n        workers\r\n            .startSSM(\r\n                this.getID(),\r\n                features.pitches,\r\n                features.timbres,\r\n                features.avgLoudness,\r\n                this.features.sampleDuration,\r\n                this.getSegmentStartDuration(),\r\n                this.features.beatsStartDuration,\r\n                {\r\n                    enhanceBlurLength,\r\n                    threshold,\r\n                    thresholdPercentage,\r\n                    tempoRatios,\r\n                    allPitches,\r\n                    SPminSize,\r\n                    SPstepSize,\r\n                    createScapePlot,\r\n                }\r\n            )\r\n            .then((result) => {\r\n                const diff = new Date() - time;\r\n                const diffBack = new Date() - result.timestamp;\r\n                log.info(\"workerSSM outside\", diff);\r\n                log.info(\"workerSSM sending back\", diffBack);\r\n                this.matrixes = result.matrixes;\r\n                this.graphFeatures = result.graphs;\r\n                this.structures = result.structures;\r\n                this.scapePlot = result.scapePlot;\r\n                this.scapePlotAnchorColor = result.scapePlotAnchorColor;\r\n                this.structureSections = result.structureSections;\r\n                this.optimalStructure = result.optimalStructure;\r\n                this.separators = result.separators;\r\n                this.courseStructure = result.courseStructure;\r\n                this.fineStructure = result.fineStructure;\r\n                window.eventBus.$emit(\"readyForPrototypeVis\");\r\n            });\r\n    }\r\n\r\n    getMatrixByName(name) {\r\n        for (const matrix of this.matrixes) {\r\n            if (matrix.name === name) return matrix;\r\n        }\r\n        log.error(\"Could not find matrix with name\", name);\r\n    }\r\n\r\n    updateDTW(start, end) {\r\n        let index = -1;\r\n        for (var i = this.matrixes.length - 1; i >= 0; --i) {\r\n            if (this.matrixes[i].name == \"DTW\") {\r\n                index = i;\r\n            }\r\n        }\r\n\r\n        const strictpath = this.getMatrixByName(\"StrictPath\").matrix;\r\n\r\n        const scoreMatrix = pathExtraction.visualizationMatrix(strictpath, strictpath.getSampleAmount(), start, end);\r\n\r\n        if (index < 0) {\r\n            this.matrixes.push({ name: \"DTW\", matrix: scoreMatrix });\r\n        } else {\r\n            this.matrixes[index] = { name: \"DTW\", matrix: scoreMatrix };\r\n        }\r\n        window.eventBus.$emit(\"readyForPrototypeVis\");\r\n    }\r\n\r\n    cluster() {\r\n        workers.cluster({ features: this.smoothedTimbre, minK: 2, maxK: 10, tries: 10 }).then((result) => {\r\n            log.debug(\"Clustering Result\", result);\r\n\r\n            this.clusters = result;\r\n            let prevCluster = result[0];\r\n\r\n            this.clusterSections = [];\r\n            this.clusterSections.push({ cluster: prevCluster, start: 0 });\r\n            for (let i = 1; i < result.length; i++) {\r\n                const cluster = result[i];\r\n                if (cluster !== prevCluster) {\r\n                    this.clusterSections[this.clusterSections.length - 1].end = i;\r\n                    this.clusterSections.push({ cluster: cluster, start: i });\r\n                    prevCluster = cluster;\r\n                }\r\n            }\r\n            this.clusterSections[this.clusterSections.length - 1].end = result.length;\r\n            log.debug(this.clusterSections);\r\n        });\r\n    }\r\n\r\n    tsne() {\r\n        workers.tsne({ features: this.smoothedTimbre }).then((result) => {\r\n            this.tsneListener(result);\r\n        });\r\n        window.eventBus.$on(\"tsneReady\", this.tsneListener);\r\n        this.eventListenerSet = true;\r\n    }\r\n    tsneListener = (result) => {\r\n        this.tsneCoords = result;\r\n    };\r\n\r\n    getClosestSegment(coord) {\r\n        let minDist = Infinity;\r\n        let closestSegment = null;\r\n        this.features.segments.forEach((segment) => {\r\n            const dist = sim.euclidianDistance(coord, segment.tsneCoord);\r\n            if (dist < minDist) {\r\n                minDist = dist;\r\n                closestSegment = segment;\r\n            }\r\n        });\r\n        return closestSegment;\r\n    }\r\n\r\n    placeMarker(time) {\r\n        log.debug(\"Placemarker\", time);\r\n        // Delete marker if it exists at that time\r\n        const alreadyPlacedMarkerIndex = this.markers.findIndex((marker) => Math.abs(marker.time - time) < 1);\r\n        if (alreadyPlacedMarkerIndex >= 0) {\r\n            this.markers.splice(alreadyPlacedMarkerIndex, 1);\r\n            return;\r\n        }\r\n\r\n        const color = d3.color(vis.goldenRatioCategoricalColor(this.markersCreated, 0)).formatHex();\r\n        const label = String.fromCharCode(97 + this.markersCreated).toUpperCase();\r\n        this.markers.push({ time, color, label });\r\n        this.markersCreated++;\r\n    }\r\n\r\n    static createWithAnalysis(trackData, analysisData) {\r\n        const track = new Track(trackData);\r\n        track.setAnalysis(analysisData);\r\n        return track;\r\n    }\r\n\r\n    static fromJSON(json) {\r\n        return this.createWithAnalysis(json.trackData, json.analysisData);\r\n    }\r\n\r\n    // Works with JSON.stringify!\r\n    toJSON() {\r\n        return {\r\n            trackData: this.trackData,\r\n            analysisData: this.analysisData,\r\n        };\r\n    }\r\n\r\n    getID() {\r\n        return this.trackData.id;\r\n    }\r\n    hasAnalysis() {\r\n        return this.analysisData !== null && this.features.segments.length > 0;\r\n    }\r\n    hasVisualization() {\r\n        return this.matrixes.length > 0;\r\n    }\r\n    getAnalysis() {\r\n        return this.analysisData;\r\n    }\r\n    reload() {\r\n        log.debug(\"Reloading track\");\r\n        if (this.hasVisualization()) {\r\n            window.setTimeout(() => window.eventBus.$emit(\"readyForPrototypeVis\"), 0);\r\n        }\r\n    }\r\n    setAnalysis(analysis) {\r\n        if (!this.processed && !this.processing) {\r\n            this.analysisData = analysis;\r\n            this.process();\r\n        }\r\n    }\r\n    getDuration() {\r\n        return this.features.duration;\r\n    }\r\n    getName() {\r\n        return this.trackData.name;\r\n    }\r\n    getArtist() {\r\n        return this.trackData.artist;\r\n    }\r\n    getURI() {\r\n        return this.trackData.uri;\r\n    }\r\n    getSegments() {\r\n        return this.features.segments;\r\n    }\r\n    getSegment(i) {\r\n        return this.features.segments[i];\r\n    }\r\n    getSegmentStartDuration() {\r\n        if (useSampled) {\r\n            return this.features.sampleStartDuration;\r\n        } else {\r\n            return this.features.segmentStartDuration;\r\n        }\r\n    }\r\n    getSSM() {\r\n        return this.matrixes.transpositionInvariantSSM;\r\n    }\r\n    getBars() {\r\n        return this.analysisData.bars;\r\n    }\r\n    getBeats() {\r\n        return this.analysisData.beats;\r\n    }\r\n    getTatums() {\r\n        return this.analysisData.tatums;\r\n    }\r\n    getProcessedPitch(i) {\r\n        return this.features.processed.pitches[i];\r\n    }\r\n    getProcessedPitches() {\r\n        return this.features.processed.pitches;\r\n    }\r\n    getProcessedTimbre(i) {\r\n        return this.features.processed.timbres[i];\r\n    }\r\n    getProcessedTimbres() {\r\n        return this.features.processed.timbres;\r\n    }\r\n    getAnalysisDuration() {\r\n        return this.analysisData.track.duration;\r\n    }\r\n}\r\n","import * as log from \"../dev/log\";\r\n\r\nimport Isophonics_1 from \"../data/testing/Isophonics/Isophonics_1.json\";\r\nimport Isophonics_01 from \"../data/testing/Isophonics/Isophonics_01.json\";\r\nimport Isophonics_2 from \"../data/testing/Isophonics/Isophonics_2.json\";\r\nimport Isophonics_02 from \"../data/testing/Isophonics/Isophonics_02.json\";\r\nimport Isophonics_03 from \"../data/testing/Isophonics/Isophonics_03.json\";\r\nimport Isophonics_04 from \"../data/testing/Isophonics/Isophonics_04.json\";\r\nimport Isophonics_05 from \"../data/testing/Isophonics/Isophonics_05.json\";\r\nimport Isophonics_06 from \"../data/testing/Isophonics/Isophonics_06.json\";\r\nimport Isophonics_07 from \"../data/testing/Isophonics/Isophonics_07.json\";\r\nimport Isophonics_08 from \"../data/testing/Isophonics/Isophonics_08.json\";\r\nimport Isophonics_09 from \"../data/testing/Isophonics/Isophonics_09.json\";\r\nimport Isophonics_10 from \"../data/testing/Isophonics/Isophonics_10.json\";\r\nimport Isophonics_11 from \"../data/testing/Isophonics/Isophonics_11.json\";\r\nimport Isophonics_12 from \"../data/testing/Isophonics/Isophonics_12.json\";\r\nimport Isophonics_13 from \"../data/testing/Isophonics/Isophonics_13.json\";\r\nimport Isophonics_14 from \"../data/testing/Isophonics/Isophonics_14.json\";\r\nimport Isophonics_15 from \"../data/testing/Isophonics/Isophonics_15.json\";\r\nimport Isophonics_16 from \"../data/testing/Isophonics/Isophonics_16.json\";\r\nimport Isophonics_17 from \"../data/testing/Isophonics/Isophonics_17.json\";\r\nimport Isophonics_18 from \"../data/testing/Isophonics/Isophonics_18.json\";\r\nimport Isophonics_CD1 from \"../data/testing/Isophonics/Isophonics_CD1.json\";\r\nimport Isophonics_CD2 from \"../data/testing/Isophonics/Isophonics_CD2.json\";\r\n\r\nconst dataPath = \"../data/testing/\";\r\n\r\nexport const namespaces = {\r\n    coarse: [\"segment_open\", \"segment_salami_upper\"],\r\n    function: [\"segment_open\", \"segment_salami_function\"],\r\n    fine: [\"chord\", \"segment_salami_lower\"],\r\n    chord: [\"chord\"],\r\n    key: [\"key_mode\"],\r\n    beat: [\"beat\"],\r\n};\r\n\r\nexport function getAllTestSets() {\r\n    return Object.keys(sets);\r\n}\r\n\r\nexport function getTracks(setKey) {\r\n    const set = sets[setKey].data;\r\n    let tracks = [];\r\n    for (const track of set) {\r\n        track.query = getQuery(track);\r\n        tracks.push(track);\r\n    }\r\n    return tracks;\r\n}\r\n\r\nfunction getQuery(track) {\r\n    let query = track.file_metadata.artist + track.file_metadata.title;\r\n    query = query.replace(/_/g, \" \");\r\n    query = query.replace(/\\d/g, \"\");\r\n    query = query.replace(/-/g, \"\");\r\n    return query;\r\n}\r\n\r\nexport function getSpotifySearch(set) {}\r\n\r\nfunction readTextFile(file) {\r\n    var rawFile = new XMLHttpRequest();\r\n    rawFile.open(\"GET\", file, false);\r\n    rawFile.onreadystatechange = function() {\r\n        if (rawFile.readyState === 4) {\r\n            if (rawFile.status === 200 || rawFile.status == 0) {\r\n                var allText = rawFile.responseText;\r\n                alert(allText);\r\n            }\r\n        }\r\n    };\r\n    rawFile.send(null);\r\n}\r\n\r\nexport const sets = {\r\n    \"Isophonics 1a\": { folder: \"Isophonics\", prefix: \"Isophonics_1\", data: Isophonics_1 },\r\n    \"Isophonics 1b\": { folder: \"Isophonics\", prefix: \"Isophonics_01\", data: Isophonics_01 },\r\n    \"Isophonics 2a\": { folder: \"Isophonics\", prefix: \"Isophonics_2\", data: Isophonics_2 },\r\n    \"Isophonics 2b\": { folder: \"Isophonics\", prefix: \"Isophonics_02\", data: Isophonics_02 },\r\n    \"Isophonics 3\": { folder: \"Isophonics\", prefix: \"Isophonics_03\", data: Isophonics_03 },\r\n    \"Isophonics 4\": { folder: \"Isophonics\", prefix: \"Isophonics_04\", data: Isophonics_04 },\r\n    \"Isophonics 5\": { folder: \"Isophonics\", prefix: \"Isophonics_05\", data: Isophonics_05 },\r\n    \"Isophonics 6\": { folder: \"Isophonics\", prefix: \"Isophonics_06\", data: Isophonics_06 },\r\n    \"Isophonics 7\": { folder: \"Isophonics\", prefix: \"Isophonics_07\", data: Isophonics_07 },\r\n    \"Isophonics 8\": { folder: \"Isophonics\", prefix: \"Isophonics_08\", data: Isophonics_08 },\r\n    \"Isophonics 9\": { folder: \"Isophonics\", prefix: \"Isophonics_09\", data: Isophonics_09 },\r\n    \"Isophonics 10\": { folder: \"Isophonics\", prefix: \"Isophonics_10\", data: Isophonics_10 },\r\n    \"Isophonics 11\": { folder: \"Isophonics\", prefix: \"Isophonics_11\", data: Isophonics_11 },\r\n    \"Isophonics 12\": { folder: \"Isophonics\", prefix: \"Isophonics_12\", data: Isophonics_12 },\r\n    \"Isophonics 13\": { folder: \"Isophonics\", prefix: \"Isophonics_13\", data: Isophonics_13 },\r\n    \"Isophonics 14\": { folder: \"Isophonics\", prefix: \"Isophonics_14\", data: Isophonics_14 },\r\n    \"Isophonics 15\": { folder: \"Isophonics\", prefix: \"Isophonics_15\", data: Isophonics_15 },\r\n    \"Isophonics 16\": { folder: \"Isophonics\", prefix: \"Isophonics_16\", data: Isophonics_16 },\r\n    \"Isophonics 17\": { folder: \"Isophonics\", prefix: \"Isophonics_17\", data: Isophonics_17 },\r\n    \"Isophonics 18\": { folder: \"Isophonics\", prefix: \"Isophonics_18\", data: Isophonics_18 },\r\n    \"Isophonics CD1\": { folder: \"Isophonics\", prefix: \"Isophonics_CD1\", data: Isophonics_CD1 },\r\n    \"Isophonics CD2\": { folder: \"Isophonics\", prefix: \"Isophonics_CD2\", data: Isophonics_CD2 },\r\n};\r\n","import { same } from \"numeric\";\r\nimport HalfMatrix from \"./dataStructures/HalfMatrix\";\r\nimport { NumberType } from \"./dataStructures/NumberType\";\r\nimport Track from \"./Track\";\r\nimport * as log from \"../dev/log\";\r\nimport Features from \"./Features\";\r\nimport * as workers from \"./workers/workers\";\r\n\r\nconst preset1 = \"AABB\";\r\nconst sampleAmount = 250;\r\nconst sampleDuration = 1;\r\nconst templateSegment = {\r\n    start: 0,\r\n    duration: 1,\r\n    pitches: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    timbre: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    loudness_start: 0,\r\n    loudness_max: 1,\r\n    loudness_max_time: 0.5,\r\n    loudness_end: 0,\r\n};\r\nconst templateElement = {\r\n    start: 0,\r\n    duration: 1,\r\n    confidence: 1,\r\n};\r\nexport default class SynthesizedTrack extends Track {\r\n    synthesizerString;\r\n    constructor(trackData, synthesizerString) {\r\n        trackData.name = synthesizerString;\r\n        trackData.artist = \"synthesizer\";\r\n        super(trackData);\r\n\r\n        this.synthesizerString = synthesizerString;\r\n\r\n        const track = {\r\n            duration: sampleAmount,\r\n        };\r\n        this.analysisData = {\r\n            track,\r\n            segments: [templateSegment],\r\n            beats: [templateElement],\r\n            tatums: [templateElement],\r\n            bars: [templateElement],\r\n            sections: [templateElement],\r\n        };\r\n\r\n        this.features = new Features(this.analysisData, {\r\n            samples: sampleAmount,\r\n            sampleBlur: Track.sampleBlur,\r\n            downsampleAmount: Track.maxTimbreDownSamples,\r\n        });\r\n        this.process();\r\n    }\r\n\r\n    process() {\r\n        log.debug(\"Processing synthesized track\");\r\n        const pitchSSM = synthesizeSSMPitch(sampleAmount, this.synthesizerString);\r\n        const timbreSSM = synthesizeSSMTimbre(sampleAmount, this.synthesizerString);\r\n\r\n        workers\r\n            .startSSM(\r\n                this.getID(),\r\n                null,\r\n                null,\r\n                new Float32Array(sampleAmount).fill(1),\r\n                sampleDuration,\r\n                null,\r\n                this.features.beatsStartDuration,\r\n                {\r\n                    sampleAmount: sampleAmount,\r\n                    blurTime: Track.blurTime,\r\n                    enhanceBlurLength: Track.enhanceBlurLength,\r\n                    threshold: Track.threshold,\r\n                    thresholdPercentage: Track.thresholdPercentage,\r\n                    tempoRatios: Track.tempoRatios,\r\n                    allPitches: false,\r\n                    SPminSize: Track.SPminSize,\r\n                    SPstepSize: Track.SPstepSize,\r\n                    createScapePlot: Track.createScapePlot,\r\n                    synthesized: true,\r\n                    synthesizedSSMPitch: pitchSSM.getBuffer(),\r\n                    synthesizedSSMTimbre: timbreSSM.getBuffer(),\r\n                }\r\n            )\r\n            .then((result) => {\r\n                log.debug(\"Done processing\");\r\n                this.matrixes = result.matrixes;\r\n                this.graphFeatures = result.graphs;\r\n                this.scapePlot = result.scapePlot;\r\n                this.scapePlotAnchorColor = result.scapePlotAnchorColor;\r\n                this.structureSections = result.structureSections;\r\n                this.optimalStructure = result.optimalStructure;\r\n                this.structures = result.structures;\r\n                window.eventBus.$emit(\"readyForPrototypeVis\");\r\n            });\r\n    }\r\n    hasAnalysis() {\r\n        return true;\r\n    }\r\n}\r\n\r\nexport function synthesizeSSMPitch(sampleAmount, preset) {\r\n    const ssm = new HalfMatrix({\r\n        size: sampleAmount,\r\n        numberType: HalfMatrix.NumberType.UINT8,\r\n        sampleDuration: 1,\r\n        featureAmount: 1,\r\n    });\r\n\r\n    const sections = preset.split(\"\");\r\n    const sectionLength = Math.floor(sampleAmount / sections.length);\r\n    sections.forEach((ySection, yIndex) => {\r\n        const yOffset = yIndex * sectionLength;\r\n        sections.forEach((xSection, xIndex) => {\r\n            if (ySection === xSection) {\r\n                const xOffset = xIndex * sectionLength;\r\n                for (let i = 0; i < sectionLength; i++) {\r\n                    ssm.setValueNormalizedMirrored(xOffset + i, yOffset + i, 1);\r\n                }\r\n            }\r\n        });\r\n    });\r\n    return ssm;\r\n}\r\nexport function synthesizeSSMTimbre(sampleAmount, preset) {\r\n    const ssm = new HalfMatrix({\r\n        size: sampleAmount,\r\n        numberType: HalfMatrix.NumberType.UINT8,\r\n        sampleDuration: 1,\r\n        featureAmount: 1,\r\n    });\r\n\r\n    const sections = preset.split(\"\");\r\n    const sectionLength = Math.floor(sampleAmount / sections.length);\r\n    sections.forEach((ySection, yIndex) => {\r\n        const yOffset = yIndex * sectionLength;\r\n        sections.forEach((xSection, xIndex) => {\r\n            if (ySection === xSection) {\r\n                const xOffset = xIndex * sectionLength;\r\n                for (let y = 0; y < sectionLength; y++) {\r\n                    for (let x = 0; x <= y; x++) {\r\n                        ssm.setValueNormalizedMirrored(xOffset + x, yOffset + y, 1);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    });\r\n    return ssm;\r\n}\r\n","import * as SpotifyWebApi from \"spotify-web-api-js\";\r\nimport * as auth from \"./authentication\";\r\nimport Track from \"./Track\";\r\nimport store from \"./../store\"; // path to your Vuex store\r\nimport router from \"../router\";\r\nimport * as workers from \"./workers/workers\";\r\nimport * as log from \"../dev/log\";\r\nimport * as testing from \"./testing\";\r\nimport SynthesizedTrack from \"./synthesizer\";\r\n\r\nexport const spotify = new SpotifyWebApi();\r\n\r\nconst allTracks = new Map();\r\n\r\n// Initialize spotify access, load tracks from local storage, get user data\r\nexport async function initialize() {\r\n    log.info(\"Initializing App\");\r\n\r\n    workers.init().then(() => log.info(\"Initialized Workers!\"));\r\n\r\n    //loadAllTracks();\r\n\r\n    spotify.setAccessToken(auth.token);\r\n    spotify\r\n        .getMe()\r\n        .then((data) => {\r\n            store.commit(\"setUser\", data);\r\n        })\r\n        .catch((err) => {\r\n            router.push(\"/login\");\r\n        });\r\n\r\n    let firstTrack;\r\n    const localTrackId = window.localStorage.getItem(\"trackId\");\r\n    if (localTrackId && localTrackId !== \"-1\") {\r\n        firstTrack = (await spotify.getTracks([localTrackId])).tracks[0];\r\n    }\r\n    if (!firstTrack) {\r\n        firstTrack = (await spotify.getPlaylistTracks(\"34wIIW2zm3vw5ZRqO8dHi0\")).items[0].track;\r\n    }\r\n    spotify.getMyTopTracks({ limit: 50, offset: 0 }).then((topTracks) => {\r\n        loadTracksFromSpotify([firstTrack, ...topTracks.items], false);\r\n    });\r\n}\r\n\r\nexport async function selectTrackAtIndex(index) {\r\n    store.commit(\"loadingTrack\", true);\r\n    const selectedTrack = store.getters.selectedTrack;\r\n    const newTrack = store.getters.trackList[index];\r\n    if (selectedTrack && selectedTrack !== newTrack) selectedTrack.deselect();\r\n    return getAnalysis(newTrack).then(() => {\r\n        store.commit(\"setSelectedIndex\", index);\r\n\r\n        store.commit(\"loadingTrack\", false);\r\n\r\n        //const query = { ...this.$route.query, trackID: newTrack.getID() };\r\n        //router.replace({ query });\r\n        router.push(`/track/${newTrack.getID()}`);\r\n    });\r\n}\r\nexport async function getAnalysis(track) {\r\n    if (track.hasAnalysis()) {\r\n        track.reload();\r\n        return track.getAnalysis();\r\n    }\r\n    return spotify\r\n        .getAudioAnalysisForTrack(track.getID())\r\n        .then((analysis) => {\r\n            track.setAnalysis(analysis);\r\n        })\r\n        .catch((err) => {\r\n            log.error(err);\r\n        });\r\n}\r\n\r\n// Save tracks to local storage\r\nexport function saveAllTracks() {\r\n    localStorage.allTracks = JSON.stringify(Array.from(allTracks.entries()));\r\n}\r\n\r\n// Save tracks to local storage\r\nexport function loadAllTracks() {\r\n    if (localStorage.allTracks) {\r\n        const allTracksArray = JSON.parse(localStorage.allTracks);\r\n        allTracksArray.forEach((trackArray) => {\r\n            const track = Track.createWithAnalysis(trackArray[1].trackData, trackArray[1].analysisData);\r\n            allTracks.set(trackArray[0], track);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Load tracks from spotify api result\r\n */\r\n\r\nfunction loadTracksFromSpotify(tracks, keepCurrentTrack = true) {\r\n    const selectedTrack = store.getters.selectedTrack;\r\n    store.commit(\"clearTrackList\");\r\n    tracks.forEach((trackData) => {\r\n        if (allTracks.has(trackData.id)) {\r\n            if (trackData.groundTruth) {\r\n                allTracks.get(trackData.id).groundTruth = trackData.groundTruth;\r\n            }\r\n            store.commit(\"addToTrackList\", allTracks.get(trackData.id));\r\n        } else {\r\n            const track = new Track(trackData);\r\n            allTracks.set(trackData.id, track);\r\n            store.commit(\"addToTrackList\", track);\r\n        }\r\n    });\r\n    if (keepCurrentTrack) {\r\n        store.commit(\"addToTrackListFront\", selectedTrack);\r\n        store.commit(\"setSelectedIndex\", 0);\r\n    } else {\r\n        selectTrackAtIndex(0);\r\n    }\r\n}\r\n\r\nexport async function search(query) {\r\n    spotify\r\n        .search(query, [\"track\"])\r\n        .then((results) => {\r\n            loadTracksFromSpotify(results.tracks.items, true);\r\n        })\r\n        .catch((err) => {\r\n            log.error(err);\r\n        });\r\n}\r\n\r\nexport async function loadArtistTopTracks(artistID) {\r\n    spotify.getArtistTopTracks(artistID, \"from_token\").then((result) => {\r\n        loadTracksFromSpotify(result.tracks);\r\n    });\r\n}\r\n\r\nexport async function loadTestSet(testSetKey) {\r\n    log.debug(\"loading test set with key\", testSetKey);\r\n    const testSetTracks = testing.getTracks(testSetKey);\r\n    const spotifyTracks = [];\r\n    for (const track of testSetTracks) {\r\n        const spotifySearches = [];\r\n        spotifySearches.push(\r\n            spotify\r\n                .search(track.query, [\"track\"])\r\n                .then((results) => {\r\n                    if (results.tracks.items.length > 0) {\r\n                        let spotifyTrack = results.tracks.items[0];\r\n                        log.debug(track.query, track);\r\n                        spotifyTrack.groundTruth = track;\r\n                        spotifyTracks.push(spotifyTrack);\r\n                    }\r\n                })\r\n                .catch((err) => {\r\n                    log.error(err);\r\n                })\r\n        );\r\n        await Promise.all(spotifySearches);\r\n    }\r\n    loadTracksFromSpotify(spotifyTracks, true);\r\n}\r\n\r\nexport async function synthesize(synthesizerString) {\r\n    let trackData = {};\r\n    trackData.id = \"0000\";\r\n    const track = new SynthesizedTrack(trackData, synthesizerString);\r\n    allTracks.set(trackData.id, track);\r\n    store.commit(\"clearTrackList\");\r\n    store.commit(\"addToTrackList\", track);\r\n\r\n    //selectTrackAtIndex(0);\r\n}\r\n","<template>\r\n  <div>\r\n    <v-slide-group\r\n      v-model=\"selected\"\r\n      center-active\r\n      class=\"pt-2\"\r\n      v-on:scroll.native=\"onScroll\"\r\n      mandatory\r\n    >\r\n      <v-slide-item\r\n        v-for=\"(track, index) in tracks\"\r\n        :key=\"index\"\r\n        v-slot:default=\"{ active, toggle }\"\r\n        class=\"mx-2 my-1\"\r\n      >\r\n        <Album\r\n          :album=\"track.trackData\"\r\n          :imgSize=\"active ? albumSize * 1.5 : albumSize\"\r\n          :active=\"active\"\r\n          @clicked=\"toggle\"\r\n          @clickedArtist=\"clickedArtist(track)\"\r\n        />\r\n      </v-slide-item>\r\n    </v-slide-group>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Album from \"../components/Album\";\r\nimport * as app from \"../app/app\";\r\nimport * as log from \"../dev/log\";\r\n\r\nexport default {\r\n  name: \"TrackSelector\",\r\n  props: [\"tracks\", \"albumSize\"],\r\n  components: {\r\n    Album,\r\n  },\r\n  data() {\r\n    return {\r\n      selected: 0,\r\n    };\r\n  },\r\n  computed: {\r\n    selectedFromStore() {\r\n      return this.$store.getters.selectedIndex;\r\n    },\r\n  },\r\n  watch: {\r\n    selected: \"selectedChanged\",\r\n    selectedFromStore: \"selectedFromStoreChanged\",\r\n  },\r\n  mounted() {},\r\n  methods: {\r\n    selectedChanged(newIndex, oldIndex) {\r\n      app.selectTrackAtIndex(newIndex);\r\n    },\r\n    selectedFromStoreChanged(newIndex, oldIndex) {\r\n      this.selected = newIndex;\r\n    },\r\n    clickedArtist(track) {\r\n      log.debug(\"Clicked Artist\", track);\r\n      app.loadArtistTopTracks(track.trackData.artists[0].id);\r\n    },\r\n  },\r\n};\r\n</script>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TrackSelector.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TrackSelector.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TrackSelector.vue?vue&type=template&id=44bd9f82&\"\nimport script from \"./TrackSelector.vue?vue&type=script&lang=js&\"\nexport * from \"./TrackSelector.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VSlideGroup } from 'vuetify/lib/components/VSlideGroup';\nimport { VSlideItem } from 'vuetify/lib/components/VSlideGroup';\ninstallComponents(component, {VSlideGroup,VSlideItem})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"visualization\"},[_c('div',[_c('v-row',{staticClass:\"d-flex justify-center py-2\"}),(_vm.showPrototype)?_c('div',[_c('GroundTruth',{attrs:{\"width\":_vm.width}}),_c('Graphs',{attrs:{\"width\":_vm.width}}),_c('PitchTimbre',{attrs:{\"width\":_vm.width}})],1):_vm._e(),(!_vm.showPrototype)?_c('div',[_c('div',{staticStyle:{\"height\":\"5px\"}}),(!_vm.loadingTrack && _vm.tsneReady)?_c('svg',{staticClass:\"tsneContainer\",style:((\"height: \" + (_vm.tsneSize + 5 * 20) + \"px; width: \" + _vm.width + \"px; left: \" + (10)))},[_vm._l((_vm.tsneCoords.length - 2),function(index){return _c('line',{key:index + 'clusterline',staticStyle:{\"stroke-opacity\":\".1\"},attrs:{\"x1\":_vm.tsneCoordX(_vm.tsneCoords[index][0]),\"y1\":_vm.tsneCoordY(_vm.tsneCoords[index][1]),\"x2\":_vm.tsneCoordX(_vm.tsneCoords[index + 1][0]),\"y2\":_vm.tsneCoordY(_vm.tsneCoords[index + 1][1]),\"stroke\":_vm.clusterColor(_vm.clusters[index]),\"stroke-width\":\"2\"}})}),_vm._l((_vm.tsneCoords),function(coord,index){return _c('circle',{key:index + 'clustercircle',class:_vm.isPlayingSample(index) ? 'segmentCirclePlaying' : 'segmentCircle',attrs:{\"r\":_vm.isPlayingSample(index) ? 5 + _vm.tsneDynamics(index) * 10 : 3 + _vm.tsneDynamics(index) * 5,\"cx\":_vm.tsneCoordX(coord[0]) -\n                            (_vm.isPlayingSample(index) ? 5 + _vm.tsneDynamics(index) * 10 : 3 + _vm.tsneDynamics(index) * 5) /\n                                2,\"cy\":_vm.tsneCoordY(coord[1]) -\n                            (_vm.isPlayingSample(index) ? 5 + _vm.tsneDynamics(index) * 10 : 3 + _vm.tsneDynamics(index) * 5) /\n                                2,\"fill\":_vm.isPlayingSample(index) ? 'white' : _vm.clusterColor(_vm.clusters[index])}})}),_c('circle',{class:'playingSegmentCircle',style:((\"transition:  cx \" + (_vm.track.features.sampleDuration) + \"s linear, cy \" + (_vm.track.features.sampleDuration) + \"s linear;\")),attrs:{\"r\":5 + _vm.tsneDynamics(_vm.playingSample) * 10,\"cx\":_vm.tsneCoordX(_vm.tsneCoords[_vm.playingSample][0]) - (5 + _vm.tsneDynamics(_vm.playingSample) * 10) / 2,\"cy\":_vm.tsneCoordY(_vm.tsneCoords[_vm.playingSample][1]) - (5 + _vm.tsneDynamics(_vm.playingSample) * 10) / 2,\"fill\":'white'}}),_vm._l((_vm.clusterSections),function(clusterSection,index){return _c('rect',{key:index + 'clustersection',staticClass:\"clusterRect\",attrs:{\"fill\":_vm.clusterColor(clusterSection.cluster),\"x\":_vm.samplePosNormalized(clusterSection.start) * _vm.width,\"y\":_vm.tsneSize + 20 * clusterSection.cluster,\"width\":_vm.samplePosNormalized(clusterSection.end - clusterSection.start) * _vm.width,\"height\":20}})}),_c('rect',{staticClass:\"seekerRect\",attrs:{\"x\":_vm.seekerNormalized * _vm.width - 1.25,\"y\":_vm.tsneSize,\"width\":2.5,\"height\":20 * 6,\"fill\":\"rgb(255,255,255,0.3)\"}})],2):_vm._e(),_c('HolisticStructure',{attrs:{\"width\":_vm.width}}),_c('TimbreSegmentedGraph',{attrs:{\"width\":_vm.width}}),_c('Chords',{attrs:{\"width\":_vm.width}}),_c('div',{staticStyle:{\"height\":\"50px\"}}),_c('Tonality',{attrs:{\"width\":_vm.width}}),_c('div',{staticStyle:{\"height\":\"400px\"}})],1):_vm._e()],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('v-card',{attrs:{\"width\":_vm.width}},[(_vm.trackVisready)?_c('v-tabs',{attrs:{\"dark\":\"\",\"center-active\":\"\",\"show-arrows\":\"\"},model:{value:(_vm.selectedTab),callback:function ($$v) {_vm.selectedTab=$$v},expression:\"selectedTab\"}},_vm._l((this.track.matrixes),function(matrix){return _c('v-tab',{key:matrix.name},[_vm._v(_vm._s(matrix.name))])}),1):_vm._e()],1),_c('Seeker',{attrs:{\"width\":_vm.width,\"height\":_vm.width}}),_c('Seeker',{attrs:{\"width\":_vm.width,\"height\":_vm.width,\"vertical\":true}}),(_vm.hasStructures)?_c('svg',{staticClass:\"annotations\",attrs:{\"height\":_vm.width,\"width\":_vm.width}},_vm._l((_vm.selectedStructure.data),function(section,index){return _c('g',{key:index},[(_vm.showPathStart)?_c('rect',{attrs:{\"x\":section.start * _vm.secondsToXPosition - 1,\"y\":0,\"width\":2,\"height\":_vm.width,\"fill\":_vm.getCategoryColor(section.label),\"opacity\":0.8}}):_vm._e(),(_vm.fillSections)?_c('rect',{attrs:{\"x\":section.start * _vm.secondsToXPosition,\"y\":0,\"width\":section.duration * _vm.secondsToXPosition,\"height\":_vm.width,\"fill\":_vm.getCategoryColor(section.label),\"opacity\":0.3}}):_vm._e(),(section.pathFamily && _vm.showPaths)?_c('g',_vm._l((section.pathFamily),function(path,pathIndex){return _c('g',{key:pathIndex},[_c('path',{staticClass:\"path\",attrs:{\"fill\":\"none\",\"stroke\":\"black\",\"stroke-width\":\"8\",\"d\":_vm.generateLine(path),\"stroke-linejoin\":\"round\"}}),_c('path',{staticClass:\"path\",attrs:{\"fill\":\"none\",\"stroke\":_vm.getCategoryColor(section.label),\"stroke-width\":\"4\",\"d\":_vm.generateLine(path),\"stroke-linejoin\":\"round\"}})])}),0):_vm._e()])}),0):_vm._e(),_c('canvas',{staticClass:\"glCanvas pa-0 ma-0\",attrs:{\"id\":\"gl-canvas\",\"height\":_vm.width,\"width\":_vm.width}}),(_vm.hasStructures)?_c('v-row',{staticClass:\"options-row\",style:((\"width: \" + _vm.width + \"px\"))},[_c('v-select',{attrs:{\"items\":_vm.track.structures,\"item-text\":\"name\",\"return-object\":\"\",\"label\":\"Structure\",\"solo\":\"\"},model:{value:(_vm.selectedStructure),callback:function ($$v) {_vm.selectedStructure=$$v},expression:\"selectedStructure\"}}),_c('v-spacer'),_c('v-switch',{attrs:{\"label\":\"Show Path Start\",\"hide-details\":\"\"},model:{value:(_vm.showPathStart),callback:function ($$v) {_vm.showPathStart=$$v},expression:\"showPathStart\"}}),_c('v-switch',{attrs:{\"label\":\"Fill Sections\",\"hide-details\":\"\"},model:{value:(_vm.fillSections),callback:function ($$v) {_vm.fillSections=$$v},expression:\"fillSections\"}}),_c('v-switch',{attrs:{\"label\":\"Show Paths\",\"hide-details\":\"\"},model:{value:(_vm.showPaths),callback:function ($$v) {_vm.showPaths=$$v},expression:\"showPaths\"}})],1):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { buffer } from \"d3\";\r\nimport * as log from \"../../dev/log\";\r\nimport Matrix from \"../dataStructures/Matrix\";\r\n\r\nexport default class webGLCanvas {\r\n    gl;\r\n    program;\r\n\r\n    bufferSize = 0;\r\n\r\n    translateLoc;\r\n    scaleLoc;\r\n\r\n    useColor;\r\n\r\n    constructor(canvas, useColor = false) {\r\n        this.useColor = useColor;\r\n        if (!canvas) {\r\n            log.warn(\"canvas not ready\");\r\n            return;\r\n        }\r\n\r\n        this.gl = canvas.getContext(\"webgl2\");\r\n\r\n        if (!this.gl) {\r\n            log.warn(\"WebGL not supported, falling back on experimental WebGL\");\r\n            this.gl = canvas.getContext(\"experimental-webgl2\");\r\n            if (!this.gl) alert(\"Your browser does not support WebGL\");\r\n        }\r\n\r\n        this.gl.clearColor(0, 0, 0, 0);\r\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n\r\n        let vertexShader = this.gl.createShader(this.gl.VERTEX_SHADER);\r\n        let fragmentShader = this.gl.createShader(this.gl.FRAGMENT_SHADER);\r\n\r\n        if (useColor) {\r\n            this.gl.shaderSource(vertexShader, this.vertexShaderTextColor);\r\n            this.gl.shaderSource(fragmentShader, this.fragmentShaderTextColor);\r\n        } else {\r\n            this.gl.shaderSource(vertexShader, this.vertexShaderTextGreyscale);\r\n            this.gl.shaderSource(fragmentShader, this.fragmentShaderTextGreyscale);\r\n        }\r\n\r\n        this.gl.compileShader(vertexShader);\r\n        if (!this.gl.getShaderParameter(vertexShader, this.gl.COMPILE_STATUS)) {\r\n            log.error(\"ERROR compiling vertex shader!\", this.gl.getShaderInfoLog(vertexShader));\r\n            return;\r\n        }\r\n        this.gl.compileShader(fragmentShader);\r\n        if (!this.gl.getShaderParameter(fragmentShader, this.gl.COMPILE_STATUS)) {\r\n            log.error(\"ERROR compiling fragment shader!\", this.gl.getShaderInfoLog(fragmentShader));\r\n            return;\r\n        }\r\n\r\n        this.program = this.gl.createProgram();\r\n        this.gl.attachShader(this.program, vertexShader);\r\n        this.gl.attachShader(this.program, fragmentShader);\r\n        this.gl.linkProgram(this.program);\r\n        if (!this.gl.getProgramParameter(this.program, this.gl.LINK_STATUS)) {\r\n            console.error(\"ERROR linking program!\", this.gl.getProgramInfoLof(this.program));\r\n            return;\r\n        }\r\n\r\n        this.gl.validateProgram(this.program);\r\n        if (!this.gl.getProgramParameter(this.program, this.gl.VALIDATE_STATUS)) {\r\n            console.error(\"ERROR validating program!\", this.gl.getProgramInfoLog(this.program));\r\n            return;\r\n        }\r\n\r\n        this.translateLoc = this.gl.getUniformLocation(this.program, \"translate\");\r\n        this.scaleLoc = this.gl.getUniformLocation(this.program, \"scale\");\r\n    }\r\n\r\n    setHeight(height) {\r\n        this.gl.canvas.height = height;\r\n        this.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\r\n    }\r\n\r\n    clear() {\r\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n    }\r\n\r\n    setBufferData(bufferData) {\r\n        this.bufferSize = bufferData.verts.length / 2;\r\n\r\n        // Vertex buffer\r\n        // Create an empty buffer object to store the vertex buffer\r\n        const rectangleVertexBufferObject = this.gl.createBuffer();\r\n\r\n        //Bind appropriate array buffer to it\r\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, rectangleVertexBufferObject);\r\n\r\n        // Pass the vertex data to the buffer\r\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, bufferData.verts, this.gl.STATIC_DRAW);\r\n\r\n        // Unbind the buffer\r\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, null);\r\n\r\n        // Color buffer\r\n        const colorBufferObject = this.gl.createBuffer();\r\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, colorBufferObject);\r\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, bufferData.colors, this.gl.STATIC_DRAW);\r\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, null);\r\n\r\n        // Bind vertex buffer object\r\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, rectangleVertexBufferObject);\r\n\r\n        // Get the attribute location\r\n        const vertAttribLocation = this.gl.getAttribLocation(this.program, \"vert\");\r\n\r\n        // Point an attribute to the currently bound VBO\r\n        this.gl.vertexAttribPointer(\r\n            vertAttribLocation,\r\n            2, // Number of elements per attribute (x, y)\r\n            this.gl.FLOAT, // Type of element\r\n            this.gl.FALSE, // data normalized\r\n            2 * Float32Array.BYTES_PER_ELEMENT, // Size of one vertex\r\n            0 // Offset from beginning of single vertex\r\n        );\r\n\r\n        // Enable the attribute\r\n        this.gl.enableVertexAttribArray(vertAttribLocation);\r\n\r\n        // bind the color buffer\r\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, colorBufferObject);\r\n\r\n        // get the attribute location\r\n        const colorAttribLocation = this.gl.getAttribLocation(this.program, \"vertColor\");\r\n\r\n        // point attribute to the color buffer object\r\n        this.gl.vertexAttribPointer(\r\n            colorAttribLocation,\r\n            3, // Number of elements per attribute (r, g, b)\r\n            this.gl.FLOAT, // Type of element\r\n            this.gl.FALSE, // data normalized\r\n            3 * Float32Array.BYTES_PER_ELEMENT, // Size of one vertex\r\n            0 // Offset from beginning of single vertex\r\n        );\r\n        // enable the color attribute\r\n        this.gl.enableVertexAttribArray(colorAttribLocation);\r\n    }\r\n\r\n    draw(translateX, translateY, scaleX, scaleY) {\r\n        //Main render loop\r\n        this.gl.useProgram(this.program);\r\n        this.gl.uniform2f(this.translateLoc, translateX, translateY);\r\n        this.gl.uniform2f(this.scaleLoc, scaleX, scaleY);\r\n        this.gl.drawArrays(this.gl.TRIANGLES, 0, this.bufferSize);\r\n    }\r\n\r\n    vertexShaderTextGreyscale = [\r\n        \"#version 300 es\",\r\n        \"precision mediump float;\",\r\n        \"uniform vec2 translate;\",\r\n        \"uniform vec2 scale;\",\r\n        \"in vec2 vert;\",\r\n        \"in vec3 vertColor;\",\r\n        \"flat out vec3 color;\",\r\n        \"\",\r\n        \"void main()\",\r\n        \"{\",\r\n        \" gl_Position = vec4((vert.x*scale.x + translate.x), (vert.y*scale.y+translate.y), 0.0, 1.0);\",\r\n        \" color = vertColor;\",\r\n        \"}\",\r\n    ].join(\"\\n\");\r\n\r\n    vertexShaderTextColor = [\r\n        \"#version 300 es\",\r\n        \"precision mediump float;\",\r\n        \"uniform vec2 translate;\",\r\n        \"uniform vec2 scale;\",\r\n        \"in vec2 vert;\",\r\n        \"in vec3 vertColor;\",\r\n        \"flat out vec3 color;\",\r\n        \"\",\r\n        \"void main()\",\r\n        \"{\",\r\n        \" gl_Position = vec4((vert.x*scale.x + translate.x), (vert.y*scale.y+translate.y), 0.0, 1.0);\",\r\n        \" color = vertColor;\",\r\n        \"}\",\r\n    ].join(\"\\n\");\r\n\r\n    fragmentShaderTextGreyscale = [\r\n        \"#version 300 es\",\r\n        \"precision mediump float;\",\r\n        \"\",\r\n        \"flat in vec3 color;\",\r\n        \"out vec4 fragColor;\",\r\n        \"void main()\",\r\n        \"{\",\r\n        \" fragColor = vec4(color, 1.0);\",\r\n        \"}\",\r\n    ].join(\"\\n\");\r\n\r\n    fragmentShaderTextColor = [\r\n        \"#version 300 es\",\r\n        \"precision mediump float;\",\r\n        \"\",\r\n        \"flat in vec3 color;\",\r\n        \"out vec4 fragColor;\",\r\n        \"void main()\",\r\n        \"{\",\r\n        \" fragColor = vec4(color, 1.0);\",\r\n        \"}\",\r\n    ].join(\"\\n\");\r\n}\r\n","import WebGL from \"./WebGL\";\r\nimport assert from \"assert\";\r\nimport * as log from \"../../dev/log\";\r\nimport Matrix from \"../dataStructures/Matrix\";\r\nimport store from \"../../store\";\r\n\r\nexport default class WebGLMatrixPool extends WebGL {\r\n    matrixBufferPool;\r\n\r\n    constructor(...args) {\r\n        super(...args);\r\n    }\r\n\r\n    fillMatrixBufferPool(track, selectedIndex) {\r\n        assert(track.matrixes, \"track does not have matrixes\");\r\n        this.matrixBufferPool = new Array(track.matrixes.length);\r\n        track.matrixes.forEach((matrix, index) => {\r\n            if (index === selectedIndex) {\r\n                this.matrixBufferPool[index] = this.createDataArray(track, matrix.matrix);\r\n            } else {\r\n                setTimeout(() => (this.matrixBufferPool[index] = this.createDataArray(track, matrix.matrix)), 0);\r\n            }\r\n        });\r\n    }\r\n\r\n    select(index) {\r\n        assert(this.matrixBufferPool);\r\n        this.setBufferData(this.matrixBufferPool[index]);\r\n    }\r\n\r\n    draw(xCenterPositionNormalized, scaleX, scaleY) {\r\n        super.draw((1 - xCenterPositionNormalized * 2) * scaleX, 0, scaleX, scaleY);\r\n    }\r\n\r\n    createDataArray(track, ssm) {\r\n        const segmentStartDuration = track.getSegmentStartDuration();\r\n        const size = segmentStartDuration.length;\r\n\r\n        this.bufferSize = size * size * 6;\r\n        if (this.bufferSize > 22e6) {\r\n            log.error(\"Buffer OVERFLOW with size\", this.bufferSize);\r\n        }\r\n\r\n        const halfDuration = track.getAnalysisDuration() / 2;\r\n        function st(pos) {\r\n            return pos / halfDuration - 1;\r\n        } // Scale and translate\r\n\r\n        const ssmVertices = [];\r\n        const colors = [];\r\n        const isMatrix = ssm instanceof Matrix;\r\n\r\n        for (let y = 0; y < size; y++) {\r\n            for (let x = 0; x < size; x++) {\r\n                let v;\r\n                if (isMatrix) {\r\n                    v = ssm.getValueNormalized(x, y);\r\n                } else {\r\n                    v = ssm.getValueNormalizedMirrored(x, y);\r\n                }\r\n                const left = st(segmentStartDuration[x][0]);\r\n                const top = -st(segmentStartDuration[y][0]);\r\n                const right = st(segmentStartDuration[x][0] + segmentStartDuration[x][1]);\r\n                const bottom = -st(segmentStartDuration[y][0] + segmentStartDuration[y][1]);\r\n                ssmVertices.push(left, top, left, bottom, right, top, right, top, left, bottom, right, bottom);\r\n                colors.push(v, v, v, v, v, v, v, v, v, v, v, v, v, v, v, v, v, v);\r\n            }\r\n        }\r\n\r\n        return { verts: new Float32Array(ssmVertices), colors: new Float32Array(colors) };\r\n    }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (!_vm.loadingTrack)?_c('svg',{staticClass:\"seekerSVG\",style:((\"transform: translate(\" + (0) + \"px, 0px);\")),attrs:{\"height\":_vm.height,\"width\":_vm.width},on:{\"click\":_vm.clickedSVG,\"contextmenu\":[function($event){return _vm.rightClick($event)},function($event){$event.preventDefault();}]}},[_c('rect',{staticClass:\"seekerRect\",attrs:{\"x\":!_vm.isVertical * ((_vm.useZoom && _vm.isZoomed ? 0.5 : _vm.seekerNormalized) * _vm.width - 1.25),\"y\":_vm.isVertical * ((_vm.useZoom && _vm.isZoomed ? 0.5 : _vm.seekerNormalized) * _vm.height - 1.25) + _vm.showMarkerLabel ? 15 : 0,\"width\":_vm.isVertical ? _vm.width * 2 : 2.5,\"height\":(_vm.isVertical ? 2.5 : _vm.height * 2) - (_vm.showMarkerLabel ? 15 : 0),\"fill\":_vm.seekerColor}}),_c('Markers',{ref:'markers',attrs:{\"v-if\":_vm.drawMarkers,\"width\":_vm.width,\"height\":_vm.height,\"opacity\":_vm.markerOpacity || 0.3,\"showMarkerLabel\":_vm.showMarkerLabel}})],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import * as log from \"../dev/log\";\r\nimport { spotify } from \"./app\";\r\nimport store from \"../store\";\r\n\r\nexport const autoConnect = true;\r\nexport let active = false;\r\nexport let deviceId = null;\r\nlet player = null;\r\n\r\nlet playedTrackBefore = false;\r\nlet trackURI = null;\r\n\r\nexport async function loadTrack(track) {\r\n    if (!active) return;\r\n\r\n    if (!store.state.playerReady) {\r\n        log.warn(\"Trying to load track while player not ready\");\r\n        return;\r\n    }\r\n    pause();\r\n    seekMS(0);\r\n    pause();\r\n    trackURI = track.getURI();\r\n    playedTrackBefore = false;\r\n    store.commit(\"setSeeker\", 0);\r\n    store.commit(\"setPlaying\", false);\r\n}\r\n\r\nasync function play() {\r\n    if (!active) return;\r\n\r\n    spotify.play({ uris: [trackURI], position_ms: store.state.seeker }, (err, result) => {\r\n        playedTrackBefore = true;\r\n        log.debug(\"Playing from\", store.state.seeker);\r\n        store.commit(\"setPlaying\", true);\r\n    });\r\n}\r\n\r\n/**\r\n * Resume playback,\r\n * If track is loaded, starts playback from time 0\r\n */\r\nlet locallyResumed = false;\r\nexport async function resume() {\r\n    if (!active) return;\r\n\r\n    if (playedTrackBefore) {\r\n        player.resume().then(() => {\r\n            locallyResumed = true;\r\n            store.commit(\"setPlaying\", true);\r\n        });\r\n    } else {\r\n        play();\r\n    }\r\n}\r\n\r\nlet locallyPaused = false;\r\nexport async function pause() {\r\n    if (!active) return;\r\n\r\n    if (playedTrackBefore) {\r\n        player.pause().then(() => {\r\n            locallyPaused = true;\r\n            store.commit(\"setPlaying\", false);\r\n        });\r\n    }\r\n}\r\n/**\r\n * Go to a specific time in the track\r\n * Playing state will not be affected\r\n * @param {*} time_ms in ms\r\n */\r\nexport async function seekMS(time_ms) {\r\n    if (!active) return;\r\n\r\n    // Seek\r\n    player.seek(time_ms);\r\n    store.commit(\"setSeeker\", time_ms);\r\n}\r\nexport async function seekS(time_seconds) {\r\n    if (!active) return;\r\n\r\n    return seekMS(time_seconds * 1000);\r\n}\r\n\r\nlet playingSegment = null;\r\nexport async function playSegment(segment) {\r\n    if (!active) return;\r\n    store.commit(\"setSeeker\", segment.start * 1000);\r\n    resume().then(() => {\r\n        playingSegment = segment;\r\n        window.setTimeout(() => {\r\n            if (playingSegment === segment) {\r\n                pause();\r\n            }\r\n        }, segment.duration * 1000);\r\n    });\r\n}\r\n\r\nexport function setVolume(volume) {\r\n    if (!active) return;\r\n\r\n    if (player) {\r\n        player.setVolume(volume);\r\n    }\r\n}\r\n\r\nasync function stateChangedCallback(newState) {\r\n    if (!active) return;\r\n\r\n    if (!playedTrackBefore) return;\r\n    const { current_track, position, duration } = newState;\r\n    store.commit(\"setSeeker\", position);\r\n\r\n    const time = performance.now();\r\n    spotify.getMyCurrentPlaybackState().then((result) => {\r\n        if (locallyPaused || locallyResumed) {\r\n            if (locallyPaused && !result.is_playing) {\r\n                locallyPaused = false;\r\n            }\r\n            if (locallyResumed && result.is_playing) {\r\n                locallyResumed = false;\r\n            }\r\n        } else {\r\n            store.commit(\"setPlaying\", result.is_playing);\r\n        }\r\n    });\r\n}\r\n\r\nstore.watch(\r\n    (state) => state.seeker,\r\n    (newSeeker, oldSeeker) => {\r\n        //log.debug(\"Vuex Seeker: \", newSeeker);\r\n    }\r\n);\r\n\r\nstore.watch(\r\n    (state) => state.playing,\r\n    (newPlaying, oldPlaying) => {\r\n        //log.debug(\"Vuex Playing: \", newPlaying);\r\n    }\r\n);\r\n\r\nfunction startSeekerInterval() {\r\n    lastSeekerIntervalPoll = new Date();\r\n    setInterval(() => incrementSeeker(33), 33);\r\n}\r\nlet lastSeekerIntervalPoll;\r\nfunction incrementSeeker() {\r\n    if (store.state.playing) {\r\n        const now = new Date();\r\n        const elapsed = now - lastSeekerIntervalPoll;\r\n        lastSeekerIntervalPoll = now;\r\n        store.commit(\"incrementSeeker\", elapsed);\r\n    } else {\r\n        lastSeekerIntervalPoll = new Date();\r\n    }\r\n}\r\n\r\nexport async function initialize(token) {\r\n    waitForSpotifyWebPlaybackSDKToLoad().then(() => {\r\n        player = new window.Spotify.Player({\r\n            name: \"Music Structure Visualizer\",\r\n            getOAuthToken: (cb) => {\r\n                cb(token);\r\n            },\r\n            volume: 0.5,\r\n        });\r\n\r\n        // Error handling\r\n        player.addListener(\"initialization_error\", ({ message }) => {\r\n            log.error(message);\r\n        });\r\n        player.addListener(\"authentication_error\", ({ message }) => {\r\n            log.error(message);\r\n        });\r\n        player.addListener(\"account_error\", ({ message }) => {\r\n            log.error(message);\r\n        });\r\n        player.addListener(\"playback_error\", ({ message }) => {\r\n            log.error(message);\r\n        });\r\n        // Playback status updates\r\n        player.addListener(\"player_state_changed\", ({ position, duration, track_window: { current_track } }) => {\r\n            stateChangedCallback({ current_track, position, duration });\r\n        });\r\n\r\n        // Ready\r\n        player.addListener(\"ready\", ({ device_id }) => {\r\n            deviceId = device_id;\r\n            log.info(\"Ready with Device ID\", device_id);\r\n            const deviceIdArray = [deviceId];\r\n            if (autoConnect) {\r\n                spotify.transferMyPlayback(deviceIdArray).then((err, result) => {\r\n                    window.setTimeout(store.commit(\"playerReady\", true), 1);\r\n                    startSeekerInterval();\r\n                    active = true;\r\n                    store.commit(\"setPlayerActive\", active);\r\n                });\r\n            } else {\r\n                window.setTimeout(store.commit(\"playerReady\", true), 1);\r\n                startSeekerInterval();\r\n            }\r\n        });\r\n\r\n        // Not Ready\r\n        player.addListener(\"not_ready\", ({ device_id }) => {\r\n            log.warn(\"Device ID has gone offline\", device_id);\r\n        });\r\n\r\n        // Connect to the player!\r\n        player\r\n            .connect()\r\n            .then(() => {\r\n                log.info(\"Connected succesfully!!!\");\r\n            })\r\n            .catch((err) => {\r\n                log.error(\"Could not connect\");\r\n            });\r\n    });\r\n}\r\n\r\nexport function transferPlayback() {\r\n    if (!active) {\r\n        log.debug(\"Transfering playback\");\r\n        const deviceIdArray = [deviceId];\r\n        spotify.transferMyPlayback(deviceIdArray).then((result) => {});\r\n        active = true;\r\n        store.commit(\"setPlayerActive\", active);\r\n\r\n        loadTrack(store.getters.selectedTrack);\r\n    }\r\n}\r\n\r\nexport function releasePlayback() {\r\n    if (!active) return;\r\n    spotify.getMyDevices().then((result) => {\r\n        result.devices.forEach((device) => {\r\n            if (!device.is_active) {\r\n                spotify.transferMyPlayback([device.id]);\r\n                active = false;\r\n                store.commit(\"setPlayerActive\", active);\r\n                return true;\r\n            }\r\n        });\r\n    });\r\n    return false;\r\n}\r\n\r\nasync function waitForSpotifyWebPlaybackSDKToLoad() {\r\n    return new Promise((resolve) => {\r\n        if (window.Spotify) {\r\n            resolve(window.Spotify);\r\n        } else {\r\n            window.onSpotifyWebPlaybackSDKReady = () => {\r\n                resolve(window.Spotify);\r\n            };\r\n        }\r\n    });\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',_vm._l((_vm.markers),function(marker){return _c('g',{key:marker.time},[_c('rect',{staticClass:\"marker\",style:((\"opacity: \" + _vm.opacity)),attrs:{\"x\":_vm.normalizeTime(marker.time) * _vm.width - 1.25,\"y\":_vm.showMarkerLabel ? _vm.markerLabelHeight : 0,\"width\":2.5,\"height\":_vm.height - (_vm.showMarkerLabel ? _vm.markerLabelHeight : 0),\"fill\":marker.color || 'grey'},on:{\"click\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"left\",37,$event.key,[\"Left\",\"ArrowLeft\"])){ return null; }if('button' in $event && $event.button !== 0){ return null; }return _vm.clickedMarker(marker)},\"dblclick\":function($event){return _vm.doubleClickMarker(marker)}}}),(_vm.showMarkerLabel)?_c('foreignObject',{attrs:{\"x\":_vm.normalizeTime(marker.time) * _vm.width - 1.25 - 3,\"y\":-_vm.markerLabelHeight / 2,\"width\":100,\"height\":_vm.markerLabelHeight * 2}},[_c('span',{staticClass:\"markerLabel\",style:((\"color: \" + (marker.color)))},[_vm._v(\" \"+_vm._s(marker.label)+\" \")])]):_vm._e(),(_vm.isShowingEdit(marker))?_c('g',[_c('foreignObject',{staticClass:\"editObject\",attrs:{\"x\":Math.min(_vm.width - 180, _vm.normalizeTime(marker.time) * _vm.width - 1.25 + 10),\"y\":0,\"width\":180,\"height\":_vm.height}},[_c('div',{staticClass:\"markerEditDiv\",attrs:{\"height\":_vm.height / 2},on:{\"blur\":function($event){return _vm.blur(marker)}}},[_c('v-text-field',{staticClass:\"px-5 pb-0\",on:{\"focus\":function($event){return _vm.$store.commit('setInputFocus', true)},\"blur\":function($event){return _vm.blur(marker)}},model:{value:(marker.label),callback:function ($$v) {_vm.$set(marker, \"label\", $$v)},expression:\"marker.label\"}}),_c('v-color-picker',{attrs:{\"hide-inputs\":\"\",\"hide-canvas\":\"\",\"height\":_vm.height / 2},model:{value:(marker.color),callback:function ($$v) {_vm.$set(marker, \"color\", $$v)},expression:\"marker.color\"}})],1)])],1):_vm._e()],1)}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <g>\r\n        <g v-for=\"marker in markers\" :key=\"marker.time\">\r\n            <rect\r\n                class=\"marker\"\r\n                :x=\"normalizeTime(marker.time) * width - 1.25\"\r\n                :y=\"showMarkerLabel ? markerLabelHeight : 0\"\r\n                :width=\"2.5\"\r\n                :height=\"height - (showMarkerLabel ? markerLabelHeight : 0)\"\r\n                :fill=\"marker.color || 'grey'\"\r\n                :style=\"`opacity: ${opacity}`\"\r\n                @click.left=\"clickedMarker(marker)\"\r\n                @dblclick=\"doubleClickMarker(marker)\"\r\n            ></rect>\r\n            <foreignObject\r\n                v-if=\"showMarkerLabel\"\r\n                :x=\"normalizeTime(marker.time) * width - 1.25 - 3\"\r\n                :y=\"-markerLabelHeight / 2\"\r\n                :width=\"100\"\r\n                :height=\"markerLabelHeight * 2\"\r\n            >\r\n                <span class=\"markerLabel\" :style=\"`color: ${marker.color}`\">\r\n                    {{ marker.label }}\r\n                </span>\r\n            </foreignObject>\r\n\r\n            <g v-if=\"isShowingEdit(marker)\">\r\n                <foreignObject\r\n                    :x=\"Math.min(width - 180, normalizeTime(marker.time) * width - 1.25 + 10)\"\r\n                    :y=\"0\"\r\n                    :width=\"180\"\r\n                    :height=\"height\"\r\n                    class=\"editObject\"\r\n                >\r\n                    <div class=\"markerEditDiv\" :height=\"height / 2\" @blur=\"blur(marker)\">\r\n                        <v-text-field\r\n                            class=\"px-5 pb-0\"\r\n                            v-model=\"marker.label\"\r\n                            @focus=\"$store.commit('setInputFocus', true)\"\r\n                            @blur=\"blur(marker)\"\r\n                        ></v-text-field>\r\n\r\n                        <v-color-picker\r\n                            v-model=\"marker.color\"\r\n                            hide-inputs\r\n                            hide-canvas\r\n                            :height=\"height / 2\"\r\n                        ></v-color-picker>\r\n                    </div>\r\n                </foreignObject>\r\n            </g>\r\n        </g>\r\n    </g>\r\n</template>\r\n\r\n<script>\r\nimport * as d3 from \"d3\";\r\nimport * as log from \"../../dev/log\";\r\nimport * as player from \"../../app/player\";\r\n\r\nexport default {\r\n    props: {\r\n        width: Number,\r\n        height: Number,\r\n        opacity: Number,\r\n        showMarkerLabel: Boolean,\r\n    },\r\n    data() {\r\n        return {\r\n            showingMarkerEdit: null,\r\n            markerLabelHeight: 15,\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        loadingTrack() {\r\n            return this.$store.state.loadingTrack;\r\n        },\r\n        seekerNormalized() {\r\n            return this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000);\r\n        },\r\n        isZoomed() {\r\n            return this.$store.state.isZoomed;\r\n        },\r\n        zoomScale() {\r\n            return this.$store.getters.zoomScale;\r\n        },\r\n        markers() {\r\n            return this.track.markers;\r\n        },\r\n        inputFocus() {\r\n            return this.$store.state.inputFocus;\r\n        },\r\n    },\r\n    mounted() {\r\n        this._keyListener = function(e) {\r\n            if (event.keyCode === 13 && this.showingMarkerEdit) {\r\n                e.preventDefault();\r\n                this.showingMarkerEdit = null;\r\n            }\r\n        };\r\n        document.addEventListener(\"keydown\", this._keyListener.bind(this));\r\n    },\r\n    beforeDestroy() {\r\n        document.removeEventListener(\"keydown\", this._keyListener);\r\n    },\r\n    watch: {\r\n        inputFocus() {\r\n            log.debug(this.inputFocus);\r\n            if (!this.inputFocus) {\r\n                this.showingMarkerEdit = null;\r\n            }\r\n        },\r\n    },\r\n    methods: {\r\n        normalizeTime(time) {\r\n            return time / this.track.getAnalysisDuration();\r\n        },\r\n        clickedMarker(marker) {\r\n            player.seekS(marker.time);\r\n        },\r\n        doubleClickMarker(marker) {\r\n            log.debug(\"dblckick\");\r\n            this.showEdit(marker);\r\n        },\r\n        rightClick(event) {\r\n            let xNormalized = 0;\r\n            if (this.$store.state.browser === \"Firefox\") {\r\n                xNormalized = event.layerX / this.width;\r\n            } else {\r\n                xNormalized = event.offsetX / this.width;\r\n            }\r\n            this.track.placeMarker(xNormalized * this.track.getAnalysisDuration());\r\n        },\r\n        showEdit(marker) {\r\n            if (!this.isShowingEdit(marker)) {\r\n                this.showingMarkerEdit = marker;\r\n                this.$store.commit(\"setInputFocus\", true);\r\n            }\r\n        },\r\n        isShowingEdit(marker) {\r\n            return this.showingMarkerEdit === marker;\r\n        },\r\n        blur(marker) {\r\n            log.debug(\"blur\");\r\n            this.showingMarkerEdit = null;\r\n            this.$store.commit(\"setInputFocus\", false);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.marker {\r\n    z-index: -100;\r\n}\r\n.marker:hover {\r\n    fill: white !important;\r\n    opacity: 0.7 !important;\r\n    cursor: pointer;\r\n}\r\n.markerEditDiv {\r\n    background-color: rgba(50, 50, 50, 1);\r\n    border-radius: 5px;\r\n    z-index: 20;\r\n}\r\n.markerLabel {\r\n    font: 13px Roboto;\r\n}\r\n.editObject {\r\n    transform-style: preserve-3d;\r\n    z-index: 10;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Markers.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Markers.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Markers.vue?vue&type=template&id=008c66ac&\"\nimport script from \"./Markers.vue?vue&type=script&lang=js&\"\nexport * from \"./Markers.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Markers.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VColorPicker } from 'vuetify/lib/components/VColorPicker';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VColorPicker,VTextField})\n","<template>\r\n    <svg\r\n        v-if=\"!loadingTrack\"\r\n        :height=\"height\"\r\n        :width=\"width\"\r\n        class=\"seekerSVG\"\r\n        :style=\"`transform: translate(${0}px, 0px);`\"\r\n        @click=\"clickedSVG\"\r\n        @click.right=\"rightClick\"\r\n        @contextmenu.prevent\r\n    >\r\n        <rect\r\n            class=\"seekerRect\"\r\n            :x=\"!isVertical * ((useZoom && isZoomed ? 0.5 : seekerNormalized) * width - 1.25)\"\r\n            :y=\"\r\n                isVertical * ((useZoom && isZoomed ? 0.5 : seekerNormalized) * height - 1.25) + showMarkerLabel ? 15 : 0\r\n            \"\r\n            :width=\"isVertical ? width * 2 : 2.5\"\r\n            :height=\"(isVertical ? 2.5 : height * 2) - (showMarkerLabel ? 15 : 0)\"\r\n            :fill=\"seekerColor\"\r\n        ></rect>\r\n        <Markers\r\n            :ref=\"'markers'\"\r\n            :v-if=\"drawMarkers\"\r\n            :width=\"width\"\r\n            :height=\"height\"\r\n            :opacity=\"markerOpacity || 0.3\"\r\n            :showMarkerLabel=\"showMarkerLabel\"\r\n        ></Markers>\r\n    </svg>\r\n</template>\r\n\r\n<script>\r\nimport * as d3 from \"d3\";\r\nimport * as log from \"../../dev/log\";\r\nimport * as player from \"../../app/player\";\r\nimport Markers from \"./Markers\";\r\n\r\nexport default {\r\n    props: [\"width\", \"height\", \"useZoom\", \"vertical\", \"color\", \"drawMarkers\", \"markerOpacity\", \"showMarkerLabel\"],\r\n    components: {\r\n        Markers,\r\n    },\r\n    data() {\r\n        return {};\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        loadingTrack() {\r\n            return this.$store.state.loadingTrack;\r\n        },\r\n        seekerNormalized() {\r\n            return this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000);\r\n        },\r\n        isZoomed() {\r\n            return this.$store.state.isZoomed;\r\n        },\r\n        zoomScale() {\r\n            return this.$store.getters.zoomScale;\r\n        },\r\n        isVertical() {\r\n            if (this.vertical) {\r\n                return 1;\r\n            } else {\r\n                return 0;\r\n            }\r\n        },\r\n        seekerColor() {\r\n            if (this.color) return this.color;\r\n            return this.isVertical ? \"#1D4924\" : \"#1DB954\";\r\n        },\r\n    },\r\n    mounted() {},\r\n    methods: {\r\n        clicked(event) {\r\n            this.clickedSVG(event);\r\n        },\r\n        clickedSVG(event) {\r\n            log.debug(\"CLickedseeker\");\r\n\r\n            this.$store.commit(\"setInputFocus\", false);\r\n            let xNormalized = 0;\r\n            let yNormalized = 0;\r\n            if (this.$store.state.browser === \"Firefox\") {\r\n                xNormalized = event.layerX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            } else {\r\n                xNormalized = event.offsetX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            }\r\n\r\n            if (this.useZoom && this.isZoomed) {\r\n                const xFromMiddle = xNormalized * 2 - 1;\r\n                const seekerPos = Math.min(1, Math.max(0, this.seekerNormalized + xFromMiddle / (2 * this.zoomScale)));\r\n                player.seekS(seekerPos * this.track.getAnalysisDuration());\r\n            } else {\r\n                player.seekS(xNormalized * this.track.getAnalysisDuration());\r\n            }\r\n        },\r\n        rightClick(event) {\r\n            this.$store.commit(\"setInputFocus\", false);\r\n            log.debug(this.$refs);\r\n            this.$refs.markers.rightClick(event);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.seekerSVG {\r\n    position: absolute;\r\n    z-index: 50;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Seeker.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Seeker.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Seeker.vue?vue&type=template&id=4a3ff05d&\"\nimport script from \"./Seeker.vue?vue&type=script&lang=js&\"\nexport * from \"./Seeker.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Seeker.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\r\n    <div>\r\n        <v-card :width=\"width\">\r\n            <v-tabs v-if=\"trackVisready\" v-model=\"selectedTab\" dark center-active show-arrows>\r\n                <v-tab v-for=\"matrix in this.track.matrixes\" :key=\"matrix.name\">{{ matrix.name }}</v-tab>\r\n            </v-tabs>\r\n        </v-card>\r\n        <Seeker :width=\"width\" :height=\"width\" />\r\n        <Seeker :width=\"width\" :height=\"width\" :vertical=\"true\" />\r\n        <svg v-if=\"hasStructures\" class=\"annotations\" :height=\"width\" :width=\"width\">\r\n            <g v-for=\"(section, index) in selectedStructure.data\" :key=\"index\">\r\n                <rect\r\n                    v-if=\"showPathStart\"\r\n                    :x=\"section.start * secondsToXPosition - 1\"\r\n                    :y=\"0\"\r\n                    :width=\"2\"\r\n                    :height=\"width\"\r\n                    :fill=\"getCategoryColor(section.label)\"\r\n                    :opacity=\"0.8\"\r\n                ></rect>\r\n                <rect\r\n                    v-if=\"fillSections\"\r\n                    :x=\"section.start * secondsToXPosition\"\r\n                    :y=\"0\"\r\n                    :width=\"section.duration * secondsToXPosition\"\r\n                    :height=\"width\"\r\n                    :fill=\"getCategoryColor(section.label)\"\r\n                    :opacity=\"0.3\"\r\n                ></rect>\r\n                <g v-if=\"section.pathFamily && showPaths\">\r\n                    <g v-for=\"(path, pathIndex) in section.pathFamily\" :key=\"pathIndex\">\r\n                        <path\r\n                            fill=\"none\"\r\n                            stroke=\"black\"\r\n                            stroke-width=\"8\"\r\n                            :d=\"generateLine(path)\"\r\n                            class=\"path\"\r\n                            stroke-linejoin=\"round\"\r\n                        />\r\n                        <path\r\n                            fill=\"none\"\r\n                            :stroke=\"getCategoryColor(section.label)\"\r\n                            stroke-width=\"4\"\r\n                            :d=\"generateLine(path)\"\r\n                            class=\"path\"\r\n                            stroke-linejoin=\"round\"\r\n                        />\r\n                    </g>\r\n                </g>\r\n            </g>\r\n        </svg>\r\n        <canvas id=\"gl-canvas\" :height=\"width\" :width=\"width\" class=\"glCanvas pa-0 ma-0\"></canvas>\r\n        <v-row class=\"options-row\" v-if=\"hasStructures\" :style=\"`width: ${width}px`\">\r\n            <v-select\r\n                v-model=\"selectedStructure\"\r\n                :items=\"track.structures\"\r\n                item-text=\"name\"\r\n                return-object\r\n                label=\"Structure\"\r\n                solo\r\n            ></v-select>\r\n            <v-spacer></v-spacer>\r\n            <v-switch v-model=\"showPathStart\" label=\"Show Path Start\" hide-details></v-switch>\r\n            <v-switch v-model=\"fillSections\" label=\"Fill Sections\" hide-details></v-switch>\r\n            <v-switch v-model=\"showPaths\" label=\"Show Paths\" hide-details></v-switch>\r\n        </v-row>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport WebGLMatrixPool from \"../../app/webgl/WebGLMatrixPool\";\r\nimport * as d3 from \"d3\";\r\n\r\nimport Seeker from \"./Seeker\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            selectedStructure: { name: \"undefined\", data: [] },\r\n            fillSections: false,\r\n            showPathStart: false,\r\n            showPaths: false,\r\n            selectedTab: 0,\r\n            drawLoop: null,\r\n            webGLMatrixPool: null,\r\n        };\r\n    },\r\n    watch: {\r\n        zoomed() {\r\n            this.applyRenderMode();\r\n        },\r\n        selectedTab() {\r\n            this.setSelected();\r\n            this.draw();\r\n        },\r\n        track() {\r\n            this.webGLMatrixPool.clear();\r\n        },\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        hasStructures() {\r\n            return this.track && this.track.structures && this.track.structures.length > 0;\r\n        },\r\n        zoomed() {\r\n            return this.$store.getters.isZoomed;\r\n        },\r\n        zoomScale() {\r\n            return this.$store.getters.zoomScale;\r\n        },\r\n        seekerNormalized() {\r\n            return this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000);\r\n        },\r\n        secondsToXPosition() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        xCenterPositionNormalized() {\r\n            if (this.zoomed) {\r\n                return this.seekerNormalized;\r\n            } else {\r\n                return 0.5;\r\n            }\r\n        },\r\n        trackVisready() {\r\n            return this.track && this.track.matrixes.length > 0;\r\n        },\r\n        lineGenerator() {\r\n            return d3\r\n                .line()\r\n                .x((v) => {\r\n                    return (this.width / this.track.features.sampleAmount) * v[0];\r\n                })\r\n                .y((v) => {\r\n                    return (this.width / this.track.features.sampleAmount) * v[1];\r\n                });\r\n        },\r\n    },\r\n    mounted() {\r\n        this.webGLMatrixPool = new WebGLMatrixPool(document.getElementById(\"gl-canvas\"));\r\n        window.eventBus.$on(\"readyForPrototypeVis\", () => {\r\n            if (!this.track) log.error(\"SSM done but track does not exist\");\r\n            clearInterval(this.drawLoop);\r\n            this.selectedStructure = this.track.structures[this.track.structures.length - 1];\r\n\r\n            this.webGLMatrixPool.fillMatrixBufferPool(this.track, this.selectedTab);\r\n\r\n            this.setSelected();\r\n            this.applyRenderMode();\r\n        });\r\n        this._keyListener = function(e) {\r\n            if (e.key === \"p\" && (e.ctrlKey || e.metaKey)) {\r\n                e.preventDefault(); // present \"Save Page\" from getting triggered.\r\n                this.showPaths = !this.showPaths;\r\n            }\r\n        };\r\n        document.addEventListener(\"keydown\", this._keyListener.bind(this));\r\n    },\r\n    beforeDestroy() {\r\n        document.removeEventListener(\"keydown\", this._keyListener);\r\n    },\r\n    methods: {\r\n        setSelected() {\r\n            this.webGLMatrixPool.select(this.selectedTab);\r\n        },\r\n        draw() {\r\n            this.webGLMatrixPool.clear();\r\n            this.webGLMatrixPool.draw(0.5, 1, 1);\r\n            // no zoom pls  this.zoomed ? this.zoomScale : 1\r\n        },\r\n        applyRenderMode() {\r\n            clearInterval(this.drawLoop);\r\n            if (this.zoomed) {\r\n                this.drawLoop = setInterval(this.draw, this.$store.getters.seekerUpdateSpeed);\r\n            } else {\r\n                this.draw();\r\n            }\r\n        },\r\n        getCategoryColor(index) {\r\n            return vis.categoryColor(index);\r\n        },\r\n        generateLine(path) {\r\n            return this.lineGenerator(path);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.SPcanvas {\r\n    background-color: \"white\";\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n.annotations {\r\n    position: absolute;\r\n    z-index: 5;\r\n}\r\n.options-row {\r\n    z-index: 20;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Matrixes.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Matrixes.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Matrixes.vue?vue&type=template&id=3dfee1ef&\"\nimport script from \"./Matrixes.vue?vue&type=script&lang=js&\"\nexport * from \"./Matrixes.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Matrixes.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VSwitch } from 'vuetify/lib/components/VSwitch';\nimport { VTab } from 'vuetify/lib/components/VTabs';\nimport { VTabs } from 'vuetify/lib/components/VTabs';\ninstallComponents(component, {VCard,VRow,VSelect,VSpacer,VSwitch,VTab,VTabs})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('p',{staticClass:\"pa-0 ma-0\"},[_vm._v(\"Spotify Sections\")]),_c('Seeker',{attrs:{\"width\":_vm.width,\"height\":_vm.height,\"useZoom\":\"true\"}}),_c('canvas',{ref:\"GTcanvas\",staticClass:\"GTcanvas pa-0 ma-0\",attrs:{\"id\":\"GTcanvas\",\"height\":_vm.height,\"width\":_vm.width}}),(_vm.track)?_c('div',[(_vm.trackHasGroundTruth)?_c('p',{staticClass:\"pa-0 ma-0\",style:((\"transform: translate(0px, \" + (-_vm.height + 15) + \"px);\"))},[_vm._v(\" Ground Truth \")]):_vm._e()]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import * as log from \"../../dev/log\";\r\nimport * as d3 from \"d3\";\r\nimport store from \"../../store\";\r\n\r\nexport default class ZoomCanvas {\r\n    drawLoop = null;\r\n    canvas = null;\r\n    ctx = null;\r\n    trackDuration = 0;\r\n    width = 0;\r\n    height = 0;\r\n    zoomed = false;\r\n    zoomScale = 1;\r\n    drawFunction = null;\r\n\r\n    constructor(canvas, type = \"2d\") {\r\n        this.canvas = canvas;\r\n        if (!canvas) {\r\n            log.error(\"canvas not ready\");\r\n            return;\r\n        }\r\n        this.ctx = canvas.getContext(type);\r\n        this.width = this.canvas.width;\r\n        this.height = this.canvas.height;\r\n        this.clear();\r\n    }\r\n\r\n    clear() {\r\n        this.ctx.clearRect(0, 0, this.width, this.height);\r\n    }\r\n\r\n    setTrackDuration(track) {\r\n        this.trackDuration = track.getAnalysisDuration();\r\n    }\r\n\r\n    setZoomed(zoomed) {\r\n        this.zoomed = zoomed;\r\n        this.zoomScale = store.state.zoomScale;\r\n        this.applyRenderMode();\r\n    }\r\n\r\n    setWidth(width) {\r\n        this.width = width;\r\n        this.canvas.width = width;\r\n        setTimeout(() => this.applyRenderMode(), 0);\r\n    }\r\n\r\n    setHeight(height) {\r\n        this.height = height;\r\n        this.canvas.height = height;\r\n        setTimeout(() => this.applyRenderMode(), 0);\r\n    }\r\n\r\n    setDrawFunction(drawFunction) {\r\n        this.drawFunction = drawFunction;\r\n        this.applyRenderMode();\r\n    }\r\n\r\n    applyRenderMode() {\r\n        clearInterval(this.drawLoop);\r\n        if (this.zoomed) {\r\n            this.drawLoop = setInterval(() => this.clearAndDraw(), store.state.seekerUpdateSpeed);\r\n        } else {\r\n            this.clearAndDraw();\r\n        }\r\n    }\r\n\r\n    clearAndDraw() {\r\n        this.clear();\r\n        this.drawFunction();\r\n    }\r\n\r\n    getSeekerNormalized() {\r\n        return store.state.seeker / (this.trackDuration * 1000);\r\n    }\r\n\r\n    getOffsetXNormalized() {\r\n        return this.zoomed ? 0.5 - this.getSeekerNormalized() * this.zoomScale : 0;\r\n    }\r\n\r\n    drawRect(start, y, duration, height, color) {\r\n        let startNormalized = start / this.trackDuration;\r\n        if (this.zoomed) startNormalized *= this.zoomScale;\r\n\r\n        const x = (startNormalized + this.getOffsetXNormalized()) * this.width;\r\n        const width = (duration / this.trackDuration) * (this.zoomed ? this.zoomScale : 1) * this.width;\r\n        this.ctx.fillStyle = color;\r\n        this.ctx.fillRect(x, y, width, height);\r\n    }\r\n\r\n    drawRectWithBorder(start, y, duration, height, color, borderSize, borderColor) {\r\n        let startNormalized = start / this.trackDuration;\r\n        if (this.zoomed) startNormalized *= this.zoomScale;\r\n\r\n        const x = (startNormalized + this.getOffsetXNormalized()) * this.width;\r\n        const width = (duration / this.trackDuration) * (this.zoomed ? this.zoomScale : 1) * this.width;\r\n        if (borderColor !== null) {\r\n            this.ctx.fillStyle = borderColor;\r\n            this.ctx.fillRect(x, y, width, height);\r\n        }\r\n        this.ctx.fillStyle = color;\r\n        this.ctx.fillRect(x + borderSize, y + borderSize, width - borderSize * 2, height - borderSize * 2);\r\n    }\r\n\r\n    drawVerticalLine(start, y, width, height, color) {\r\n        let startNormalized = start / this.trackDuration;\r\n        if (this.zoomed) startNormalized *= this.zoomScale;\r\n\r\n        const x = (startNormalized + this.getOffsetXNormalized()) * this.width;\r\n        this.ctx.fillStyle = color;\r\n        this.ctx.fillRect(x, y, width, height);\r\n    }\r\n\r\n    drawText(start, y, text, color = \"white\", font = \"12px Roboto\") {\r\n        let startNormalized = start / this.trackDuration;\r\n        if (this.zoomed) startNormalized *= this.zoomScale;\r\n\r\n        const x = (startNormalized + this.getOffsetXNormalized()) * this.width;\r\n\r\n        this.ctx.fillStyle = color;\r\n        this.ctx.font = font;\r\n        this.ctx.fillText(text, x, y);\r\n    }\r\n\r\n    drawTitle(y, text, color = \"white\", font = \"16px Roboto\") {\r\n        const x = 0;\r\n\r\n        this.ctx.fillStyle = color;\r\n        this.ctx.font = font;\r\n        this.ctx.fillText(text, x, y);\r\n    }\r\n}\r\n","<template>\r\n    <div>\r\n        <p class=\"pa-0 ma-0\">Spotify Sections</p>\r\n\r\n        <Seeker :width=\"width\" :height=\"height\" useZoom=\"true\" />\r\n        <canvas id=\"GTcanvas\" ref=\"GTcanvas\" class=\"GTcanvas pa-0 ma-0\" :height=\"height\" :width=\"width\"></canvas>\r\n        <div v-if=\"track\">\r\n            <p v-if=\"trackHasGroundTruth\" class=\"pa-0 ma-0\" :style=\"`transform: translate(0px, ${-height + 15}px);`\">\r\n                Ground Truth\r\n            </p>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            allowedNamespaces: [testing.namespaces.coarse, testing.namespaces.fine],\r\n            blockHeight: 20,\r\n            innerSpacing: 3,\r\n            zoomCanvas: null,\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        trackHasGroundTruth() {\r\n            log.debug(\"TESTING IF IT HAS GROUND TRUTH\", this.track.groundTruth);\r\n            return this.track && this.track.groundTruth !== null;\r\n        },\r\n        height() {\r\n            return (\r\n                (1 + (this.trackHasGroundTruth ? this.allowedNamespaces.length + 1 : 0)) *\r\n                (this.blockHeight + this.innerSpacing)\r\n            );\r\n        },\r\n        zoomed() {\r\n            return this.$store.getters.isZoomed;\r\n        },\r\n    },\r\n    watch: {\r\n        width() {\r\n            this.zoomCanvas.setWidth(this.width);\r\n        },\r\n        zoomed() {\r\n            this.zoomCanvas.setZoomed(this.zoomed);\r\n        },\r\n    },\r\n    mounted() {\r\n        this.zoomCanvas = new ZoomCanvas(document.getElementById(\"GTcanvas\"));\r\n        window.eventBus.$on(\"readyForPrototypeVis\", () => {\r\n            this.zoomCanvas.setTrackDuration(this.track);\r\n            this.zoomCanvas.setDrawFunction(this.drawGT);\r\n        });\r\n        this.zoomCanvas.setTrackDuration(this.track);\r\n        this.zoomCanvas.setDrawFunction(this.drawGT);\r\n    },\r\n    methods: {\r\n        drawGT() {\r\n            const allAllowedNamespaces = [].concat.apply([], this.allowedNamespaces);\r\n            const trackDuration = this.track.getAnalysisDuration();\r\n\r\n            let y = 0;\r\n            const height = this.blockHeight + this.innerSpacing;\r\n\r\n            this.track.getAnalysis().sections.forEach((section, index) => {\r\n                this.zoomCanvas.drawRectWithBorder(\r\n                    section.start,\r\n                    y,\r\n                    section.duration,\r\n                    height,\r\n                    vis.categoryColor(index),\r\n                    1,\r\n                    null\r\n                );\r\n            });\r\n            y += height;\r\n\r\n            if (!this.track.groundTruth) return;\r\n            const annotations = this.track.groundTruth.annotations;\r\n\r\n            allAllowedNamespaces.forEach((allowedNamespace) => {\r\n                const annotation = annotations.find((a) => allowedNamespace.includes(a.namespace));\r\n                if (!annotation) return;\r\n                y += height;\r\n                const uniqueValues = [];\r\n                annotation.data.forEach((segment) => {\r\n                    const confidence = segment.confidence;\r\n                    const duration = segment.duration;\r\n                    const time = segment.time;\r\n                    const value = segment.value;\r\n                    if (!uniqueValues.includes(value)) {\r\n                        uniqueValues.push(value);\r\n                    }\r\n\r\n                    this.zoomCanvas.drawRectWithBorder(\r\n                        time,\r\n                        y + this.innerSpacing,\r\n                        duration,\r\n                        this.blockHeight,\r\n                        vis.categoryColor(uniqueValues.indexOf(value)),\r\n                        1,\r\n                        null\r\n                    );\r\n                    //this.zoomCanvas.drawText(time + 0.5, y + this.innerSpacing + this.blockHeight * 0.75, value);\r\n                });\r\n            });\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.GTcanvas {\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GroundTruth.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GroundTruth.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./GroundTruth.vue?vue&type=template&id=744684be&\"\nimport script from \"./GroundTruth.vue?vue&type=script&lang=js&\"\nexport * from \"./GroundTruth.vue?vue&type=script&lang=js&\"\nimport style0 from \"./GroundTruth.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.track)?_c('div',_vm._l((_vm.features),function(feature,index){return _c('div',{key:feature.name},[_c('Graph',{attrs:{\"width\":_vm.width,\"height\":_vm.height,\"featureIndex\":index}})],1)}),0):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.track && _vm.hasFeatures)?_c('div',[_c('v-row',[_c('v-btn',{staticClass:\"pa-0 ma-0\",attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.expanded = !_vm.expanded}}},[_c('v-icon',[_vm._v(_vm._s(_vm.expanded ? \"mdi-chevron-up\" : \"mdi-chevron-down\"))])],1),_c('p',{staticClass:\"pa-0 ma-0\",on:{\"click\":function($event){_vm.expanded = !_vm.expanded}}},[_vm._v(_vm._s(_vm.feature.name))])],1),_c('v-expand-transition',[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.expanded),expression:\"expanded\"}]},[_c('Seeker',{attrs:{\"width\":_vm.width,\"height\":_vm.height}}),_c('svg',{attrs:{\"width\":_vm.width + 25,\"height\":_vm.height}},[_c('path',{staticClass:\"graphPath\",attrs:{\"fill\":\"none\",\"stroke\":\"white\",\"stroke-width\":\"2\",\"d\":_vm.d}}),_c('rect',{staticStyle:{\"fill\":\"none\",\"stroke\":\"grey\",\"stroke-width\":\"1\",\"fill-opacity\":\"0\",\"stroke-opacity\":\"1\"},attrs:{\"x\":\"0\",\"y\":\"0\",\"width\":_vm.width,\"height\":_vm.height}}),_c('text',{attrs:{\"x\":_vm.width + 2,\"y\":\"7\",\"font-size\":\"10\",\"fill\":\"white\"}},[_vm._v(_vm._s(parseFloat(_vm.max).toFixed(2)))]),_c('text',{attrs:{\"x\":_vm.width + 2,\"y\":_vm.height,\"font-size\":\"10\",\"fill\":\"white\"}},[_vm._v(\" \"+_vm._s(parseFloat(_vm.min).toFixed(2))+\" \")])])],1)])],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div v-if=\"track && hasFeatures\">\r\n        <v-row>\r\n            <v-btn icon small class=\"pa-0 ma-0\" @click=\"expanded = !expanded\"\r\n                ><v-icon>{{ expanded ? \"mdi-chevron-up\" : \"mdi-chevron-down\" }}</v-icon>\r\n            </v-btn>\r\n            <p @click=\"expanded = !expanded\" class=\"pa-0 ma-0\">{{ feature.name }}</p>\r\n        </v-row>\r\n        <v-expand-transition>\r\n            <div v-show=\"expanded\">\r\n                <Seeker :width=\"width\" :height=\"height\" />\r\n                <svg :width=\"width + 25\" :height=\"height\">\r\n                    <path fill=\"none\" stroke=\"white\" stroke-width=\"2\" :d=\"d\" class=\"graphPath\" />\r\n                    <rect\r\n                        x=\"0\"\r\n                        y=\"0\"\r\n                        :width=\"width\"\r\n                        :height=\"height\"\r\n                        style=\"fill:none; stroke:grey; stroke-width:1; fill-opacity:0; stroke-opacity:1;\"\r\n                    />\r\n                    <text :x=\"width + 2\" y=\"7\" font-size=\"10\" fill=\"white\">{{ parseFloat(max).toFixed(2) }}</text>\r\n                    <text :x=\"width + 2\" :y=\"height\" font-size=\"10\" fill=\"white\">\r\n                        {{ parseFloat(min).toFixed(2) }}\r\n                    </text>\r\n                </svg>\r\n            </div>\r\n        </v-expand-transition>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as d3 from \"d3\";\r\nimport * as log from \"../../dev/log\";\r\nimport Seeker from \"./Seeker\";\r\n\r\nexport default {\r\n    props: [\"width\", \"height\", \"featureIndex\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            expanded: true,\r\n            max: 0,\r\n            min: 0,\r\n            d: null,\r\n        };\r\n    },\r\n    watch: {\r\n        width() {\r\n            this.generateLine();\r\n        },\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        hasFeatures() {\r\n            return this.track.graphFeatures.length > 0;\r\n        },\r\n        feature() {\r\n            return this.track.graphFeatures[this.featureIndex];\r\n        },\r\n        step() {\r\n            return this.width / (this.feature.data.length - 1);\r\n        },\r\n        lineGenerator() {\r\n            return d3\r\n                .line()\r\n                .x((v, i) => {\r\n                    return this.step * i;\r\n                })\r\n                .y((v) => {\r\n                    return this.height - this.lmap(v, this.min, this.max) * this.height;\r\n                });\r\n        },\r\n    },\r\n    mounted() {\r\n        this.generateLine();\r\n        window.eventBus.$on(\"readyForPrototypeVis\", () => {\r\n            this.generateLine();\r\n        });\r\n    },\r\n    methods: {\r\n        lmap(val, min, max) {\r\n            return (val - min) / (max - min);\r\n        },\r\n        generateLine() {\r\n            if (this.feature.min !== undefined) {\r\n                this.min = this.feature.min;\r\n            } else {\r\n                this.min = Math.min(...this.feature.data);\r\n            }\r\n            if (this.feature.max !== undefined) {\r\n                this.max = this.feature.max;\r\n            } else {\r\n                this.max = Math.max(...this.feature.data);\r\n            }\r\n            this.d = this.lineGenerator(this.feature.data);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.graphTitle {\r\n    color: white;\r\n}\r\n.icon__flip {\r\n    -moz-transform: scaleX(-1);\r\n    -o-transform: scaleX(-1);\r\n    -webkit-transform: scaleX(-1);\r\n    transform: scaleX(-1);\r\n    filter: FlipH;\r\n    -ms-filter: \"FlipH\";\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graph.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graph.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Graph.vue?vue&type=template&id=4e8d86e0&\"\nimport script from \"./Graph.vue?vue&type=script&lang=js&\"\nexport * from \"./Graph.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Graph.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VExpandTransition } from 'vuetify/lib/components/transitions';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VExpandTransition,VIcon,VRow})\n","<template>\r\n    <div v-if=\"track\">\r\n        <div v-for=\"(feature, index) in features\" :key=\"feature.name\">\r\n            <Graph :width=\"width\" :height=\"height\" :featureIndex=\"index\" />\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as d3 from \"d3\";\r\nimport * as log from \"../../dev/log\";\r\nimport Graph from \"./Graph\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Graph,\r\n    },\r\n    data() {\r\n        return {\r\n            height: 60,\r\n            features: [],\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n    },\r\n    mounted() {\r\n        window.eventBus.$on(\"readyForPrototypeVis\", () => {\r\n            if (this.features.length <= 0) {\r\n                this.track.graphFeatures.forEach((feature, index) => {\r\n                    this.features.push(feature.name);\r\n                });\r\n            }\r\n        });\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.graphTitle {\r\n    color: white;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graphs.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graphs.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Graphs.vue?vue&type=template&id=712e411a&\"\nimport script from \"./Graphs.vue?vue&type=script&lang=js&\"\nexport * from \"./Graphs.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Graphs.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.track && _vm.createScapePlot)?_c('canvas',{ref:\"SPcanvas\",staticClass:\"SPcanvas pa-0 ma-0\",attrs:{\"id\":\"SPcanvas\",\"height\":_vm.width,\"width\":_vm.width}}):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <canvas\r\n        v-if=\"track && createScapePlot\"\r\n        id=\"SPcanvas\"\r\n        ref=\"SPcanvas\"\r\n        class=\"SPcanvas pa-0 ma-0\"\r\n        :height=\"width\"\r\n        :width=\"width\"\r\n    ></canvas>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport * as Track from \"../../app/Track\";\r\nexport default {\r\n    props: [\"width\"],\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        createScapePlot() {\r\n            return Track.createScapePlot;\r\n        },\r\n    },\r\n    mounted() {\r\n        window.eventBus.$on(\"readyForPrototypeVis\", () => {\r\n            if (this.createScapePlot) {\r\n                this.drawSP();\r\n            }\r\n        });\r\n    },\r\n    methods: {\r\n        drawSP() {\r\n            if (!this.createScapePlot) return;\r\n            const canvas = document.getElementById(\"SPcanvas\");\r\n            if (!canvas) {\r\n                log.error(\"canvas not ready\");\r\n                return;\r\n            }\r\n            const ctx = canvas.getContext(\"2d\");\r\n\r\n            //vis.drawScapePlot(this.track, ctx, this.width);\r\n            vis.drawScapePlot(this.track, ctx, this.width, false);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.SPcanvas {\r\n    background-color: \"white\";\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ScapePlot.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ScapePlot.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ScapePlot.vue?vue&type=template&id=0ee27a34&\"\nimport script from \"./ScapePlot.vue?vue&type=script&lang=js&\"\nexport * from \"./ScapePlot.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ScapePlot.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('Seeker',{attrs:{\"width\":_vm.width,\"height\":_vm.height,\"useZoom\":true}}),_c('canvas',{ref:\"Beatcanvas\",staticClass:\"Beatcanvas pa-0 ma-0\",attrs:{\"id\":\"Beatcanvas\",\"height\":_vm.height,\"width\":_vm.width}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div>\r\n        <Seeker :width=\"width\" :height=\"height\" :useZoom=\"true\" />\r\n        <canvas id=\"Beatcanvas\" ref=\"Beatcanvas\" class=\"Beatcanvas pa-0 ma-0\" :height=\"height\" :width=\"width\"></canvas>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            // possible elements: bars, beats, tatums\r\n            elements: [\"bars\", \"beats\", \"tatums\"],\r\n            elementHeight: 10,\r\n            elementWidth: 1,\r\n            zoomCanvas: null,\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        height() {\r\n            return this.elements.length * this.elementHeight;\r\n        },\r\n        scale() {\r\n            return this.width;\r\n        },\r\n        zoomed() {\r\n            return this.$store.getters.isZoomed;\r\n        },\r\n    },\r\n    watch: {\r\n        width() {\r\n            this.zoomCanvas.setWidth(this.width);\r\n        },\r\n        zoomed() {\r\n            this.zoomCanvas.setZoomed(this.zoomed);\r\n        },\r\n    },\r\n    mounted() {\r\n        this.zoomCanvas = new ZoomCanvas(document.getElementById(\"Beatcanvas\"));\r\n        window.eventBus.$on(\"readyForPrototypeVis\", () => {\r\n            this.zoomCanvas.setTrackDuration(this.track);\r\n            this.zoomCanvas.setDrawFunction(this.draw);\r\n        });\r\n    },\r\n    methods: {\r\n        draw() {\r\n            let y = 0;\r\n            this.drawElements(this.track.getBars(), y);\r\n            y += this.elementHeight;\r\n\r\n            this.drawElements(this.track.getBeats(), y);\r\n            y += this.elementHeight;\r\n\r\n            this.drawElements(this.track.getTatums(), y);\r\n        },\r\n        drawElements(elements, y) {\r\n            elements.forEach((element) => {\r\n                this.zoomCanvas.drawVerticalLine(\r\n                    element.start,\r\n                    y,\r\n                    this.elementWidth,\r\n                    this.elementHeight,\r\n                    vis.zeroOneColor(element.confidence)\r\n                );\r\n            });\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.GTcanvas {\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Beats.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Beats.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Beats.vue?vue&type=template&id=56090a04&\"\nimport script from \"./Beats.vue?vue&type=script&lang=js&\"\nexport * from \"./Beats.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Beats.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('Seeker',{attrs:{\"width\":_vm.width,\"height\":_vm.height,\"useZoom\":true}}),_c('canvas',{ref:\"PTcanvas\",staticClass:\"PTcanvas pa-0 ma-0\",attrs:{\"id\":\"PTcanvas\",\"height\":_vm.height,\"width\":_vm.width}}),(_vm.selectedFeatures)?_c('div',_vm._l((_vm.selectedFeatures),function(feature,index){return _c('p',{key:feature.name,style:((\"transform: translate(0px, \" + (-_vm.height - 10 + index * (_vm.featureHeight - 40)) + \"px);\"))},[_vm._v(\" \"+_vm._s(feature.name)+\" \")])}),0):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import WebGL from \"./WebGL\";\r\nimport assert from \"assert\";\r\nimport * as log from \"../../dev/log\";\r\nimport Matrix from \"../dataStructures/Matrix\";\r\nimport * as vis from \"../vis\";\r\nimport * as d3 from \"d3\";\r\n\r\nexport default class WebGLPitchTimbre extends WebGL {\r\n    pitchTimbreBufferPool;\r\n    inverseBufferPoolLength = 0;\r\n    bufferPoolLength = 0;\r\n\r\n    marginPercentage = 0.8;\r\n\r\n    constructor(canvas) {\r\n        const useColor = true;\r\n        super(canvas, useColor); // colored\r\n    }\r\n\r\n    fillpitchTimbreBufferPool(track, featureSelection) {\r\n        assert(track.matrixes, \"track does not have matrixes\");\r\n        this.pitchTimbreBufferPool = new Array(featureSelection.length);\r\n        this.inverseBufferPoolLength = 1 / featureSelection.length;\r\n        this.bufferPoolLength = featureSelection.length;\r\n\r\n        featureSelection.forEach((featureObject, index) => {\r\n            this.pitchTimbreBufferPool[index] = this.createSegmentFeatureDataArray(\r\n                track,\r\n                featureObject.data,\r\n                featureObject.sampled,\r\n                featureObject.range,\r\n                featureObject.featureAmount,\r\n            );\r\n        });\r\n    }\r\n\r\n    inverseBufferPoolLength() {\r\n        return 1 / this.pitchTimbreBufferPool;\r\n    }\r\n\r\n    draw(xCenterPositionNormalized, scaleX, scaleY) {\r\n        for (let i = 0; i < this.bufferPoolLength; i++) {\r\n            this.setBufferData(this.pitchTimbreBufferPool[i]);\r\n            const scale = this.inverseBufferPoolLength * this.marginPercentage;\r\n            super.draw(\r\n                (1 - xCenterPositionNormalized * 2) * scaleX,\r\n                1 - this.inverseBufferPoolLength - i * 2 * this.inverseBufferPoolLength,\r\n                scaleX,\r\n                scale\r\n            );\r\n        }\r\n    }\r\n\r\n    createSegmentFeatureDataArray(track, feature, sampled, range, featureAmount) {\r\n        const startDuration = sampled ? track.features.sampleStartDuration : track.features.segmentStartDuration;\r\n        const segmentAmount = startDuration.length;\r\n        const vectorSize = featureAmount || feature[0].length || 1;\r\n        const inverseVectorSize = 1 / vectorSize;\r\n        range = range || [0, 1];\r\n        const centeredRange = range[0] === -range[1];\r\n\r\n        this.bufferSize = segmentAmount * vectorSize * 6;\r\n        if (this.bufferSize > 22e6) {\r\n            log.error(\"Buffer OVERFLOW with size\", this.bufferSize);\r\n        }\r\n\r\n        const halfDuration = track.getAnalysisDuration() / 2;\r\n        function st(pos) {\r\n            return pos / halfDuration - 1;\r\n        } // Scale and translate\r\n\r\n        const featureVertices = [];\r\n        const colors = [];\r\n        for (let s = 0; s < segmentAmount; s++) {\r\n            if(vectorSize === 1){\r\n                const y = .8;\r\n                const left = st(startDuration[s][0]);\r\n                const top = y;\r\n                const right = st(startDuration[s][0] + startDuration[s][1]);\r\n                const bottom = .3;\r\n                let value, color;\r\n                value = feature[s];\r\n                if (centeredRange) {\r\n                    color = d3.rgb(vis.divergingColor(value / range[1]));\r\n                } else {\r\n                    color = d3.rgb(vis.pitchColor(value));\r\n                }\r\n                const r = color.r / 255;\r\n                const g = color.g / 255;\r\n                const b = color.b / 255;\r\n                featureVertices.push(left, top, left, bottom, right, top, right, top, left, bottom, right, bottom);\r\n                colors.push(r, g, b, r, g, b, r, g, b, r, g, b, r, g, b, r, g, b);\r\n            }\r\n            for (let i = 0; i < vectorSize; i++) {\r\n                const y = -1 + 2 * i * inverseVectorSize;\r\n                const left = st(startDuration[s][0]);\r\n                const top = y;\r\n                const right = st(startDuration[s][0] + startDuration[s][1]);\r\n                const bottom = y - 2 * inverseVectorSize;\r\n                let value, color;\r\n                value = feature[s][i];\r\n                if (centeredRange) {\r\n                    color = d3.rgb(vis.divergingColor(value / range[1]));\r\n                } else {\r\n                    color = d3.rgb(vis.pitchColor(value));\r\n                }\r\n                const r = color.r / 255;\r\n                const g = color.g / 255;\r\n                const b = color.b / 255;\r\n                featureVertices.push(left, top, left, bottom, right, top, right, top, left, bottom, right, bottom);\r\n                colors.push(r, g, b, r, g, b, r, g, b, r, g, b, r, g, b, r, g, b);\r\n            }\r\n        }\r\n\r\n        return { verts: new Float32Array(featureVertices), colors: new Float32Array(colors) };\r\n    }\r\n}\r\n","<template>\r\n    <div>\r\n        <Seeker :width=\"width\" :height=\"height\" :useZoom=\"true\" />\r\n        <canvas id=\"PTcanvas\" ref=\"PTcanvas\" class=\"PTcanvas pa-0 ma-0\" :height=\"height\" :width=\"width\"></canvas>\r\n        <div v-if=\"selectedFeatures\">\r\n            <p\r\n                v-for=\"(feature, index) in selectedFeatures\"\r\n                :key=\"feature.name\"\r\n                :style=\"`transform: translate(0px, ${-height - 10 + index * (featureHeight - 40)}px);`\"\r\n            >\r\n                {{ feature.name }}\r\n            </p>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport * as filter from \"../../app/filter\";\r\n\r\nimport Seeker from \"./Seeker\";\r\nimport WebGLPitchTimbre from \"../../app/webgl/WebGLPitchTimbre\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            webGLPitchTimbre: null,\r\n            selectedFeatures: null,\r\n            featureHeight: 200,\r\n        };\r\n    },\r\n    watch: {\r\n        zoomed() {\r\n            this.applyRenderMode();\r\n        },\r\n        track() {\r\n            this.webGLPitchTimbre.clear();\r\n        },\r\n        seekerNormalized() {\r\n            this.draw();\r\n        },\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        zoomed() {\r\n            return this.$store.getters.isZoomed;\r\n        },\r\n        zoomScale() {\r\n            return this.$store.getters.zoomScale;\r\n        },\r\n        seekerNormalized() {\r\n            return this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000);\r\n        },\r\n        xCenterPositionNormalized() {\r\n            if (this.zoomed) {\r\n                return this.seekerNormalized;\r\n            } else {\r\n                return 0.5;\r\n            }\r\n        },\r\n        height() {\r\n            if (!this.selectedFeatures) return 100;\r\n            return this.selectedFeatures.length * this.featureHeight;\r\n        },\r\n    },\r\n    mounted() {\r\n        this.webGLPitchTimbre = new WebGLPitchTimbre(document.getElementById(\"PTcanvas\"));\r\n        window.eventBus.$on(\"readyForPrototypeVis\", () => {\r\n            if (!this.track) log.error(\"Processing done but track does not exist\");\r\n\r\n            this.selectedFeatures = [\r\n                { name: \"Pitch raw\", data: this.track.features.raw.pitches, sampled: false, featureAmount: 12 },\r\n                { name: \"Pitch Noise\", data: this.track.features.processed.noise, sampled: false, featureAmount: 12 },\r\n\r\n                {\r\n                    name: \"Pitch processed\",\r\n                    data: this.track.features.processed.pitches,\r\n                    sampled: false,\r\n                    featureAmount: 12,\r\n                },\r\n                { name: \"Pitch sampled\", data: this.track.features.sampled.pitches, sampled: true, featureAmount: 12 },\r\n                {\r\n                    name: \"Major / Minor\",\r\n                    data: this.track.features.sampled.majorminor,\r\n                    sampled: true,\r\n                    featureAmount: 1,\r\n                    range: [-1, 1],\r\n                },\r\n                {\r\n                    name: \"Chords\",\r\n                    data: this.track.chordsVector,\r\n                    sampled: true,\r\n                    featureAmount: 24,\r\n                    range: [0, 1],\r\n                },\r\n                {\r\n                    name: \"Timbre raw\",\r\n                    data: this.track.features.raw.timbres,\r\n                    sampled: false,\r\n                    range: [-300, 300],\r\n                    featureAmount: 12,\r\n                },\r\n                {\r\n                    name: \"Timbre processed\",\r\n                    data: this.track.features.processed.timbres,\r\n                    sampled: false,\r\n                    range: [-1, 1],\r\n                    featureAmount: 12,\r\n                },\r\n                {\r\n                    name: \"Timbre Sampled\",\r\n                    data: this.track.features.sampled.timbres,\r\n                    sampled: true,\r\n                    range: [-1, 1],\r\n                    featureAmount: 12,\r\n                },\r\n                {\r\n                    name: \"Timbre Sampled Averaged\",\r\n                    data: filter.gaussianBlurFeatures(this.track.features.sampled.timbres, 5),\r\n                    sampled: true,\r\n                    range: [-1, 1],\r\n                    featureAmount: 12,\r\n                },\r\n                {\r\n                    name: \"Frankenfeatures Sampled\",\r\n                    data: this.track.features.sampled.frankenFeatures,\r\n                    sampled: true,\r\n                    range: [-1, 1],\r\n                    featureAmount: 12,\r\n                },\r\n                {\r\n                    name: \"smoothed Sampled\",\r\n                    data: this.track.features.sampled.smoothedTimbre,\r\n                    sampled: true,\r\n                    range: [-1, 1],\r\n                    featureAmount: 12,\r\n                },\r\n            ];\r\n            this.webGLPitchTimbre.setHeight(this.height);\r\n            this.webGLPitchTimbre.fillpitchTimbreBufferPool(this.track, this.selectedFeatures);\r\n            this.applyRenderMode();\r\n        });\r\n    },\r\n    methods: {\r\n        draw() {\r\n            log.debug(\"Redraw\");\r\n            this.webGLPitchTimbre.clear();\r\n            this.webGLPitchTimbre.draw(this.xCenterPositionNormalized, this.zoomed ? this.zoomScale : 1, 1);\r\n        },\r\n        applyRenderMode() {\r\n            clearInterval(this.drawLoop);\r\n            if (this.zoomed) {\r\n                this.draw();\r\n                //this.drawLoop = setInterval(this.draw, this.$store.getters.seekerUpdateSpeed*5);\r\n            } else {\r\n                this.draw();\r\n            }\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.GTcanvas {\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PitchTimbre.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PitchTimbre.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PitchTimbre.vue?vue&type=template&id=03d7874a&\"\nimport script from \"./PitchTimbre.vue?vue&type=script&lang=js&\"\nexport * from \"./PitchTimbre.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PitchTimbre.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[(_vm.hasStructure)?_c('div',[_vm._l((_vm.track.structures),function(structure){return _c('div',{key:structure.name,staticClass:\"structure\"},[_c('v-row',{staticClass:\"mb-0 pt-2\"},[(!structure.separateByGroup)?_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){return _vm.clickStructureUnfold(structure)}}},[_c('v-icon',[_vm._v(\" \"+_vm._s(structure.verticalPosition ? \"mdi-unfold-less-horizontal\" : \"mdi-unfold-more-horizontal\")+\" \")])],1):_vm._e(),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\",\"color\":structure.showLoudness ? 'white' : 'dimgrey'},on:{\"click\":function($event){return _vm.clickStructureshowLoudness(structure)}}},[_c('v-icon',[_vm._v(\"mdi-equalizer\")])],1),_c('p',[_vm._v(_vm._s(structure.name))]),_c('v-spacer'),_c('div',{staticStyle:{\"width\":\"6em\"}},[_c('v-btn',{attrs:{\"small\":\"\",\"icon\":\"\"},on:{\"click\":function($event){return _vm.clickStructureChangeVertical(structure)}}},[_c('v-icon',{attrs:{\"dark\":\"\"}},[_vm._v(\"mdi-format-line-spacing\")])],1),_c('span',{staticStyle:{\"color\":\"grey\"}},[_vm._v(\" \"+_vm._s(structure.vertLayout || _vm.layouts[0])+\" \")])],1),_c('div',{staticStyle:{\"width\":\"6em\"}},[_c('v-btn',{attrs:{\"small\":\"\",\"icon\":\"\"},on:{\"click\":function($event){return _vm.clickStructureChangeColor(structure)}}},[_c('v-icon',{attrs:{\"dark\":\"\"}},[_vm._v(\"mdi-palette\")])],1),_c('span',{staticStyle:{\"color\":\"grey\"}},[_vm._v(\" \"+_vm._s(structure.colorLayout || _vm.layouts[0])+\" \")])],1),_c('div',{staticStyle:{\"width\":\"2.5em\"}})],1),_c('Seeker',{ref:'seeker' + structure.name,refInFor:true,staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.heightOfStructure(structure)}}),_c('svg',{staticClass:\"structureSVG\",attrs:{\"width\":_vm.width,\"height\":_vm.heightOfStructure(structure)},on:{\"mouseout\":function($event){return _vm.unhover()}}},[_c('rect',{staticClass:\"structureBackground\",attrs:{\"x\":\"0\",\"y\":\"0\",\"width\":_vm.width,\"height\":_vm.heightOfStructure(structure),\"fill\":\"#1a1a1a\"},on:{\"click\":function($event){return _vm.clickBackground($event, structure)},\"mouseover\":function($event){return _vm.unhover()},\"mouseout\":function($event){return _vm.unhover()}}}),_vm._l((structure.data),function(section,index){return _c('g',{key:index},[(!structure.showLoudness)?_c('rect',{staticClass:\"section\",attrs:{\"stroke\":\"none\",\"stroke-width\":\".5\",\"rx\":\"5\",\"x\":section.start * _vm.scale,\"y\":_vm.sectionVerticalPosition(structure, section),\"width\":(section.end - section.start) * _vm.scale,\"height\":_vm.blockHeight,\"fill\":_vm.sectionColor(structure, section)},on:{\"mouseover\":function($event){return _vm.hoverSection($event, section, structure)},\"mouseout\":function($event){return _vm.unhoverSection(section)},\"click\":function($event){return _vm.clickSection($event, section)}}}):_vm._e(),(structure.showLoudness)?_c('path',{staticClass:\"shapedSection\",attrs:{\"d\":_vm.generatePointsForShapedSection(structure, section),\"fill\":_vm.sectionColor(structure, section)},on:{\"mouseover\":function($event){return _vm.hoverSection($event, section, structure)},\"mouseout\":function($event){return _vm.unhoverSection(section)},\"click\":function($event){return _vm.clickSection($event, section)}}}):_vm._e()])})],2),(_vm.hasStructure)?_c('MDS',{attrs:{\"size\":_vm.width / 3,\"sections\":structure.data}}):_vm._e()],1)}),_c('v-tooltip',{staticClass:\"tooltip\",attrs:{\"id\":\"tooltip\",\"bottom\":\"\"},model:{value:(_vm.showTooltip),callback:function ($$v) {_vm.showTooltip=$$v},expression:\"showTooltip\"}},[_c('div',{domProps:{\"innerHTML\":_vm._s(_vm.toolTipText)}})])],2):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('svg',{staticClass:\"mdsSVG\",staticStyle:{\"background\":\"#222222\"},attrs:{\"width\":_vm.size * 2,\"height\":_vm.size}},[_vm._l((_vm.sections),function(section,index){return _c('circle',{key:index + 'mdsCourse' + section.length,attrs:{\"cx\":_vm.size / 2 + (_vm.size / 2) * section.colorRadius * Math.cos(section.colorAngle * 2 * Math.PI),\"cy\":_vm.size / 2 + (_vm.size / 2) * section.colorRadius * Math.sin(section.colorAngle * 2 * Math.PI),\"r\":\"4\",\"fill\":_vm.sectionColor(section)}})}),_vm._l((_vm.sections),function(section,index){return _c('circle',{key:index + 'mdsCourseLin' + section.length,attrs:{\"cx\":_vm.size + _vm.size / 2 + (_vm.size / 2) * section.mdsFeature,\"cy\":_vm.size / 2,\"r\":\"4\",\"fill\":_vm.sectionColor(section)}})})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <svg class=\"mdsSVG\" :width=\"size * 2\" :height=\"size\" style=\"background: #222222\">\r\n        <circle\r\n            v-for=\"(section, index) in sections\"\r\n            :key=\"index + 'mdsCourse' + section.length\"\r\n            :cx=\"size / 2 + (size / 2) * section.colorRadius * Math.cos(section.colorAngle * 2 * Math.PI)\"\r\n            :cy=\"size / 2 + (size / 2) * section.colorRadius * Math.sin(section.colorAngle * 2 * Math.PI)\"\r\n            r=\"4\"\r\n            :fill=\"sectionColor(section)\"\r\n        ></circle>\r\n        <circle\r\n            v-for=\"(section, index) in sections\"\r\n            :key=\"index + 'mdsCourseLin' + section.length\"\r\n            :cx=\"size + size / 2 + (size / 2) * section.mdsFeature\"\r\n            :cy=\"size / 2\"\r\n            r=\"4\"\r\n            :fill=\"sectionColor(section)\"\r\n        ></circle>\r\n    </svg>\r\n</template>\r\n\r\n<script>\r\nimport * as vis from \"../../app/vis\";\r\nimport * as log from \"../../dev/log\";\r\n\r\nexport default {\r\n    props: [\"sections\", \"size\"],\r\n    components: {},\r\n    data() {\r\n        return {};\r\n    },\r\n    computed: {},\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {\r\n        sectionColor(section) {\r\n            return vis.sinebowColorNormalizedRadius(section.colorAngle, section.colorRadius, 1);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped></style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MDS.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MDS.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MDS.vue?vue&type=template&id=47405be8&scoped=true&\"\nimport script from \"./MDS.vue?vue&type=script&lang=js&\"\nexport * from \"./MDS.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"47405be8\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n    <div>\r\n        <div v-if=\"hasStructure\">\r\n            <div class=\"structure\" v-for=\"structure in track.structures\" :key=\"structure.name\">\r\n                <v-row class=\"mb-0 pt-2\">\r\n                    <v-btn v-if=\"!structure.separateByGroup\" icon small @click=\"clickStructureUnfold(structure)\">\r\n                        <v-icon>\r\n                            {{\r\n                                structure.verticalPosition ? \"mdi-unfold-less-horizontal\" : \"mdi-unfold-more-horizontal\"\r\n                            }}\r\n                        </v-icon>\r\n                    </v-btn>\r\n                    <v-btn\r\n                        icon\r\n                        small\r\n                        @click=\"clickStructureshowLoudness(structure)\"\r\n                        :color=\"structure.showLoudness ? 'white' : 'dimgrey'\"\r\n                    >\r\n                        <v-icon>mdi-equalizer</v-icon>\r\n                    </v-btn>\r\n                    <p>{{ structure.name }}</p>\r\n                    <v-spacer></v-spacer>\r\n                    <div style=\"width: 6em\">\r\n                        <v-btn small icon @click=\"clickStructureChangeVertical(structure)\">\r\n                            <v-icon dark>mdi-format-line-spacing</v-icon>\r\n                        </v-btn>\r\n                        <span style=\"color: grey\">\r\n                            {{ structure.vertLayout || layouts[0] }}\r\n                        </span>\r\n                    </div>\r\n                    <div style=\"width: 6em\">\r\n                        <v-btn small icon @click=\"clickStructureChangeColor(structure)\">\r\n                            <v-icon dark>mdi-palette</v-icon>\r\n                        </v-btn>\r\n                        <span style=\"color: grey\">\r\n                            {{ structure.colorLayout || layouts[0] }}\r\n                        </span>\r\n                    </div>\r\n                    <div style=\"width: 2.5em\"></div>\r\n                </v-row>\r\n\r\n                <Seeker\r\n                    class=\"seeker\"\r\n                    :ref=\"'seeker' + structure.name\"\r\n                    :width=\"width\"\r\n                    :height=\"heightOfStructure(structure)\"\r\n                />\r\n                <svg class=\"structureSVG\" :width=\"width\" :height=\"heightOfStructure(structure)\" @mouseout=\"unhover()\">\r\n                    <rect\r\n                        class=\"structureBackground\"\r\n                        x=\"0\"\r\n                        y=\"0\"\r\n                        :width=\"width\"\r\n                        :height=\"heightOfStructure(structure)\"\r\n                        @click=\"clickBackground($event, structure)\"\r\n                        @mouseover=\"unhover()\"\r\n                        @mouseout=\"unhover()\"\r\n                        fill=\"#1a1a1a\"\r\n                    ></rect>\r\n                    <g v-for=\"(section, index) in structure.data\" :key=\"index\">\r\n                        <rect\r\n                            v-if=\"!structure.showLoudness\"\r\n                            class=\"section\"\r\n                            stroke=\"none\"\r\n                            stroke-width=\".5\"\r\n                            rx=\"5\"\r\n                            @mouseover=\"hoverSection($event, section, structure)\"\r\n                            @mouseout=\"unhoverSection(section)\"\r\n                            @click=\"clickSection($event, section)\"\r\n                            :x=\"section.start * scale\"\r\n                            :y=\"sectionVerticalPosition(structure, section)\"\r\n                            :width=\"(section.end - section.start) * scale\"\r\n                            :height=\"blockHeight\"\r\n                            :fill=\"sectionColor(structure, section)\"\r\n                        ></rect>\r\n                        <path\r\n                            v-if=\"structure.showLoudness\"\r\n                            class=\"shapedSection\"\r\n                            :d=\"generatePointsForShapedSection(structure, section)\"\r\n                            @mouseover=\"hoverSection($event, section, structure)\"\r\n                            @mouseout=\"unhoverSection(section)\"\r\n                            @click=\"clickSection($event, section)\"\r\n                            :fill=\"sectionColor(structure, section)\"\r\n                        ></path>\r\n                    </g>\r\n                </svg>\r\n                <MDS v-if=\"hasStructure\" :size=\"width / 3\" :sections=\"structure.data\"></MDS>\r\n            </div>\r\n\r\n            <v-tooltip id=\"tooltip\" class=\"tooltip\" v-model=\"showTooltip\" bottom\r\n                ><div v-html=\"toolTipText\"></div\r\n            ></v-tooltip>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\nimport * as player from \"../../app/player\";\r\nimport Vue from \"vue\";\r\nimport MDS from \"./MDS\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n        MDS,\r\n    },\r\n    data() {\r\n        return {\r\n            titleHeight: 16,\r\n            blockHeight: 20,\r\n            showTooltip: false,\r\n            tooltipTimeout: null,\r\n            toolTipText: \"\",\r\n            tooltipTime: 200,\r\n            verticalPositionScale: 4.5,\r\n            layouts: [\"circular\", \"linear\", \"cluster\"],\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        zoomed() {\r\n            return this.$store.getters.isZoomed;\r\n        },\r\n        hasStructure() {\r\n            return this.track && this.track.structures.length > 0;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        averageLoudness() {\r\n            return this.track && this.track.features.sampled.smoothedAvgLoudness;\r\n        },\r\n    },\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {\r\n        getAmountOfUniqueLabels(structure) {\r\n            if (structure.groupAmount) return structure.groupAmount;\r\n            const groupIDs = [];\r\n            structure.data.forEach((section, index) => {\r\n                if (!groupIDs.includes(section.groupID)) {\r\n                    groupIDs.push(section.groupID);\r\n                }\r\n            });\r\n            structure.groupAmount = groupIDs.length;\r\n            return structure.groupAmount;\r\n        },\r\n        heightOfStructure(structure) {\r\n            if (structure.verticalPosition && structure.vertLayout === \"cluster\") {\r\n                return this.getAmountOfUniqueLabels(structure) * this.blockHeight;\r\n            }\r\n            return (\r\n                (structure.verticalPosition\r\n                    ? this.verticalPositionScale + 1\r\n                    : structure.separateByGroup\r\n                    ? this.getAmountOfUniqueLabels(structure)\r\n                    : 1) * this.blockHeight\r\n            );\r\n        },\r\n        sectionColor(structure, section) {\r\n            if (\r\n                section.groupID !== undefined &&\r\n                section.mdsFeature === undefined &&\r\n                section.colorRadius === undefined\r\n            ) {\r\n                structure.colorLayout = \"cluster\";\r\n            }\r\n            switch (structure.colorLayout) {\r\n                case \"cluster\":\r\n                    return vis.categoryColorWithOpacity(\r\n                        section.groupID,\r\n                        Math.sqrt(section.confidence !== undefined ? section.confidence : 1)\r\n                    );\r\n                case \"linear\":\r\n                    return vis.zeroOneColorWarm(section.mdsFeature);\r\n                default:\r\n                case \"circular\":\r\n                    return vis.sinebowColorNormalizedRadius(section.colorAngle, section.colorRadius, 1);\r\n            }\r\n        },\r\n        sectionVerticalPosition(structure, section) {\r\n            if (\r\n                section.groupID !== undefined &&\r\n                section.mdsFeature === undefined &&\r\n                section.colorRadius === undefined\r\n            ) {\r\n                structure.vertLayout = \"cluster\";\r\n            }\r\n            if (structure.verticalPosition) {\r\n                switch (structure.vertLayout) {\r\n                    case \"cluster\":\r\n                        return section.groupID * this.blockHeight;\r\n                    case \"linear\":\r\n                        return section.mdsFeature * this.blockHeight * this.verticalPositionScale;\r\n                    default:\r\n                    case \"circular\":\r\n                        return section.colorAngle * this.blockHeight * this.verticalPositionScale;\r\n                }\r\n            } else if (structure.separateByGroup) {\r\n                return section.groupID * this.blockHeight;\r\n            } else {\r\n                return 0;\r\n            }\r\n        },\r\n        sectionBorderColor(section) {\r\n            return vis.categoryColorWithOpacity(\r\n                section.groupID,\r\n                Math.max(0, Math.sqrt(section.confidence !== undefined ? section.confidence : 1) - 0.5)\r\n            );\r\n        },\r\n        hoverSection(event, section, structure) {\r\n            this.tooltipTimeout = setTimeout(() => {\r\n                this.toolTipText = `\r\n                Label: ${section.groupID} <br /> \r\n                Confidence: ${parseFloat(section.confidence).toFixed(2)} <br /> \r\n                [${parseFloat(section.start).toFixed(2)}, ${parseFloat(section.end).toFixed(2)}] <br /> \r\n                Duration: ${parseFloat(section.end - section.start).toFixed(2)} <br /> \r\n                ColorAngle: ${parseFloat(section.colorAngle).toFixed(2)} <br />\r\n                MDSFeature: ${parseFloat(section.mdsFeature).toFixed(2)} <br />\r\n                NormScore: ${parseFloat(section.normalizedScore).toFixed(2)} <br /> \r\n                NormCoverage: ${parseFloat(section.normalizedCoverage).toFixed(2)} <br /> \r\n                Fitness: ${parseFloat(section.fitness).toFixed(2)}\r\n                `;\r\n                setTimeout(() => {\r\n                    let tooltips = document.getElementsByClassName(\"v-tooltip__content\");\r\n                    tooltips.forEach((tool) => {\r\n                        tool.style.left = event.pageX - event.offsetX + section.start * this.scale + \"px\";\r\n                        tool.style.top =\r\n                            event.pageY -\r\n                            event.offsetY +\r\n                            (structure.separateByGroup ? section.groupID + 1 : 1) * this.blockHeight +\r\n                            \"px\";\r\n                    });\r\n                }, 0);\r\n                this.showTooltip = true;\r\n            }, this.tooltipTime);\r\n        },\r\n        unhoverSection(section) {\r\n            this.unhover();\r\n        },\r\n        unhover() {\r\n            this.showTooltip = false;\r\n            clearTimeout(this.tooltipTimeout);\r\n        },\r\n        clickSection(event, section) {\r\n            if (event.shiftKey) {\r\n                const startInSamples = section.start / this.track.features.sampleDuration;\r\n                const endInSamples = section.end / this.track.features.sampleDuration;\r\n                this.track.updateDTW(startInSamples, endInSamples);\r\n            } else {\r\n                player.seekS(section.start);\r\n            }\r\n        },\r\n        clickBackground(event, structure) {\r\n            this.$refs[\"seeker\" + structure.name][0].clickedSVG(event);\r\n        },\r\n        clickStructureUnfold(structure) {\r\n            if (structure.verticalPosition === undefined) {\r\n                // To make object reactive\r\n                Vue.set(structure, \"verticalPosition\", true);\r\n            } else {\r\n                structure.verticalPosition = !structure.verticalPosition;\r\n            }\r\n        },\r\n        clickStructureshowLoudness(structure) {\r\n            if (structure.showLoudness === undefined) {\r\n                // To make object reactive\r\n                Vue.set(structure, \"showLoudness\", true);\r\n            } else {\r\n                structure.showLoudness = !structure.showLoudness;\r\n            }\r\n        },\r\n        clickStructureChangeColor(structure) {\r\n            if (structure.colorLayout === undefined) {\r\n                Vue.set(structure, \"colorLayout\", this.layouts[1]);\r\n            } else {\r\n                const currentIndex = this.layouts.indexOf(structure.colorLayout);\r\n                let nextIndex = (currentIndex + 1) % this.layouts.length;\r\n                if (\r\n                    this.layouts[nextIndex] === \"cluster\" &&\r\n                    this.getAmountOfUniqueLabels(structure) === structure.data.length\r\n                ) {\r\n                    nextIndex = (nextIndex + 1) % this.layouts.length;\r\n                }\r\n                structure.colorLayout = this.layouts[nextIndex];\r\n            }\r\n        },\r\n        clickStructureChangeVertical(structure) {\r\n            if (structure.vertLayout === undefined) {\r\n                Vue.set(structure, \"vertLayout\", this.layouts[1]);\r\n            } else {\r\n                const currentIndex = this.layouts.indexOf(structure.vertLayout);\r\n                let nextIndex = (currentIndex + 1) % this.layouts.length;\r\n                if (\r\n                    this.layouts[nextIndex] === \"cluster\" &&\r\n                    this.getAmountOfUniqueLabels(structure) === structure.data.length\r\n                ) {\r\n                    nextIndex = (nextIndex + 1) % this.layouts.length;\r\n                }\r\n                structure.vertLayout = this.layouts[nextIndex];\r\n            }\r\n        },\r\n        generatePointsForShapedSection(structure, section) {\r\n            const x = Math.round(section.start * this.scale);\r\n            const y = this.sectionVerticalPosition(structure, section);\r\n            const width = Math.round((section.end - section.start) * this.scale);\r\n            const halfHeight = this.blockHeight / 2;\r\n            const yMid = y + halfHeight;\r\n            const heightFactor = 1 / this.track.features.maxLoudness;\r\n\r\n            const startInSamples = Math.floor(section.start / this.track.features.sampleDuration);\r\n            const endInSamples = Math.floor(section.end / this.track.features.sampleDuration);\r\n            const durationInSamples = endInSamples - startInSamples;\r\n\r\n            const sampleSkip = 3;\r\n            let rx = 1; // in pixels\r\n            if (width < rx * 2 + sampleSkip) {\r\n                rx = Math.max(0, Math.floor((width - sampleSkip) / 2));\r\n            }\r\n            const sampleAmount = this.track.features.sampleAmount;\r\n            const endOffsetInSamples = Math.round((rx / this.width) * sampleAmount); // scale with sampleamount\r\n            const endOffsetAbsolute = rx;\r\n\r\n            const startYHalfNeg = Math.round(\r\n                yMid - 0.8 * this.averageLoudness[endOffsetInSamples] * halfHeight * heightFactor\r\n            );\r\n            const startYPNeg = Math.round(yMid - this.averageLoudness[endOffsetInSamples] * halfHeight * heightFactor);\r\n            let points = `M ${x} ${Math.round(yMid)} L ${x} ${startYHalfNeg} Q ${x} ${startYPNeg}`;\r\n\r\n            for (let i = startInSamples; i < endInSamples; i++) {\r\n                if (i === startInSamples + endOffsetInSamples) {\r\n                    const pointX = Math.round(x + ((i - startInSamples) / durationInSamples) * width);\r\n                    const pointY = Math.round(yMid - this.averageLoudness[i] * halfHeight * heightFactor);\r\n                    points = points.concat(\", \", pointX, \" \", pointY);\r\n                } else if (i === endInSamples - 1 - endOffsetInSamples) {\r\n                    const pointX = Math.round(x + ((i - startInSamples) / durationInSamples) * width);\r\n                    const pointY = Math.round(yMid - this.averageLoudness[i] * halfHeight * heightFactor);\r\n                    points = points.concat(\" L \", pointX, \" \", pointY);\r\n                    points = points.concat(\r\n                        \" Q \",\r\n                        Math.round(x + width - 1),\r\n                        \" \",\r\n                        pointY,\r\n                        \",\",\r\n                        Math.round(x + width - 1),\r\n                        \" \",\r\n                        yMid\r\n                    );\r\n                } else if (\r\n                    i > startInSamples + endOffsetInSamples &&\r\n                    i < endInSamples - 1 - endOffsetInSamples &&\r\n                    i % sampleSkip === 0\r\n                ) {\r\n                    const pointX = Math.round(x + ((i - startInSamples) / durationInSamples) * width);\r\n                    const pointY = Math.round(yMid - this.averageLoudness[i] * halfHeight * heightFactor);\r\n                    points = points.concat(\" L \", pointX, \" \", pointY);\r\n                }\r\n            }\r\n            for (let i = endInSamples - 1; i >= startInSamples; i--) {\r\n                if (i === endInSamples - 1 - endOffsetInSamples) {\r\n                    const pointX = Math.round(x + ((i - startInSamples) / durationInSamples) * width);\r\n                    const pointY = Math.round(yMid + this.averageLoudness[i] * halfHeight * heightFactor);\r\n                    points = points.concat(\" Q \", Math.round(x + width - 1), \" \", pointY, \",\", pointX, \" \", pointY);\r\n                } else if (i === startInSamples + endOffsetInSamples) {\r\n                    const pointX = Math.round(x + ((i - startInSamples) / durationInSamples) * width);\r\n                    const pointY = Math.round(yMid + this.averageLoudness[i] * halfHeight * heightFactor);\r\n                    points = points.concat(\" L \", pointX, \" \", pointY);\r\n                } else if (\r\n                    i > startInSamples + endOffsetInSamples &&\r\n                    i < endInSamples - 1 - endOffsetInSamples &&\r\n                    i % sampleSkip === 0\r\n                ) {\r\n                    const pointX = Math.round(x + ((i - startInSamples) / durationInSamples) * width);\r\n                    const pointY = Math.round(yMid + this.averageLoudness[i] * halfHeight * heightFactor);\r\n                    points = points.concat(\" L \", pointX, \" \", pointY);\r\n                }\r\n            }\r\n\r\n            const startYHalfPos = Math.round(\r\n                yMid + 0.8 * this.averageLoudness[endOffsetInSamples] * halfHeight * heightFactor\r\n            );\r\n            const startYPos = Math.round(yMid + this.averageLoudness[endOffsetInSamples] * halfHeight * heightFactor);\r\n            points = points.concat(` Q ${x} ${startYPos}, ${x} ${startYHalfPos} Z`);\r\n            return points;\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.seeker {\r\n    pointer-events: none;\r\n}\r\n.structureSVG {\r\n    pointer-events: all;\r\n    transition: height 0.4s;\r\n}\r\n.structureBackground {\r\n    transition: height 0.4s;\r\n}\r\n.section {\r\n    pointer-events: all;\r\n    transition: fill 0.3s, y 0.4s;\r\n}\r\n.shapedSection {\r\n    pointer-events: all;\r\n    transition: 0.3s;\r\n    stroke-linejoin: round;\r\n}\r\n.shapedSection:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n.section:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n.tooltip {\r\n    white-space: pre-line !important;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Structure.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Structure.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Structure.vue?vue&type=template&id=7a056106&scoped=true&\"\nimport script from \"./Structure.vue?vue&type=script&lang=js&\"\nexport * from \"./Structure.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Structure.vue?vue&type=style&index=0&id=7a056106&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7a056106\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VTooltip } from 'vuetify/lib/components/VTooltip';\ninstallComponents(component, {VBtn,VIcon,VRow,VSpacer,VTooltip})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"pt-5\"},[_c('v-row',[_c('v-col',[_vm._v(\"Repetition \")]),_c('v-spacer'),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\",\"color\":_vm.showLoudness ? 'white' : 'dimgrey'},on:{\"click\":function($event){_vm.showLoudness = !_vm.showLoudness}}},[_c('v-icon',[_vm._v(\"mdi-equalizer\")])],1),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\",\"color\":_vm.catColoring ? 'white' : 'dimgrey'},on:{\"click\":function($event){_vm.catColoring = !_vm.catColoring}}},[_c('v-icon',{attrs:{\"dark\":\"\"}},[_vm._v(\"mdi-palette\")])],1),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.showHelp = !_vm.showHelp}}},[_c('v-icon',{attrs:{\"color\":\"#ccc\",\"dark\":\"\"}},[_vm._v(\"mdi-help-box\")])],1),_c('Tooltip',{attrs:{\"show\":_vm.showHelp}},[_vm._v(\" This visualization shows section blocks, where each row/group of blocks represent repeating harmonic sequences. For example, in many songs, a section block will represent a repeated chord progression. The \"),_c('v-icon',{attrs:{\"dark\":\"\",\"small\":\"\",\"color\":\"#ccc\"}},[_vm._v(\"mdi-palette\")]),_vm._v(\" button switches colours to show either the harmonic sequential similarity within a group, or between groups. The \"),_c('v-icon',{attrs:{\"dark\":\"\",\"small\":\"\",\"color\":\"#ccc\"}},[_vm._v(\"mdi-equalizer\")]),_vm._v(\" button toggles the embedding of loudnenss in the visualization. \")],1)],1),(_vm.hasStructure)?_c('Seeker',{ref:'holisticSeeker',staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.height,\"color\":'rgb(255,255,255,0.3)',\"drawMarkers\":false}}):_vm._e(),(_vm.hasStructure)?_c('svg',{staticClass:\"structureSVG\",attrs:{\"width\":_vm.width,\"height\":_vm.height},on:{\"contextmenu\":function($event){$event.preventDefault();return _vm.rightClick($event)}}},[_c('SeparatorBackground',{attrs:{\"width\":_vm.width,\"height\":_vm.height,\"scale\":_vm.scale}}),_c('rect',{staticClass:\"clickRect\",attrs:{\"id\":\"clickRect\",\"width\":_vm.width,\"height\":_vm.height},on:{\"click\":_vm.clicked}}),_c('rect',{staticClass:\"glowRect\"}),_vm._l((_vm.courseStructure),function(section,index){return _c('Section',{key:index + 'course',staticClass:\"structureSection\",attrs:{\"section\":section,\"height\":_vm.sectionHeight,\"scale\":_vm.scale,\"showLoudness\":_vm.showLoudness,\"coloring\":_vm.catColoring ? 'categoricalMDS' : 'circular',\"verticalOffset\":_vm.paddingTop,\"loop\":false}})}),(_vm.showFineStructure)?_c('g',_vm._l((_vm.fineStructure),function(section,index){return _c('Section',{key:index + 'fine',attrs:{\"section\":section,\"height\":_vm.sectionHeight,\"scale\":_vm.scale,\"verticalOffset\":_vm.paddingTop + _vm.spaceBetweenCourseFine + _vm.sectionHeight * _vm.groupAmount(_vm.courseStructure),\"showLoudness\":_vm.showLoudness,\"coloring\":'circular',\"loop\":false}})}),1):_vm._e(),_c('Markers',{ref:'markers',attrs:{\"width\":_vm.width,\"height\":_vm.height,\"opacity\":0.3}})],2):_vm._e(),(!_vm.hasStructure)?_c('v-skeleton-loader',{attrs:{\"width\":_vm.width,\"height\":_vm.sectionHeight * 3,\"type\":\"image\"}}):_vm._e(),(_vm.showMDS && _vm.hasStructure)?_c('MDS',{attrs:{\"size\":_vm.width / 3,\"sections\":_vm.courseStructure}}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',[_c('defs',[_c('linearGradient',{attrs:{\"id\":(\"glowRectGradient\" + (_vm.section.start) + (_vm.section.end)),\"x1\":\"0\",\"x2\":\"0\",\"y1\":\"0\",\"y2\":\"1\"}},[_c('stop',{style:((\"stop-color:\" + _vm.color + \";stop-opacity:0\")),attrs:{\"offset\":\"0\"}}),_c('stop',{style:((\"stop-color:\" + _vm.color + \";stop-opacity:\" + _vm.glowOpacity)),attrs:{\"offset\":\"0.5\"}}),_c('stop',{style:((\"stop-color:\" + _vm.color + \";stop-opacity:0\")),attrs:{\"offset\":\"1\"}})],1)],1),_c('rect',{staticClass:\"glowRect\",attrs:{\"fill\":(\"url(#glowRectGradient\" + (_vm.section.start) + (_vm.section.end) + \")\"),\"x\":_vm.x,\"y\":_vm.y + _vm.height / 2 - (_vm.seekerIsInSection ? _vm.glowRectSize() / 2 : 0),\"width\":_vm.width,\"height\":_vm.seekerIsInSection ? _vm.glowRectSize() : 0,\"opacity\":_vm.seekerIsInSection ? '1' : '0'}}),_c('path',{staticClass:\"shapedSection\",attrs:{\"d\":_vm.shapedSectionPath,\"fill\":_vm.color},on:{\"mouseover\":function($event){return _vm.hover($event)},\"mouseout\":function($event){return _vm.unhover()},\"click\":function($event){return _vm.click($event)}}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <g>\r\n        <defs>\r\n            <linearGradient :id=\"`glowRectGradient${section.start}${section.end}`\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\r\n                <stop offset=\"0\" :style=\"`stop-color:${color};stop-opacity:0`\" />\r\n                <stop offset=\"0.5\" :style=\"`stop-color:${color};stop-opacity:${glowOpacity}`\" />\r\n                <stop offset=\"1\" :style=\"`stop-color:${color};stop-opacity:0`\" />\r\n            </linearGradient>\r\n        </defs>\r\n        <rect\r\n            class=\"glowRect\"\r\n            :fill=\"`url(#glowRectGradient${section.start}${section.end})`\"\r\n            :x=\"x\"\r\n            :y=\"y + height / 2 - (seekerIsInSection ? glowRectSize() / 2 : 0)\"\r\n            :width=\"width\"\r\n            :height=\"seekerIsInSection ? glowRectSize() : 0\"\r\n            :opacity=\"seekerIsInSection ? '1' : '0'\"\r\n        >\r\n        </rect>\r\n        <path\r\n            class=\"shapedSection\"\r\n            :d=\"shapedSectionPath\"\r\n            :fill=\"color\"\r\n            @mouseover=\"hover($event)\"\r\n            @mouseout=\"unhover()\"\r\n            @click=\"click($event)\"\r\n        ></path>\r\n    </g>\r\n</template>\r\n\r\n<script>\r\nimport * as vis from \"../../app/vis\";\r\nimport * as log from \"../../dev/log\";\r\nimport * as player from \"../../app/player\";\r\nimport { sampleDuration } from \"../../app/Track\";\r\nimport * as audioUtil from \"../../app/audioUtil\";\r\nimport * as svgVariableWidthLine from \"svg-variable-width-line\";\r\nimport * as d3 from \"d3\";\r\n\r\nexport default {\r\n    props: [\r\n        \"section\",\r\n        \"height\",\r\n        \"scale\",\r\n        \"verticalOffset\",\r\n        \"containerHeight\",\r\n        \"showLoudness\",\r\n        \"coloring\",\r\n        \"positioning\",\r\n        \"loop\",\r\n    ],\r\n    components: {},\r\n    data() {\r\n        return {\r\n            glowOpacity: 0.4,\r\n            glowSize: 6,\r\n            seekerWasInSection: false,\r\n            noLoudness: 0.8,\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n\r\n        verticalPosition() {\r\n            switch (this.positioning) {\r\n                default:\r\n                case \"cluster\" || \"group\":\r\n                    return this.section.groupID * this.height + this.verticalOffset;\r\n                case \"circular\":\r\n                    return this.section.colorAngle * (this.containerHeight - this.height);\r\n                case \"linear\":\r\n                    return this.section.mdsFeature * (this.containerHeight - this.height);\r\n            }\r\n        },\r\n        color() {\r\n            switch (this.coloring) {\r\n                default:\r\n                case \"cluster\" || \"group\":\r\n                    return vis.goldenRatioCategoricalColor(this.section.groupID, 0, 1);\r\n                case \"circular\":\r\n                    return vis.sinebowColorNormalizedRadius(this.section.colorAngle, this.section.colorRadius, 1);\r\n                case \"categoricalMDS\":\r\n                    return vis.sinebowColorNormalizedRadius(this.section.catColorAngle, this.section.catColorRadius, 1);\r\n\r\n                case \"linear\":\r\n                    return vis.zeroOneColorWarm(this.section.mdsFeature);\r\n            }\r\n        },\r\n        seekerIsInSection() {\r\n            const isSeekerInSection =\r\n                this.$store.getters.seeker / 1000 >= this.section.start &&\r\n                this.$store.getters.seeker / 1000 < this.section.end;\r\n            return isSeekerInSection;\r\n        },\r\n\r\n        x() {\r\n            return this.section.start * this.scale;\r\n        },\r\n        y() {\r\n            return this.verticalOffset + this.verticalPosition;\r\n        },\r\n        width() {\r\n            return Math.max(1, (this.section.end - this.section.start) * this.scale - 2);\r\n        },\r\n        directLoudness() {\r\n            return this.track && this.track.features.directLoudness;\r\n        },\r\n        shapedSectionPath() {\r\n            const halfHeight = this.height / 2;\r\n            let roundoff = 4;\r\n            let step = 4 / this.width;\r\n            step = Math.max(0.001, step);\r\n\r\n            const yMid = (time) => {\r\n                if (this.section.graph === undefined) return this.y + halfHeight;\r\n                const factorOfWidth = (time - this.section.start) / (this.section.end - this.section.start);\r\n                const sampleInSection = Math.min(\r\n                    Math.floor(factorOfWidth * this.section.graph.length),\r\n                    this.section.graph.length - 1\r\n                );\r\n                const mdsValue = this.section.graph[sampleInSection];\r\n                return mdsValue * (this.containerHeight - this.height) + halfHeight;\r\n            };\r\n\r\n            const tooSmall = this.width <= roundoff * 2;\r\n            if (tooSmall) {\r\n                roundoff = this.width / 2;\r\n            }\r\n\r\n            const firstSample = Math.round((this.x + roundoff) / this.scale / this.track.features.sampleDuration);\r\n            const firstLoudness = this.showLoudness ? this.dynamics(firstSample) : this.noLoudness;\r\n            const firstYMid = yMid(this.section.start);\r\n\r\n            let lastSample = Math.floor(\r\n                (this.x + this.width - roundoff) / this.scale / this.track.features.sampleDuration\r\n            );\r\n\r\n            const lastLoudness = this.showLoudness ? this.dynamics(lastSample) : this.noLoudness;\r\n            const lastYMid = yMid(this.section.end);\r\n\r\n            let path = `M ${this.x} ${Math.round(firstYMid)} L ${this.x} ${firstYMid -\r\n                Math.max(0, halfHeight * firstLoudness - roundoff)} Q ${this.x} ${firstYMid -\r\n                halfHeight * firstLoudness}, ${this.x + roundoff} ${firstYMid - halfHeight * firstLoudness}`;\r\n\r\n            const startFraction = roundoff / this.width;\r\n            const endFraction = 1 - roundoff / this.width;\r\n\r\n            // Top\r\n            const pointXSet = [];\r\n            for (let i = startFraction + step; i < endFraction - step; i += step) {\r\n                const pointX = this.x + i * this.width;\r\n                pointXSet.push(pointX);\r\n                const sample = Math.round(pointX / this.scale / this.track.features.sampleDuration);\r\n                const loudness = this.showLoudness ? this.dynamics(sample) : this.noLoudness;\r\n                const pointY = yMid(pointX / this.scale) - halfHeight * loudness;\r\n                path = path.concat(\" L \", pointX, \" \", pointY);\r\n            }\r\n\r\n            // Turnaround on the right\r\n            path = path.concat(\" L \", this.x + this.width - roundoff, \" \", lastYMid - halfHeight * lastLoudness);\r\n            path = path.concat(\r\n                ` Q ${this.x + this.width} ${lastYMid - halfHeight * lastLoudness}, ${this.x + this.width} ${lastYMid -\r\n                    Math.max(0, halfHeight * lastLoudness - roundoff)} L ${this.x + this.width} ${lastYMid +\r\n                    Math.max(0, halfHeight * lastLoudness - roundoff)} Q ${this.x + this.width} ${lastYMid +\r\n                    halfHeight * lastLoudness}, ${this.x + this.width - roundoff} ${lastYMid +\r\n                    halfHeight * lastLoudness}`\r\n            );\r\n\r\n            // Bottom\r\n            pointXSet.reverse();\r\n            for (const pointX of pointXSet) {\r\n                const sample = Math.round(pointX / this.scale / this.track.features.sampleDuration);\r\n                const loudness = this.showLoudness ? this.dynamics(sample) : this.noLoudness;\r\n                const pointY = yMid(pointX / this.scale) + halfHeight * loudness;\r\n                path = path.concat(\" L \", pointX, \" \", pointY);\r\n            }\r\n\r\n            // close of path with last sample\r\n            path = path.concat(\r\n                ` L ${this.x + roundoff} ${firstYMid + halfHeight * firstLoudness} Q ${this.x} ${firstYMid +\r\n                    halfHeight * firstLoudness}, ${this.x} ${firstYMid +\r\n                    Math.max(0, halfHeight * firstLoudness - roundoff)} Z `\r\n            );\r\n\r\n            return path;\r\n        },\r\n    },\r\n    watch: {\r\n        seekerIsInSection() {\r\n            if (\r\n                this.loop &&\r\n                !this.seekerIsInSection &&\r\n                this.$store.getters.seeker / 1000 >= this.section.end &&\r\n                this.$store.getters.seeker / 1000 < this.section.end + 0.1\r\n            ) {\r\n                const offset = 0;\r\n                const timeExtra = this.$store.getters.seeker / 1000 - this.section.end;\r\n                setTimeout(() => {\r\n                    player.seekS(this.section.start + timeExtra);\r\n                }, offset * 1000);\r\n            }\r\n        },\r\n    },\r\n    mounted() {},\r\n    methods: {\r\n        dynamics(sample) {\r\n            return this.track.features.sampled.dynamics[sample];\r\n        },\r\n        loudnessTime(time) {\r\n            const sample = Math.floor(time / this.track.features.sampleDuration);\r\n            return this.dynamics(sample);\r\n        },\r\n        directLoudnessTime(time) {\r\n            const sample = Math.floor(time / this.track.features.directLoudnessSampleDuration);\r\n            return this.directLoudness[sample] / this.track.features.maxLoudness || 0;\r\n        },\r\n        hover(event) {},\r\n        unhover() {},\r\n        click(event) {\r\n            this.$store.commit(\"setInputFocus\", false);\r\n\r\n            log.debug(\"clicked\", audioUtil.keyNames[this.section.key]);\r\n            if (event.shiftKey) {\r\n                const startInSamples = this.section.start / this.track.features.sampleDuration;\r\n                const endInSamples = this.section.end / this.track.features.sampleDuration;\r\n                this.track.updateDTW(startInSamples, endInSamples);\r\n            } else {\r\n                player.seekS(this.section.start);\r\n            }\r\n        },\r\n        glowRectSize() {\r\n            return (\r\n                this.glowSize *\r\n                this.height *\r\n                (0.15 +\r\n                    this.directLoudnessTime(this.$store.getters.seeker / 1000) / 4 +\r\n                    Math.pow(this.loudnessTime(this.$store.getters.seeker / 1000), 1.5))\r\n            );\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.shapedSection {\r\n    z-index: 10;\r\n    pointer-events: all;\r\n    transition: 0.25s;\r\n    stroke-linejoin: round;\r\n}\r\n.glowRect {\r\n    z-index: -1;\r\n    pointer-events: none;\r\n    transition-timing-function: linear;\r\n    transition: 0.5s;\r\n}\r\n.shapedSection:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Section.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Section.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Section.vue?vue&type=template&id=163b000b&scoped=true&\"\nimport script from \"./Section.vue?vue&type=script&lang=js&\"\nexport * from \"./Section.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Section.vue?vue&type=style&index=0&id=163b000b&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"163b000b\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',_vm._l((_vm.separators),function(separator,index){return _c('g',{key:separator.start},[_c('defs',[_c('linearGradient',{attrs:{\"id\":(\"backgroundGradient\" + index),\"x1\":\"0\",\"x2\":\"0\",\"y1\":\"0\",\"y2\":\"1\"}},[_c('stop',{style:((\"stop-color:\" + (_vm.backgroundColor(separator)) + \";stop-opacity:1\")),attrs:{\"offset\":\"0%\"}}),_c('stop',{style:((\"stop-color:\" + (_vm.backgroundColor(separator)) + \";stop-opacity:1\")),attrs:{\"offset\":\"100%\"}})],1)],1),(_vm.showBackground)?_c('rect',{key:separator.start + 'bg',staticClass:\"background\",attrs:{\"x\":separator.start * _vm.scale - 1,\"y\":0,\"width\":(separator.end - separator.start) * _vm.scale,\"height\":_vm.height,\"fill\":(\"url(#backgroundGradient\" + index + \")\")},on:{\"click\":function($event){return _vm.click($event)}}}):_vm._e(),(_vm.showSeparators)?_c('rect',{staticClass:\"separator\",attrs:{\"x\":separator.start * _vm.scale - 1,\"y\":0,\"width\":3,\"height\":_vm.height,\"fill\":_vm.separatorColor(separator)}}):_vm._e()])}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <g>\r\n        <g v-for=\"(separator, index) in separators\" :key=\"separator.start\">\r\n            <defs>\r\n                <linearGradient :id=\"`backgroundGradient${index}`\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\r\n                    <stop offset=\"0%\" :style=\"`stop-color:${backgroundColor(separator)};stop-opacity:1`\" />\r\n                    <stop offset=\"100%\" :style=\"`stop-color:${backgroundColor(separator)};stop-opacity:1`\" />\r\n                </linearGradient>\r\n            </defs>\r\n            <rect\r\n                v-if=\"showBackground\"\r\n                class=\"background\"\r\n                :key=\"separator.start + 'bg'\"\r\n                :x=\"separator.start * scale - 1\"\r\n                :y=\"0\"\r\n                :width=\"(separator.end - separator.start) * scale\"\r\n                :height=\"height\"\r\n                :fill=\"`url(#backgroundGradient${index})`\"\r\n                @click=\"click($event)\"\r\n            >\r\n            </rect>\r\n            <rect\r\n                v-if=\"showSeparators\"\r\n                class=\"separator\"\r\n                :x=\"separator.start * scale - 1\"\r\n                :y=\"0\"\r\n                :width=\"3\"\r\n                :height=\"height\"\r\n                :fill=\"separatorColor(separator)\"\r\n            ></rect>\r\n        </g>\r\n    </g>\r\n</template>\r\n\r\n<script>\r\nimport * as vis from \"../../app/vis\";\r\nimport * as player from \"../../app/player\";\r\n\r\nexport default {\r\n    props: [\"width\", \"height\", \"scale\"],\r\n    components: {},\r\n    data() {\r\n        return {\r\n            showSeparators: false,\r\n            showBackground: false,\r\n            backgroundOpacity: 0.2,\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        separators() {\r\n            return this.track.separatorGenerator();\r\n        },\r\n    },\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {\r\n        backgroundColor(separator) {\r\n            return vis.goldenRatioCategoricalColor(separator.groupID, 0, 0.2);\r\n        },\r\n        separatorColor(separator) {\r\n            return vis.goldenRatioCategoricalColor(separator.groupID, 0, 0.5);\r\n        },\r\n        click(event) {\r\n            console.log(\"clicked\", event);\r\n            let xNormalized = 0;\r\n            let yNormalized = 0;\r\n            if (this.$store.state.browser === \"Firefox\") {\r\n                xNormalized = event.layerX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            } else {\r\n                xNormalized = event.offsetX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            }\r\n\r\n            if (this.useZoom && this.isZoomed) {\r\n                const xFromMiddle = xNormalized * 2 - 1;\r\n                const seekerPos = Math.min(\r\n                    1,\r\n                    Math.max(\r\n                        0,\r\n                        this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000) +\r\n                            xFromMiddle / (2 * this.zoomScale)\r\n                    )\r\n                );\r\n                player.seekS(seekerPos * this.track.getAnalysisDuration());\r\n            } else {\r\n                player.seekS(xNormalized * this.track.getAnalysisDuration());\r\n            }\r\n            this.$store.commit(\"setInputFocus\", false);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped></style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SeparatorBackground.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SeparatorBackground.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SeparatorBackground.vue?vue&type=template&id=3d560fa0&scoped=true&\"\nimport script from \"./SeparatorBackground.vue?vue&type=script&lang=js&\"\nexport * from \"./SeparatorBackground.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3d560fa0\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.show)?_c('div',{staticClass:\"tooltip\"},[_c('span',[_vm._t(\"default\")],2)]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div v-if=\"show\" class=\"tooltip\">\r\n        <span>\r\n            <slot></slot>\r\n        </span>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    props: [\"show\"],\r\n    components: {},\r\n    data() {\r\n        return {\r\n            showHelp: false,\r\n        };\r\n    },\r\n    computed: {},\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {},\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.tooltip {\r\n    color: #ccc;\r\n    position: relative;\r\n    transition: 0.5s;\r\n    margin-left: 10px;\r\n    margin-right: 10px;\r\n    margin-bottom: 5px;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tooltip.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tooltip.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Tooltip.vue?vue&type=template&id=5c5d57d2&scoped=true&\"\nimport script from \"./Tooltip.vue?vue&type=script&lang=js&\"\nexport * from \"./Tooltip.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Tooltip.vue?vue&type=style&index=0&id=5c5d57d2&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5c5d57d2\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n    <div class=\"pt-5\">\r\n        <v-row>\r\n            <v-col>Repetition </v-col>\r\n\r\n            <v-spacer></v-spacer>\r\n            <v-btn icon small @click=\"showLoudness = !showLoudness\" :color=\"showLoudness ? 'white' : 'dimgrey'\">\r\n                <v-icon>mdi-equalizer</v-icon>\r\n            </v-btn>\r\n            <v-btn icon small @click=\"catColoring = !catColoring\" :color=\"catColoring ? 'white' : 'dimgrey'\">\r\n                <v-icon dark>mdi-palette</v-icon>\r\n            </v-btn>\r\n            <v-btn icon small @click=\"showHelp = !showHelp\"> <v-icon color=\"#ccc\" dark>mdi-help-box</v-icon> </v-btn>\r\n            <Tooltip :show=\"showHelp\">\r\n                This visualization shows section blocks, where each row/group of blocks represent repeating harmonic\r\n                sequences. For example, in many songs, a section block will represent a repeated chord progression. The\r\n                <v-icon dark small color=\"#ccc\">mdi-palette</v-icon> button switches colours to show either the harmonic\r\n                sequential similarity within a group, or between groups. The\r\n                <v-icon dark small color=\"#ccc\">mdi-equalizer</v-icon> button toggles the embedding of loudnenss in the\r\n                visualization.\r\n            </Tooltip>\r\n        </v-row>\r\n        <Seeker\r\n            v-if=\"hasStructure\"\r\n            class=\"seeker\"\r\n            :ref=\"'holisticSeeker'\"\r\n            :width=\"width\"\r\n            :height=\"height\"\r\n            :color=\"'rgb(255,255,255,0.3)'\"\r\n            :drawMarkers=\"false\"\r\n        />\r\n        <svg v-if=\"hasStructure\" class=\"structureSVG\" :width=\"width\" :height=\"height\" @contextmenu.prevent=\"rightClick\">\r\n            <SeparatorBackground :width=\"width\" :height=\"height\" :scale=\"scale\" />\r\n            <rect class=\"clickRect\" id=\"clickRect\" :width=\"width\" :height=\"height\" @click=\"clicked\"></rect>\r\n\r\n            <rect class=\"glowRect\"></rect>\r\n            <Section\r\n                class=\"structureSection\"\r\n                v-for=\"(section, index) in courseStructure\"\r\n                :key=\"index + 'course'\"\r\n                :section=\"section\"\r\n                :height=\"sectionHeight\"\r\n                :scale=\"scale\"\r\n                :showLoudness=\"showLoudness\"\r\n                :coloring=\"catColoring ? 'categoricalMDS' : 'circular'\"\r\n                :verticalOffset=\"paddingTop\"\r\n                :loop=\"false\"\r\n            />\r\n            <g v-if=\"showFineStructure\">\r\n                <Section\r\n                    v-for=\"(section, index) in fineStructure\"\r\n                    :key=\"index + 'fine'\"\r\n                    :section=\"section\"\r\n                    :height=\"sectionHeight\"\r\n                    :scale=\"scale\"\r\n                    :verticalOffset=\"paddingTop + spaceBetweenCourseFine + sectionHeight * groupAmount(courseStructure)\"\r\n                    :showLoudness=\"showLoudness\"\r\n                    :coloring=\"'circular'\"\r\n                    :loop=\"false\"\r\n                />\r\n            </g>\r\n            <Markers :ref=\"'markers'\" :width=\"width\" :height=\"height\" :opacity=\"0.3\"></Markers>\r\n        </svg>\r\n        <v-skeleton-loader\r\n            v-if=\"!hasStructure\"\r\n            :width=\"width\"\r\n            :height=\"sectionHeight * 3\"\r\n            type=\"image\"\r\n        ></v-skeleton-loader>\r\n        <MDS v-if=\"showMDS && hasStructure\" :size=\"width / 3\" :sections=\"courseStructure\"></MDS>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport Section from \"./Section\";\r\nimport Markers from \"./Markers\";\r\nimport MDS from \"./MDS\";\r\n\r\nimport SeparatorBackground from \"./SeparatorBackground\";\r\nimport Tooltip from \"./Tooltip.vue\";\r\n\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\nimport * as player from \"../../app/player\";\r\nimport Vue from \"vue\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n        SeparatorBackground,\r\n        Section,\r\n        Markers,\r\n        MDS,\r\n        Tooltip,\r\n    },\r\n    data() {\r\n        return {\r\n            paddingTop: 10,\r\n            sectionHeight: 25,\r\n            spaceBetweenCourseFine: 50,\r\n            showFineStructure: false,\r\n            showLoudness: true,\r\n            showMDS: false,\r\n            catColoring: false,\r\n            showHelp: false,\r\n        };\r\n    },\r\n    computed: {\r\n        height() {\r\n            let height = 0;\r\n            height += this.paddingTop;\r\n            height += this.groupAmount(this.courseStructure) * this.sectionHeight;\r\n            height += this.spaceBetweenCourseFine;\r\n            if (this.showFineStructure) {\r\n                height += this.groupAmount(this.fineStructure) * this.sectionHeight;\r\n            }\r\n            return height;\r\n        },\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        hasStructure() {\r\n            return this.track && this.track.harmonicStructureCourse && this.track.harmonicStructureCourse.length > 0;\r\n        },\r\n        courseStructure() {\r\n            return this.track.harmonicStructureCourse;\r\n        },\r\n        fineStructure() {\r\n            return this.track.harmonicStructureFine;\r\n        },\r\n    },\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {\r\n        groupAmount(structure) {\r\n            let maxGroupID = 0;\r\n            for (let i = 0; i < structure.length; i++) {\r\n                if (structure[i].groupID > maxGroupID) {\r\n                    maxGroupID = structure[i].groupID;\r\n                }\r\n            }\r\n            return maxGroupID + 1;\r\n        },\r\n        rightClick(event) {\r\n            this.$refs[\"holisticSeeker\"].rightClick(event);\r\n        },\r\n        clicked(event) {\r\n            log.debug(\"Clicked\");\r\n            this.$refs[\"holisticSeeker\"].clicked(event);\r\n        },\r\n        clickedHelp(event) {},\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.structureSVG {\r\n    z-index: 100;\r\n}\r\n.seeker {\r\n    pointer-events: none;\r\n}\r\n.structureSection {\r\n    z-index: 100;\r\n}\r\n.clickRect {\r\n    opacity: 0;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HolisticStructure.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HolisticStructure.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./HolisticStructure.vue?vue&type=template&id=67916a9a&scoped=true&\"\nimport script from \"./HolisticStructure.vue?vue&type=script&lang=js&\"\nexport * from \"./HolisticStructure.vue?vue&type=script&lang=js&\"\nimport style0 from \"./HolisticStructure.vue?vue&type=style&index=0&id=67916a9a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"67916a9a\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSkeletonLoader } from 'vuetify/lib/components/VSkeletonLoader';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCol,VIcon,VRow,VSkeletonLoader,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.hasStructure)?_c('div',{staticClass:\"py-1\"},[_c('v-row',[_c('v-col',[_vm._v(\"Timbre Structure\")]),_c('v-spacer'),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\",\"color\":_vm.showLoudness ? 'white' : 'dimgrey'},on:{\"click\":function($event){_vm.showLoudness = !_vm.showLoudness}}},[_c('v-icon',[_vm._v(\"mdi-equalizer\")])],1)],1),_c('Seeker',{ref:'timbreStructureSeeker',staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.height,\"color\":'rgb(255,255,255,0.3)'}}),_c('svg',{staticClass:\"timbreStructureSVG\",attrs:{\"width\":_vm.width,\"height\":_vm.height}},[_c('StructureBackground',{attrs:{\"width\":_vm.width,\"height\":_vm.height,\"scale\":_vm.scale,\"structure\":_vm.timbreStructure}}),_vm._l((_vm.timbreStructure),function(section,index){return _c('Section',{key:index + 'course',attrs:{\"section\":section,\"height\":_vm.sectionHeight,\"scale\":_vm.scale,\"showLoudness\":_vm.showLoudness,\"coloring\":'circular',\"positioning\":'linear',\"verticalOffset\":_vm.paddingTop,\"containerHeight\":_vm.height - _vm.sectionHeight / 2,\"loop\":false}})})],2),_c('svg',{class:\"eventSVG\",style:((\"margin-left: -\" + _vm.eventSize)),attrs:{\"width\":_vm.width + _vm.eventSize * 2,\"height\":_vm.eventHeight}},_vm._l((_vm.events),function(event){return _c('circle',{key:event.time,staticClass:\"event\",attrs:{\"cx\":_vm.eventSize + event.time * _vm.scale,\"cy\":_vm.eventSize + event.mdsFeature * (_vm.eventHeight - _vm.eventSize * 2),\"r\":_vm.eventSize,\"fill\":_vm.color(event, event.confidence + 0.5)},on:{\"click\":function($event){return _vm.clickEvent(event)}}})}),0)],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',_vm._l((_vm.structure),function(section,index){return _c('g',{key:section.start},[_c('defs',[_c('linearGradient',{attrs:{\"id\":(\"timbreBackgroundGradient\" + index),\"x1\":\"0\",\"x2\":\"0\",\"y1\":\"0\",\"y2\":\"1\"}},[_c('stop',{style:((\"stop-color:\" + (_vm.backgroundColor(section)) + \";stop-opacity:0\")),attrs:{\"offset\":(\"\" + (0))}}),_c('stop',{style:((\"stop-color:\" + (_vm.backgroundColor(section)) + \";stop-opacity:1\")),attrs:{\"offset\":(\"\" + (section.colorAngle))}}),_c('stop',{style:((\"stop-color:\" + (_vm.backgroundColor(section)) + \";stop-opacity:0\")),attrs:{\"offset\":(\"\" + (1))}})],1)],1),_c('rect',{key:section.start + 'bg',staticClass:\"background\",attrs:{\"x\":section.start * _vm.scale,\"y\":0,\"width\":(section.end - section.start) * _vm.scale,\"height\":_vm.height,\"fill\":(\"url(#timbreBackgroundGradient\" + index + \")\")},on:{\"click\":function($event){return _vm.click($event)}}}),_c('rect',{staticClass:\"separator\",attrs:{\"x\":section.start * _vm.scale - 1.5,\"y\":0,\"width\":3,\"height\":_vm.height,\"fill\":_vm.separatorColor(section)}})])}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <g>\r\n        <g v-for=\"(section, index) in structure\" :key=\"section.start\">\r\n            <defs>\r\n                <linearGradient :id=\"`timbreBackgroundGradient${index}`\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\r\n                    <stop :offset=\"`${0}`\" :style=\"`stop-color:${backgroundColor(section)};stop-opacity:0`\" />\r\n                    <stop\r\n                        :offset=\"`${section.colorAngle}`\"\r\n                        :style=\"`stop-color:${backgroundColor(section)};stop-opacity:1`\"\r\n                    />\r\n                    <stop :offset=\"`${1}`\" :style=\"`stop-color:${backgroundColor(section)};stop-opacity:0`\" />\r\n                </linearGradient>\r\n            </defs>\r\n            <rect\r\n                class=\"background\"\r\n                :key=\"section.start + 'bg'\"\r\n                :x=\"section.start * scale\"\r\n                :y=\"0\"\r\n                :width=\"(section.end - section.start) * scale\"\r\n                :height=\"height\"\r\n                :fill=\"`url(#timbreBackgroundGradient${index})`\"\r\n                @click=\"click($event)\"\r\n            >\r\n            </rect>\r\n            <rect\r\n                class=\"separator\"\r\n                :x=\"section.start * scale - 1.5\"\r\n                :y=\"0\"\r\n                :width=\"3\"\r\n                :height=\"height\"\r\n                :fill=\"separatorColor(section)\"\r\n            ></rect>\r\n        </g>\r\n    </g>\r\n</template>\r\n\r\n<script>\r\nimport * as vis from \"../../app/vis\";\r\nimport * as player from \"../../app/player\";\r\n\r\nexport default {\r\n    props: [\"width\", \"height\", \"scale\", \"structure\"],\r\n    components: {},\r\n    data() {\r\n        return {\r\n            showSeparators: true,\r\n            showBackground: true,\r\n            backgroundOpacity: 0.07,\r\n            separtorOpacity: 0.15,\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n    },\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {\r\n        backgroundColor(section) {\r\n            return vis.sinebowColorNormalizedRadius(\r\n                section.colorAngle,\r\n                1,\r\n                this.backgroundOpacity * this.showBackground\r\n            );\r\n        },\r\n        separatorColor(section) {\r\n            return vis.sinebowColorNormalizedRadius(section.colorAngle, 1, this.separtorOpacity * this.showSeparators);\r\n        },\r\n        click(event) {\r\n            let xNormalized = 0;\r\n            let yNormalized = 0;\r\n            if (this.$store.state.browser === \"Firefox\") {\r\n                xNormalized = event.layerX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            } else {\r\n                xNormalized = event.offsetX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            }\r\n\r\n            if (this.useZoom && this.isZoomed) {\r\n                const xFromMiddle = xNormalized * 2 - 1;\r\n                const seekerPos = Math.min(\r\n                    1,\r\n                    Math.max(\r\n                        0,\r\n                        this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000) +\r\n                            xFromMiddle / (2 * this.zoomScale)\r\n                    )\r\n                );\r\n                player.seekS(seekerPos * this.track.getAnalysisDuration());\r\n            } else {\r\n                player.seekS(xNormalized * this.track.getAnalysisDuration());\r\n            }\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped></style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./StructureBackground.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./StructureBackground.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./StructureBackground.vue?vue&type=template&id=68b11708&scoped=true&\"\nimport script from \"./StructureBackground.vue?vue&type=script&lang=js&\"\nexport * from \"./StructureBackground.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"68b11708\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n    <div class=\"py-1\" v-if=\"hasStructure\">\r\n        <v-row>\r\n            <v-col>Timbre Structure</v-col>\r\n            <v-spacer></v-spacer>\r\n            <v-btn icon small @click=\"showLoudness = !showLoudness\" :color=\"showLoudness ? 'white' : 'dimgrey'\">\r\n                <v-icon>mdi-equalizer</v-icon>\r\n            </v-btn>\r\n        </v-row>\r\n        <Seeker\r\n            class=\"seeker\"\r\n            :ref=\"'timbreStructureSeeker'\"\r\n            :width=\"width\"\r\n            :height=\"height\"\r\n            :color=\"'rgb(255,255,255,0.3)'\"\r\n        />\r\n        <svg class=\"timbreStructureSVG\" :width=\"width\" :height=\"height\">\r\n            <StructureBackground :width=\"width\" :height=\"height\" :scale=\"scale\" :structure=\"timbreStructure\" />\r\n            <Section\r\n                v-for=\"(section, index) in timbreStructure\"\r\n                :key=\"index + 'course'\"\r\n                :section=\"section\"\r\n                :height=\"sectionHeight\"\r\n                :scale=\"scale\"\r\n                :showLoudness=\"showLoudness\"\r\n                :coloring=\"'circular'\"\r\n                :positioning=\"'linear'\"\r\n                :verticalOffset=\"paddingTop\"\r\n                :containerHeight=\"height - sectionHeight / 2\"\r\n                :loop=\"false\"\r\n            />\r\n        </svg>\r\n        <svg\r\n            :class=\"`eventSVG`\"\r\n            :style=\"`margin-left: -${eventSize}`\"\r\n            :width=\"width + eventSize * 2\"\r\n            :height=\"eventHeight\"\r\n        >\r\n            <circle\r\n                v-for=\"event in events\"\r\n                :key=\"event.time\"\r\n                class=\"event\"\r\n                :cx=\"eventSize + event.time * scale\"\r\n                :cy=\"eventSize + event.mdsFeature * (eventHeight - eventSize * 2)\"\r\n                :r=\"eventSize\"\r\n                :fill=\"color(event, event.confidence + 0.5)\"\r\n                @click=\"clickEvent(event)\"\r\n            ></circle>\r\n        </svg>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport Section from \"./Section\";\r\n\r\nimport StructureBackground from \"./StructureBackground\";\r\n\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\nimport * as player from \"../../app/player\";\r\nimport Vue from \"vue\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n        StructureBackground,\r\n        Section,\r\n    },\r\n    data() {\r\n        return {\r\n            paddingTop: 10,\r\n            sectionHeight: 25,\r\n            eventSize: 7,\r\n            eventHeight: 30,\r\n            showLoudness: true,\r\n        };\r\n    },\r\n    computed: {\r\n        height() {\r\n            return 150;\r\n        },\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        hasStructure() {\r\n            return this.track && this.track.timbreStructure && this.track.timbreStructure.length > 0;\r\n        },\r\n        timbreStructure() {\r\n            return this.track.timbreStructure;\r\n        },\r\n        events() {\r\n            return this.track.events;\r\n        },\r\n    },\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {\r\n        color(element, confidence = 1) {\r\n            return vis.sinebowColorNormalizedRadius(element.colorAngle, 1, confidence);\r\n        },\r\n        clickEvent(event) {\r\n            player.seekS(event.time);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.seeker {\r\n    pointer-events: none;\r\n}\r\n.event {\r\n    transition: 0.3s;\r\n}\r\n.event:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreStructure.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreStructure.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TimbreStructure.vue?vue&type=template&id=09646f45&scoped=true&\"\nimport script from \"./TimbreStructure.vue?vue&type=script&lang=js&\"\nexport * from \"./TimbreStructure.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TimbreStructure.vue?vue&type=style&index=0&id=09646f45&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"09646f45\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCol,VIcon,VRow,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.hasStructure)?_c('div',{staticClass:\"py-1\"},[_c('v-row',[_c('v-col',[_vm._v(\"Timbre\")]),_c('v-spacer'),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\",\"color\":_vm.showLoudness ? 'white' : 'dimgrey'},on:{\"click\":function($event){_vm.showLoudness = !_vm.showLoudness}}},[_c('v-icon',[_vm._v(\"mdi-equalizer\")])],1),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.showHelp = !_vm.showHelp}}},[_c('v-icon',{attrs:{\"color\":\"#ccc\",\"dark\":\"\"}},[_vm._v(\"mdi-help-box\")])],1),_c('Tooltip',{attrs:{\"show\":_vm.showHelp}},[_vm._v(\" This visualization shows timbre in the form of a segmented graph. The vertical axis, together with colour, denote similarity. Height in the graph will mostly correspond to energy and brightness. A sudden change in timbre will show up as a break in the graph. The \"),_c('v-icon',{attrs:{\"dark\":\"\",\"small\":\"\",\"color\":\"#ccc\"}},[_vm._v(\"mdi-equalizer\")]),_vm._v(\" button toggles the embedding of loudnenss in the visualization. \"),_c('br'),_vm._v(\" The dots shown below the graph are moments of timbral anomaly, points in the music where the timbre is unique and locally distinct. \")],1)],1),_c('Seeker',{ref:'timbreSegmentedGraphSeeker',staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.height,\"color\":'rgb(255,255,255,0.3)'}}),_c('svg',{staticClass:\"timbreStructureSVG\",attrs:{\"width\":_vm.width,\"height\":_vm.height}},[_c('defs',[_c('linearGradient',{attrs:{\"id\":\"pathGradient\",\"x1\":\"0\",\"x2\":\"0\",\"y1\":\"0\",\"y2\":\"1\"}},_vm._l((_vm.gradientSteps),function(gradientStep){return _c('stop',{key:gradientStep,style:((\"stop-color:\" + (_vm.color(1 - gradientStep)) + \";stop-opacity:1\")),attrs:{\"offset\":(\"\" + gradientStep)}})}),1)],1),_c('ClickableBackground',{attrs:{\"width\":_vm.width,\"height\":_vm.height}}),_vm._l((_vm.segmentedTimbreGraph),function(section,index){return _c('GraphSection',{key:index + 'segmented',attrs:{\"section\":section,\"height\":_vm.sectionHeight,\"scale\":_vm.scale,\"showLoudness\":_vm.showLoudness,\"coloring\":'linear',\"positioning\":'linear',\"verticalOffset\":_vm.paddingTop,\"containerHeight\":_vm.height}})})],2),_c('hr',{staticClass:\"divider\"}),_c('Events',{attrs:{\"width\":_vm.width}})],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('g',[_c('defs',[_c('linearGradient',{attrs:{\"id\":(\"glowRectGradient\" + (_vm.section.start) + (_vm.section.end)),\"x1\":\"0\",\"x2\":\"0\",\"y1\":0,\"y2\":1}},[_c('stop',{style:((\"stop-color:\" + _vm.currentColor + \";stop-opacity:0\")),attrs:{\"offset\":\"0\"}}),_c('stop',{style:((\"stop-color:\" + _vm.currentColor + \";stop-opacity:\" + _vm.glowOpacity)),attrs:{\"offset\":\"0.5\"}}),_c('stop',{style:((\"stop-color:\" + _vm.currentColor + \";stop-opacity:0\")),attrs:{\"offset\":\"1\"}})],1),_c('linearGradient',{attrs:{\"id\":(\"sectionGradient\" + (_vm.section.start)),\"x1\":\"0\",\"x2\":\"0\",\"y1\":_vm.max / (_vm.max - _vm.min + 0.01),\"y2\":-(1 - _vm.max) / (_vm.max - _vm.min + 0.01)}},_vm._l((_vm.gradientSteps),function(gradientStep){return _c('stop',{key:gradientStep,style:((\"stop-color:\" + (_vm.colorGradient(gradientStep)) + \";stop-opacity:1\")),attrs:{\"offset\":(\"\" + gradientStep)}})}),1)],1),_c('rect',{staticClass:\"glowRect\",attrs:{\"fill\":(\"url(#glowRectGradient\" + (_vm.section.start) + (_vm.section.end) + \")\"),\"x\":_vm.x,\"y\":_vm.currentY - (_vm.seekerIsInSection ? _vm.glowRectSize() / 2 : 0),\"width\":_vm.width,\"height\":_vm.seekerIsInSection ? _vm.glowRectSize() : 0,\"opacity\":_vm.seekerIsInSection ? '1' : '0'}}),_c('path',{staticClass:\"shapedSection\",attrs:{\"d\":_vm.shapedSectionPath,\"shape-rendering\":\"geometricPrecision\",\"fill\":_vm.gradientColoring ? (\"url(#sectionGradient\" + (_vm.section.start) + \")\") : _vm.color},on:{\"mouseover\":function($event){return _vm.hover($event)},\"mouseout\":function($event){return _vm.unhover()},\"click\":function($event){return _vm.click($event)}}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <g>\r\n        <defs>\r\n            <linearGradient :id=\"`glowRectGradient${section.start}${section.end}`\" x1=\"0\" x2=\"0\" :y1=\"0\" :y2=\"1\">\r\n                <stop offset=\"0\" :style=\"`stop-color:${currentColor};stop-opacity:0`\" />\r\n                <stop offset=\"0.5\" :style=\"`stop-color:${currentColor};stop-opacity:${glowOpacity}`\" />\r\n                <stop offset=\"1\" :style=\"`stop-color:${currentColor};stop-opacity:0`\" />\r\n            </linearGradient>\r\n            <linearGradient\r\n                :id=\"`sectionGradient${section.start}`\"\r\n                x1=\"0\"\r\n                x2=\"0\"\r\n                :y1=\"max / (max - min + 0.01)\"\r\n                :y2=\"-(1 - max) / (max - min + 0.01)\"\r\n            >\r\n                <stop\r\n                    v-for=\"gradientStep in gradientSteps\"\r\n                    :key=\"gradientStep\"\r\n                    :offset=\"`${gradientStep}`\"\r\n                    :style=\"`stop-color:${colorGradient(gradientStep)};stop-opacity:1`\"\r\n                />\r\n            </linearGradient>\r\n        </defs>\r\n        <rect\r\n            class=\"glowRect\"\r\n            :fill=\"`url(#glowRectGradient${section.start}${section.end})`\"\r\n            :x=\"x\"\r\n            :y=\"currentY - (seekerIsInSection ? glowRectSize() / 2 : 0)\"\r\n            :width=\"width\"\r\n            :height=\"seekerIsInSection ? glowRectSize() : 0\"\r\n            :opacity=\"seekerIsInSection ? '1' : '0'\"\r\n        >\r\n        </rect>\r\n        <path\r\n            class=\"shapedSection\"\r\n            :d=\"shapedSectionPath\"\r\n            shape-rendering=\"geometricPrecision\"\r\n            :fill=\"gradientColoring ? `url(#sectionGradient${section.start})` : color\"\r\n            @mouseover=\"hover($event)\"\r\n            @mouseout=\"unhover()\"\r\n            @click=\"click($event)\"\r\n        ></path>\r\n    </g>\r\n</template>\r\n\r\n<script>\r\nimport * as vis from \"../../app/vis\";\r\nimport * as log from \"../../dev/log\";\r\nimport * as player from \"../../app/player\";\r\nimport { sampleDuration } from \"../../app/Track\";\r\nimport * as audioUtil from \"../../app/audioUtil\";\r\nimport * as svgVariableWidthLine from \"svg-variable-width-line\";\r\nimport * as d3 from \"d3\";\r\n\r\nexport default {\r\n    props: [\r\n        \"section\",\r\n        \"height\",\r\n        \"scale\",\r\n        \"verticalOffset\",\r\n        \"containerHeight\",\r\n        \"showLoudness\",\r\n        \"coloring\",\r\n        \"positioning\",\r\n    ],\r\n    components: {},\r\n    data() {\r\n        return {\r\n            glowOpacity: 0.3,\r\n            glowSize: 6,\r\n            gradientColoring: true,\r\n            gradientStepAmount: 16,\r\n            strokeWidth: 0.5,\r\n            defaultLoudness: 0.7,\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n\r\n        verticalPosition() {\r\n            switch (this.positioning) {\r\n                default:\r\n                case \"cluster\" || \"group\":\r\n                    return this.section.groupID * this.height + this.verticalOffset;\r\n                case \"circular\":\r\n                    return this.section.colorAngle * (this.containerHeight - this.height);\r\n                case \"linear\":\r\n                    return this.section.mdsFeature * (this.containerHeight - this.height);\r\n            }\r\n        },\r\n        color() {\r\n            switch (this.coloring) {\r\n                default:\r\n                case \"cluster\" || \"group\":\r\n                    return vis.goldenRatioCategoricalColor(this.section.groupID, 1);\r\n                case \"circular\":\r\n                    return vis.sinebowColorNormalizedRadius(this.section.colorAngle, this.section.colorRadius, 1);\r\n                case \"linear\":\r\n                    return vis.zeroOneColorWarm(this.section.mdsFeature);\r\n            }\r\n        },\r\n        seekerIsInSection() {\r\n            return (\r\n                this.$store.getters.seeker / 1000 >= this.section.start &&\r\n                this.$store.getters.seeker / 1000 < this.section.end\r\n            );\r\n        },\r\n        min() {\r\n            return Math.min(...this.section.graph);\r\n        },\r\n        max() {\r\n            return Math.max(...this.section.graph);\r\n        },\r\n        x() {\r\n            return this.section.start * this.scale;\r\n        },\r\n        y() {\r\n            return this.verticalOffset;\r\n        },\r\n        currentY() {\r\n            return (1 - this.currentSample) * (this.containerHeight - this.height) + this.height / 2;\r\n        },\r\n        currentColor() {\r\n            return this.colorGradient(this.currentSample);\r\n        },\r\n        sectionDuration() {\r\n            return this.section.end - this.section.start;\r\n        },\r\n        currentSample() {\r\n            if (!this.seekerIsInSection) return this.section.mdsFeature;\r\n            const timeFactor = (this.$store.getters.seeker / 1000 - this.section.start) / this.sectionDuration;\r\n            const sampleIndex = Math.floor(timeFactor * this.section.graph.length);\r\n            return this.section.graph[sampleIndex];\r\n        },\r\n        width() {\r\n            return Math.max(1, (this.section.end - this.section.start) * this.scale - 2);\r\n        },\r\n        dynamicsArray() {\r\n            return this.track && this.track.features.sampled.dynamics;\r\n        },\r\n        directLoudness() {\r\n            return this.track && this.track.features.directLoudness;\r\n        },\r\n        shapedSectionPath() {\r\n            const halfHeight = this.height / 2;\r\n\r\n            const points = [];\r\n\r\n            points.push({\r\n                x: this.section.start * this.scale,\r\n                y: (1 - this.section.graph[1]) * (this.containerHeight - this.height) + halfHeight,\r\n                w: 0,\r\n            });\r\n            this.section.graph.forEach((point, index) => {\r\n                if (\r\n                    (index > 0 && index < this.section.graph.length - 1 && (index + 1) % 3 !== 0) ||\r\n                    (index > 0 && this.section.graph.length < 3)\r\n                ) {\r\n                    const factorOfWidth = index / this.section.graph.length;\r\n                    const xTime = this.section.start + (this.section.end - this.section.start) * factorOfWidth;\r\n                    const xPos = xTime * this.scale;\r\n\r\n                    const y = (1 - point) * (this.containerHeight - this.height) + halfHeight;\r\n                    const w =\r\n                        (this.showLoudness\r\n                            ? this.dynamics(Math.round(xTime / this.track.features.sampleDuration))\r\n                            : this.defaultLoudness) *\r\n                        this.height *\r\n                        this.strokeWidth;\r\n                    points.push({ x: xPos, y, w });\r\n                }\r\n            });\r\n\r\n            points.push({\r\n                x: this.section.end * this.scale,\r\n                y:\r\n                    (1 - this.section.graph[this.section.graph.length - 2]) * (this.containerHeight - this.height) +\r\n                    halfHeight,\r\n                w: 0,\r\n            });\r\n\r\n            const { d } = svgVariableWidthLine.compute(...svgVariableWidthLine.smooth(points, 2));\r\n\r\n            return d;\r\n        },\r\n        gradientSteps() {\r\n            let steps = [];\r\n            for (let i = 0; i < this.gradientStepAmount; i++) {\r\n                steps.push(i / this.gradientStepAmount);\r\n            }\r\n            return steps;\r\n        },\r\n    },\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {\r\n        dynamics(sample) {\r\n            return (this.dynamicsArray && this.dynamicsArray[sample]) || 0;\r\n        },\r\n        loudnessTime(time) {\r\n            const sample = Math.floor(time / this.track.features.sampleDuration);\r\n            return this.dynamicsArray[sample] / this.track.features.maxLoudness || 0;\r\n        },\r\n        directLoudnessTime(time) {\r\n            const sample = Math.floor(time / this.track.features.directLoudnessSampleDuration);\r\n            return this.directLoudness[sample] / this.track.features.maxLoudness || 0;\r\n        },\r\n        hover(event) {},\r\n        unhover() {},\r\n        click(event) {\r\n            this.$store.commit(\"setInputFocus\", false);\r\n\r\n            log.debug(\"clicked\", this.section.mdsFeature);\r\n            if (event.shiftKey) {\r\n                const startInSamples = this.section.start / this.track.features.sampleDuration;\r\n                const endInSamples = this.section.end / this.track.features.sampleDuration;\r\n                this.track.updateDTW(startInSamples, endInSamples);\r\n            } else {\r\n                player.seekS(this.section.start);\r\n            }\r\n        },\r\n        glowRectSize() {\r\n            return (\r\n                this.glowSize *\r\n                this.height *\r\n                (0.15 +\r\n                    this.directLoudnessTime(this.$store.getters.seeker / 1000) / 4 +\r\n                    Math.pow(this.loudnessTime(this.$store.getters.seeker / 1000), 1.5))\r\n            );\r\n        },\r\n        colorGradient(mdsFeature) {\r\n            return vis.sinebowColorNormalizedRadius((0.8 - mdsFeature * 0.9) % 1, 0.85, 0.95);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.shapedSection {\r\n    z-index: 10;\r\n    pointer-events: all;\r\n    transition: 0.45s;\r\n    stroke-linejoin: round;\r\n}\r\n.glowRect {\r\n    z-index: -1;\r\n    pointer-events: none;\r\n    transition-timing-function: linear;\r\n    transition: 0.5s;\r\n}\r\n.shapedSection:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GraphSection.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GraphSection.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./GraphSection.vue?vue&type=template&id=5c6cc0ec&scoped=true&\"\nimport script from \"./GraphSection.vue?vue&type=script&lang=js&\"\nexport * from \"./GraphSection.vue?vue&type=script&lang=js&\"\nimport style0 from \"./GraphSection.vue?vue&type=style&index=0&id=5c6cc0ec&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5c6cc0ec\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.hasStructure)?_c('div',[_c('div',{staticClass:\"events\"},[_c('Seeker',{ref:'eventseeker',staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.eventHeight,\"color\":'rgb(255,255,255,0.3)'}}),_c('svg',{class:\"eventSVG\",style:((\"margin-left: -\" + _vm.eventSize)),attrs:{\"width\":_vm.width,\"height\":_vm.eventHeight * 2}},[_c('rect',{staticClass:\"timbreGraphBackground\",attrs:{\"width\":_vm.width,\"height\":_vm.height,\"opacity\":\"0\"},on:{\"click\":function($event){return _vm.clickBackground($event)}}}),_vm._l((_vm.events),function(event){return _c('circle',{key:event.time + 'eventcircle',ref:(\"event\" + (event.time)),refInFor:true,staticClass:\"event\",attrs:{\"cx\":_vm.eventSize + event.time * _vm.scale + _vm.eventSize / 2,\"cy\":_vm.eventSize + event.mdsFeature * (_vm.eventHeight - _vm.eventSize * 2),\"r\":_vm.seekerInEvent(event) ? _vm.eventSize * 1.3 : _vm.eventSize,\"fill\":_vm.seekerInEvent(event) ? 'white' : _vm.color(event, event.confidence + 0.5)},on:{\"click\":function($event){return _vm.clickEvent(event)}}})})],2)],1)]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div v-if=\"hasStructure\">\r\n        <div class=\"events\">\r\n            <Seeker\r\n                class=\"seeker\"\r\n                :ref=\"'eventseeker'\"\r\n                :width=\"width\"\r\n                :height=\"eventHeight\"\r\n                :color=\"'rgb(255,255,255,0.3)'\"\r\n            />\r\n\r\n            <svg :class=\"`eventSVG`\" :style=\"`margin-left: -${eventSize}`\" :width=\"width\" :height=\"eventHeight * 2\">\r\n                <rect\r\n                    class=\"timbreGraphBackground\"\r\n                    :width=\"width\"\r\n                    :height=\"height\"\r\n                    opacity=\"0\"\r\n                    @click=\"clickBackground($event)\"\r\n                ></rect>\r\n                <circle\r\n                    v-for=\"event in events\"\r\n                    :key=\"event.time + 'eventcircle'\"\r\n                    class=\"event\"\r\n                    :ref=\"`event${event.time}`\"\r\n                    :cx=\"eventSize + event.time * scale + eventSize / 2\"\r\n                    :cy=\"eventSize + event.mdsFeature * (eventHeight - eventSize * 2)\"\r\n                    :r=\"seekerInEvent(event) ? eventSize * 1.3 : eventSize\"\r\n                    :fill=\"seekerInEvent(event) ? 'white' : color(event, event.confidence + 0.5)\"\r\n                    @click=\"clickEvent(event)\"\r\n                ></circle>\r\n                <!--<rect\r\n                    v-for=\"event in events\"\r\n                    :key=\"event.time + 'eventrect'\"\r\n                    class=\"rectevent\"\r\n                    :ref=\"`rectevent${event.time}`\"\r\n                    :x=\"eventSize + event.time * scale + eventSize / 2 - 2\"\r\n                    :y=\"0\"\r\n                    :height=\"eventSize * 4\"\r\n                    :width=\"3\"\r\n                    rx=\"1\"\r\n                    :fill=\"seekerInEvent(event) ? 'white' : color(event, event.confidence + 0.5)\"\r\n                    @click=\"clickEvent(event)\"\r\n                ></rect>-->\r\n            </svg>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport Section from \"./Section\";\r\n\r\nimport StructureBackground from \"./StructureBackground\";\r\n\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\nimport * as player from \"../../app/player\";\r\nimport Vue from \"vue\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            paddingTop: 10,\r\n            sectionHeight: 25,\r\n            eventSize: 6,\r\n            eventHeight: 30,\r\n            showLoudness: true,\r\n        };\r\n    },\r\n    computed: {\r\n        height() {\r\n            return 150;\r\n        },\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        hasStructure() {\r\n            return this.track && this.track.timbreStructure && this.track.timbreStructure.length > 0;\r\n        },\r\n        events() {\r\n            return this.track.events;\r\n        },\r\n        seeker() {\r\n            return this.$store.getters.seeker / 1000;\r\n        },\r\n    },\r\n    watch: {\r\n        seeker(newSeeker, oldSeeker) {\r\n            this.events.forEach((event) => {});\r\n        },\r\n    },\r\n    mounted() {},\r\n    methods: {\r\n        color(element, confidence = 1) {\r\n            return vis.sinebowColorNormalizedRadius(element.colorAngle, 1, confidence);\r\n        },\r\n        clickEvent(event) {\r\n            player.seekS(event.time - 0.2);\r\n            this.triggerEvent(event);\r\n        },\r\n        clickBackground(event) {\r\n            this.$refs[\"eventseeker\"].clickedSVG(event);\r\n        },\r\n        seekerInEvent(event) {\r\n            return this.seeker >= event.time && this.seeker < event.time + 1;\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.seeker {\r\n    pointer-events: none;\r\n}\r\n.eventSVG {\r\n}\r\n.event {\r\n    transition: 0.5s;\r\n}\r\n.event:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Events.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Events.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Events.vue?vue&type=template&id=6ddf69af&scoped=true&\"\nimport script from \"./Events.vue?vue&type=script&lang=js&\"\nexport * from \"./Events.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Events.vue?vue&type=style&index=0&id=6ddf69af&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6ddf69af\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('rect',{staticClass:\"background\",attrs:{\"id\":\"background\",\"width\":_vm.width,\"height\":_vm.height},on:{\"click\":function($event){return _vm.click($event)}}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <rect class=\"background\" id=\"background\" :width=\"width\" :height=\"height\" @click=\"click($event)\"></rect>\r\n</template>\r\n\r\n<script>\r\nimport * as player from \"../../app/player\";\r\n\r\nexport default {\r\n    props: {\r\n        width: { type: Number },\r\n        height: { type: Number },\r\n        useZoom: {\r\n            type: Boolean,\r\n            default: false,\r\n        },\r\n    },\r\n    components: {},\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        zoomScale() {\r\n            return this.$store.getters.zoomScale;\r\n        },\r\n    },\r\n    methods: {\r\n        click(event) {\r\n            let xNormalized = 0;\r\n            let yNormalized = 0;\r\n            if (this.$store.state.browser === \"Firefox\") {\r\n                xNormalized = event.layerX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            } else {\r\n                xNormalized = event.offsetX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            }\r\n\r\n            if (this.useZoom && this.isZoomed) {\r\n                const xFromMiddle = xNormalized * 2 - 1;\r\n                const seekerPos = Math.min(\r\n                    1,\r\n                    Math.max(\r\n                        0,\r\n                        this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000) +\r\n                            xFromMiddle / (2 * this.zoomScale)\r\n                    )\r\n                );\r\n                player.seekS(seekerPos * this.track.getAnalysisDuration());\r\n            } else {\r\n                player.seekS(xNormalized * this.track.getAnalysisDuration());\r\n            }\r\n        },\r\n    },\r\n};\r\n</script>\r\n<style scoped>\r\n.background {\r\n    opacity: 0;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ClickableBackground.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ClickableBackground.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ClickableBackground.vue?vue&type=template&id=71a70974&scoped=true&\"\nimport script from \"./ClickableBackground.vue?vue&type=script&lang=js&\"\nexport * from \"./ClickableBackground.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ClickableBackground.vue?vue&type=style&index=0&id=71a70974&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"71a70974\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n    <div class=\"py-1\" v-if=\"hasStructure\">\r\n        <v-row>\r\n            <v-col>Timbre</v-col>\r\n            <v-spacer></v-spacer>\r\n            <v-btn icon small @click=\"showLoudness = !showLoudness\" :color=\"showLoudness ? 'white' : 'dimgrey'\">\r\n                <v-icon>mdi-equalizer</v-icon>\r\n            </v-btn>\r\n            <v-btn icon small @click=\"showHelp = !showHelp\"> <v-icon color=\"#ccc\" dark>mdi-help-box</v-icon> </v-btn>\r\n            <Tooltip :show=\"showHelp\">\r\n                This visualization shows timbre in the form of a segmented graph. The vertical axis, together with\r\n                colour, denote similarity. Height in the graph will mostly correspond to energy and brightness. A sudden\r\n                change in timbre will show up as a break in the graph. The\r\n                <v-icon dark small color=\"#ccc\">mdi-equalizer</v-icon> button toggles the embedding of loudnenss in the\r\n                visualization. <br />\r\n                The dots shown below the graph are moments of timbral anomaly, points in the music where the timbre is\r\n                unique and locally distinct.\r\n            </Tooltip>\r\n        </v-row>\r\n        <Seeker\r\n            class=\"seeker\"\r\n            :ref=\"'timbreSegmentedGraphSeeker'\"\r\n            :width=\"width\"\r\n            :height=\"height\"\r\n            :color=\"'rgb(255,255,255,0.3)'\"\r\n        />\r\n        <svg class=\"timbreStructureSVG\" :width=\"width\" :height=\"height\">\r\n            <defs>\r\n                <linearGradient id=\"pathGradient\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\r\n                    <stop\r\n                        v-for=\"gradientStep in gradientSteps\"\r\n                        :key=\"gradientStep\"\r\n                        :offset=\"`${gradientStep}`\"\r\n                        :style=\"`stop-color:${color(1 - gradientStep)};stop-opacity:1`\"\r\n                    />\r\n                </linearGradient>\r\n            </defs>\r\n            <ClickableBackground :width=\"width\" :height=\"height\"></ClickableBackground>\r\n            <GraphSection\r\n                v-for=\"(section, index) in segmentedTimbreGraph\"\r\n                :key=\"index + 'segmented'\"\r\n                :section=\"section\"\r\n                :height=\"sectionHeight\"\r\n                :scale=\"scale\"\r\n                :showLoudness=\"showLoudness\"\r\n                :coloring=\"'linear'\"\r\n                :positioning=\"'linear'\"\r\n                :verticalOffset=\"paddingTop\"\r\n                :containerHeight=\"height\"\r\n            />\r\n        </svg>\r\n        <hr class=\"divider\" />\r\n        <Events :width=\"width\" />\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport GraphSection from \"./GraphSection\";\r\nimport Events from \"./Events\";\r\n\r\nimport ClickableBackground from \"./ClickableBackground\";\r\nimport Tooltip from \"./Tooltip.vue\";\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\nimport * as player from \"../../app/player\";\r\nimport Vue from \"vue\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n        GraphSection,\r\n        ClickableBackground,\r\n        Events,\r\n        Tooltip,\r\n    },\r\n    data() {\r\n        return {\r\n            paddingTop: 10,\r\n            sectionHeight: 25,\r\n            showLoudness: true,\r\n            gradientStepAmount: 8,\r\n            showHelp: false,\r\n        };\r\n    },\r\n    computed: {\r\n        height() {\r\n            return 150;\r\n        },\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        hasStructure() {\r\n            return this.track && this.track.segmentedTimbreGraph && this.track.segmentedTimbreGraph.length > 0;\r\n        },\r\n        segmentedTimbreGraph() {\r\n            return this.track.segmentedTimbreGraph;\r\n        },\r\n        gradientSteps() {\r\n            let steps = [];\r\n            for (let i = 0; i < this.gradientStepAmount; i++) {\r\n                steps.push(i / this.gradientStepAmount);\r\n            }\r\n            return steps;\r\n        },\r\n    },\r\n    watch: {},\r\n    mounted() {},\r\n    methods: {\r\n        color(mdsFeature) {\r\n            return vis.sinebowColorNormalizedRadius(mdsFeature, 1, 1);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.seeker {\r\n    pointer-events: none;\r\n}\r\n.divider {\r\n    border: 1px solid #333333;\r\n    border-radius: 2px;\r\n    background: #333333;\r\n    margin: 20px 0px;\r\n}\r\n.timbreStructureSVG {\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreSegmentedGraph.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreSegmentedGraph.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TimbreSegmentedGraph.vue?vue&type=template&id=56312774&scoped=true&\"\nimport script from \"./TimbreSegmentedGraph.vue?vue&type=script&lang=js&\"\nexport * from \"./TimbreSegmentedGraph.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TimbreSegmentedGraph.vue?vue&type=style&index=0&id=56312774&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"56312774\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCol,VIcon,VRow,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('v-row',[_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.collapsed = !_vm.collapsed}}},[_c('v-icon',[_vm._v(\" \"+_vm._s(_vm.collapsed ? \"mdi-unfold-more-horizontal\" : \"mdi-unfold-less-horizontal\")+\" \")])],1),_c('p',[_vm._v(\" Tonality \")]),_c('v-spacer'),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.showHelp = !_vm.showHelp}}},[_c('v-icon',{attrs:{\"color\":\"#ccc\",\"dark\":\"\"}},[_vm._v(\"mdi-help-box\")])],1),_c('Tooltip',{attrs:{\"show\":_vm.showHelp}},[_vm._v(\" This visualization shows the song's tonality change over time. Similarly to the chords, the colours correspond to the circle of fifths. Click the \"),_c('v-icon',{attrs:{\"small\":\"\",\"color\":\"#ccc\"}},[_vm._v(\"mdi-unfold-more-horizontal\")]),_vm._v(\" button to see the circle of fifths with their corresponding key names. A real-time, fast and slow pointer shows the detected key for that moment. \")],1)],1),(_vm.hasTonality)?_c('Seeker',{ref:'holisticSeeker',staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.height,\"color\":'rgb(255,255,255,0.3)'}}):_vm._e(),_c('canvas',{staticClass:\"tonalityCanvas\",attrs:{\"id\":\"tonalityCanvas\",\"width\":_vm.width,\"height\":_vm.height},on:{\"click\":function($event){return _vm.clickCanvas($event)}}}),_c('div',{staticClass:\"circleOfFifthsTonality\",style:((\"height: \" + (!_vm.collapsed * _vm.co5Size) + \"px\"))},[(_vm.hasTonality)?_c('svg',{staticClass:\"tonalitySVG\",attrs:{\"width\":_vm.co5Size,\"height\":!_vm.collapsed * _vm.co5Size}},[_c('circle',{attrs:{\"cx\":_vm.co5Size / 2,\"cy\":_vm.co5Size / 2,\"r\":_vm.co5Size / 2,\"fill\":\"black\"}}),_c('g',{attrs:{\"transform\":(\"translate(\" + (_vm.co5Size / 2) + \",\" + (_vm.co5Size / 2) + \")\"),\"stroke\":\"#000\",\"stroke-width\":\"2\"}},[_vm._l((_vm.circleOfFifths),function(keyNumber,index){return _c('path',{key:'co5' + index,attrs:{\"d\":(\"M 0 0 0 -\" + (_vm.co5Size / 2) + \" A \" + (_vm.co5Size / 2) + \" \" + (_vm.co5Size / 2) + \" 0 0 1 \" + ((Math.sin(\n                            (1 / 12) * Math.PI * 2\n                        ) *\n                            _vm.co5Size) /\n                            2) + \" \" + (-(Math.cos((1 / 12) * Math.PI * 2) * _vm.co5Size) / 2) + \" Z\"),\"transform\":(\"rotate(\" + (((-index - 0.5) / 12) * 360) + \" 0 0)\"),\"fill\":_vm.color(1 - index / 12, 1, 0.7)}})}),_c('circle',{attrs:{\"r\":(_vm.co5Size / 2) * 0.58,\"fill\":\"#121212\"}}),_c('circle',{attrs:{\"r\":(_vm.co5Size / 2) * 0.8,\"fill\":\"none\",\"stroke\":\"#121212\",\"stroke-width\":\"2\"}}),_vm._l((_vm.circleOfFifths),function(keyNumber,index){return _c('text',{key:'co5text' + index,staticClass:\"co5text\",attrs:{\"x\":(Math.sin((index / 12) * Math.PI * 2) * _vm.co5Size * 0.9) / 2,\"y\":-(Math.cos((index / 12) * Math.PI * 2) * _vm.co5Size * 0.9) / 2,\"text-anchor\":\"middle\",\"alignment-baseline\":\"middle\"}},[_vm._v(\" \"+_vm._s(_vm.keyName(keyNumber))+\" \")])}),_vm._l((_vm.circleOfFifths),function(keyNumber,index){return _c('text',{key:'co5textm' + index,staticClass:\"co5textm\",attrs:{\"x\":(Math.sin(((index - 3) / 12) * Math.PI * 2) * _vm.co5Size * 0.7) / 2,\"y\":-(Math.cos(((index - 3) / 12) * Math.PI * 2) * _vm.co5Size * 0.7) / 2,\"text-anchor\":\"middle\",\"alignment-baseline\":\"middle\"}},[_vm._v(\" \"+_vm._s(_vm.keyName(keyNumber + 12))+\" \")])})],2),_c('path',{staticClass:\"tonalityPointerSlow\",attrs:{\"transform\":(\"rotate(\" + (_vm.currentAngleSlow * 360) + \" \" + (_vm.co5Size / 2) + \" \" + (_vm.co5Size / 2) + \")\"),\"d\":_vm.tonalityPointerPath(_vm.tonalitySlow),\"stroke-width\":\"4\",\"stroke\":_vm.color(_vm.currentAngleSlow, 0.6, 0.6)}}),_c('path',{staticClass:\"tonalityPointer\",attrs:{\"transform\":(\"rotate(\" + (_vm.currentAngle * 360) + \" \" + (_vm.co5Size / 2) + \" \" + (_vm.co5Size / 2) + \")\"),\"d\":_vm.tonalityPointerPath(_vm.tonality),\"stroke-width\":\"4\",\"stroke\":_vm.color(_vm.currentAngle)}})]):_vm._e()])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div>\r\n        <v-row>\r\n            <v-btn icon small @click=\"collapsed = !collapsed\">\r\n                <v-icon>\r\n                    {{ collapsed ? \"mdi-unfold-more-horizontal\" : \"mdi-unfold-less-horizontal\" }}\r\n                </v-icon>\r\n            </v-btn>\r\n            <p>\r\n                Tonality\r\n            </p>\r\n            <v-spacer></v-spacer>\r\n            <v-btn icon small @click=\"showHelp = !showHelp\"> <v-icon color=\"#ccc\" dark>mdi-help-box</v-icon> </v-btn>\r\n            <Tooltip :show=\"showHelp\">\r\n                This visualization shows the song's tonality change over time. Similarly to the chords, the colours\r\n                correspond to the circle of fifths. Click the\r\n                <v-icon small color=\"#ccc\">mdi-unfold-more-horizontal</v-icon> button to see the circle of fifths with their\r\n                corresponding key names. A real-time, fast and slow pointer shows the detected key for that moment.\r\n            </Tooltip>\r\n        </v-row>\r\n        <Seeker\r\n            v-if=\"hasTonality\"\r\n            class=\"seeker\"\r\n            :ref=\"'holisticSeeker'\"\r\n            :width=\"width\"\r\n            :height=\"height\"\r\n            :color=\"'rgb(255,255,255,0.3)'\"\r\n        />\r\n\r\n        <canvas\r\n            id=\"tonalityCanvas\"\r\n            class=\"tonalityCanvas\"\r\n            :width=\"width\"\r\n            :height=\"height\"\r\n            @click=\"clickCanvas($event)\"\r\n        ></canvas>\r\n\r\n        <div :style=\"`height: ${!collapsed * co5Size}px`\" class=\"circleOfFifthsTonality\">\r\n            <svg v-if=\"hasTonality\" class=\"tonalitySVG\" :width=\"co5Size\" :height=\"!collapsed * co5Size\">\r\n                <circle :cx=\"co5Size / 2\" :cy=\"co5Size / 2\" :r=\"co5Size / 2\" fill=\"black\"></circle>\r\n                <g :transform=\"`translate(${co5Size / 2},${co5Size / 2})`\" stroke=\"#000\" stroke-width=\"2\">\r\n                    <!--<path  />-->\r\n                    <path\r\n                        v-for=\"(keyNumber, index) in circleOfFifths\"\r\n                        :key=\"'co5' + index\"\r\n                        :d=\"\r\n                            `M 0 0 0 -${co5Size / 2} A ${co5Size / 2} ${co5Size / 2} 0 0 1 ${(Math.sin(\r\n                                (1 / 12) * Math.PI * 2\r\n                            ) *\r\n                                co5Size) /\r\n                                2} ${-(Math.cos((1 / 12) * Math.PI * 2) * co5Size) / 2} Z`\r\n                        \"\r\n                        :transform=\"`rotate(${((-index - 0.5) / 12) * 360} 0 0)`\"\r\n                        :fill=\"color(1 - index / 12, 1, 0.7)\"\r\n                    />\r\n                    <circle :r=\"(co5Size / 2) * 0.58\" fill=\"#121212\"></circle>\r\n                    <circle :r=\"(co5Size / 2) * 0.8\" fill=\"none\" stroke=\"#121212\" stroke-width=\"2\"></circle>\r\n\r\n                    <text\r\n                        v-for=\"(keyNumber, index) in circleOfFifths\"\r\n                        :key=\"'co5text' + index\"\r\n                        :x=\"(Math.sin((index / 12) * Math.PI * 2) * co5Size * 0.9) / 2\"\r\n                        :y=\"-(Math.cos((index / 12) * Math.PI * 2) * co5Size * 0.9) / 2\"\r\n                        class=\"co5text\"\r\n                        text-anchor=\"middle\"\r\n                        alignment-baseline=\"middle\"\r\n                    >\r\n                        {{ keyName(keyNumber) }}\r\n                    </text>\r\n                    <text\r\n                        v-for=\"(keyNumber, index) in circleOfFifths\"\r\n                        :key=\"'co5textm' + index\"\r\n                        :x=\"(Math.sin(((index - 3) / 12) * Math.PI * 2) * co5Size * 0.7) / 2\"\r\n                        :y=\"-(Math.cos(((index - 3) / 12) * Math.PI * 2) * co5Size * 0.7) / 2\"\r\n                        class=\"co5textm\"\r\n                        text-anchor=\"middle\"\r\n                        alignment-baseline=\"middle\"\r\n                    >\r\n                        {{ keyName(keyNumber + 12) }}\r\n                    </text>\r\n                </g>\r\n\r\n                <path\r\n                    class=\"tonalityPointerSlow\"\r\n                    :transform=\"`rotate(${currentAngleSlow * 360} ${co5Size / 2} ${co5Size / 2})`\"\r\n                    :d=\"tonalityPointerPath(tonalitySlow)\"\r\n                    stroke-width=\"4\"\r\n                    :stroke=\"color(currentAngleSlow, 0.6, 0.6)\"\r\n                />\r\n                <path\r\n                    class=\"tonalityPointer\"\r\n                    :transform=\"`rotate(${currentAngle * 360} ${co5Size / 2} ${co5Size / 2})`\"\r\n                    :d=\"tonalityPointerPath(tonality)\"\r\n                    stroke-width=\"4\"\r\n                    :stroke=\"color(currentAngle)\"\r\n                />\r\n            </svg>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport * as audioUtil from \"../../app/audioUtil\";\r\n\r\nimport * as keyDetection from \"../../app/keyDetection\";\r\nimport Seeker from \"./Seeker\";\r\nimport Section from \"./Section\";\r\n\r\nimport ClickableBackground from \"./ClickableBackground\";\r\nimport SeparatorBackground from \"./SeparatorBackground\";\r\nimport Tooltip from \"./Tooltip.vue\";\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\nimport * as player from \"../../app/player\";\r\nimport Vue from \"vue\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n        Tooltip,\r\n    },\r\n    data() {\r\n        return {\r\n            paddingTop: 10,\r\n            sectionHeight: 20,\r\n            showLoudness: true,\r\n            accumulativeAngle: [],\r\n            collapsed: true,\r\n            co5Size: 300,\r\n            showHelp: false,\r\n        };\r\n    },\r\n    computed: {\r\n        height() {\r\n            let height = 0;\r\n            height += this.sectionHeight * 2;\r\n            height += 2 * 2;\r\n            return height;\r\n        },\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        hasTonality() {\r\n            return this.track && this.track.tonalityFeatureLarge && this.track.tonalityFeatureLarge.length > 0;\r\n        },\r\n        tonality() {\r\n            return this.hasTonality && this.track.tonalityFeatureSmall;\r\n        },\r\n        tonalitySlow() {\r\n            return this.hasTonality && this.track.tonalityFeatureLarge;\r\n        },\r\n        keyFeature() {\r\n            return this.hasTonality && this.track.keyFeature;\r\n        },\r\n        sampleDuration() {\r\n            return this.track.features.sampleDuration;\r\n        },\r\n        fastSampleDuration() {\r\n            return this.track.features.fastSampleDuration;\r\n        },\r\n        currentFastSample() {\r\n            return Math.floor(this.$store.getters.seeker / 1000 / this.fastSampleDuration);\r\n        },\r\n        currentSample() {\r\n            return Math.floor(this.$store.getters.seeker / 1000 / this.sampleDuration);\r\n        },\r\n        currentAngle() {\r\n            return this.accumulativeAngle[this.currentFastSample];\r\n        },\r\n        currentAngleSlow() {\r\n            return this.accumulativeAngleSlow[this.currentFastSample];\r\n        },\r\n        circleOfFifths() {\r\n            return audioUtil.circleOfFifths;\r\n        },\r\n        currentKey() {\r\n            return this.keyFeature[this.currentFastSample];\r\n        },\r\n    },\r\n    watch: {\r\n        track() {\r\n            if (this.hasTonality) {\r\n                this.setupCanvas();\r\n                this.accumulativeAngle = this.computeAccumulativeAngle(this.tonality);\r\n                this.accumulativeAngleSlow = this.computeAccumulativeAngle(this.tonalitySlow);\r\n\r\n                this.drawTonality();\r\n            }\r\n        },\r\n        hasTonality() {\r\n            if (this.hasTonality) {\r\n                this.setupCanvas();\r\n                this.accumulativeAngle = this.computeAccumulativeAngle(this.tonality);\r\n                this.accumulativeAngleSlow = this.computeAccumulativeAngle(this.tonalitySlow);\r\n                this.drawTonality();\r\n            }\r\n        },\r\n    },\r\n    mounted() {\r\n        this.setupCanvas();\r\n    },\r\n    methods: {\r\n        setupCanvas() {\r\n            if (this.ctx) return;\r\n            this.canvas = document.getElementById(\"tonalityCanvas\");\r\n            if (!this.canvas) {\r\n                return;\r\n            }\r\n\r\n            this.canvas.width = this.width;\r\n            this.ctx = this.canvas.getContext(\"2d\");\r\n            this.drawTonality();\r\n        },\r\n        tonalityPointerPath(tonality) {\r\n            const scale = this.co5Size / 2;\r\n            const radius = Math.tanh(tonality[this.currentFastSample][1] * 3) * 0.5;\r\n            const x = 0; // Math.cos(this.tonality[this.currentSample][0] * Math.PI * 2);\r\n            const y = -1; //Math.sin(this.tonality[this.currentSample][0] * Math.PI * 2);\r\n\r\n            let path = \"\";\r\n            path = path.concat(\" M \", scale, \" \", scale);\r\n            path = path.concat(\" L \", scale + x * scale * radius, \" \", scale + y * scale * radius);\r\n            path = path.concat(\" Z\");\r\n            return path;\r\n        },\r\n        drawTonality() {\r\n            if (!this.ctx || !this.hasTonality) {\r\n                return;\r\n            }\r\n            this.ctx.clearRect(0, 0, this.width, this.height);\r\n\r\n            for (let i = 0; i < this.tonality.length; i++) {\r\n                const x = i * this.fastSampleDuration * this.scale;\r\n\r\n                this.ctx.fillStyle = this.color(this.tonalitySlow[i][0], Math.sqrt(this.tonalitySlow[i][1] * 2), 1);\r\n                this.ctx.fillRect(\r\n                    x,\r\n                    this.sectionHeight + 2,\r\n                    this.fastSampleDuration * this.scale + 2,\r\n                    this.sectionHeight\r\n                );\r\n                this.ctx.fillStyle = this.color(this.tonality[i][0], this.tonality[i][1] * 1.5, 1);\r\n                this.ctx.fillRect(x, 0, this.fastSampleDuration * this.scale + 2, this.sectionHeight);\r\n                /*\r\n                this.ctx.fillStyle = this.color(keyDetection.circleOfFifthsAngle(this.keyFeature[i]), 1, 1);\r\n                this.ctx.fillRect(\r\n                    x,\r\n                    (this.sectionHeight + 2) * 2,\r\n                    this.fastSampleDuration * this.scale + 2,\r\n                    this.sectionHeight\r\n                );*/\r\n                /*if (i === 0 || i === 200) {\r\n                    this.ctx.fillStyle = \"white\";\r\n                    this.ctx.fillRect(\r\n                        x,\r\n                        (this.sectionHeight + 2) * 2 - 4,\r\n                        this.fastSampleDuration * this.scale + 6,\r\n                        this.sectionHeight * 2\r\n                    );\r\n                }*/\r\n            }\r\n        },\r\n        computeAccumulativeAngle(tonality) {\r\n            const accumulativeAngle = [];\r\n            let prevAngle = tonality[0][0];\r\n            let windCounter = 0;\r\n            for (let i = 0; i < tonality.length; i++) {\r\n                const current = tonality[i][0];\r\n                const passThrough0Pos = current < prevAngle && prevAngle - current > 1 + current - prevAngle;\r\n                const passThrough0Neg = current > prevAngle && current - prevAngle > 1 + prevAngle - current;\r\n                if (passThrough0Pos) windCounter++;\r\n                if (passThrough0Neg) windCounter--;\r\n                accumulativeAngle.push(windCounter + current);\r\n                prevAngle = current;\r\n            }\r\n            return accumulativeAngle;\r\n        },\r\n        color(angle, saturation = 1.3, opacity = 1) {\r\n            if (angle < 0) angle += Math.abs(Math.floor(angle));\r\n            return vis.circleOfFifthsColor(angle % 1, saturation, opacity);\r\n        },\r\n        keyName(keyNumber) {\r\n            return audioUtil.keyNames[keyNumber];\r\n        },\r\n        clickCanvas(event) {\r\n            let xNormalized = 0;\r\n            let yNormalized = 0;\r\n            if (this.$store.state.browser === \"Firefox\") {\r\n                xNormalized = event.layerX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            } else {\r\n                xNormalized = event.offsetX / this.width;\r\n                yNormalized = event.layerY / this.height;\r\n            }\r\n\r\n            player.seekS(xNormalized * this.track.getAnalysisDuration());\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.seeker {\r\n    pointer-events: none;\r\n}\r\n.circleOfFifthsTonality {\r\n    position: relative;\r\n    transition: 0.5s;\r\n}\r\n.tonalitySVG {\r\n    position: absolute;\r\n    transition: 0.5s;\r\n    top: 0;\r\n    left: 0;\r\n    z-index: 20;\r\n}\r\n.tonalityPointer {\r\n    transition: 0.15s;\r\n    z-index: 20;\r\n}\r\n.tonalityPointerSlow {\r\n    transition: 0.15s;\r\n    z-index: 20;\r\n}\r\n.CO5 {\r\n    transition: 0.5s;\r\n    overflow: hidden;\r\n    z-index: 1;\r\n    object-position: 0 0;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    opacity: 0.5;\r\n}\r\n.co5text {\r\n    font: 14px Roboto;\r\n    fill: white;\r\n    stroke: transparent;\r\n}\r\n.co5textm {\r\n    font: 12px Roboto;\r\n    fill: white;\r\n    stroke: transparent;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tonality.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tonality.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Tonality.vue?vue&type=template&id=47c37c70&scoped=true&\"\nimport script from \"./Tonality.vue?vue&type=script&lang=js&\"\nexport * from \"./Tonality.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Tonality.vue?vue&type=style&index=0&id=47c37c70&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"47c37c70\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VIcon,VRow,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"py-1\"},[_c('v-row',[_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.collapsed = !_vm.collapsed}}},[_c('v-icon',[_vm._v(\" \"+_vm._s(_vm.collapsed ? \"mdi-unfold-more-horizontal\" : \"mdi-unfold-less-horizontal\")+\" \")])],1),_c('p',[_vm._v(\" Chords \")]),_c('v-spacer'),_c('v-btn',{attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.showHelp = !_vm.showHelp}}},[_c('v-icon',{attrs:{\"color\":\"#ccc\",\"dark\":\"\"}},[_vm._v(\"mdi-help-box\")])],1),_c('Tooltip',{attrs:{\"show\":_vm.showHelp}},[_vm._v(\" This visualization shows major and minor triad chords over time. The colors and positions correspond to the circle of fifhts, such that relative minor and major chords have the same colour, with minor chords being distinguished by diagonal stripes. The \"),_c('v-icon',{attrs:{\"small\":\"\",\"color\":\"#ccc\"}},[_vm._v(\"mdi-unfold-less-horizontal\")]),_vm._v(\" button collapses the chord positions into a single row. \")],1)],1),(_vm.hasChords)?_c('Seeker',{ref:'chordsSeeker',staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.height,\"color\":'rgb(255,255,255,0.3)'}}):_vm._e(),(_vm.hasChords)?_c('svg',{staticClass:\"chordsSVG\",attrs:{\"width\":_vm.width,\"height\":_vm.height}},[_c('ClickableBackground',{attrs:{\"width\":_vm.width,\"height\":_vm.height}}),_c('defs',[_c('pattern',{attrs:{\"id\":\"textureDiagonal\",\"width\":\"4\",\"height\":\"4\",\"patternUnits\":\"userSpaceOnUse\",\"patternContentUnits\":\"userSpaceOnUse\"}},[_c('path',{staticStyle:{\"stroke\":\"#999999\",\"stroke-width\":\"1\"},attrs:{\"d\":\"M-1,1 l2,-2\\n                        M0,4 l4,-4\\n                        M3,5 l2,-2\"}})]),_c('pattern',{attrs:{\"id\":\"texture\",\"width\":\"4\",\"height\":\"1\",\"patternUnits\":\"userSpaceOnUse\",\"patternContentUnits\":\"userSpaceOnUse\"}},[_c('path',{staticStyle:{\"stroke\":\"#414141\",\"stroke-width\":\"1\"},attrs:{\"d\":\"M 0 0 l 10 0\"}})]),_c('mask',{attrs:{\"id\":\"diagonalMask\",\"x\":\"0\",\"y\":\"0\",\"width\":\"1\",\"height\":\"1\"}},[_c('rect',{attrs:{\"x\":\"0\",\"y\":\"0\",\"width\":\"1000\",\"height\":\"1000\",\"fill\":\"url(#textureDiagonal)\"}})])]),_vm._l((_vm.chords),function(chord,index){return _c('rect',{key:index + 'chord',staticClass:\"chord\",attrs:{\"rx\":\"3\",\"x\":chord.start * _vm.scale + 0.5,\"y\":_vm.collapsed ? '0' : ((2 - chord.angle + _vm.chordGapOffset) % 1) * (_vm.height - _vm.blockHeight) + 0.5,\"width\":(chord.end - chord.start) * _vm.scale - 0.5,\"height\":_vm.blockHeight - 0.5,\"fill\":_vm.color(chord)},on:{\"click\":function($event){return _vm.clickedChord(chord)}}})}),_vm._l((_vm.chords),function(chord,index){return _c('rect',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.isMajor(chord)),expression:\"!isMajor(chord)\"}],key:index + 'chordoverlay',staticClass:\"chordoverlay\",attrs:{\"rx\":\"3\",\"x\":chord.start * _vm.scale + 0.5,\"y\":_vm.collapsed ? '0' : ((2 - chord.angle + _vm.chordGapOffset) % 1) * (_vm.height - _vm.blockHeight) + 0.5,\"width\":(chord.end - chord.start) * _vm.scale - 0.5,\"height\":_vm.blockHeight - 0.5,\"fill\":_vm.colorBrightness(chord, 0.02),\"mask\":\"url(#diagonalMask)\"},on:{\"click\":function($event){return _vm.clickedChord(chord)}}})})],2):_vm._e(),_c('canvas',{staticClass:\"chordNameCanvas\",attrs:{\"id\":\"chordNameCanvas\",\"width\":_vm.width,\"height\":_vm.chordNameHeight}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"py-1\">\r\n        <v-row>\r\n            <v-btn icon small @click=\"collapsed = !collapsed\">\r\n                <v-icon>\r\n                    {{ collapsed ? \"mdi-unfold-more-horizontal\" : \"mdi-unfold-less-horizontal\" }}\r\n                </v-icon>\r\n            </v-btn>\r\n            <p>\r\n                Chords\r\n            </p>\r\n            <v-spacer></v-spacer>\r\n            <v-btn icon small @click=\"showHelp = !showHelp\"> <v-icon color=\"#ccc\" dark>mdi-help-box</v-icon> </v-btn>\r\n            <Tooltip :show=\"showHelp\">\r\n                This visualization shows major and minor triad chords over time. The colors and positions correspond to\r\n                the circle of fifhts, such that relative minor and major chords have the same colour, with minor chords\r\n                being distinguished by diagonal stripes. The\r\n                <v-icon small color=\"#ccc\">mdi-unfold-less-horizontal</v-icon> button collapses the chord positions into\r\n                a single row.\r\n            </Tooltip>\r\n        </v-row>\r\n\r\n        <Seeker\r\n            v-if=\"hasChords\"\r\n            class=\"seeker\"\r\n            :ref=\"'chordsSeeker'\"\r\n            :width=\"width\"\r\n            :height=\"height\"\r\n            :color=\"'rgb(255,255,255,0.3)'\"\r\n        />\r\n        <svg v-if=\"hasChords\" class=\"chordsSVG\" :width=\"width\" :height=\"height\">\r\n            <ClickableBackground :width=\"width\" :height=\"height\"></ClickableBackground>\r\n            <defs>\r\n                <pattern\r\n                    id=\"textureDiagonal\"\r\n                    width=\"4\"\r\n                    height=\"4\"\r\n                    patternUnits=\"userSpaceOnUse\"\r\n                    patternContentUnits=\"userSpaceOnUse\"\r\n                >\r\n                    <path\r\n                        d=\"M-1,1 l2,-2\r\n                            M0,4 l4,-4\r\n                            M3,5 l2,-2\"\r\n                        style=\"stroke:#999999; stroke-width:1\"\r\n                    />\r\n                </pattern>\r\n                <pattern\r\n                    id=\"texture\"\r\n                    width=\"4\"\r\n                    height=\"1\"\r\n                    patternUnits=\"userSpaceOnUse\"\r\n                    patternContentUnits=\"userSpaceOnUse\"\r\n                >\r\n                    <path d=\"M 0 0 l 10 0\" style=\"stroke:#414141; stroke-width:1\" />\r\n                </pattern>\r\n                <mask id=\"diagonalMask\" x=\"0\" y=\"0\" width=\"1\" height=\"1\">\r\n                    <rect x=\"0\" y=\"0\" width=\"1000\" height=\"1000\" fill=\"url(#textureDiagonal)\" />\r\n                </mask>\r\n            </defs>\r\n            <!--<rect\r\n                v-for=\"(chord, index) in chords\"\r\n                :key=\"index + 'chord'\"\r\n                class=\"chord\"\r\n                rx=\"3\"\r\n                :x=\"chord.start * scale + 0.5\"\r\n                :y=\"height - chord.index * blockHeight - blockHeight\"\r\n                :width=\"(chord.end - chord.start) * scale - 0.5\"\r\n                :height=\"blockHeight - 0.5\"\r\n                :fill=\"'black'\"\r\n                @click=\"clickedChord(chord)\"\r\n            ></rect>-->\r\n            <rect\r\n                v-for=\"(chord, index) in chords\"\r\n                :key=\"index + 'chord'\"\r\n                class=\"chord\"\r\n                rx=\"3\"\r\n                :x=\"chord.start * scale + 0.5\"\r\n                :y=\"collapsed ? '0' : ((2 - chord.angle + chordGapOffset) % 1) * (height - blockHeight) + 0.5\"\r\n                :width=\"(chord.end - chord.start) * scale - 0.5\"\r\n                :height=\"blockHeight - 0.5\"\r\n                :fill=\"color(chord)\"\r\n                @click=\"clickedChord(chord)\"\r\n            ></rect>\r\n            <rect\r\n                v-for=\"(chord, index) in chords\"\r\n                :key=\"index + 'chordoverlay'\"\r\n                v-show=\"!isMajor(chord)\"\r\n                class=\"chordoverlay\"\r\n                rx=\"3\"\r\n                :x=\"chord.start * scale + 0.5\"\r\n                :y=\"collapsed ? '0' : ((2 - chord.angle + chordGapOffset) % 1) * (height - blockHeight) + 0.5\"\r\n                :width=\"(chord.end - chord.start) * scale - 0.5\"\r\n                :height=\"blockHeight - 0.5\"\r\n                :fill=\"colorBrightness(chord, 0.02)\"\r\n                mask=\"url(#diagonalMask)\"\r\n                @click=\"clickedChord(chord)\"\r\n            />\r\n        </svg>\r\n        <canvas id=\"chordNameCanvas\" class=\"chordNameCanvas\" :width=\"width\" :height=\"chordNameHeight\"></canvas>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n// chord.index/ 12 %1\r\n// (chord.index < 12 ? chord.index / 12 : (chord.index + (3 % 12)) / 12)\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport Section from \"./Section\";\r\nimport ClickableBackground from \"./ClickableBackground\";\r\nimport StructureBackground from \"./StructureBackground\";\r\nimport Tooltip from \"./Tooltip\";\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\nimport * as player from \"../../app/player\";\r\nimport Vue from \"vue\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n        ClickableBackground,\r\n        Tooltip,\r\n    },\r\n    data() {\r\n        return {\r\n            blockHeight: 10,\r\n            chordNameHeight: 20,\r\n            maxChordViewDistance: 10,\r\n            canvas: null,\r\n            ctx: null,\r\n            collapsed: false,\r\n            showHelp: false,\r\n        };\r\n    },\r\n    computed: {\r\n        height() {\r\n            return this.blockHeight * (this.collapsed ? 1 : 12);\r\n        },\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        seekerTime() {\r\n            return this.$store.getters.seeker / 1000;\r\n        },\r\n        hasChords() {\r\n            return this.track && this.track.chords && this.track.chords.length > 0;\r\n        },\r\n        chords() {\r\n            return this.track.chords;\r\n        },\r\n        currentChord() {\r\n            return this.chords.find((chord) => this.isPlayingChord(chord, this.seekerTime)) || { name: \"\" };\r\n        },\r\n        chordScrollMiddle() {\r\n            return 50;\r\n            //return this.seekerTime * this.scale;\r\n        },\r\n        chordGapOffset() {\r\n            const chordTotalDuration = new Float32Array(12);\r\n\r\n            this.chords.forEach((chord) => {\r\n                chordTotalDuration[Math.round(chord.angle * 12)] += chord.end - chord.start;\r\n            });\r\n\r\n            let min = Number.POSITIVE_INFINITY;\r\n            let minIndex = -1;\r\n            for (let i = 0; i < 12; i++) {\r\n                if (chordTotalDuration[i] < min) {\r\n                    min = chordTotalDuration[i];\r\n                    minIndex = i;\r\n                }\r\n            }\r\n\r\n            log.debug(\"Chord total duration\", chordTotalDuration);\r\n            return minIndex / 12;\r\n        },\r\n    },\r\n    watch: {\r\n        seekerTime() {\r\n            this.drawChordNames();\r\n        },\r\n        hasChords() {\r\n            this.setupCanvas();\r\n        },\r\n    },\r\n    mounted() {\r\n        this.setupCanvas();\r\n    },\r\n    methods: {\r\n        setupCanvas() {\r\n            if (this.ctx) return;\r\n            this.canvas = document.getElementById(\"chordNameCanvas\");\r\n            if (!this.canvas) {\r\n                return;\r\n            }\r\n            this.canvas.width = this.width;\r\n            this.ctx = this.canvas.getContext(\"2d\");\r\n            this.drawChordNames();\r\n        },\r\n        drawChordNames() {\r\n            if (!this.ctx || !this.hasChords) {\r\n                log.debug(\"No drawing\");\r\n                return;\r\n            }\r\n            this.ctx.fillStyle = \"white\";\r\n            this.ctx.clearRect(0, 0, this.width, this.chordNameHeight);\r\n            //this.ctx.fillRect(0, 0, this.width, this.chordNameHeight);\r\n\r\n            const lineStep = this.chordNameHeight;\r\n\r\n            this.ctx.fillStyle = \"white\";\r\n            this.chords.forEach((chord) => {\r\n                const chordSeekerStartOffset = chord.start - this.seekerTime;\r\n                let startX = this.chordScrollMiddle + chordSeekerStartOffset * this.scale * 22;\r\n                const chordSeekerEndOffset = chord.end - this.seekerTime;\r\n                const endX = this.chordScrollMiddle + chordSeekerEndOffset * this.scale * 22;\r\n\r\n                if (chordSeekerEndOffset > 0 && chordSeekerStartOffset < this.maxChordViewDistance) {\r\n                    if (chord.start <= this.seekerTime) {\r\n                        this.ctx.fillStyle = this.color(chord, 1);\r\n                        if (endX - this.chordScrollMiddle - 3 > 6) {\r\n                            this.roundedRect(\r\n                                this.chordScrollMiddle,\r\n                                0,\r\n                                endX - this.chordScrollMiddle - 3,\r\n                                this.chordNameHeight,\r\n                                3\r\n                            );\r\n                            this.ctx.strokeStyle = \"rgba(0,0,0,0.3)\";\r\n                            this.ctx.lineWidth = 3;\r\n                            const textSpaceOffset = chord.name.length * 12;\r\n                            if (!this.isMajor(chord)) {\r\n                                for (let i = startX + textSpaceOffset; i < endX; i += lineStep / 2) {\r\n                                    if (i < this.chordScrollMiddle - lineStep) continue;\r\n                                    this.ctx.beginPath();\r\n                                    this.ctx.moveTo(i, this.chordNameHeight);\r\n                                    if (i + lineStep > endX - 3) {\r\n                                        this.ctx.lineTo(\r\n                                            endX - 3,\r\n                                            this.chordNameHeight + 3 - (lineStep - (lineStep + i - endX))\r\n                                        );\r\n                                    } else {\r\n                                        this.ctx.lineTo(i + lineStep, 0);\r\n                                    }\r\n                                    this.ctx.stroke();\r\n                                }\r\n                                this.ctx.fillStyle = \"#121212\";\r\n                                this.ctx.fillRect(this.chordScrollMiddle - lineStep, 0, lineStep, this.chordNameHeight);\r\n                            }\r\n                        }\r\n\r\n                        this.ctx.fillStyle = \"white\";\r\n                        this.ctx.font = \"18px Roboto\";\r\n\r\n                        this.ctx.fillText(chord.name, this.chordScrollMiddle - 50 + 2, this.chordNameHeight - 4);\r\n                    } else {\r\n                        const opacity = 1 - chordSeekerStartOffset / this.maxChordViewDistance;\r\n                        this.ctx.fillStyle = this.color(chord, opacity * 1.5);\r\n                        this.roundedRect(startX, 0, endX - startX - 3, this.chordNameHeight, 3);\r\n                        this.ctx.strokeStyle = \"rgba(0,0,0,0.3)\";\r\n                        this.ctx.font = \"14px Roboto\";\r\n                        this.ctx.lineWidth = 3;\r\n                        if (!this.isMajor(chord)) {\r\n                            const textSpaceOffset = chord.name.length * 12;\r\n                            for (let i = startX + textSpaceOffset; i < endX; i += lineStep / 2) {\r\n                                this.ctx.beginPath();\r\n                                this.ctx.moveTo(i, this.chordNameHeight);\r\n                                if (i + lineStep > endX - 3) {\r\n                                    this.ctx.lineTo(\r\n                                        endX - 3,\r\n                                        this.chordNameHeight + 3 - (lineStep - (lineStep + i - endX))\r\n                                    );\r\n                                } else {\r\n                                    this.ctx.lineTo(i + lineStep, 0);\r\n                                }\r\n                                this.ctx.stroke();\r\n                            }\r\n                        }\r\n\r\n                        this.ctx.fillStyle = `rgba(0,0,0,${opacity * 2})`;\r\n\r\n                        this.ctx.fillText(chord.name, startX + 2, this.chordNameHeight - 4);\r\n                    }\r\n                }\r\n            });\r\n            this.ctx.fillRect(this.chordScrollMiddle - 1, 0, 2, this.chordNameHeight);\r\n        },\r\n        roundedRect(x, y, width, height, radius) {\r\n            this.ctx.beginPath();\r\n            this.ctx.moveTo(x + width, y + height);\r\n            this.ctx.arcTo(x, y + height, x, y, radius);\r\n            this.ctx.arcTo(x, y, x + width, y, radius);\r\n            this.ctx.arcTo(x + width, y, x + width, y + height, radius);\r\n            this.ctx.arcTo(x + width, y + height, x, y + height, radius);\r\n            this.ctx.fill();\r\n        },\r\n        color(chord, confidence = 1) {\r\n            return vis.circleOfFifthsColor(chord.angle % 1, 1, confidence);\r\n            //return vis.circleOfFifthsColor(chord.angle % 1, chord.index > 11 ? 1 : 0.8, chord.index > 11 ? 1 : 0.8);\r\n        },\r\n        colorBrightness(chord, brightness) {\r\n            return vis.circleOfFifthsColorBrightness(chord.angle % 1, 0.5, brightness);\r\n        },\r\n        isMajor(chord) {\r\n            return chord.index <= 11;\r\n        },\r\n        isPlayingChord(chord) {\r\n            return this.seekerTime >= chord.start && this.seekerTime < chord.end;\r\n        },\r\n        clickedChord(chord) {\r\n            player.seekS(chord.start);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.seeker {\r\n    pointer-events: none;\r\n}\r\n.chord {\r\n    transition: 0.3s;\r\n}\r\n.chordoverlay {\r\n    transition: 0.3s;\r\n}\r\n.chordoverlay:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n.chordsSVG {\r\n    transition: 0.3s;\r\n}\r\n.chordsBackground {\r\n    transition: 0.3s;\r\n}\r\n.chord:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chords.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chords.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Chords.vue?vue&type=template&id=77fbb0a5&scoped=true&\"\nimport script from \"./Chords.vue?vue&type=script&lang=js&\"\nexport * from \"./Chords.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Chords.vue?vue&type=style&index=0&id=77fbb0a5&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"77fbb0a5\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VIcon,VRow,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.track && _vm.hasFeatures)?_c('div',[_c('v-row',[_c('v-btn',{staticClass:\"pa-0 ma-0\",attrs:{\"icon\":\"\",\"small\":\"\"},on:{\"click\":function($event){_vm.expanded = !_vm.expanded}}},[_c('v-icon',[_vm._v(_vm._s(_vm.expanded ? \"mdi-chevron-up\" : \"mdi-chevron-down\"))])],1),_c('p',{staticClass:\"pa-0 ma-0\",on:{\"click\":function($event){_vm.expanded = !_vm.expanded}}},[_vm._v(_vm._s(_vm.feature.name))])],1),_c('v-expand-transition',[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.expanded),expression:\"expanded\"}]},[_c('Seeker',{attrs:{\"width\":_vm.width,\"height\":_vm.height}}),_c('svg',{attrs:{\"width\":_vm.width + 25,\"height\":_vm.height}},[_c('rect',{attrs:{\"x\":\"0\",\"width\":_vm.width,\"y\":_vm.height -\n                            (_vm.height * this.offsetHeight) / 2 -\n                            _vm.height * (this.avgPos - (3.5 * this.offsetHeight) / 2),\"height\":(_vm.height * this.offsetHeight) / 2,\"opacity\":\".1\",\"fill\":\"grey\"}}),_c('rect',{attrs:{\"x\":\"0\",\"width\":_vm.width,\"y\":_vm.height -\n                            (_vm.height * this.offsetHeight) / 2 -\n                            _vm.height * (this.avgPos - (2.5 * this.offsetHeight) / 2),\"height\":(_vm.height * this.offsetHeight) / 2,\"opacity\":\".1\",\"fill\":\"white\"}}),_c('rect',{attrs:{\"x\":\"0\",\"width\":_vm.width,\"y\":_vm.height -\n                            (_vm.height * this.offsetHeight) / 2 -\n                            _vm.height * (this.avgPos - (1.5 * this.offsetHeight) / 2),\"height\":(_vm.height * this.offsetHeight) / 2,\"opacity\":\".1\",\"fill\":\"grey\"}}),_c('rect',{attrs:{\"x\":\"0\",\"width\":_vm.width,\"y\":_vm.height - (_vm.height * this.offsetHeight) / 2 - _vm.height * (this.avgPos - this.offsetHeight / 4),\"height\":(_vm.height * this.offsetHeight) / 2,\"opacity\":\".2\",\"fill\":\"white\"}}),_c('rect',{attrs:{\"x\":\"0\",\"width\":_vm.width,\"y\":_vm.height - (_vm.height * this.offsetHeight) / 2 - _vm.height * (this.avgPos + this.offsetHeight / 4),\"height\":(_vm.height * this.offsetHeight) / 2,\"opacity\":\".1\",\"fill\":\"grey\"}}),_c('rect',{attrs:{\"x\":\"0\",\"width\":_vm.width,\"y\":_vm.height -\n                            (_vm.height * this.offsetHeight) / 2 -\n                            _vm.height * (this.avgPos + (1.5 * this.offsetHeight) / 2),\"height\":(_vm.height * this.offsetHeight) / 2,\"opacity\":\".1\",\"fill\":\"white\"}}),_c('rect',{attrs:{\"x\":\"0\",\"width\":_vm.width,\"y\":_vm.height -\n                            (_vm.height * this.offsetHeight) / 2 -\n                            _vm.height * (this.avgPos + (2.5 * this.offsetHeight) / 2),\"height\":(_vm.height * this.offsetHeight) / 2,\"opacity\":\".1\",\"fill\":\"grey\"}}),_c('path',{staticClass:\"graphPath\",attrs:{\"fill\":\"none\",\"stroke\":\"white\",\"stroke-width\":\"2\",\"d\":_vm.d}}),_c('text',{attrs:{\"x\":_vm.width + 2,\"y\":\"7\",\"font-size\":\"10\",\"fill\":\"white\"}},[_vm._v(_vm._s(parseFloat(_vm.max).toFixed(2)))]),_c('text',{attrs:{\"x\":_vm.width + 2,\"y\":_vm.height,\"font-size\":\"10\",\"fill\":\"white\"}},[_vm._v(\" \"+_vm._s(parseFloat(_vm.min).toFixed(2))+\" \")]),_c('text',{attrs:{\"x\":_vm.width + 2,\"y\":_vm.height - _vm.height * ((this.feature.avg - this.min) / (this.max - this.min)),\"font-size\":\"10\",\"fill\":\"white\"}},[_vm._v(\" \"+_vm._s(parseFloat(this.feature.avg).toFixed(2))+\" \")])])],1)])],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div v-if=\"track && hasFeatures\">\r\n        <v-row>\r\n            <v-btn icon small class=\"pa-0 ma-0\" @click=\"expanded = !expanded\"\r\n                ><v-icon>{{ expanded ? \"mdi-chevron-up\" : \"mdi-chevron-down\" }}</v-icon>\r\n            </v-btn>\r\n            <p @click=\"expanded = !expanded\" class=\"pa-0 ma-0\">{{ feature.name }}</p>\r\n        </v-row>\r\n        <v-expand-transition>\r\n            <div v-show=\"expanded\">\r\n                <Seeker :width=\"width\" :height=\"height\" />\r\n                <svg :width=\"width + 25\" :height=\"height\">\r\n                    <rect\r\n                        x=\"0\"\r\n                        :width=\"width\"\r\n                        :y=\"\r\n                            height -\r\n                                (height * this.offsetHeight) / 2 -\r\n                                height * (this.avgPos - (3.5 * this.offsetHeight) / 2)\r\n                        \"\r\n                        :height=\"(height * this.offsetHeight) / 2\"\r\n                        opacity=\".1\"\r\n                        fill=\"grey\"\r\n                    ></rect>\r\n                    <rect\r\n                        x=\"0\"\r\n                        :width=\"width\"\r\n                        :y=\"\r\n                            height -\r\n                                (height * this.offsetHeight) / 2 -\r\n                                height * (this.avgPos - (2.5 * this.offsetHeight) / 2)\r\n                        \"\r\n                        :height=\"(height * this.offsetHeight) / 2\"\r\n                        opacity=\".1\"\r\n                        fill=\"white\"\r\n                    ></rect>\r\n                    <rect\r\n                        x=\"0\"\r\n                        :width=\"width\"\r\n                        :y=\"\r\n                            height -\r\n                                (height * this.offsetHeight) / 2 -\r\n                                height * (this.avgPos - (1.5 * this.offsetHeight) / 2)\r\n                        \"\r\n                        :height=\"(height * this.offsetHeight) / 2\"\r\n                        opacity=\".1\"\r\n                        fill=\"grey\"\r\n                    ></rect>\r\n                    <rect\r\n                        x=\"0\"\r\n                        :width=\"width\"\r\n                        :y=\"height - (height * this.offsetHeight) / 2 - height * (this.avgPos - this.offsetHeight / 4)\"\r\n                        :height=\"(height * this.offsetHeight) / 2\"\r\n                        opacity=\".2\"\r\n                        fill=\"white\"\r\n                    ></rect>\r\n                    <rect\r\n                        x=\"0\"\r\n                        :width=\"width\"\r\n                        :y=\"height - (height * this.offsetHeight) / 2 - height * (this.avgPos + this.offsetHeight / 4)\"\r\n                        :height=\"(height * this.offsetHeight) / 2\"\r\n                        opacity=\".1\"\r\n                        fill=\"grey\"\r\n                    ></rect>\r\n                    <rect\r\n                        x=\"0\"\r\n                        :width=\"width\"\r\n                        :y=\"\r\n                            height -\r\n                                (height * this.offsetHeight) / 2 -\r\n                                height * (this.avgPos + (1.5 * this.offsetHeight) / 2)\r\n                        \"\r\n                        :height=\"(height * this.offsetHeight) / 2\"\r\n                        opacity=\".1\"\r\n                        fill=\"white\"\r\n                    ></rect>\r\n                    <rect\r\n                        x=\"0\"\r\n                        :width=\"width\"\r\n                        :y=\"\r\n                            height -\r\n                                (height * this.offsetHeight) / 2 -\r\n                                height * (this.avgPos + (2.5 * this.offsetHeight) / 2)\r\n                        \"\r\n                        :height=\"(height * this.offsetHeight) / 2\"\r\n                        opacity=\".1\"\r\n                        fill=\"grey\"\r\n                    ></rect>\r\n                    <path fill=\"none\" stroke=\"white\" stroke-width=\"2\" :d=\"d\" class=\"graphPath\" />\r\n\r\n                    <text :x=\"width + 2\" y=\"7\" font-size=\"10\" fill=\"white\">{{ parseFloat(max).toFixed(2) }}</text>\r\n                    <text :x=\"width + 2\" :y=\"height\" font-size=\"10\" fill=\"white\">\r\n                        {{ parseFloat(min).toFixed(2) }}\r\n                    </text>\r\n                    <text\r\n                        :x=\"width + 2\"\r\n                        :y=\"height - height * ((this.feature.avg - this.min) / (this.max - this.min))\"\r\n                        font-size=\"10\"\r\n                        fill=\"white\"\r\n                    >\r\n                        {{ parseFloat(this.feature.avg).toFixed(2) }}\r\n                    </text>\r\n                </svg>\r\n            </div>\r\n        </v-expand-transition>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as d3 from \"d3\";\r\nimport * as log from \"../../dev/log\";\r\nimport Seeker from \"./Seeker\";\r\n\r\nexport default {\r\n    props: [\"width\", \"height\", \"featureIndex\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            range: [-5, -4, -3, -2, -1, 1, 2, 3, 4, 5],\r\n            bgOffset: 0.1,\r\n            expanded: true,\r\n            max: 0,\r\n            min: 0,\r\n            d: null,\r\n        };\r\n    },\r\n    watch: {\r\n        track() {\r\n            this.generateLine();\r\n        },\r\n        width() {\r\n            this.generateLine();\r\n        },\r\n        feature() {\r\n            this.generateLine();\r\n        },\r\n        expanded() {\r\n            this.generateLine();\r\n        },\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        hasFeatures() {\r\n            return this.track.tempoFeature.data.length > 0;\r\n        },\r\n        feature() {\r\n            return this.track.tempoFeature;\r\n        },\r\n        step() {\r\n            return this.width / (this.feature.data.length - 1);\r\n        },\r\n        lineGenerator() {\r\n            return d3\r\n                .line()\r\n                .x((v, i) => {\r\n                    return (this.width / (this.feature.data.length - 1)) * i;\r\n                })\r\n                .y((v) => {\r\n                    return this.height - this.lmap(v, this.min, this.max) * this.height;\r\n                });\r\n        },\r\n        avgPos() {\r\n            return this.lmap(this.feature.avg, this.min, this.max);\r\n        },\r\n        offsetHeight() {\r\n            return (this.feature.avg * this.bgOffset) / (this.max - this.min);\r\n        },\r\n    },\r\n    mounted() {\r\n        this.generateLine();\r\n        window.eventBus.$on(\"featuresProcessed\", () => {\r\n            log.debug(\"FEATURESPROCESSEDFROMTempo\");\r\n            this.generateLine();\r\n        });\r\n    },\r\n    methods: {\r\n        lmap(val, min, max) {\r\n            return (val - min) / (max - min);\r\n        },\r\n        generateLine() {\r\n            this.min = this.feature.avg * (1 - this.bgOffset);\r\n            this.max = this.feature.avg * (1 + this.bgOffset);\r\n            if (this.feature.min < this.min) {\r\n                this.min = this.feature.min;\r\n            }\r\n            if (this.feature.max > this.max) {\r\n                this.max = this.feature.max;\r\n            }\r\n            this.d = this.lineGenerator(this.feature.data);\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.graphTitle {\r\n    color: white;\r\n}\r\n.icon__flip {\r\n    -moz-transform: scaleX(-1);\r\n    -o-transform: scaleX(-1);\r\n    -webkit-transform: scaleX(-1);\r\n    transform: scaleX(-1);\r\n    filter: FlipH;\r\n    -ms-filter: \"FlipH\";\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tempo.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tempo.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Tempo.vue?vue&type=template&id=348ed111&\"\nimport script from \"./Tempo.vue?vue&type=script&lang=js&\"\nexport * from \"./Tempo.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Tempo.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VExpandTransition } from 'vuetify/lib/components/transitions';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VExpandTransition,VIcon,VRow})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"py-5\"},[_c('Seeker',{ref:'holisticSeeker',staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.height,\"color\":'rgb(255,255,255,0.5)'}}),_c('svg',{staticClass:\"timbreGraphSVG\",attrs:{\"width\":_vm.width,\"height\":_vm.height}},[_c('defs',[_c('linearGradient',{attrs:{\"id\":\"pathGradient\",\"x1\":\"0\",\"x2\":\"0\",\"y1\":\"0\",\"y2\":\"1\"}},_vm._l((_vm.gradientSteps),function(gradientStep){return _c('stop',{key:gradientStep,style:((\"stop-color:\" + (_vm.color(1 - gradientStep)) + \";stop-opacity:1\")),attrs:{\"offset\":(\"\" + gradientStep)}})}),1)],1),_c('rect',{staticClass:\"timbreGraphBackground\",attrs:{\"width\":_vm.width,\"height\":_vm.height,\"opacity\":\"0\"},on:{\"click\":function($event){return _vm.clickBackground($event)}}}),(_vm.timbreFeatureGraph && _vm.showPath)?_c('path',{staticClass:\"timbreGraph\",attrs:{\"fill\":\"none\",\"stroke\":_vm.showPathGradient ? 'url(#pathGradient)' : 'white',\"opacity\":_vm.showPathGradient ? '1' : '0.2',\"stroke-width\":\"2\",\"stroke-linejoin\":\"round\",\"d\":_vm.timbreFeatureGraphPath}}):_vm._e(),(_vm.showPoints)?_c('g',[_vm._l((_vm.timbreFeatureGraph),function(sample,index){return _c('rect',{key:index,staticClass:\"sample\",attrs:{\"stroke\":\"black\",\"stroke-width\":\".5\",\"rx\":\"5\",\"x\":index * _vm.sampleWidth - _vm.sampleWidth / 2,\"y\":_vm.height - _vm.sampleWidth * 2 - sample.mdsFeature * (_vm.height - _vm.sampleWidth * 2),\"width\":_vm.sampleWidth,\"height\":_vm.sampleWidth * 2,\"fill\":_vm.color(sample.mdsFeature)}})}),_vm._l((_vm.timbreFeatureGraph),function(sample,index){return _c('rect',{key:index,staticClass:\"sample\",attrs:{\"stroke\":\"black\",\"stroke-width\":\".5\",\"rx\":\"5\",\"x\":index * _vm.sampleWidth - _vm.sampleWidth / 2,\"width\":_vm.sampleWidth,\"height\":_vm.sampleWidth * 2,\"fill\":_vm.color(sample.mdsFeature)}})})],2):_vm._e()]),_c('v-row',[_vm._l((_vm.timbreSlider),function(sliderValue,index){return _c('v-col',{key:index,attrs:{\"align\":\"center\"}},[_c('v-img',{staticClass:\"timbreImage pa-0 ma-0\",attrs:{\"max-width\":\"40\",\"src\":require((\"../../assets/timbres/\" + index + \".png\"))}}),_c('v-slider',{attrs:{\"dense\":\"\",\"disabled\":_vm.disabled[index],\"vertical\":\"\",\"thumb-label\":\"\",\"min\":\"-1\",\"max\":\"1\",\"step\":\"0.05\",\"color\":\"dark\",\"track-color\":\"dark\",\"thumb-color\":_vm.disabled[index] ? '#414141' : 'primary'},on:{\"click\":function($event){return _vm.click($event, index)},\"mousedown\":function($event){_vm.mousedown = true},\"mouseup\":function($event){_vm.mousedown = false}},model:{value:(_vm.timbreSlider[index]),callback:function ($$v) {_vm.$set(_vm.timbreSlider, index, $$v)},expression:\"timbreSlider[index]\"}}),_c('v-btn',{attrs:{\"small\":\"\",\"icon\":\"\",\"color\":_vm.solod[index] ? 'primary' : '#414141'},on:{\"click\":function($event){return _vm.solo(index)}}},[_c('v-icon',[_vm._v(\"mdi-headphones\")])],1),_c('v-btn',{attrs:{\"small\":\"\",\"icon\":\"\",\"color\":_vm.muted[index] ? 'primary' : '#414141'},on:{\"click\":function($event){return _vm.mute(index)}}},[_c('v-icon',[_vm._v(\"mdi-volume-off\")])],1)],1)}),_c('v-col',[_c('v-btn',{attrs:{\"icon\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.resetSliders()}}},[_c('v-icon',[_vm._v(\"mdi-cached\")])],1),_c('v-btn',{attrs:{\"icon\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.setPreset(_vm.presets.test)}}},[_c('v-icon',[_vm._v(\"mdi-eye\")])],1),_c('v-btn',{attrs:{\"icon\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.setPreset(_vm.presets.all)}}},[_c('v-icon',[_vm._v(\"mdi-arrow-up-bold\")])],1)],1)],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"py-5\">\r\n        <Seeker\r\n            class=\"seeker\"\r\n            :ref=\"'holisticSeeker'\"\r\n            :width=\"width\"\r\n            :height=\"height\"\r\n            :color=\"'rgb(255,255,255,0.5)'\"\r\n        />\r\n        <svg class=\"timbreGraphSVG\" :width=\"width\" :height=\"height\">\r\n            <defs>\r\n                <linearGradient id=\"pathGradient\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\r\n                    <stop\r\n                        v-for=\"gradientStep in gradientSteps\"\r\n                        :key=\"gradientStep\"\r\n                        :offset=\"`${gradientStep}`\"\r\n                        :style=\"`stop-color:${color(1 - gradientStep)};stop-opacity:1`\"\r\n                    />\r\n                </linearGradient>\r\n            </defs>\r\n            <rect\r\n                class=\"timbreGraphBackground\"\r\n                :width=\"width\"\r\n                :height=\"height\"\r\n                opacity=\"0\"\r\n                @click=\"clickBackground($event)\"\r\n            ></rect>\r\n            <path\r\n                v-if=\"timbreFeatureGraph && showPath\"\r\n                fill=\"none\"\r\n                :stroke=\"showPathGradient ? 'url(#pathGradient)' : 'white'\"\r\n                :opacity=\"showPathGradient ? '1' : '0.2'\"\r\n                stroke-width=\"2\"\r\n                stroke-linejoin=\"round\"\r\n                :d=\"timbreFeatureGraphPath\"\r\n                class=\"timbreGraph\"\r\n            />\r\n            <g v-if=\"showPoints\">\r\n                <rect\r\n                    v-for=\"(sample, index) in timbreFeatureGraph\"\r\n                    :key=\"index\"\r\n                    class=\"sample\"\r\n                    stroke=\"black\"\r\n                    stroke-width=\".5\"\r\n                    rx=\"5\"\r\n                    :x=\"index * sampleWidth - sampleWidth / 2\"\r\n                    :y=\"height - sampleWidth * 2 - sample.mdsFeature * (height - sampleWidth * 2)\"\r\n                    :width=\"sampleWidth\"\r\n                    :height=\"sampleWidth * 2\"\r\n                    :fill=\"color(sample.mdsFeature)\"\r\n                ></rect>\r\n                <rect\r\n                    v-for=\"(sample, index) in timbreFeatureGraph\"\r\n                    :key=\"index\"\r\n                    class=\"sample\"\r\n                    stroke=\"black\"\r\n                    stroke-width=\".5\"\r\n                    rx=\"5\"\r\n                    :x=\"index * sampleWidth - sampleWidth / 2\"\r\n                    :width=\"sampleWidth\"\r\n                    :height=\"sampleWidth * 2\"\r\n                    :fill=\"color(sample.mdsFeature)\"\r\n                ></rect>\r\n            </g>\r\n        </svg>\r\n        <v-row>\r\n            <v-col align=\"center\" v-for=\"(sliderValue, index) in timbreSlider\" :key=\"index\">\r\n                <v-img\r\n                    class=\"timbreImage pa-0 ma-0\"\r\n                    max-width=\"40\"\r\n                    :src=\"require(`../../assets/timbres/${index}.png`)\"\r\n                ></v-img>\r\n                <v-slider\r\n                    dense\r\n                    :disabled=\"disabled[index]\"\r\n                    v-model=\"timbreSlider[index]\"\r\n                    vertical\r\n                    thumb-label\r\n                    min=\"-1\"\r\n                    max=\"1\"\r\n                    step=\"0.05\"\r\n                    color=\"dark\"\r\n                    track-color=\"dark\"\r\n                    :thumb-color=\"disabled[index] ? '#414141' : 'primary'\"\r\n                    @click=\"click($event, index)\"\r\n                    @mousedown=\"mousedown = true\"\r\n                    @mouseup=\"mousedown = false\"\r\n                ></v-slider>\r\n\r\n                <v-btn small icon :color=\"solod[index] ? 'primary' : '#414141'\" @click=\"solo(index)\">\r\n                    <v-icon>mdi-headphones</v-icon>\r\n                </v-btn>\r\n                <v-btn small icon :color=\"muted[index] ? 'primary' : '#414141'\" @click=\"mute(index)\">\r\n                    <v-icon>mdi-volume-off</v-icon>\r\n                </v-btn>\r\n            </v-col>\r\n            <v-col>\r\n                <v-btn icon color=\"primary\" @click=\"resetSliders()\">\r\n                    <v-icon>mdi-cached</v-icon>\r\n                </v-btn>\r\n                <v-btn icon color=\"primary\" @click=\"setPreset(presets.test)\">\r\n                    <v-icon>mdi-eye</v-icon>\r\n                </v-btn>\r\n                <v-btn icon color=\"primary\" @click=\"setPreset(presets.all)\">\r\n                    <v-icon>mdi-arrow-up-bold</v-icon>\r\n                </v-btn>\r\n            </v-col>\r\n        </v-row>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../../dev/log\";\r\nimport * as vis from \"../../app/vis\";\r\nimport Seeker from \"./Seeker\";\r\nimport Section from \"./Section\";\r\nimport * as d3 from \"d3\";\r\n\r\nimport * as testing from \"../../app/testing\";\r\nimport ZoomCanvas from \"../../app/visualization/ZoomCanvas\";\r\nimport * as player from \"../../app/player\";\r\nimport Vue from \"vue\";\r\nimport { updateTimbreGraphVis } from \"../../app/workers/workers\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            timbreSlider: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n            presets: {\r\n                all: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\r\n                bass: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n                test: [0.5, 1, -0.3, 0.4, 0.1, -0.8, 0.7, 0.2, 0.1, -0.1, 0.75, -0.75],\r\n            },\r\n            disabled: [false, false, false, false, false, false, false, false, false, false, false, false],\r\n            solod: [false, false, false, false, false, false, false, false, false, false, false, false],\r\n            muted: [false, false, false, false, false, false, false, false, false, false, false, false],\r\n            clicks: 0,\r\n            timer: null,\r\n            mousedown: false,\r\n            showPoints: false,\r\n            gradientStepAmount: 8,\r\n            showPathGradient: true,\r\n            showPath: true,\r\n        };\r\n    },\r\n    computed: {\r\n        height() {\r\n            return 100;\r\n        },\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        scale() {\r\n            return this.width / this.track.getAnalysisDuration();\r\n        },\r\n        timbreFeatureGraph() {\r\n            return this.track ? this.track.timbreFeatureGraph : null;\r\n        },\r\n        sampleAmount() {\r\n            return this.timbreFeatureGraph.length;\r\n        },\r\n        sampleWidth() {\r\n            return this.width / this.sampleAmount;\r\n        },\r\n        timbreFeatureGraphPath() {\r\n            let path = `M 0 ${this.timbreFeatureGraph[0].mdsFeature * this.height}`;\r\n            for (let i = 1; i < this.sampleAmount; i++) {\r\n                path = path.concat(\r\n                    ` L ${i * this.sampleWidth} ${this.height - this.timbreFeatureGraph[i].mdsFeature * this.height}`\r\n                );\r\n            }\r\n\r\n            return path;\r\n        },\r\n        gradientSteps() {\r\n            let steps = [];\r\n            for (let i = 0; i < this.gradientStepAmount; i++) {\r\n                steps.push(i / this.gradientStepAmount);\r\n            }\r\n            return steps;\r\n        },\r\n    },\r\n    watch: {\r\n        timbreSlider: {\r\n            deep: true,\r\n\r\n            handler() {\r\n                if (!this.mousedown) {\r\n                    this.sendUpdate();\r\n                }\r\n            },\r\n        },\r\n        track() {\r\n            this.sendUpdate();\r\n        },\r\n    },\r\n    mounted() {\r\n        const self = this;\r\n        window.eventBus.$on(\"featuresProcessed\", () => {\r\n            self.sendUpdate();\r\n        });\r\n    },\r\n    methods: {\r\n        setPreset(preset) {\r\n            this.timbreSlider = preset;\r\n        },\r\n        resetSliders() {\r\n            this.timbreSlider = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        },\r\n        click(event, index) {\r\n            this.clicks++;\r\n            if (this.clicks === 1) {\r\n                var self = this;\r\n                this.timer = setTimeout(() => {\r\n                    self.clicks = 0;\r\n                }, 300);\r\n            } else {\r\n                clearTimeout(this.timer);\r\n                Vue.set(this.timbreSlider, index, 0);\r\n                this.clicks = 0;\r\n            }\r\n        },\r\n        clickBackground(event) {\r\n            this.$refs[\"holisticSeeker\"].clickedSVG(event);\r\n        },\r\n        solo(index) {\r\n            Vue.set(this.solod, index, !this.solod[index]);\r\n            if (this.solod[index]) {\r\n                Vue.set(this.muted, index, false);\r\n            }\r\n            this.updateDisabled();\r\n        },\r\n        mute(index) {\r\n            Vue.set(this.muted, index, !this.muted[index]);\r\n            if (this.muted[index]) {\r\n                Vue.set(this.solod, index, false);\r\n            }\r\n            this.updateDisabled();\r\n        },\r\n        updateDisabled() {\r\n            const thereIsASolodSlider = this.solod.some((val) => val);\r\n            this.disabled.forEach((slider, index) => {\r\n                if (thereIsASolodSlider) {\r\n                    Vue.set(this.disabled, index, !this.solod[index]);\r\n                } else {\r\n                    Vue.set(this.disabled, index, this.muted[index]);\r\n                }\r\n            });\r\n            this.sendUpdate();\r\n        },\r\n        getSliderValues() {\r\n            const slidersWithDisabled = [];\r\n            this.timbreSlider.forEach((value, index) => {\r\n                slidersWithDisabled.push(this.disabled[index] ? 0 : value);\r\n            });\r\n            return slidersWithDisabled;\r\n        },\r\n        sendUpdate() {\r\n            if (!this.track.updatingTimbreVis) {\r\n                this.track.updateTimbreVis(this.getSliderValues());\r\n            }\r\n        },\r\n        color(mdsFeature) {\r\n            return vis.sinebowColorNormalizedRadius(mdsFeature, 1, 1);\r\n        },\r\n        color2D(coord) {},\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.timbreSVG {\r\n}\r\n.seeker {\r\n    pointer-events: none;\r\n}\r\n.timbreGraph {\r\n    transition: all 0.3s;\r\n}\r\n.sample {\r\n    transition: all 0.3s;\r\n}\r\n.sample:hover {\r\n    fill: white !important;\r\n    cursor: pointer;\r\n}\r\n.timbreImage {\r\n    /*filter: sepia(100%) saturate(250%) hue-rotate(80deg) contrast(80%);*/\r\n    filter: brightness(1.1) contrast(80%);\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreGraph.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TimbreGraph.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TimbreGraph.vue?vue&type=template&id=5c7598a9&scoped=true&\"\nimport script from \"./TimbreGraph.vue?vue&type=script&lang=js&\"\nexport * from \"./TimbreGraph.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TimbreGraph.vue?vue&type=style&index=0&id=5c7598a9&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5c7598a9\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VImg } from 'vuetify/lib/components/VImg';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSlider } from 'vuetify/lib/components/VSlider';\ninstallComponents(component, {VBtn,VCol,VIcon,VImg,VRow,VSlider})\n","<template>\r\n    <div class=\"visualization\">\r\n        <div>\r\n            <v-row class=\"d-flex justify-center py-2\"> </v-row>\r\n            <div v-if=\"showPrototype\">\r\n                <!--<Matrixes :width=\"width\" />-->\r\n                <!--<Structure :width=\"width\" />-->\r\n                <GroundTruth :width=\"width\" />\r\n                <Graphs :width=\"width\" />\r\n\r\n                <!--<Beats :width=\"width\" />-->\r\n                <PitchTimbre :width=\"width\" />\r\n                <!--<ScapePlot :width=\"width\" />-->\r\n            </div>\r\n\r\n            <div v-if=\"!showPrototype\">\r\n                <div style=\"height: 5px\"></div>\r\n\r\n                <svg\r\n                    v-if=\"!loadingTrack && tsneReady\"\r\n                    class=\"tsneContainer\"\r\n                    :style=\"`height: ${tsneSize + 5 * 20}px; width: ${width}px; left: ${10}`\"\r\n                >\r\n                    <line\r\n                        v-for=\"index in tsneCoords.length - 2\"\r\n                        :key=\"index + 'clusterline'\"\r\n                        :x1=\"tsneCoordX(tsneCoords[index][0])\"\r\n                        :y1=\"tsneCoordY(tsneCoords[index][1])\"\r\n                        :x2=\"tsneCoordX(tsneCoords[index + 1][0])\"\r\n                        :y2=\"tsneCoordY(tsneCoords[index + 1][1])\"\r\n                        :stroke=\"clusterColor(clusters[index])\"\r\n                        style=\"stroke-opacity: .1;\"\r\n                        stroke-width=\"2\"\r\n                    />\r\n                    <circle\r\n                        v-for=\"(coord, index) in tsneCoords\"\r\n                        :key=\"index + 'clustercircle'\"\r\n                        :r=\"isPlayingSample(index) ? 5 + tsneDynamics(index) * 10 : 3 + tsneDynamics(index) * 5\"\r\n                        :cx=\"\r\n                            tsneCoordX(coord[0]) -\r\n                                (isPlayingSample(index) ? 5 + tsneDynamics(index) * 10 : 3 + tsneDynamics(index) * 5) /\r\n                                    2\r\n                        \"\r\n                        :cy=\"\r\n                            tsneCoordY(coord[1]) -\r\n                                (isPlayingSample(index) ? 5 + tsneDynamics(index) * 10 : 3 + tsneDynamics(index) * 5) /\r\n                                    2\r\n                        \"\r\n                        :class=\"isPlayingSample(index) ? 'segmentCirclePlaying' : 'segmentCircle'\"\r\n                        :fill=\"isPlayingSample(index) ? 'white' : clusterColor(clusters[index])\"\r\n                    />\r\n\r\n                    <circle\r\n                        :r=\"5 + tsneDynamics(playingSample) * 10\"\r\n                        :cx=\"tsneCoordX(tsneCoords[playingSample][0]) - (5 + tsneDynamics(playingSample) * 10) / 2\"\r\n                        :cy=\"tsneCoordY(tsneCoords[playingSample][1]) - (5 + tsneDynamics(playingSample) * 10) / 2\"\r\n                        :class=\"'playingSegmentCircle'\"\r\n                        :style=\"\r\n                            `transition:  cx ${track.features.sampleDuration}s linear, cy ${track.features.sampleDuration}s linear;`\r\n                        \"\r\n                        :fill=\"'white'\"\r\n                    />\r\n                    <rect\r\n                        v-for=\"(clusterSection, index) in clusterSections\"\r\n                        :key=\"index + 'clustersection'\"\r\n                        class=\"clusterRect\"\r\n                        :fill=\"clusterColor(clusterSection.cluster)\"\r\n                        :x=\"samplePosNormalized(clusterSection.start) * width\"\r\n                        :y=\"tsneSize + 20 * clusterSection.cluster\"\r\n                        :width=\"samplePosNormalized(clusterSection.end - clusterSection.start) * width\"\r\n                        :height=\"20\"\r\n                    ></rect>\r\n                    <rect\r\n                        class=\"seekerRect\"\r\n                        :x=\"seekerNormalized * width - 1.25\"\r\n                        :y=\"tsneSize\"\r\n                        :width=\"2.5\"\r\n                        :height=\"20 * 6\"\r\n                        fill=\"rgb(255,255,255,0.3)\"\r\n                    ></rect>\r\n                </svg>\r\n                <HolisticStructure :width=\"width\" />\r\n\r\n                <TimbreSegmentedGraph :width=\"width\" />\r\n\r\n                <!--<Tempo :width=\"width\" :height=\"70\" />-->\r\n\r\n                <Chords :width=\"width\" />\r\n                <div style=\"height: 50px\"></div>\r\n\r\n                <Tonality :width=\"width\" />\r\n\r\n                <div style=\"height: 400px\"></div>\r\n                <!--<TimbreStructure :width=\"width\" />\r\n                <TimbreGraph :width=\"width\" />-->\r\n            </div>\r\n        </div>\r\n\r\n        <!--<div class=\"floatingTime\">\r\n            {{ parseFloat(seekerTime).toFixed(2) }}\r\n        </div>-->\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport Matrixes from \"./visualizations/Matrixes\";\r\nimport GroundTruth from \"./visualizations/GroundTruth\";\r\nimport Graphs from \"./visualizations/Graphs\";\r\nimport ScapePlot from \"./visualizations/ScapePlot\";\r\nimport Beats from \"./visualizations/Beats\";\r\nimport PitchTimbre from \"./visualizations/PitchTimbre\";\r\nimport Structure from \"./visualizations/Structure\";\r\nimport HolisticStructure from \"./visualizations/HolisticStructure\";\r\nimport TimbreStructure from \"./visualizations/TimbreStructure\";\r\nimport TimbreSegmentedGraph from \"./visualizations/TimbreSegmentedGraph\";\r\nimport Tonality from \"./visualizations/Tonality\";\r\nimport Chords from \"./visualizations/Chords\";\r\nimport Tempo from \"./visualizations/Tempo\";\r\n\r\nimport TimbreGraph from \"./visualizations/TimbreGraph\";\r\n\r\nimport * as log from \"../dev/log\";\r\nimport * as player from \"../app/player\";\r\nimport * as vis from \"../app/vis\";\r\nimport * as d3 from \"d3\";\r\n\r\nexport default {\r\n    props: [\"width\", \"showPrototype\"],\r\n    components: {\r\n        //Matrixes,\r\n        GroundTruth,\r\n        //Beats,\r\n        Graphs,\r\n        //ScapePlot,\r\n        PitchTimbre,\r\n        //Tempo,\r\n        //Structure,\r\n        HolisticStructure,\r\n        //TimbreGraph,\r\n        //TimbreStructure,\r\n        Chords,\r\n        TimbreSegmentedGraph,\r\n        Tonality,\r\n    },\r\n    data() {\r\n        return {\r\n            readyForPrototypeVis: false,\r\n            tsneReady: false,\r\n            tsneSize: this.width * 0.75,\r\n        };\r\n    },\r\n    watch: {\r\n        showPrototype() {\r\n            if (this.showPrototype && this.readyForPrototypeVis) {\r\n                setTimeout(() => window.eventBus.$emit(\"readyForPrototypeVis\"), 0);\r\n            }\r\n        },\r\n        track() {\r\n            this.readyForPrototypeVis = false;\r\n        },\r\n    },\r\n    computed: {\r\n        loadingTrack() {\r\n            return this.$store.state.loadingTrack;\r\n        },\r\n        seekerNormalized() {\r\n            return this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000);\r\n        },\r\n        seekerTime() {\r\n            return this.$store.getters.seeker / 1000;\r\n        },\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        height() {\r\n            return this.width;\r\n        },\r\n        zoomed() {\r\n            return this.$store.state.isZoomed;\r\n        },\r\n        playing() {\r\n            return this.$store.getters.playing;\r\n        },\r\n        tsneCoords() {\r\n            return this.track.tsneCoords;\r\n        },\r\n        clusters() {\r\n            return this.track.clusters;\r\n        },\r\n        clusterSections() {\r\n            return this.track.clusterSections;\r\n        },\r\n        playingSample() {\r\n            return Math.ceil(this.seekerTime / this.track.features.sampleDuration);\r\n        },\r\n    },\r\n    mounted() {\r\n        window.eventBus.$on(\"readyForPrototypeVis\", () => {\r\n            this.readyForPrototypeVis = true;\r\n        });\r\n        window.eventBus.$on(\"tsneReady\", () => {\r\n            this.tsneReady = true;\r\n        });\r\n    },\r\n\r\n    methods: {\r\n        visChanged(newVis, oldVis) {},\r\n        clusterColor(index) {\r\n            return vis.goldenRatioCategoricalColor(index, 0, 1);\r\n        },\r\n        isPlayingSample(index) {\r\n            return (\r\n                index <= this.seekerTime / this.track.features.sampleDuration &&\r\n                index + 1 > this.seekerTime / this.track.features.sampleDuration\r\n            );\r\n        },\r\n        samplePosNormalized(sample) {\r\n            return (sample * this.track.features.sampleDuration) / this.track.getAnalysisDuration();\r\n        },\r\n        tsneCoord(x, y) {\r\n            return [this.tsneCoordX(x), this.tsneCoordY(y)];\r\n        },\r\n        tsneCoordX(x) {\r\n            return this.width / 2 + (x * this.tsneSize) / 2;\r\n        },\r\n        tsneCoordY(y) {\r\n            return 80 + ((y + 1) * this.tsneSize) / 2;\r\n        },\r\n        tsneDynamics(index) {\r\n            const fraction = index / this.tsneCoords.length;\r\n            return this.track.features.directLoudness[Math.floor(this.track.features.directLoudness.length * fraction)];\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.seekerSVGWrapper {\r\n    position: relative;\r\n}\r\n.seekerSVG {\r\n    position: absolute;\r\n    z-index: 10;\r\n}\r\n.floatingTime {\r\n    position: fixed;\r\n    z-index: 1000;\r\n    right: 5px;\r\n    bottom: 0%;\r\n}\r\n.segmentCircle {\r\n    transition: r 1.5s ease-out, fill 1.5s ease-out, cx 0.5s, cy 0.5s; /*, cx 1s ease, cy 1s ease;*/\r\n}\r\n.playingSegmentCircle {\r\n}\r\n.segmentCirclePlaying {\r\n    transition: r 0.1s ease-in, fill 0.1s ease-in;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Visualization.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Visualization.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Visualization.vue?vue&type=template&id=80f34d62&\"\nimport script from \"./Visualization.vue?vue&type=script&lang=js&\"\nexport * from \"./Visualization.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Visualization.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VRow})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"player\"},[_c('div',{staticClass:\"d-flex justify-center pa-4\"},[(_vm.playerReady)?_c('div',[_c('v-hover',{scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar hover = ref.hover;\nreturn [_c('v-btn',{attrs:{\"elevation\":hover ? 5 : 0,\"outlined\":\"\",\"fab\":\"\"},on:{\"click\":_vm.playPause}},[_c('v-icon',{attrs:{\"large\":\"\"}},[_vm._v(\"mdi-\"+_vm._s(_vm.playing ? \"pause\" : \"play\"))])],1)]}}],null,false,2208235142)})],1):_vm._e(),(!_vm.playerReady)?_c('div',[_c('v-progress-circular',{attrs:{\"indeterminate\":\"\",\"size\":\"56\"}})],1):_vm._e()]),(_vm.doDrawWaveform)?_c('div',[_c('Seeker',{ref:'holisticSeeker',staticClass:\"seeker\",attrs:{\"width\":_vm.width,\"height\":_vm.height + _vm.markerLabelHeight,\"color\":'rgb(255,255,255,1)',\"markerOpacity\":1,\"showMarkerLabel\":\"\"}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.loadingTrack),expression:\"!loadingTrack\"}],staticClass:\"waveformWrapper\",on:{\"click\":_vm.clickedWaveform}},[_c('canvas',{staticClass:\"waveform pa-0 ma-0\",attrs:{\"id\":\"waveform\",\"height\":_vm.height + _vm.markerLabelHeight}}),(false && !_vm.loadingTrack)?_c('svg',{staticClass:\"seekerSVG\",style:((\"transform: translate(\" + (-_vm.width) + \"px, 0px);\")),attrs:{\"height\":_vm.height,\"width\":_vm.width}},[_c('rect',{staticClass:\"darkenWaveform\",attrs:{\"x\":0,\"y\":0,\"width\":_vm.seekerNormalized * _vm.width,\"height\":_vm.height,\"fill\":'#121212'}}),_c('rect',{attrs:{\"x\":_vm.seekerNormalized * _vm.width - 1.25,\"y\":0,\"width\":2.5,\"height\":_vm.height,\"fill\":\"#1DB954\"}})]):_vm._e()]),(_vm.loadingTrack)?_c('div',[_c('v-progress-linear',{attrs:{\"indeterminate\":\"\",\"color\":\"success\"}})],1):_vm._e()],1):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"player\">\r\n        <!-- Play Button -->\r\n        <div class=\"d-flex justify-center pa-4\">\r\n            <div v-if=\"playerReady\">\r\n                <v-hover v-slot:default=\"{ hover }\">\r\n                    <v-btn :elevation=\"hover ? 5 : 0\" outlined fab @click=\"playPause\">\r\n                        <v-icon large>mdi-{{ playing ? \"pause\" : \"play\" }}</v-icon>\r\n                    </v-btn>\r\n                </v-hover>\r\n            </div>\r\n            <div v-if=\"!playerReady\">\r\n                <v-progress-circular indeterminate size=\"56\"></v-progress-circular>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Waveform -->\r\n        <div v-if=\"doDrawWaveform\">\r\n            <Seeker\r\n                class=\"seeker\"\r\n                :ref=\"'holisticSeeker'\"\r\n                :width=\"width\"\r\n                :height=\"height + markerLabelHeight\"\r\n                :color=\"'rgb(255,255,255,1)'\"\r\n                :markerOpacity=\"1\"\r\n                showMarkerLabel\r\n            />\r\n            <div v-show=\"!loadingTrack\" class=\"waveformWrapper\" @click=\"clickedWaveform\">\r\n                <canvas id=\"waveform\" :height=\"height + markerLabelHeight\" class=\"waveform pa-0 ma-0\"></canvas>\r\n                <svg\r\n                    v-if=\"false && !loadingTrack\"\r\n                    :height=\"height\"\r\n                    :width=\"width\"\r\n                    class=\"seekerSVG\"\r\n                    :style=\"`transform: translate(${-width}px, 0px);`\"\r\n                >\r\n                    <rect\r\n                        :x=\"0\"\r\n                        :y=\"0\"\r\n                        :width=\"seekerNormalized * width\"\r\n                        :height=\"height\"\r\n                        :fill=\"'#121212'\"\r\n                        class=\"darkenWaveform\"\r\n                    ></rect>\r\n                    <rect\r\n                        :x=\"seekerNormalized * width - 1.25\"\r\n                        :y=\"0\"\r\n                        :width=\"2.5\"\r\n                        :height=\"height\"\r\n                        fill=\"#1DB954\"\r\n                    ></rect>\r\n                </svg>\r\n            </div>\r\n            <div v-if=\"loadingTrack\">\r\n                <v-progress-linear indeterminate color=\"success\"></v-progress-linear>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as log from \"../dev/log\";\r\nimport * as player from \"../app/player\";\r\nimport * as auth from \"../app/authentication\";\r\nimport * as vis from \"../app/vis\";\r\nimport Seeker from \"./visualizations/Seeker\";\r\n\r\nexport default {\r\n    props: [\"width\"],\r\n    components: {\r\n        Seeker,\r\n    },\r\n    data() {\r\n        return {\r\n            markerLabelHeight: 15,\r\n            height: 50,\r\n            canvas: null,\r\n            ctx: null,\r\n            doDrawWaveform: false,\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        loadingTrack() {\r\n            return this.$store.state.loadingTrack;\r\n        },\r\n        playing() {\r\n            return this.$store.getters.playing;\r\n        },\r\n        seekerNormalized() {\r\n            return this.$store.getters.seeker / (this.track.getAnalysisDuration() * 1000);\r\n        },\r\n        playerReady() {\r\n            return this.$store.getters.playerReady;\r\n        },\r\n    },\r\n    watch: {\r\n        width() {\r\n            this.setupCanvas();\r\n            this.drawWaveform();\r\n        },\r\n        loadingTrack(loading) {\r\n            if (!loading) {\r\n                this.drawWaveform();\r\n                if (this.playerReady) {\r\n                    this.loadTrackToPlayer();\r\n                }\r\n            }\r\n        },\r\n        playerReady(ready) {\r\n            if (ready && !this.loadingTrack) {\r\n                this.loadTrackToPlayer();\r\n            }\r\n        },\r\n    },\r\n    beforeCreate() {\r\n        player.initialize(auth.token);\r\n    },\r\n    mounted() {\r\n        this.setupCanvas();\r\n    },\r\n    methods: {\r\n        setupCanvas() {\r\n            this.canvas = document.getElementById(\"waveform\");\r\n            if (!this.canvas) {\r\n                log.warn(\"canvas not ready: \");\r\n                return;\r\n            }\r\n            this.canvas.width = this.width;\r\n            this.ctx = this.canvas.getContext(\"2d\");\r\n        },\r\n        loadTrackToPlayer() {\r\n            player.loadTrack(this.track);\r\n        },\r\n        drawWaveform() {\r\n            if (!this.canvas) {\r\n                log.error(\"Can't draw waveform; canvas is not created\");\r\n                return;\r\n            }\r\n            if (!this.ctx) {\r\n                log.error(\"Can't draw waveform; canvas context is not created\");\r\n                return;\r\n            }\r\n            this.ctx.clearRect(0, 0, this.width, this.height + this.markerLabelHeight);\r\n            vis.renderWaveform(this.ctx, 0, this.markerLabelHeight, this.width, this.height, this.track);\r\n        },\r\n        playPause() {\r\n            this.playing ? player.pause() : player.resume();\r\n        },\r\n        clickedWaveform(event) {\r\n            let xNormalized = 0;\r\n            if (this.$store.state.browser === \"Firefox\") {\r\n                xNormalized = event.layerX / this.width;\r\n            } else {\r\n                xNormalized = event.offsetX / this.width;\r\n            }\r\n            player.seekS(xNormalized * this.track.getAnalysisDuration());\r\n        },\r\n        rightClick(event) {\r\n            let xNormalized = 0;\r\n            if (this.$store.state.browser === \"Firefox\") {\r\n                xNormalized = event.layerX / this.width;\r\n            } else {\r\n                xNormalized = event.offsetX / this.width;\r\n            }\r\n            this.track.placeMarker(xNormalized * this.track.getAnalysisDuration());\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.player {\r\n    height: 100%;\r\n}\r\n.waveFormWrapper {\r\n    position: relative;\r\n    color: white;\r\n}\r\n\r\n.waveform {\r\n    z-index: 1;\r\n}\r\n.darkenWaveform {\r\n    background: #121212;\r\n    z-index: 5;\r\n    opacity: 0.5;\r\n}\r\n.seekerSVG {\r\n    position: absolute;\r\n    z-index: 10;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Player.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Player.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Player.vue?vue&type=template&id=74130b5a&scoped=true&\"\nimport script from \"./Player.vue?vue&type=script&lang=js&\"\nexport * from \"./Player.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Player.vue?vue&type=style&index=0&id=74130b5a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"74130b5a\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VHover } from 'vuetify/lib/components/VHover';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VProgressCircular } from 'vuetify/lib/components/VProgressCircular';\nimport { VProgressLinear } from 'vuetify/lib/components/VProgressLinear';\ninstallComponents(component, {VBtn,VHover,VIcon,VProgressCircular,VProgressLinear})\n","<template>\r\n    <div class=\"track\">\r\n        <v-app-bar dark>\r\n            <v-toolbar-title>Music Structure Visualizer</v-toolbar-title>\r\n            <v-spacer></v-spacer>\r\n\r\n            <form v-if=\"!testing && !synthesizing\" v-on:submit.prevent=\"search\">\r\n                <v-text-field\r\n                    v-model=\"searchQuery\"\r\n                    label=\"Search for songs\"\r\n                    hide-details\r\n                    append-icon=\"mdi-magnify\"\r\n                    single-line\r\n                    rounded\r\n                    dense\r\n                    filled\r\n                    @focus=\"$store.commit('setInputFocus', true)\"\r\n                    @blur=\"$store.commit('setInputFocus', false)\"\r\n                ></v-text-field>\r\n            </form>\r\n            <!--<form v-if=\"testing && !synthesizing\">\r\n                <v-select\r\n                    v-model=\"selectedTestSet\"\r\n                    :items=\"allTestSets\"\r\n                    return-object\r\n                    hide-details\r\n                    single-line\r\n                    rounded\r\n                    dense\r\n                    filled\r\n                ></v-select>\r\n            </form>\r\n            <form v-if=\"synthesizing\" v-on:submit.prevent=\"synthesize\">\r\n                <v-text-field v-model=\"synthesizerString\" hide-details single-line rounded dense filled></v-text-field>\r\n            </form>\r\n            <v-btn v-if=\"!synthesizing\" icon @click=\"testing = !testing\">\r\n                <v-icon>mdi-ab-testing</v-icon>\r\n            </v-btn>\r\n            <v-btn icon @click=\"synthesizing = !synthesizing\">\r\n                <v-icon>mdi-pencil</v-icon>\r\n            </v-btn>\r\n            -->\r\n            <v-spacer></v-spacer>\r\n            <!--\r\n            <v-btn icon @click=\"$store.commit('toggleZoomed')\">\r\n                <v-icon>mdi-magnify-plus-outline</v-icon>\r\n            </v-btn>\r\n            <v-btn icon @click=\"showPrototype = !showPrototype\">\r\n                <v-icon>{{ showPrototype ? \"mdi-monitor-eye\" : \"mdi-test-tube\" }}</v-icon>\r\n            </v-btn>\r\n            <v-btn icon @click=\"clickActivePlayer()\">\r\n                <v-icon>{{ activePlayer ? \"mdi-speaker\" : \"mdi-speaker-off\" }}</v-icon>\r\n            </v-btn>\r\n            -->\r\n            <div class=\"volumeSlider\">\r\n                <v-container>\r\n                    <v-slider\r\n                        @click:prepend=\"clickVolume\"\r\n                        :prepend-icon=\"getVolumeIcon()\"\r\n                        v-model=\"volume\"\r\n                        :min=\"0\"\r\n                        :max=\"1\"\r\n                        :step=\"0.02\"\r\n                    ></v-slider>\r\n                </v-container>\r\n            </div>\r\n            <v-btn icon @click=\"share()\">\r\n                <v-icon>mdi-share-variant</v-icon>\r\n            </v-btn>\r\n            <!--<v-btn icon>\r\n                <v-icon>mdi-heart</v-icon>\r\n            </v-btn>-->\r\n        </v-app-bar>\r\n        <TrackSelector v-if=\"!synthesizing\" :tracks=\"trackList\" :album-size=\"120\" />\r\n        <div ref=\"mainContent\" class=\"mainContent\" :style=\"mainContentStyle\">\r\n            <!--<v-btn v-for=\"(n, i) in 10\" :key=\"'colordiv' + i\" width=\"20\" height=\"20\" :color=\"color(i)\"></v-btn>-->\r\n            <Player v-if=\"!synthesizing\" :width=\"mainContentWidth\" />\r\n            <Visualization :width=\"mainContentWidth\" :showPrototype=\"showPrototype\" />\r\n            <v-btn class=\"readMore\" @click=\"readMore()\" style=\"color: #aaa\">\r\n                <v-icon style=\"margin-right: .5em\">mdi-book-information-variant</v-icon>\r\n                Read about this project\r\n            </v-btn>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport TrackSelector from \"../components/TrackSelector\";\r\nimport Visualization from \"../components/Visualization\";\r\nimport Player from \"../components/Player\";\r\nimport * as app from \"../app/app\";\r\nimport * as auth from \"../app/authentication\";\r\nimport * as player from \"../app/player\";\r\nimport * as testing from \"../app/testing\";\r\nimport * as vis from \"../app/vis\";\r\n\r\nimport * as log from \"../dev/log\";\r\nexport default {\r\n    name: \"Track\",\r\n    data() {\r\n        return {\r\n            searchQuery: \"\",\r\n            synthesizerString: \"\",\r\n            volume: 0.75,\r\n            prevVolume: 0.75,\r\n            windowWidth: window.innerWidth,\r\n            windowHeight: window.innerHeight,\r\n            testing: false,\r\n            synthesizing: false,\r\n            selectedTestSet: null,\r\n            showPrototype: false,\r\n            contentRatio: 0.97, //0.5 // 1.5\r\n        };\r\n    },\r\n    computed: {\r\n        user() {\r\n            return this.$store.getters.user;\r\n        },\r\n        trackList() {\r\n            return this.$store.getters.trackList;\r\n        },\r\n        selectedIndex() {\r\n            return this.$store.getters.selectedIndex;\r\n        },\r\n        selectedTrack() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        seeker() {\r\n            return this.$store.getters.seeker;\r\n        },\r\n        playing() {\r\n            return this.$store.getters.playing;\r\n        },\r\n        mainContentStyle() {\r\n            return {\r\n                \"padding-left\": `${this.padding}px`,\r\n                \"padding-right\": `${this.padding}px`,\r\n            };\r\n        },\r\n        padding() {\r\n            return Math.round((this.windowWidth - this.mainContentWidth) / 2 / 4) * 4;\r\n        },\r\n        mainContentWidth() {\r\n            const size = Math.min(this.windowWidth, this.windowHeight) * this.contentRatio;\r\n            return size;\r\n        },\r\n        allTestSets() {\r\n            return testing.getAllTestSets();\r\n        },\r\n        activePlayer() {\r\n            return this.$store.getters.playerActive;\r\n        },\r\n    },\r\n    watch: {\r\n        selectedIndex(newIndex, oldIndex) {\r\n            //console.log(`We have ${newVal} selected!`)\r\n        },\r\n        selectedTrack(newTrack, oldTrack) {\r\n            log.info(`We have ${newTrack.getName()} selected!`);\r\n        },\r\n        selectedTestSet(newTestSet, oldTestSet) {\r\n            this.loadTestSet(newTestSet);\r\n        },\r\n        volume(newVol, oldVol) {\r\n            player.setVolume(Math.pow(this.volume, 2));\r\n        },\r\n        activePlayer() {\r\n            log.debug(\"Activeplayer Changed\", this.activePlayer);\r\n        },\r\n    },\r\n    components: {\r\n        TrackSelector,\r\n        Visualization,\r\n        Player,\r\n    },\r\n    beforeCreate() {\r\n        app.initialize();\r\n        window.addEventListener(\"resize\", () => {\r\n            this.windowWidth = window.innerWidth;\r\n        });\r\n    },\r\n    mounted() {\r\n        this._keyListener = function(e) {\r\n            if (e.key === \"z\" && (e.ctrlKey || e.metaKey)) {\r\n                e.preventDefault(); // present \"Save Page\" from getting triggered.\r\n\r\n                this.$store.commit(\"toggleZoomed\");\r\n            }\r\n            if (e.keyCode == 32 && !this.$store.getters.isInputFocused) {\r\n                e.preventDefault();\r\n                this.playing ? player.pause() : player.resume();\r\n            }\r\n        };\r\n        document.addEventListener(\"keydown\", this._keyListener.bind(this));\r\n    },\r\n    beforeDestroy() {\r\n        document.removeEventListener(\"keydown\", this._keyListener);\r\n    },\r\n    methods: {\r\n        color(i) {\r\n            return vis.goldenRatioCategoricalColor(i, 0, 1);\r\n        },\r\n        search() {\r\n            app.search(this.searchQuery);\r\n        },\r\n        loadTestSet() {\r\n            app.loadTestSet(this.selectedTestSet);\r\n        },\r\n        getVolumeIcon() {\r\n            if (this.volume > 0.6) return \"mdi-volume-high\";\r\n            if (this.volume > 0.2) return \"mdi-volume-medium\";\r\n            if (this.volume > 0) return \"mdi-volume-low\";\r\n            return \"mdi-volume-off\";\r\n        },\r\n        clickVolume() {\r\n            if (this.volume > 0) {\r\n                this.prevVolume = this.volume;\r\n                this.volume = 0;\r\n            } else {\r\n                this.volume = this.prevVolume;\r\n            }\r\n        },\r\n        synthesize() {\r\n            log.debug(\"Synthesizing\", this.synthesizerString);\r\n\r\n            app.synthesize(this.synthesizerString);\r\n        },\r\n        clickActivePlayer() {\r\n            if (this.activePlayer) {\r\n                player.releasePlayback();\r\n            } else {\r\n                player.transferPlayback();\r\n            }\r\n        },\r\n        readMore() {\r\n            Object.assign(document.createElement(\"a\"), {\r\n                target: \"_blank\",\r\n                href: \"http://jobsavelsberg.com/musicstructure/\",\r\n            }).click();\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.track {\r\n    overflow: hidden; /* Hide scrollbars */\r\n}\r\n.mainContent {\r\n    display: inline-block;\r\n    overflow: hidden;\r\n}\r\n.volumeSlider {\r\n    height: 100%;\r\n    width: 150px;\r\n}\r\n.trackScroll {\r\n    /*overflow-x: auto;*/\r\n}\r\n.trackScroll::-webkit-scrollbar {\r\n    display: none;\r\n}\r\n.readMore {\r\n    position: fixed;\r\n    z-index: 1000;\r\n    right: 0px;\r\n    bottom: 0%;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Track.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Track.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Track.vue?vue&type=template&id=93422b0a&\"\nimport script from \"./Track.vue?vue&type=script&lang=js&\"\nexport * from \"./Track.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Track.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAppBar } from 'vuetify/lib/components/VAppBar';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VSlider } from 'vuetify/lib/components/VSlider';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VAppBar,VBtn,VContainer,VIcon,VSlider,VSpacer,VTextField,VToolbarTitle})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"callback\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"callback\"></div>\r\n</template>\r\n\r\n<script>\r\nimport { requestFirstToken } from \"../app/authentication\";\r\n\r\nexport default {\r\n    name: \"Callback\",\r\n    components: {},\r\n    beforeCreate() {\r\n        let params = new URLSearchParams(window.location.search);\r\n        let code = params.get(\"code\");\r\n        requestFirstToken(code).then(() => {\r\n            const trackId = window.localStorage.getItem(\"trackId\");\r\n            console.log(\"loading\", trackId);\r\n            this.$router.push(`/track/${trackId}`);\r\n        });\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.callback {\r\n    height: 100%;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Callback.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Callback.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Callback.vue?vue&type=template&id=655f9d36&\"\nimport script from \"./Callback.vue?vue&type=script&lang=js&\"\nexport * from \"./Callback.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Callback.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login\"},[_c('v-container',{attrs:{\"fill-height\":\"\"}},[_c('v-layout',{attrs:{\"align-center\":\"\"}},[_c('v-card',{staticClass:\"mx-auto elevation-15\"},[_c('v-card-title',{staticClass:\"justify-center\"},[_vm._v(\"Music Structure Visualizer\")]),_c('v-card-subtitle',{staticClass:\"text-center\"},[_vm._v(\" Visualize the structure of music in your own library! \")]),_c('v-card-text',{staticClass:\"text-center\"},[_vm._v(\" Logging in with spotify enables the app to play music using your spotify account. \")]),_c('v-card-actions',[_c('v-btn',{staticClass:\"mx-auto\",attrs:{\"color\":\"success\"},on:{\"click\":_vm.spotifyAuthorize}},[_vm._v(\"Log in with Spotify\")])],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"login\">\r\n        <v-container fill-height>\r\n            <v-layout align-center>\r\n                <v-card class=\"mx-auto elevation-15\">\r\n                    <v-card-title class=\"justify-center\">Music Structure Visualizer</v-card-title>\r\n                    <v-card-subtitle class=\"text-center\">\r\n                        Visualize the structure of music in your own library!\r\n                    </v-card-subtitle>\r\n                    <v-card-text class=\"text-center\">\r\n                        Logging in with spotify enables the app to play music using your spotify account.\r\n                    </v-card-text>\r\n                    <v-card-actions>\r\n                        <v-btn class=\"mx-auto\" color=\"success\" @click=\"spotifyAuthorize\">Log in with Spotify</v-btn>\r\n                    </v-card-actions>\r\n                </v-card>\r\n            </v-layout>\r\n        </v-container>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n\r\nexport default {\r\n  name: 'Login',\r\n  components: {\r\n  },\r\n  methods: {\r\n      spotifyAuthorize () {\r\n          window.location.href= process.env.VUE_APP_HOST_URL + \"/api/spotify/login\"\r\n      }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.login{\r\n    height: 100%\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Login.vue?vue&type=template&id=acb05ff4&\"\nimport script from \"./Login.vue?vue&type=script&lang=js&\"\nexport * from \"./Login.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Login.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardSubtitle } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCard,VCardActions,VCardSubtitle,VCardText,VCardTitle,VContainer,VLayout})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"landing\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"landing\"></div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: \"Landing\",\r\n    components: {},\r\n    methods: {},\r\n};\r\n</script>\r\n\r\n<style>\r\n.landing {\r\n    height: 100%;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Landing.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Landing.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Landing.vue?vue&type=template&id=31b6ba25&\"\nimport script from \"./Landing.vue?vue&type=script&lang=js&\"\nexport * from \"./Landing.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Landing.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from \"vue\";\r\nimport VueRouter from \"vue-router\";\r\nimport Track from \"../views/Track.vue\";\r\nimport Callback from \"../views/Callback.vue\";\r\nimport Login from \"../views/Login.vue\";\r\nimport Landing from \"../views/Landing.vue\";\r\nimport * as app from \"../app/app\";\r\nimport * as auth from \"../app/authentication\";\r\n\r\nVue.use(VueRouter);\r\n\r\nconst routes = [\r\n    {\r\n        path: \"/\",\r\n        name: \"Landing\",\r\n        component: Login,\r\n        beforeEnter(to, from, next) {\r\n            if (auth.isAuthorized()) {\r\n                next(\"/track/-1\");\r\n            } else {\r\n                next(\"/login\");\r\n            }\r\n        },\r\n    },\r\n    {\r\n        path: \"/login\",\r\n        name: \"Login\",\r\n        component: Login,\r\n    },\r\n    {\r\n        path: \"/track/:trackId\",\r\n        name: \"Track\",\r\n        component: Track,\r\n        beforeEnter(to, from, next) {\r\n            console.log(\"Prev stored trackid: \", window.localStorage.getItem(\"trackId\"));\r\n            if (to.params.trackId !== -1) {\r\n                window.localStorage.setItem(\"trackId\", to.params.trackId);\r\n            }\r\n            console.log(\"New stored trackid: \", window.localStorage.getItem(\"trackId\"));\r\n\r\n            if (auth.isAuthorized()) {\r\n                next();\r\n            } else {\r\n                next(\"/login\");\r\n            }\r\n        },\r\n    },\r\n    {\r\n        path: \"/callback\",\r\n        name: \"Callback\",\r\n        component: Callback,\r\n        beforeEnter(to, from, next) {\r\n            console.log(\"After callback trackid: \", window.localStorage.getItem(\"trackId\"));\r\n            next();\r\n        },\r\n    },\r\n];\r\n\r\nconst router = new VueRouter({\r\n    mode: \"history\",\r\n    base: process.env.BASE_URL,\r\n    routes,\r\n});\r\n\r\nexport default router;\r\n","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n    theme: {\n        dark: true,\n        themes:{\n            // Spotify green = 1DB954\n            // Spotify black = 191414\n            light: {\n                primary: '#1DB954',//'#1976D2',\n                secondary: '#424242',\n                accent: '#82B1FF',\n                error: '#FF5252',\n                info: '#2196F3',\n                success: '#1DB954',//'#4CAF50',\n                warning: '#FFC107',\n            },\n            dark: {\n                primary: '#1DB954',//'#1976D2',\n                success: '#1DB954',//'#4CAF50',\n            }\n        }\n    }\n});\n","import Vue from \"vue\";\r\nimport App from \"./App.vue\";\r\nimport router from \"./router\";\r\nimport vuetify from \"./plugins/vuetify\";\r\nimport store from \"./store\";\r\n\r\nVue.config.productionTip = false;\r\n\r\nwindow.eventBus = new Vue();\r\n\r\nnew Vue({\r\n    router,\r\n    vuetify,\r\n    store,\r\n    render: (h) => h(App),\r\n}).$mount(\"#app\");\r\n\r\nstore.state.browser = () => {\r\n    // Opera 8.0+\r\n    // eslint-disable-next-line no-undef\r\n    var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(\" OPR/\") >= 0;\r\n\r\n    // Firefox 1.0+\r\n    var isFirefox = typeof InstallTrigger !== \"undefined\";\r\n\r\n    // Safari 3.0+ \"[object HTMLElementConstructor]\"\r\n    var isSafari =\r\n        /constructor/i.test(window.HTMLElement) ||\r\n        (function(p) {\r\n            return p.toString() === \"[object SafariRemoteNotification]\";\r\n            // eslint-disable-next-line no-undef\r\n        })(!window[\"safari\"] || (typeof safari !== \"undefined\" && safari.pushNotification));\r\n\r\n    // Internet Explorer 6-11\r\n    var isIE = /*@cc_on!@*/ false || !!document.documentMode;\r\n\r\n    // Edge 20+\r\n    var isEdge = !isIE && !!window.StyleMedia;\r\n\r\n    // Chrome 1 - 79\r\n    var isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime);\r\n\r\n    if (isChrome) return \"Chrome\";\r\n    if (isFirefox) return \"Firefox\";\r\n    if (isSafari) return \"Safari\";\r\n    if (isIE) return \"IE\";\r\n    if (isEdge) return \"Edge\";\r\n    if (isOpera) return \"Opera\";\r\n};\r\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ClickableBackground.vue?vue&type=style&index=0&id=71a70974&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ClickableBackground.vue?vue&type=style&index=0&id=71a70974&scoped=true&lang=css&\"","import assert from \"assert\";\r\nimport { NumberType, getNumberTypeByName } from \"./NumberType\";\r\nimport * as log from \"../../dev/log\";\r\nimport * as HalfMatrix from \"./HalfMatrix\";\r\nexport default class Matrix {\r\n    static get NumberType() {\r\n        return NumberType;\r\n    }\r\n\r\n    data;\r\n    width;\r\n    height;\r\n    featureAmount;\r\n    sampleDuration;\r\n    numberType;\r\n    length;\r\n\r\n    constructor(options) {\r\n        this.width = options.width || options.size;\r\n        this.height = options.height || options.size;\r\n\r\n        this.featureAmount = options.featureAmount || 1;\r\n        this.numberType = getNumberTypeByName(options.numberType) || NumberType.FLOAT32;\r\n        this.sampleDuration = options.sampleDuration || 1;\r\n        this.length = this.width * this.height * this.featureAmount;\r\n        if (options.buffer) {\r\n            this.data = new this.numberType.array(options.buffer);\r\n            assert(this.length === this.data.length);\r\n        } else {\r\n            this.data = new this.numberType.array(this.length);\r\n        }\r\n    }\r\n\r\n    static from(matrix, options) {\r\n        if (typeof matrix === HalfMatrix) return this.fromHalfMatrix(matrix);\r\n        if (!options) options = {};\r\n        const featureAmount = options.featureAmount || matrix.featureAmount;\r\n        const numberType = options.numberType || matrix.numberType;\r\n        const sampleDuration = options.sampleDuration || matrix.sampleDuration;\r\n        const width = matrix.width || matrix.size;\r\n        const height = matrix.height || matrix.size;\r\n        return new Matrix({ width: width, height: height, featureAmount, numberType, sampleDuration });\r\n    }\r\n\r\n    static fromHalfMatrix(halfMatrix) {\r\n        const matrix = new Matrix({\r\n            width: halfMatrix.size,\r\n            height: halfMatrix.size,\r\n            numberType: halfMatrix.numberType,\r\n            sampleDuration: halfMatrix.sampleDuration,\r\n        });\r\n        matrix.fill((x, y) => halfMatrix.getValueMirrored(x, y));\r\n        return matrix;\r\n    }\r\n\r\n    static createTimeLagMatrix(matrix) {\r\n        const size = matrix.size || matrix.width;\r\n        const timeLagMatrix = new Matrix(matrix);\r\n        timeLagMatrix.fill((n, lag) => {\r\n            const x = (n + lag) % size;\r\n            return matrix.getValueMirrored(x, n);\r\n        });\r\n        return timeLagMatrix;\r\n    }\r\n\r\n    static combine(halfMatrixLeft, halfMatrixRight) {\r\n        assert(halfMatrixLeft.size === halfMatrixRight.size);\r\n        assert(halfMatrixLeft.numberType === halfMatrixRight.numberType);\r\n        assert(halfMatrixLeft.sampleDuration === halfMatrixRight.sampleDuration);\r\n        const size = halfMatrixLeft.size;\r\n        const numberType = halfMatrixLeft.numberType;\r\n        const sampleDuration = halfMatrixLeft.sampleDuration;\r\n        const matrix = new Matrix({\r\n            width: size,\r\n            height: size,\r\n            numberType: numberType,\r\n            sampleDuration: sampleDuration,\r\n        });\r\n        matrix.fill((x, y) => {\r\n            if (x > y) {\r\n                return halfMatrixRight.getValueMirrored(x, y);\r\n            } else {\r\n                return halfMatrixLeft.getValue(x, y);\r\n            }\r\n        });\r\n        return matrix;\r\n    }\r\n\r\n    clone() {\r\n        const matrix = new Matrix({\r\n            height: this.height,\r\n            width: this.width,\r\n            numberType: this.numberType,\r\n            sampleDuration: this.sampleDuration,\r\n        });\r\n        matrix.fillByIndex((i) => this.data[i]);\r\n        return matrix;\r\n    }\r\n\r\n    hasCell(x, y) {\r\n        return x < this.width && y < this.height && x >= 0 && y >= 0;\r\n    }\r\n    setValue(x, y, value) {\r\n        this.data[(y * this.width + x) * this.featureAmount] = value;\r\n    }\r\n    getValueMirrored(x, y, f = 0) {\r\n        return this.getValue(x, y, f);\r\n    }\r\n    getValue(x, y, f = 0) {\r\n        return this.data[(y * this.width + x) * this.featureAmount + f];\r\n    }\r\n    getValues(x, y) {\r\n        const values = new this.numberType.array(this.featureAmount);\r\n        for (let f = 0; f < this.featureAmount; f++) {\r\n            values[f] = this.data[(y * this.width + x) * this.featureAmount + f];\r\n        }\r\n        return values;\r\n    }\r\n\r\n    getValuesNormalized(x, y) {\r\n        const values = new this.numberType.array(this.featureAmount);\r\n        for (let f = 0; f < this.featureAmount; f++) {\r\n            values[f] = this.data[(y * this.width + x) * this.featureAmount + f] / this.numberType.scale;\r\n        }\r\n        return values;\r\n    }\r\n    getValueNormalizedMirrored(x, y) {\r\n        return this.getValueNormalized(x, y);\r\n    }\r\n    getValueNormalized(x, y, f = 0) {\r\n        return this.data[(y * this.width + x) * this.featureAmount + f] / this.numberType.scale;\r\n    }\r\n\r\n    getColumnNormalized(x) {\r\n        const values = new Float32Array(this.height);\r\n        for (let y = 0; y < this.height; y++) {\r\n            values[y] = this.data[(y * this.width + x) * this.featureAmount] / this.numberType.scale;\r\n        }\r\n        return values;\r\n    }\r\n\r\n    fillByIndex(callback) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] = callback(i);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {*} callback dunction that returns number (compatible with DataType)\r\n     */\r\n    fill(callback) {\r\n        for (let y = 0; y < this.height; y++) {\r\n            for (let x = 0; x < this.width; x++) {\r\n                this.data[(y * this.width + x) * this.featureAmount] = callback(x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    fillFeatures(callback) {\r\n        for (let y = 0; y < this.height; y++) {\r\n            for (let x = 0; x < this.width; x++) {\r\n                for (let f = 0; f < this.featureAmount; f++) {\r\n                    this.data[(y * this.width + x) * this.featureAmount + f] = callback(x, y, f);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    fillFeaturesNormalized(callback) {\r\n        for (let y = 0; y < this.height; y++) {\r\n            for (let x = 0; x < this.width; x++) {\r\n                for (let f = 0; f < this.featureAmount; f++) {\r\n                    this.data[(y * this.width + x) * this.featureAmount + f] =\r\n                        callback(x, y, f) * this.numberType.scale;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    forEach(callback) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            callback(this.data[i], i);\r\n        }\r\n    }\r\n\r\n    forEachCell(callback) {\r\n        for (let y = 0; y < this.height; y++) {\r\n            for (let x = 0; x < this.width; x++) {\r\n                callback(x, y, this.data[(y * this.width + x) * this.featureAmount]);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Expect normalized number [0,1] and stores this as number of specified type, with 1 being scaled to the number's max\r\n     * @param {*} callback function that returns number in range 0,1\r\n     */\r\n    fillNormalized(callback) {\r\n        for (let y = 0; y < this.heigth; y++) {\r\n            for (let x = 0; x < this.width; x++) {\r\n                this.data[(y * this.width + x) * this.featureAmount] = callback(x, y) * this.numberType.max;\r\n            }\r\n        }\r\n    }\r\n\r\n    map(callback) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] = callback(this.data[i]);\r\n        }\r\n    }\r\n\r\n    divide(number) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] /= number;\r\n        }\r\n    }\r\n    multiply(number) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] *= number;\r\n        }\r\n    }\r\n    add(number) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] += number;\r\n        }\r\n    }\r\n\r\n    getBuffer() {\r\n        return {\r\n            type: \"Matrix\",\r\n            buffer: this.data.buffer,\r\n            width: this.width,\r\n            height: this.height,\r\n            numberType: this.numberType.name,\r\n            featureAmount: this.featureAmount,\r\n            sampleDuration: this.sampleDuration,\r\n        };\r\n    }\r\n\r\n    getNewEmptyMatrix() {\r\n        return new Matrix(this);\r\n    }\r\n\r\n    getSize() {\r\n        assert(this.width === this.height);\r\n        return this.width;\r\n    }\r\n\r\n    getSampleAmount() {\r\n        return this.height;\r\n    }\r\n\r\n    getSampleDuration() {\r\n        return this.sampleDuration;\r\n    }\r\n\r\n    normalize() {\r\n        let min = this.numberType.max;\r\n        let max = this.numberType.min;\r\n        this.forEach((value) => {\r\n            if (value > max) {\r\n                max = value;\r\n            }\r\n            if (value < min) {\r\n                min = value;\r\n            }\r\n        });\r\n\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] = (this.data[i] - min) / (max - min);\r\n        }\r\n    }\r\n\r\n    subtract(matrix) {}\r\n}\r\n","module.exports = __webpack_public_path__ + \"img/11.ed7b26ed.png\";","var map = {\n\t\"./0.png\": \"853a\",\n\t\"./1.png\": \"7e02\",\n\t\"./10.png\": \"6c0f\",\n\t\"./11.png\": \"5bfe\",\n\t\"./2.png\": \"4697\",\n\t\"./3.png\": \"4d8d\",\n\t\"./4.png\": \"f8fd\",\n\t\"./5.png\": \"beb4\",\n\t\"./6.png\": \"951a\",\n\t\"./7.png\": \"3dfa\",\n\t\"./8.png\": \"70ba\",\n\t\"./9.png\": \"e2a7\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"642b\";","module.exports = __webpack_public_path__ + \"img/10.98dc5d9d.png\";","module.exports = __webpack_public_path__ + \"img/8.6c4d10ae.png\";","module.exports = __webpack_public_path__ + \"js/7.b2cc2902.worker.js\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tooltip.vue?vue&type=style&index=0&id=5c5d57d2&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tooltip.vue?vue&type=style&index=0&id=5c5d57d2&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PitchTimbre.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PitchTimbre.vue?vue&type=style&index=0&lang=css&\"","module.exports = __webpack_public_path__ + \"img/1.6abca8eb.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOkAAAClBAMAAABLg8fHAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAhUExURWtra29vb3BwcHFxcXV1dW5ubnJycnh4eG1tbXZ2dmpqajXhPR4AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMzSURBVHja7dyxjhoxEAZgKOgZS+7xrEIdxYhXSIuR/AQnRcpjXN5kC6Q8Zjz2AssBF5r8f+FMeXB8eNc79o7NLpYaVFWcIiKIFG23WRzfVGOM+x+vRHwQj/96G+dPf4vfivb96+KXwuPnZrFSnwUabihqgKo+yXG7hqtZjsOBpJ6CF2y4YU1TcyaoDtvWkgp5qiXHTtSlCrg3SVXBedhZW981odUt/AiXA+tKRsSrWlUPV/FXjk/W1l5UV1VBRz2vaNRGulHLBKofFWp6cdHUL4INtzc1oNWtZcTgRDLw3LYxB66W+xy8Goo6lls7nFjGHO92LHWJVhNVhV6wZS6xpaiRoDoteXilAr1ei9rmEh2ovqngISfV8ZWjjvjZ2n7DGNV3eNVnF/FqSsJQRTiztYHSm+qYw1NBGbGM6WVy2I+q1ptO6Plw4KltjtiHekL2phqW/QnqnqcKNpwy6k0U1alVCNB1RHGM6iXpvIoqS11iVZ/q9YpWM0nVPXguYZEpqncMNVyzP3LMkUtvgqr1jgOtprqHwKohyEh1zIGrg1W5HDoT09RTYKgjWM3TlQNWc6pzf+wdR2srvGZKVMF1RN8qP4QZjLVV4KrV1iiqjerAnWumxm7Uup6Dr8C3Sm0Xak6MukQ+RorKqIVTVQFH3X0Dng3naScvQ/0doKyf2spRhaGuwH1Yp/schjqSVPAObRcIGbGp6DVJnfaF41XG+qtGxlozTwUfYZ8ZbZ3UE0cVp+Adn3H9X/3Hqp1X6GTCi059mKCuKOqI3XvpJbR7dbhax1esmqbfcQRcNcR2D/tEUKWqI1i1qjR+3pSm+jBQtbamqSrdhXpdbUC6Pal2XldYtSTi+tt8tJoY6nn9Fa26nlQ9kNQTeC6Rpe1bQ6u1okdQW0b00LUr2XanOvDPbqkqknQstV05Yvshn6XF2VOBgtx3u+kJTK+j5VPa3dU5zJhnDLuibx5GdPOYHBcuapDPngB139Yb1f57vmGvGk9UWzPW86vh02dOfTwi+rCtyb+k1irK+ds+b2mYfUY9viX9Hxbvg0KjyFYNCdfvGS4n/ENnmb9895L8NebvLAdJD38A8lDoBSbsCfgAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"js/6.ed6c1ba0.worker.js\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Visualization.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Visualization.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tonality.vue?vue&type=style&index=0&id=47c37c70&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tonality.vue?vue&type=style&index=0&id=47c37c70&scoped=true&lang=css&\"","module.exports = __webpack_public_path__ + \"img/6.332870e2.png\";","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Markers.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Markers.vue?vue&type=style&index=0&lang=css&\"","import assert from \"assert\";\r\nimport { NumberType, getNumberTypeByName } from \"./NumberType\";\r\nimport * as log from \"../../dev/log\";\r\nimport * as Matrix from \"./Matrix\";\r\nimport { drop } from \"lodash\";\r\nexport default class HalfMatrix {\r\n    static get NumberType() {\r\n        return NumberType;\r\n    }\r\n\r\n    data;\r\n    size;\r\n    featureAmount;\r\n    sampleDuration;\r\n    numberType;\r\n    length;\r\n\r\n    /**\r\n     *\r\n     * @param {*} size\r\n     * @param {*} shape array of nested array sizes eg, ssm with 2 values per cell [2]\r\n     * @param {*} type\r\n     */\r\n    constructor(options) {\r\n        this.size = options.size;\r\n        this.featureAmount = options.featureAmount || 1;\r\n        this.numberType = getNumberTypeByName(options.numberType) || NumberType.FLOAT32;\r\n        this.sampleDuration = options.sampleDuration || 1;\r\n        this.length = ((this.size * this.size + this.size) / 2) * this.featureAmount;\r\n        if (options.buffer) {\r\n            this.data = new this.numberType.array(options.buffer);\r\n            assert(this.length === this.data.length);\r\n        } else {\r\n            this.data = new this.numberType.array(this.length);\r\n        }\r\n    }\r\n\r\n    static from(matrix, options) {\r\n        if (typeof matrix === Matrix) {\r\n            return this.fromMatrix(matrix);\r\n        }\r\n        if (!options) options = {};\r\n        const featureAmount = options.featureAmount || matrix.featureAmount;\r\n        const numberType = options.numberType || matrix.numberType;\r\n        const sampleDuration = options.sampleDuration || matrix.sampleDuration;\r\n        return new HalfMatrix({ size: matrix.size, featureAmount, numberType, sampleDuration });\r\n    }\r\n\r\n    static fromMatrix(matrix) {\r\n        const halfMatrix = new HalfMatrix({\r\n            size: matrix.width,\r\n            numberType: matrix.numberType,\r\n            sampleDuration: matrix.sampleDuration,\r\n        });\r\n        halfMatrix.fill((x, y) => {\r\n            return matrix.getValue(x, y);\r\n        });\r\n        return halfMatrix;\r\n    }\r\n\r\n    clone() {\r\n        const halfMatrix = new HalfMatrix({\r\n            size: this.size,\r\n            numberType: this.numberType,\r\n            sampleDuration: this.sampleDuration,\r\n        });\r\n        halfMatrix.fillByIndex((i) => this.data[i]);\r\n        return halfMatrix;\r\n    }\r\n\r\n    getCellFromIndex(index) {}\r\n\r\n    hasCell(x, y) {\r\n        return x <= y && y < this.size && x >= 0 && y >= 0;\r\n    }\r\n    setValue(x, y, value) {\r\n        this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount] = value;\r\n    }\r\n    setValueNormalized(x, y, value) {\r\n        this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount] = value * this.numberType.scale;\r\n    }\r\n    setValueNormalizedMirrored(x, y, value) {\r\n        if (x > y) {\r\n            this.data[((x * x + x) / 2) * this.featureAmount + y * this.featureAmount] = value * this.numberType.scale;\r\n        } else {\r\n            this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount] = value * this.numberType.scale;\r\n        }\r\n    }\r\n    getValue(x, y, f = 0) {\r\n        return this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount + f];\r\n    }\r\n    getValues(x, y) {\r\n        const values = new this.numberType.array(this.featureAmount);\r\n        for (let o = 0; o < this.featureAmount; o++) {\r\n            values[o] = this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount + o];\r\n        }\r\n        return values;\r\n    }\r\n    getValueMirrored(x, y) {\r\n        if (x > y) {\r\n            return this.data[((x * x + x) / 2) * this.featureAmount + y * this.featureAmount];\r\n        } else {\r\n            return this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount];\r\n        }\r\n    }\r\n    getValuesNormalized(x, y) {\r\n        const values = new this.numberType.array(this.featureAmount);\r\n        for (let o = 0; o < this.featureAmount; o++) {\r\n            values[o] =\r\n                this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount + o] / this.numberType.scale;\r\n        }\r\n        return values;\r\n    }\r\n    getValueNormalizedMirrored(x, y) {\r\n        if (x > y) {\r\n            return this.data[((x * x + x) / 2) * this.featureAmount + y * this.featureAmount] / this.numberType.scale;\r\n        } else {\r\n            return this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount] / this.numberType.scale;\r\n        }\r\n    }\r\n    getValueNormalized(x, y, f = 0) {\r\n        return this.data[((y * y + y) / 2) * this.featureAmount + x * this.featureAmount + f] / this.numberType.scale;\r\n    }\r\n\r\n    getColumnNormalized(x) {\r\n        const values = new Float32Array(this.size);\r\n        for (let y = 0; y < this.size; y++) {\r\n            values[y] = this.getValueNormalizedMirrored(x, y);\r\n        }\r\n        return values;\r\n    }\r\n\r\n    fillByIndex(callback) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] = callback(i);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {*} callback dunction that returns number (compatible with DataType)\r\n     */\r\n    fill(callback) {\r\n        for (let y = 0; y < this.size; y++) {\r\n            const cellsBefore = ((y * y + y) / 2) * this.featureAmount;\r\n            for (let x = 0; x < y + 1; x++) {\r\n                this.data[cellsBefore + x * this.featureAmount] = callback(x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    fillFeatures(callback) {\r\n        for (let y = 0; y < this.size; y++) {\r\n            const cellsBefore = ((y * y + y) / 2) * this.featureAmount;\r\n            for (let x = 0; x < y + 1; x++) {\r\n                for (let f = 0; f < this.featureAmount; f++) {\r\n                    this.data[cellsBefore + x * this.featureAmount + f] = callback(x, y, f);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    fillFeaturesNormalized(callback) {\r\n        for (let y = 0; y < this.size; y++) {\r\n            const cellsBefore = ((y * y + y) / 2) * this.featureAmount;\r\n            for (let x = 0; x < y + 1; x++) {\r\n                for (let f = 0; f < this.featureAmount; f++) {\r\n                    this.data[cellsBefore + x * this.featureAmount + f] = callback(x, y, f) * this.numberType.scale;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    forEach(callback) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            callback(this.data[i], i);\r\n        }\r\n    }\r\n\r\n    forEachCell(callback) {\r\n        for (let y = 0; y < this.size; y++) {\r\n            const cellsBefore = ((y * y + y) / 2) * this.featureAmount;\r\n\r\n            for (let x = 0; x < y + 1; x++) {\r\n                callback(x, y, this.data[cellsBefore + x]);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Expect normalized number [0,1] and stfores this as number of specified type, with 1 being scaled to the number's max\r\n     * @param {*} callback function that returns number in range 0,1\r\n     */\r\n    fillNormalized(callback) {\r\n        for (let y = 0; y < this.size; y++) {\r\n            const cellsBefore = (y * y + y) / 2;\r\n            for (let x = 0; x < y + 1; x++) {\r\n                this.data[cellsBefore + x] = callback(x, y) * this.numberType.scale;\r\n            }\r\n        }\r\n    }\r\n\r\n    map(callback) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] = callback(this.data[i]);\r\n        }\r\n    }\r\n\r\n    divide(number) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] /= number;\r\n        }\r\n    }\r\n    multiply(number) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] *= number;\r\n        }\r\n    }\r\n    add(number) {\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] += number;\r\n        }\r\n    }\r\n\r\n    getFirstFeatureMatrix() {\r\n        const matrix = new HalfMatrix(this);\r\n        matrix.fill((x, y) => {\r\n            return this.getValue(x, y);\r\n        });\r\n        return matrix;\r\n    }\r\n\r\n    getFeatureMatrix(featureIndex) {\r\n        const matrix = new HalfMatrix(this);\r\n        matrix.fill((x, y) => {\r\n            return this.getValue(x, y, featureIndex);\r\n        });\r\n        return matrix;\r\n    }\r\n\r\n    getBuffer() {\r\n        return {\r\n            type: \"HalfMatrix\",\r\n            buffer: this.data.buffer,\r\n            size: this.size,\r\n            numberType: this.numberType.name,\r\n            featureAmount: this.featureAmount,\r\n            sampleDuration: this.sampleDuration,\r\n        };\r\n    }\r\n\r\n    getSampleAmount() {\r\n        return this.size;\r\n    }\r\n\r\n    getSampleDuration() {\r\n        return this.sampleDuration;\r\n    }\r\n\r\n    getNestedArray() {\r\n        const nestedArray = new Array(this.size);\r\n        for (let y = 0; y < this.size; y++) {\r\n            nestedArray[y] = new Array(this.size);\r\n            for (let x = 0; x < this.size; x++) {\r\n                nestedArray[y][x] = this.getValueMirrored(x, y);\r\n            }\r\n        }\r\n\r\n        return nestedArray;\r\n    }\r\n\r\n    getNewEmptyMatrix() {\r\n        return new HalfMatrix(this);\r\n    }\r\n    getSize() {\r\n        return this.size;\r\n    }\r\n\r\n    normalize() {\r\n        let min = this.numberType.max;\r\n        let max = this.numberType.min;\r\n        this.forEach((value) => {\r\n            if (value > max) {\r\n                max = value;\r\n            }\r\n            if (value < min) {\r\n                min = value;\r\n            }\r\n        });\r\n\r\n        let i = this.length;\r\n        while (i--) {\r\n            this.data[i] = (this.data[i] - min) / (max - min);\r\n        }\r\n    }\r\n\r\n    getMeanAndStandardDeviation() {\r\n        if (this.featureAmount > 1) return 0;\r\n        let sum = 0;\r\n        for (let y = 0; y < this.size; y++) {\r\n            const cellsBefore = ((y * y + y) / 2) * this.featureAmount;\r\n            for (let x = 0; x < y + 1; x++) {\r\n                sum += this.data[cellsBefore + x] / this.numberType.scale;\r\n            }\r\n        }\r\n        const mean = sum / this.data.length;\r\n        let meanSquared = 0;\r\n        for (let y = 0; y < this.size; y++) {\r\n            const cellsBefore = ((y * y + y) / 2) * this.featureAmount;\r\n            for (let x = 0; x < y + 1; x++) {\r\n                meanSquared += Math.pow(this.data[cellsBefore + x] / this.numberType.scale - mean, 2);\r\n            }\r\n        }\r\n        const sd = Math.sqrt(meanSquared / this.data.length);\r\n        return [mean, sd];\r\n    }\r\n\r\n    changeDistribution(deltaMean, deltaDeviation) {\r\n        const [mean, sd] = this.getMeanAndStandardDeviation();\r\n        let i = this.length;\r\n        while (i--) {\r\n            let val = this.data[i] / this.numberType.scale;\r\n            val -= mean;\r\n            val *= deltaDeviation;\r\n            val += mean + deltaMean;\r\n            val = Math.min(1, Math.max(0, val));\r\n            this.data[i] = val * this.numberType.scale;\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tempo.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tempo.vue?vue&type=style&index=0&lang=css&\"","module.exports = __webpack_public_path__ + \"js/9.59fd8a5f.worker.js\"","import * as log from \"../../dev/log\";\r\n\r\nexport const NumberType = Object.freeze({\r\n    UINT8: { name: \"UINT8\", max: Math.pow(2, 8) - 1, min: 0, scale: Math.pow(2, 8) - 1, array: Uint8Array },\r\n    UINT16: { name: \"UINT16\", max: Math.pow(2, 16) - 1, min: 0, scale: Math.pow(2, 16) - 1, array: Uint16Array },\r\n    UINT32: { name: \"UINT32\", max: Math.pow(2, 32) - 1, min: 0, scale: Math.pow(2, 32) - 1, array: Uint32Array },\r\n    INT8: { name: \"INT8\", max: Math.pow(2, 7) - 1, min: -Math.pow(2, 7), scale: Math.pow(2, 7) - 1, array: Int8Array },\r\n    INT16: {\r\n        name: \"INT16\",\r\n        max: Math.pow(2, 15) - 1,\r\n        min: -Math.pow(2, 15),\r\n        scale: Math.pow(2, 15) - 1,\r\n        array: Int16Array,\r\n    },\r\n    INT32: {\r\n        name: \"INT32\",\r\n        max: Math.pow(2, 31) - 1,\r\n        min: -Math.pow(2, 31),\r\n        scale: Math.pow(2, 31) - 1,\r\n        array: Int32Array,\r\n    },\r\n    FLOAT32: {\r\n        name: \"FLOAT32\",\r\n        max: Number.POSITIVE_INFINITY,\r\n        min: Number.NEGATIVE_INFINITY,\r\n        scale: 1,\r\n        array: Float32Array,\r\n    },\r\n    FLOAT64: {\r\n        name: \"FLOAT64\",\r\n        max: Number.POSITIVE_INFINITY,\r\n        min: Number.NEGATIVE_INFINITY,\r\n        scale: 1,\r\n        array: Float64Array,\r\n    },\r\n});\r\n\r\nexport function getNumberTypeByName(objectOrString) {\r\n    if (typeof objectOrString === \"string\") {\r\n        for (const type of Object.values(NumberType)) {\r\n            if (type.name === objectOrString) {\r\n                return type;\r\n            }\r\n        }\r\n    } else {\r\n        return objectOrString;\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Track.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Track.vue?vue&type=style&index=0&lang=css&\"","module.exports = __webpack_public_path__ + \"img/5.8f775571.png\";","module.exports = __webpack_public_path__ + \"js/4.84fc8a5c.worker.js\"","module.exports = __webpack_public_path__ + \"js/2.cc3899fc.worker.js\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Landing.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Landing.vue?vue&type=style&index=0&lang=css&\"","module.exports = __webpack_public_path__ + \"js/8.b85bdbc5.worker.js\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graphs.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graphs.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graph.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Graph.vue?vue&type=style&index=0&lang=css&\"","module.exports = __webpack_public_path__ + \"js/10.a6feb73b.worker.js\"","module.exports = __webpack_public_path__ + \"img/9.4839c5e9.png\";","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Seeker.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Seeker.vue?vue&type=style&index=0&lang=css&\"","module.exports = __webpack_public_path__ + \"js/1.9337d902.worker.js\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Player.vue?vue&type=style&index=0&id=74130b5a&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Player.vue?vue&type=style&index=0&id=74130b5a&scoped=true&lang=css&\"","module.exports = __webpack_public_path__ + \"js/5.59c9e39c.worker.js\"","module.exports = __webpack_public_path__ + \"js/0.58cca094.worker.js\"","module.exports = __webpack_public_path__ + \"js/3.ea244109.worker.js\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HolisticStructure.vue?vue&type=style&index=0&id=67916a9a&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HolisticStructure.vue?vue&type=style&index=0&id=67916a9a&scoped=true&lang=css&\"","module.exports = __webpack_public_path__ + \"img/4.1282f7d7.png\";","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GroundTruth.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./GroundTruth.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}