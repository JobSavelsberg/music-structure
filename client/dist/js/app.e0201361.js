(function(t){function e(e){for(var a,r,o=e[0],c=e[1],l=e[2],h=0,d=[];h<o.length;h++)r=o[h],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&d.push(s[r][0]),s[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==s[c]&&(a=!1)}a&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},s={app:0},i=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var o=this["webpackJsonp"]=this["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var a=n("85ec"),s=n.n(a);s.a},"1aec":function(t,e,n){"use strict";var a=n("d917"),s=n.n(a);s.a},"2f67":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{attrs:{id:"app",dark:!0}},[n("router-view")],1)},i=[],r={name:"App",components:{},beforeCreate:function(){window.onSpotifyWebPlaybackSDKReady=function(){console.log("The Web Playback SDK is ready. We have access to Spotify.Player"),console.log(window.Spotify.Player)}},data:function(){return{}},mounted:function(){var t=document.getElementsByTagName("html")[0];t.style.overflowY="auto"},destroyed:function(){var t=document.getElementsByTagName("html")[0];t.style.overflowY=null}},o=r,c=(n("034f"),n("2877")),l=n("6544"),u=n.n(l),h=n("7496"),d=Object(c["a"])(o,s,i,!1,null,null,null),f=d.exports;u()(d,{VApp:h["a"]});var m=n("8c4f"),p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("v-app-bar",{attrs:{dark:""}},[n("v-toolbar-title",[t._v("Music Structure Visualizer")]),n("v-spacer"),n("form",{on:{submit:function(e){return e.preventDefault(),t.search(e)}}},[n("v-text-field",{attrs:{"hide-details":"","append-icon":"mdi-magnify","single-line":"",rounded:"",dense:"",filled:""},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}})],1),n("div",{staticClass:"volumeSlider"},[n("v-container",[n("v-slider",{attrs:{"prepend-icon":t.getVolumeIcon(t.volume),min:0,max:1,step:.02},on:{"click:prepend":t.clickVolume},model:{value:t.volume,callback:function(e){t.volume=e},expression:"volume"}})],1)],1),n("v-btn",{attrs:{icon:""}},[n("v-icon",[t._v("mdi-heart")])],1),n("v-btn",{attrs:{icon:""}},[n("v-icon",[t._v("mdi-dots-vertical")])],1)],1),n("TrackSelector",{attrs:{tracks:t.trackList,"album-size":120}}),n("Player",{attrs:{padding:t.padding}}),n("Visualization",{attrs:{padding:t.padding}})],1)},g=[],v=(n("b0c0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-slide-group",{staticClass:"pt-2",attrs:{"center-active":"",mandatory:""},nativeOn:{scroll:function(e){return t.onScroll(e)}},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},t._l(t.tracks,(function(e,a){return n("v-slide-item",{key:a,staticClass:"mx-2 my-1",scopedSlots:t._u([{key:"default",fn:function(a){var s=a.active,i=a.toggle;return[n("Album",{attrs:{album:e.trackData,imgSize:s?1.5*t.albumSize:t.albumSize,active:s},on:{clicked:i}})]}}],null,!0)})})),1)],1)}),y=[],b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card",{class:t.active?"elevation-3":"elevation-0",style:t.cardStyle},[n("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"track",on:{click:t.clicked}},[n("v-img",{attrs:{height:t.imgSize,width:t.imgSize,src:t.album.album.images[t.imgIndex].url}}),n("v-card-text",{staticClass:"pl-2 py-0 pt-1 ml-0 my-0"},[n("div",{staticClass:"text-subtitle-2 text--primary text-truncate "},[t._v(t._s(t.album.name))])])],1),n("v-card-actions",{staticClass:"pl-0 py-0 ml-0 my-0"},[n("v-btn",{staticClass:"artistButton",attrs:{text:"",color:"grey",small:""}},[n("span",{staticClass:"artistButtonText text-caption text-truncate",style:{"max-width":this.imgSize-12+"px"}},[t._v(" "+t._s(t.album.artists[0].name)+" ")])])],1)],1)},k=[],w={props:["album","imgSize","active"],data:function(){return{}},mounted:function(){},computed:{imgIndex:function(){return this.size<=this.album.album.images[2].height?2:this.size<=this.album.album.images[1].height?1:0},cardStyle:function(){return{width:this.imgSize+"px",height:this.imgSize+55+"px"}}},methods:{clicked:function(){this.$emit("clicked")}}},S=w,x=(n("8ade"),n("8336")),T=n("b0af"),R=n("99d9"),O=n("adda"),C=n("269a"),_=n.n(C),A=n("5607"),j=Object(c["a"])(S,b,k,!1,null,null,null),E=j.exports;u()(j,{VBtn:x["a"],VCard:T["a"],VCardActions:R["a"],VCardText:R["c"],VImg:O["a"]}),_()(j,{Ripple:A["a"]});n("4160"),n("a630"),n("4ec9"),n("d3b7"),n("ac1f"),n("3ca3"),n("841c"),n("159b"),n("ddb0");var P,V,F=n("a34a"),M=n.n(F),D=(n("96cf"),n("1da1")),L=n("be8d"),I=(n("25f0"),n("bc3a")),B=n.n(I),$="https://music-structure.herokuapp.com/api",z=B.a.create({baseURL:$,withCredentials:!1});function W(t){return U.apply(this,arguments)}function U(){return U=Object(D["a"])(M.a.mark((function t(e){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,z.post("spotify/token",{code:e}).then((function(t){P=t.data.access_token,window.sessionStorage.setItem("token",P),t.data.expires_in,window.sessionStorage.setItem("tokenTimestamp",(new Date).getTime().toString()),V=t.data.expires_in,window.sessionStorage.setItem("refreshToken",V)})).catch((function(t){console.log(t)}));case 2:case"end":return t.stop()}}),t)}))),U.apply(this,arguments)}function N(){if(void 0===P){var t=window.sessionStorage.getItem("token");window.sessionStorage.getItem("tokenTimestamp"),window.sessionStorage.getItem("refreshToken");return!!t&&(P=t,!0)}return!0}n("cb29"),n("d81d");var H=n("d4ec"),G=n("bee2"),Y=n("ade3"),q=(n("99af"),n("3835")),X=n("5698"),J=[0,7,2,9,4,11,6,1,8,3,10,5],Q=X.scaleLinear().domain([0,1/12,2/12,2.8/12,3.8/12,4.3/12,5.3/12,6.8/12,8/12,8.8/12,.775,.875,1]).interpolate(X.interpolateHcl).range([X.rgb("#FE0000"),X.rgb("#FF7300"),X.rgb("#FFAA01"),X.rgb("#FFD300"),X.rgb("#FFFF01"),X.rgb("#9FEE00"),X.rgb("#01CC00"),X.rgb("#009899"),X.rgb("#1241AB"),X.rgb("#3914B1"),X.rgb("#7209AC"),X.rgb("#CD0174"),X.rgb("#FE0000")]);Math.PI,Math.PI;var K=2*Math.PI,Z=3*Math.PI/2;function tt(t){for(var e=0,n=0,a=0,s=0;s<12;s++){var i=-J[s]/12*K+Z,r=t[s];a+=r/12,e+=r*Math.cos(i),n+=r*Math.sin(i)}var o=(Math.atan2(e,n)+Math.PI)/K,c=Math.sqrt(e*e+n*n);return[o,c,a]}function et(t){var e=tt(t),n=Object(q["a"])(e,3),a=n[0],s=n[1],i=n[2],r=X.hsl(Q(a)),o=Math.min(3*s/(12*i),1);return r.s=o,r.hex()}function nt(t){var e=Math.max(0,60+t)/60;return e*e}var at=function(){function t(e){Object(H["a"])(this,t),Object(Y["a"])(this,"segment",null),Object(Y["a"])(this,"start",0),Object(Y["a"])(this,"duration",0),Object(Y["a"])(this,"loudness_start",0),Object(Y["a"])(this,"loudness_max_time",0),Object(Y["a"])(this,"loudness_max",0),Object(Y["a"])(this,"loudness_end",0),Object(Y["a"])(this,"pitches",[]),Object(Y["a"])(this,"pitchesTransposed",[]),Object(Y["a"])(this,"timbres",[]),Object(Y["a"])(this,"timbresScaled",[]),Object(Y["a"])(this,"cluster",-1),Object(Y["a"])(this,"tsneCoord",[0,0]),Object(Y["a"])(this,"tonalityAngle",0),Object(Y["a"])(this,"tonalityRadius",0),Object(Y["a"])(this,"tonalityEnergy",0),Object(Y["a"])(this,"percussiony",0),Object(Y["a"])(this,"processedPitch",!1),Object(Y["a"])(this,"processedPitchSmooth",!1),Object(Y["a"])(this,"processedTimbre",!1),this.segment=e,this.start=e.start,this.duration=e.duration,this.loudness_start=e.loudness_start,this.loudness_max=e.loudness_max,this.loudness_max_time=e.loudness_max_time,this.loudness_end=e.loudness_end}return Object(G["a"])(t,[{key:"processPitch",value:function(){var t=this;if(!this.processedPitch){if(this.processedPitchSmooth)throw Error("processed pitchSmooth before setting initial pitch");this.segment.pitches.forEach((function(e,n){t.pitches.push(e)}));var e=tt(this.pitches),n=Object(q["a"])(e,3);this.tonalityAngle=n[0],this.tonalityRadius=n[1],this.tonalityEnergy=n[2];var a=.2,s=.5,i=this.duration<a?1:s-(this.duration-.15);this.percussiony=Math.min(1,(1-this.tonalityRadius)*this.tonalityEnergy*2)*i,this.calculateTransposedPitches(),this.processedPitch=!0}}},{key:"processPitchSmooth",value:function(t,e){if(!this.processedPitchSmooth){if(!this.processedPitch)throw Error("processed pitchSmooth called before setting initial pitch");for(var n=0;n<this.pitches.length;n++)this.pitches[n]=(1-this.percussiony)*this.pitches[n]+this.percussiony*(t.pitches[n]+e.pitches[n])/2;this.processedPitchSmooth=!0}}},{key:"processTimbre",value:function(t,e,n,a){var s=this;this.processedTimbre||(this.segment.timbre.forEach((function(t,e){s.timbres.push(t/a)})),this.segment.timbre.forEach((function(t,e){s.timbresScaled.push(t/n[e])})),this.processedTimbre=!0)}},{key:"calculateTransposedPitches",value:function(){for(var t=0;t<12;t++){this.pitchesTransposed.push(new Array(12));for(var e=0;e<12;e++)this.pitchesTransposed[t][e]=this.pitches[(e+t)%12]}}},{key:"getPitches",value:function(){return this.pitches}},{key:"getTimbres",value:function(){return this.timbres}},{key:"getDuration",value:function(){return this.duration_ms}},{key:"getStart",value:function(){return this.start}},{key:"getOriginalTimbres",value:function(){return this.segment.timbre}},{key:"getFeatures",value:function(){return this.pitches.concat(this.timbres)}},{key:"setCluster",value:function(t){this.cluster=t}},{key:"setTSNECoord",value:function(t){this.tsneCoord=t}},{key:"getTonalEnergy",value:function(){return this.tonalityEnergy}},{key:"getTonalAngle",value:function(){return this.tonalityAngle}},{key:"getLoudnessFeatures",value:function(){return[nt(this.loudness_start),nt(this.loudness_max),this.loudness_max_time,nt(this.loudness_end)]}}]),t}();function st(t,e){for(var n=0,a=0,s=0,i=0;i<t.length;i++)n+=t[i]*e[i],a+=t[i]*t[i],s+=e[i]*e[i];return a=Math.sqrt(a),s=Math.sqrt(s),n/(a*s)}function it(t,e){return Math.sqrt(rt(t,e))}function rt(t,e){for(var n=0,a=0;a<t.length;a++){var s=t[a]-e[a];n+=s*s}return n}n("a434");var ot=n("2f62");a["a"].use(ot["a"]);var ct,lt=new ot["a"].Store({state:{user:Object,trackList:[],selectedIndex:-1,seeker:0,playerState:null,loadingTrack:!0,playerReady:!1,playing:!1,tsneReady:!1,ssmReady:!1,clusterReady:!1},mutations:{setSeeker:function(t,e){t.seeker=e},setUser:function(t,e){console.log("setting user to",e),t.user=e},setPlayerState:function(t,e){t.playerState=e},loadingTrack:function(t,e){t.loadingTrack=e},playerReady:function(t,e){t.playerReady=e},addToTrackList:function(t,e){t.trackList.push(e)},addToTrackListIndex:function(t,e,n){t.trackList.splice(e,0,n)},addToTrackListFront:function(t,e){t.trackList.unshift(e)},clearTrackList:function(t){t.trackList=[]},setSelectedIndex:function(t,e){t.selectedIndex=e},setPlaying:function(t,e){t.playing=e},incrementSeeker:function(t,e){t.seeker+=e},tsneReady:function(t,e){t.tsneReady=e},clusterReady:function(t,e){t.clusterReady=e},ssmReady:function(t,e){t.ssmReady=e}},actions:{},getters:{seeker:function(t){return t.seeker},selectedIndex:function(t){return t.selectedIndex},selectedTrack:function(t){return t.trackList[t.selectedIndex]},user:function(t){return t.user},track:function(t,e){return t.trackList[e]},trackList:function(t){return t.trackList},playerState:function(t){return t.playerState},playing:function(t){return t.playing},tsneReady:function(t){return t.tsneReady},clusterReady:function(t){return t.clusterReady},ssmReady:function(t){return t.ssmReady}},modules:{}}),ut=n("2909"),ht=n("b85c"),dt=function(){function t(e,n,a){Object(H["a"])(this,t),Object(Y["a"])(this,"timbreMax",new Array(12).fill(0)),Object(Y["a"])(this,"timbreMin",new Array(12).fill(0)),Object(Y["a"])(this,"timbreBiggest",new Array(12).fill(0)),Object(Y["a"])(this,"timbreTotalBiggest",0),Object(Y["a"])(this,"segments",void 0),Object(Y["a"])(this,"raw",{pitches:[],timbres:[],loudness:[]}),Object(Y["a"])(this,"processed",{pitches:[],pitchesFlat:[],timbres:[],loudness:[],tonalEnergy:[],tonalRadius:[],tonalAngle:[]}),Object(Y["a"])(this,"ssmSelection",[]),Object(Y["a"])(this,"clusterSelection",[]),Object(Y["a"])(this,"tsneSelection",[]),Object(Y["a"])(this,"sampleDuration",0),Object(Y["a"])(this,"sampleAmount",0),Object(Y["a"])(this,"sampled",{}),this.segments=e,this.sampleDuration=1/n,this.duration=a,this.sampleAmount=Math.ceil(a/n),console.log("Sample amount:",this.sampleAmount),this.calculateMaxMin(),this.processSegments(),this.sampleFeatures()}return Object(G["a"])(t,[{key:"calculateMaxMin",value:function(){var t=this;this.segments.forEach((function(e,n){for(var a=0;a<12;a++)t.timbreMax[a]=Math.max(t.timbreMax[a],e.getOriginalTimbres()[a]),t.timbreMin[a]=Math.min(t.timbreMin[a],e.getOriginalTimbres()[a])}));for(var e=0;e<12;e++)this.timbreBiggest[e]=Math.max(Math.abs(this.timbreMax[e]),Math.abs(this.timbreMin[e])),this.timbreTotalBiggest=Math.max(this.timbreTotalBiggest,this.timbreBiggest[e])}},{key:"processSegments",value:function(){var t=this;this.segments.forEach((function(e,n){t.raw.pitches=e.segment.pitches,t.raw.timbres=e.segment.timbres,t.raw.loudness=e.getLoudnessFeatures(),e.processPitch(),e.processTimbre(t.timbreMin,t.timbreMax,t.timbreBiggest,t.timbreTotalBiggest),t.processed.pitches.push(e.pitches);var a,s=Object(ht["a"])(e.pitches);try{for(s.s();!(a=s.n()).done;){var i=a.value;t.processed.pitchesFlat.push(i)}}catch(r){s.e(r)}finally{s.f()}t.processed.timbres.push(e.timbres),t.processed.tonalEnergy.push(e.tonalityEnergy),t.processed.tonalRadius.push(e.tonalityRadius),t.processed.tonalAngle.push(e.tonalityAngle),t.processed.loudness.push(e.getLoudnessFeatures())}));for(var e=0;e<this.segments.length;e++)e>0&&e<this.segments.length-1&&this.segments[e].processPitchSmooth(this.segments[e-1],this.segments[e+1]),this.clusterSelection.push([].concat(Object(ut["a"])(this.processed.timbres[e]),[this.processed.tonalEnergy[e],this.processed.tonalRadius[e]],Object(ut["a"])(this.processed.loudness[e]))),this.tsneSelection.push([].concat(Object(ut["a"])(this.processed.timbres[e]),[this.processed.tonalEnergy[e],this.processed.tonalRadius[e]],Object(ut["a"])(this.processed.loudness[e])))}},{key:"sampleFeatures",value:function(){console.log("sampling features");var t=0,e=this.sampleDuration;this.initSampleFeatures();for(var n=0;n<this.segments.length;n++){var a=this.segments[n],s=a.duration;if(this.addFeaturesScaled(t,n,s),s>e){if(this.addFeaturesScaled(t,n,e),this.divideFeatures(t,this.sampleDuration-e),t+1>=this.sampleAmount)break;t++;var i=s-e;this.addFeaturesScaled(t,n,i),e=this.sampleDuration-i}else this.setFeaturesScaled(t,n,s),e-=s}this.divideFeatures(t,this.sampleDuration-e)}},{key:"initSampleFeatures",value:function(){for(var t in this.processed)if(this.sampled[t]=new Array(this.sampleAmount).fill(0),this.processed[t][0].length)for(var e=0;e<this.sampleAmount;e++)this.sampled[t][e]=new Array(this.processed[t][0].length).fill(0)}},{key:"setFeaturesScaled",value:function(t,e,n){for(var a in this.processed)if(this.processed[a][t].length)for(var s=0;s<this.processed[a][t].length;s++)this.sampled[a][t][s]=this.processed[a][e][s]*n;else this.sampled[a][t]=this.processed[a][e]*n}},{key:"addFeaturesScaled",value:function(t,e,n){for(var a in this.processed)if(this.processed[a][t].length)for(var s=0;s<this.processed[a][t].length;s++)this.sampled[a][t][s]+=this.processed[a][e][s]*n;else this.sampled[a][t]+=this.processed[a][e]*n}},{key:"divideFeatures",value:function(t,e){for(var n in this.sampled)if(this.sampled[n][t].length)for(var a=0;a<this.sampled[n][t].length;a++)this.sampled[n][t][a]/=e;else this.sampled[n][t]/=e}}]),t}();function ft(){return mt.apply(this,arguments)}function mt(){return mt=Object(D["a"])(M.a.mark((function t(){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:ct=new Worker("/ssmWorker.js",{type:"module"}),new Worker("./tsneWorker",{type:"module"}),new Worker("clusterWorker.js",{type:"module"});case 3:case"end":return t.stop()}}),t)}))),mt.apply(this,arguments)}function pt(t,e,n,a){return gt.apply(this,arguments)}function gt(){return gt=Object(D["a"])(M.a.mark((function t(e,n,a,s){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,i){var r=!1|s.useSampled,o=4|s.blurTime,c=.5|s.threshold,l=e.getId();ct.postMessage({features:n,featureLength:a,segmentObjects:e.segments,id:l,timestamp:new Date,sampled:r,blurTime:o,threshold:c}),ct.onmessage=function(e){var n=e.data;n.id===l&&t(n)}})));case 1:case"end":return t.stop()}}),t)}))),gt.apply(this,arguments)}function vt(t,e){return yt.apply(this,arguments)}function yt(){return yt=Object(D["a"])(M.a.mark((function t(e,n){var a,s,i,r,o,c,l;return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(a=e.length,s=new Array(12),i=n?12:1,r=0;r<i;r++)for(s[r]=new Array(a),o=0;o<a;o++)for(c=e[o],s[r][o]=new Array(a-o),l=o;l<a;l++)s[r][o][l-o]=new Array(2),s[r][o][l-o][0]=st(c.pitches,e[l].pitchesTransposed[r]),s[r][o][l-o][1]=st(c.timbresScaled,e[l].timbresScaled);return t.abrupt("return",s);case 5:case"end":return t.stop()}}),t)}))),yt.apply(this,arguments)}var bt=10,kt=function(){function t(e){Object(H["a"])(this,t),Object(Y["a"])(this,"trackData",null),Object(Y["a"])(this,"analysisData",null),Object(Y["a"])(this,"segments",[]),Object(Y["a"])(this,"ssm",null),Object(Y["a"])(this,"features",void 0),Object(Y["a"])(this,"processed",!1),Object(Y["a"])(this,"clusters",new Array(bt).fill([])),this.trackData=e}return Object(G["a"])(t,[{key:"process",value:function(){this.createSegmentObjects(),this.features=new dt(this.segments,1,this.getAnalysisDuration()),this.tsne(),this.cluster(),this.calculateSSM(),this.processed=!0}},{key:"createSegmentObjects",value:function(){var t=this;console.log("Creating segmentObjects"),this.analysisData.segments.forEach((function(e){t.segments.push(new at(e))})),console.log("Created segmentObjects")}},{key:"calculateSSM",value:function(){var t=this,e=new Date,n=vt(this.segments,!1).then((function(){console.log(n);var t=new Date-e;console.log("Time it took to finish JS",t)}));console.log("Ello"),console.log("starting SSMWorker"),pt(this,this.features.processed.pitchesFlat,12,{useSampled:!1}).then((function(e){console.log(e),t.ssm=n,lt.commit("ssmReady",!0),console.log("ssm Done")}))}},{key:"cluster",value:function(){console.log("starting Clusterworker")}},{key:"updateClusters",value:function(t){var e=this;lt.commit("clusterReady",!1),t.forEach((function(t,n){e.segments[n].setCluster(t),e.clusters[t].push(e.segments[n])})),window.setTimeout(lt.commit("clusterReady",!0),1)}},{key:"tsne",value:function(){console.log("starting tsneWorker")}},{key:"updateTSNECoords",value:function(t){lt.commit("tsneReady",!1);for(var e=0;e<this.segments.length;e++)this.segments[e].setTSNECoord(t[e]);window.setTimeout(lt.commit("tsneReady",!0),1)}},{key:"getClosestSegment",value:function(t){var e=1/0,n=null;return this.segments.forEach((function(a){var s=it(t,a.tsneCoord);s<e&&(e=s,n=a)})),n}}]),Object(G["a"])(t,[{key:"toJSON",value:function(){return{trackData:this.trackData,analysisData:this.analysisData}}},{key:"getId",value:function(){return this.trackData.id}},{key:"hasAnalysis",value:function(){return null!==this.analysisData&&this.segments.length>0}},{key:"getAnalysis",value:function(){return this.analysisData}},{key:"setAnalysis",value:function(t){this.processed||(this.analysisData=t,console.log("processing"),this.process(),console.log("processed"))}},{key:"getName",value:function(){return this.trackData.name}},{key:"getArtist",value:function(){return this.trackData.artist}},{key:"getUri",value:function(){return this.trackData.uri}},{key:"getSegments",value:function(){return this.segments}},{key:"getSegment",value:function(t){return this.segments[t]}},{key:"getSSM",value:function(){return this.ssm}},{key:"getSSMValue",value:function(t,e){return this.ssm[t][t-e]}},{key:"getBars",value:function(){return this.analysisData.bars}},{key:"getBeats",value:function(){return this.analysisData.beats}},{key:"getTatums",value:function(){return this.analysisData.tatums}},{key:"getProcessedPitch",value:function(t){return this.segments[t].getPitches()}},{key:"getProcessedPitches",value:function(){return this.segments.map((function(t){return t.getPitches()}))}},{key:"getProcessedTimbre",value:function(t){return this.segments[t].getTimbres()}},{key:"getProcessedTimbres",value:function(){return this.segments.map((function(t){return t.getTimbres()}))}},{key:"getAnalysisDuration",value:function(){return this.analysisData.track.duration}}],[{key:"createWithAnalysis",value:function(e,n){var a=new t(e);return a.setAnalysis(n),a}},{key:"fromJSON",value:function(t){return this.createWithAnalysis(t.trackData,t.analysisData)}}]),t}(),wt=new L,St=new Map;function xt(){return Tt.apply(this,arguments)}function Tt(){return Tt=Object(D["a"])(M.a.mark((function t(){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:ft().then((function(){return console.log("Initialized Workers!")})),console.log("Got tracks from local storage: ",St),wt.setAccessToken(P),wt.getMe().then((function(t){lt.commit("setUser",t)})).catch((function(t){kn.push("/")})),wt.getMyTopTracks({limit:50,offset:0}).then((function(t){Ct(t.items,!1),Rt(0)})).catch((function(t){return console.log(t)}));case 5:case"end":return t.stop()}}),t)}))),Tt.apply(this,arguments)}function Rt(t){return Ot.apply(this,arguments)}function Ot(){return Ot=Object(D["a"])(M.a.mark((function t(e){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return lt.commit("loadingTrack",!0),lt.commit("tsneReady",!1),lt.commit("clusterReady",!1),lt.commit("ssmReady",!1),t.abrupt("return",_t(lt.getters.trackList[e]).then((function(){console.log("Getting analysis and everything done, now setting selected index"),lt.commit("loadingTrack",!1),lt.commit("setSelectedIndex",e)})));case 5:case"end":return t.stop()}}),t)}))),Ot.apply(this,arguments)}function Ct(t,e){var n=lt.getters.selectedTrack;lt.commit("clearTrackList"),t.forEach((function(t){if(St.has(t.id))lt.commit("addToTrackList",St.get(t.id));else{var e=new kt(t);St.set(t.id,e),lt.commit("addToTrackList",e)}})),e?(lt.commit("addToTrackListFront",n),lt.commit("setSelectedIndex",0)):Rt(0)}function _t(t){return At.apply(this,arguments)}function At(){return At=Object(D["a"])(M.a.mark((function t(e){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.hasAnalysis()){t.next=2;break}return t.abrupt("return",e.getAnalysis());case 2:return t.abrupt("return",wt.getAudioAnalysisForTrack(e.getId()).then((function(t){console.log("Got analysis from api"),e.setAnalysis(t),console.log("Track has done everything with analysis")})).catch((function(t){console.log(t)})));case 3:case"end":return t.stop()}}),t)}))),At.apply(this,arguments)}function jt(t){return Et.apply(this,arguments)}function Et(){return Et=Object(D["a"])(M.a.mark((function t(e){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:wt.search(e,["track"]).then((function(t){Ct(t.tracks.items,!0)})).catch((function(t){console.log(t)}));case 1:case"end":return t.stop()}}),t)}))),Et.apply(this,arguments)}var Pt={name:"TrackSelector",props:["tracks","albumSize"],components:{Album:E},data:function(){return{selected:0}},computed:{selectedFromStore:function(){return this.$store.getters.selectedIndex}},watch:{selected:"selectedChanged",selectedFromStore:"selectedFromStoreChanged"},mounted:function(){},methods:{selectedChanged:function(t,e){Rt(t)},selectedFromStoreChanged:function(t,e){this.selected=t}}},Vt=Pt,Ft=n("7efd"),Mt=n("9dbe"),Dt=Object(c["a"])(Vt,v,y,!1,null,null,null),Lt=Dt.exports;u()(Dt,{VSlideGroup:Ft["a"],VSlideItem:Mt["a"]});var It,Bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"d-flex pa-2"},[n("v-row",[n("v-layout",{staticClass:"ml-10"},[n("v-switch",{staticClass:"mx-5",attrs:{label:"Raw Pitch Data","hide-details":""},model:{value:t.canvasVis.rawPitch.draw,callback:function(e){t.$set(t.canvasVis.rawPitch,"draw",e)},expression:"canvasVis.rawPitch.draw"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Raw Timbre Data","hide-details":""},model:{value:t.canvasVis.rawTimbre.draw,callback:function(e){t.$set(t.canvasVis.rawTimbre,"draw",e)},expression:"canvasVis.rawTimbre.draw"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Rhythm Data","hide-details":""},model:{value:t.canvasVis.rawRhythm.draw,callback:function(e){t.$set(t.canvasVis.rawRhythm,"draw",e)},expression:"canvasVis.rawRhythm.draw"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Tonality","hide-details":""},model:{value:t.canvasVis.tonality.draw,callback:function(e){t.$set(t.canvasVis.tonality,"draw",e)},expression:"canvasVis.tonality.draw"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Similarity Matrix","hide-details":""},model:{value:t.canvasVis.ssm.draw,callback:function(e){t.$set(t.canvasVis.ssm,"draw",e)},expression:"canvasVis.ssm.draw"}})],1),n("v-spacer"),n("v-btn",{staticClass:"mr-10",attrs:{color:"primary",fab:"",dark:"",small:""},on:{click:t.zoom}},[n("v-icon",[t._v("mdi-magnify-plus-outline")])],1)],1)],1),n("div",{staticClass:"vis",on:{click:t.clickedVis}},[t.loadingTrack?t._e():n("svg",{staticClass:"visSeeker"},[n("rect",{attrs:{x:this.zoomed?this.padding+this.canvasWidth/2:t.padding+this.seeker/1e3*t.scale-1,y:0,width:2,height:t.canvasHeight,fill:"#ffffff",opacity:.5}})]),n("canvas",{directives:[{name:"show",rawName:"v-show",value:!t.loadingTrack,expression:"!loadingTrack"}],ref:"visCanvas",staticClass:"visCanvas pa-0 ma-0",attrs:{id:"visCanvas"}}),n("canvas",{staticClass:"visCanvas pa-0 ma-0",attrs:{id:"gl-canvas"}})])])},$t=[],zt=(n("4fad"),n("5698")),Wt=null,Ut=!1,Nt="",Ht=0,Gt=null;function Yt(t,e){return qt.apply(this,arguments)}function qt(){return qt=Object(D["a"])(M.a.mark((function t(e,n){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:Nt=e,Ht=n;case 2:case"end":return t.stop()}}),t)}))),qt.apply(this,arguments)}function Xt(t){return Jt.apply(this,arguments)}function Jt(){return Jt=Object(D["a"])(M.a.mark((function t(e){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!Wt){t.next=7;break}if(!Ut||""!==Nt){t.next=6;break}return Zt(e),t.abrupt("return",It.resume().then((function(){lt.commit("setPlaying",!0)})).catch((function(t){console.log(t)})));case 6:return t.abrupt("return",wt.play({device_id:Wt,uris:[Nt],position_ms:e||Ht}).then((function(){Ut=!0,Nt,Nt="",Ht=0,lt.commit("setPlaying",!0)})).catch((function(t){console.log(t)})));case 7:case"end":return t.stop()}}),t)}))),Jt.apply(this,arguments)}function Qt(){return Kt.apply(this,arguments)}function Kt(){return Kt=Object(D["a"])(M.a.mark((function t(){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!Wt||!Ut){t.next=2;break}return t.abrupt("return",It.pause().then((function(){lt.commit("setPlaying",!1)})).catch((function(t){console.log(t)})));case 2:case"end":return t.stop()}}),t)}))),Kt.apply(this,arguments)}function Zt(t){return te.apply(this,arguments)}function te(){return te=Object(D["a"])(M.a.mark((function t(e){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!Wt||!Ut){t.next=2;break}return t.abrupt("return",It.seek(e).catch((function(t){console.log(t)})));case 2:case"end":return t.stop()}}),t)}))),te.apply(this,arguments)}function ee(t){return ne.apply(this,arguments)}function ne(){return ne=Object(D["a"])(M.a.mark((function t(e){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("playing segment",e),Xt(1e3*e.start).then((function(){Gt=e,window.setTimeout((function(){Gt===e&&Qt()}),1e3*e.duration)}));case 2:case"end":return t.stop()}}),t)}))),ne.apply(this,arguments)}function ae(){return se.apply(this,arguments)}function se(){return se=Object(D["a"])(M.a.mark((function t(){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var n=new Date,a=setInterval((function(){null!==Wt?(console.log("resolved after",new Date-n,"ms"),clearInterval(a),t()):new Date-n>1e4&&(console.log("rejected after",new Date-n,"ms"),clearInterval(a),e())}),20)})));case 1:case"end":return t.stop()}}),t)}))),se.apply(this,arguments)}function ie(t){It&&It.setVolume(t)}function re(){return oe.apply(this,arguments)}function oe(){return oe=Object(D["a"])(M.a.mark((function t(){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("waiting"),t.abrupt("return",new Promise((function(t){window.Spotify?t(window.Spotify):window.onSpotifyWebPlaybackSDKReady=function(){t(window.Spotify)}})));case 2:case"end":return t.stop()}}),t)}))),oe.apply(this,arguments)}function ce(t,e){return le.apply(this,arguments)}function le(){return le=Object(D["a"])(M.a.mark((function t(e,n){return M.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:re().then((function(){It=new window.Spotify.Player({name:"Music Structure Visualizer",getOAuthToken:function(t){t(e)},volume:.5}),It.addListener("initialization_error",(function(t){var e=t.message;console.error(e)})),It.addListener("authentication_error",(function(t){var e=t.message;console.error(e)})),It.addListener("account_error",(function(t){var e=t.message;console.error(e)})),It.addListener("playback_error",(function(t){var e=t.message;console.error(e)})),It.addListener("player_state_changed",(function(t){var e=t.position,a=t.duration,s=t.track_window.current_track;n({current_track:s,position:e,duration:a})})),It.addListener("ready",(function(t){var e=t.device_id;Wt=e,console.log("Ready with Device ID",e)})),It.addListener("not_ready",(function(t){var e=t.device_id;console.log("Device ID has gone offline",e)})),It.connect().then((function(){console.log("Connected succesfully!!!")})).catch((function(t){console.log("Could not connect")}))}));case 1:case"end":return t.stop()}}),t)}))),le.apply(this,arguments)}var ue=zt["scaleSequential"]().domain([0,1]).interpolator(zt["interpolateViridis"]),he=ue,de=zt["scaleSequential"]().domain([1,0]).interpolator(zt["interpolateGreys"]),fe=zt["scaleSequential"]().domain([-1,1]).interpolator(zt["interpolateViridis"]),me=zt["scaleSequential"]().domain([0,11]).interpolator(zt["interpolateRainbow"]),pe=zt["scaleDiverging"]().domain([-1,0,1]).interpolator(zt["interpolateRdBu"]);function ge(t,e,n,a,s,i){var r=n/t.getAnalysis().track.duration;t.getSegments().forEach((function(t){for(var n=0;n<12;n++){var o=e+t.start*r,c=s/12-2,l=a+(11-n)*(c+2),u=t.duration*r;i.fillStyle=he(t.segment.pitches[n]),i.fillRect(o,l,u,c)}}))}function ve(t,e,n,a,s,i){var r=n/t.getAnalysis().track.duration;t.getSegments().forEach((function(t,n){var o=e+t.start*r,c=s/3-2,l=a+0*(c+2),u=t.duration*r;i.fillStyle=he(2*t.tonalityEnergy-.5),i.fillRect(o,l,u,c),l=a+1*(c+2),i.fillStyle=he(1-t.tonalityRadius),i.fillRect(o,l,u,c),l=a+2*(c+2),i.fillStyle=t.duration>.15?he(0):he(t.percussiony),i.fillRect(o,l,u,c)}))}function ye(t,e,n,a,s,i){var r=n/t.getAnalysis().track.duration;t.getSegments().forEach((function(n,o){for(var c=0;c<12;c++){var l=e+n.start*r,u=s/12-2,h=a+(11-c)*(u+2),d=n.duration*r;i.fillStyle=pe(t.getProcessedTimbre(o)[c]),i.fillRect(l,h,d,u)}}))}function be(t,e,n,a,s,i){var r=n/t.getAnalysis().track.duration;t.getBars().forEach((function(t){var n=e+t.start*r,o=a;i.fillStyle=de(.3+t.confidence),i.fillRect(n,o,1,s/3)})),t.getBeats().forEach((function(t){var n=e+t.start*r,o=a+s/3;i.fillStyle=de(.3+t.confidence),i.fillRect(n,o,1,s/3)})),t.getTatums().forEach((function(t){var n=e+t.start*r,o=a+s/3*2;i.fillStyle=de(.3+t.confidence),i.fillRect(n,o,1,s/3)}))}function ke(t,e,n,a,s,i){var r=n/t.getAnalysis().track.duration;t.getSegments().forEach((function(t){var n=e+t.start*r,o=s,c=a,l=t.duration*r;i.fillStyle=et(t.pitches),i.fillRect(n,c,l,o)}))}function we(t,e,n,a,s,i){console.log("Rendering ssm...");for(var r=s/t.getAnalysis().track.duration,o=t.getSegments().length,c=0;c<o;c++)for(var l=c;l<o;l++){var u=t.getSegment(c),h=t.getSegment(l),d=t.getSSM()[c][l-c][0];i.fillStyle=de(Math.pow(d,4));var f=e+u.start*r,m=u.duration*r,p=a+h.start*r,g=h.duration*r;if(!g)return;i.fillRect(f,p,m,g);var v=t.getSSM()[c][l-c][1];i.fillStyle=de(Math.pow(v,5)),i.fillRect(p+e-a,f-e+a,g,m)}}n("a15b"),n("cfc3"),n("84c3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7");var Se,xe,Te=0;function Re(t){Se=t.getContext("webgl2"),Se||(console.log("WebGL not supported, falling back on experimental WebGL"),Se=t.getContext("experimental-webgl2"),Se||alert("Your browser does not support WebGL")),Se.clearColor(.2,.2,.2,1),Se.clear(Se.COLOR_BUFFER_BIT|Se.DEPTH_BUFFER_BIT);var e=Se.createShader(Se.VERTEX_SHADER),n=Se.createShader(Se.FRAGMENT_SHADER);if(Se.shaderSource(e,Ae),Se.shaderSource(n,je),Se.compileShader(e),Se.getShaderParameter(e,Se.COMPILE_STATUS))if(Se.compileShader(n),Se.getShaderParameter(n,Se.COMPILE_STATUS))if(xe=Se.createProgram(),Se.attachShader(xe,e),Se.attachShader(xe,n),Se.linkProgram(xe),Se.getProgramParameter(xe,Se.LINK_STATUS))if(Se.validateProgram(xe),Se.getProgramParameter(xe,Se.VALIDATE_STATUS)){for(var a=10,s=[],i=0;i<a;i++){for(var r=0;r<a;r++)s.push(.1*r,.1*i,(i*a+r)/(a*a));s.push(.1*a,.1*i,0)}for(var o=0;o<a;o++)s.push(.1*o,.1*a,0);s.push(.1*a,.1*a,0);for(var c=[],l=0;l<a;l++)for(var u=0;u<a;u++){var h=l*(a+1)+u,d=(l+1)*(a+1)+u;c.push(d,d+1,h),c.push(d+1,h+1,h)}var f=Se.createBuffer();Se.bindBuffer(Se.ELEMENT_ARRAY_BUFFER,f),Se.bufferData(Se.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),Se.STATIC_DRAW);var m=Se.createBuffer();Se.bindBuffer(Se.ARRAY_BUFFER,m),Se.bufferData(Se.ARRAY_BUFFER,new Float32Array(s),Se.STATIC_DRAW);var p=Se.getAttribLocation(xe,"vert");Se.vertexAttribPointer(p,3,Se.FLOAT,Se.FALSE,3*Float32Array.BYTES_PER_ELEMENT,0),Se.enableVertexAttribArray(p),Te=a*a*6}else console.error("ERROR validating program!",Se.getProgramInfoLog(xe));else console.error("ERROR linking program!",Se.getProgramInfoLof(xe));else console.error("ERROR compiling fragment shader!",Se.getShaderInfoLog(n));else console.error("ERROR compiling vertex shader!",Se.getShaderInfoLog(e))}function Oe(){Se.clear(Se.COLOR_BUFFER_BIT|Se.DEPTH_BUFFER_BIT)}function Ce(t){var e=t.segmentObjects,n=t.ssm,a=e.length;console.log("Number of segments: ",a);var s=t.getAnalysisDuration()/2;function i(t){return t/s-1}for(var r=[],o=0;o<a;o++)for(var c=0;c<a;c++){var l=Math.pow(o>=c?n[c][o-c][0]:n[o][c-o-1][1],4),u=i(e[c].start),h=-i(e[o].start),d=i(e[c].start+e[c].duration),f=-i(e[o].start+e[o].duration);r.push(u,h,l,u,f,l,d,h,l,d,h,l,u,f,l,d,f,l)}var m=Se.createBuffer();Se.bindBuffer(Se.ARRAY_BUFFER,m),Se.bufferData(Se.ARRAY_BUFFER,new Float32Array(r),Se.STATIC_DRAW);var p=Se.getAttribLocation(xe,"vert");Se.vertexAttribPointer(p,3,Se.FLOAT,Se.FALSE,3*Float32Array.BYTES_PER_ELEMENT,0),Se.enableVertexAttribArray(p),Te=a*a*6,console.log("Created buffer of size:",Te)}function _e(){Se.useProgram(xe),Se.drawArrays(Se.TRIANGLES,0,Te)}var Ae=["#version 300 es","precision mediump float;","","in vec3 vert;","flat out float color;","","void main()","{"," gl_Position = vec4(vert.xy, 0.0, 1.0);"," color = vert.z;","}"].join("\n"),je=["#version 300 es","precision mediump float;","","flat in float color;","out vec4 fragColor;","void main()","{"," fragColor = vec4(color, color, color, 1.0);","}"].join("\n"),Ee=zt["scaleOrdinal"](zt["schemeCategory10"]),Pe={props:["padding"],data:function(){return{canvas:null,ctx:null,hover:0,windowWidth:window.innerWidth,spotifyVisualizer:null,power:1,zoomed:!1,scaleX:4,visSpaceBetween:5,drawClusters:!0,canvasVis:{rawPitch:{draw:!0,height:150,function:ge},percussionPitch:{draw:!1,height:30,function:ve},rawTimbre:{draw:!0,height:150,function:ye},ssm:{draw:!1,height:window.innerWidth-2*this.padding,function:we},tonality:{draw:!0,height:25,function:ke},rawRhythm:{draw:!0,height:30,function:be}}}},computed:{track:function(){return this.$store.getters.selectedTrack},analysis:function(){return this.track.getAnalysis()},segments:function(){return this.track.getSegments()},scale:function(){return this.width/this.analysis.track.duration},width:function(){return this.windowWidth*(this.zoomed?this.scaleX:1)-2*this.padding},canvasWidth:function(){return this.windowWidth-2*this.padding},tsneSize:function(){return this.canvasWidth/2},canvasHeight:function(){for(var t=0,e=0,n=Object.entries(this.canvasVis);e<n.length;e++){var a=Object(q["a"])(n[e],2),s=(a[0],a[1]);t+=s.draw?this.visSpaceBetween+s.height:0}return t},loadingTrack:function(){return this.$store.state.loadingTrack},duration:function(){return Math.round(1e3*this.track.getAnalysis().track.duration)},seeker:function(){return this.$store.state.seeker}},watch:{loadingTrack:"loadingTrackChanged",seeker:"seekerChanged",canvasHeight:"canvasHeightChanged",canvasVis:{deep:!0,handler:function(t,e){this.canvasVisChanged(t,e)}}},mounted:function(){var t=this;window.addEventListener("resize",(function(){t.windowWidth=window.innerWidth})),this.webGLSetup()},methods:{webGLSetup:function(){var t=document.getElementById("gl-canvas");t.width=this.windowWidth,t.height=this.windowWidth,Re(t)},drawSSM:function(){console.log("Drawing SSM"),Oe(),Ce(this.track),_e()},clickedVis:function(t){if(console.log(t),"visCanvas"===t.srcElement.id&&t.offsetY<=this.canvasHeight){var e=Math.min(Math.max(0,t.clientX-this.padding)/this.width,1),n=e*this.duration;this.$store.commit("setSeeker",n),Zt(n)}},loudness:function(t){return nt(t)},pitchColorRange:function(t){return he(t)},timbreColorRange:function(t){return fe(t)},rainbowColorRange:function(t){return me(t)},clusterColor:function(t){return Ee(t)},loadingTrackChanged:function(t,e){this.loadingTrack&&(this.canvasVis.ssm.draw=!1)},setupCanvas:function(t){if(t){console.log("canvas ready: draw()"),this.canvas=t,this.ctx=t.getContext("2d");t.getBoundingClientRect();this.canvas.width=this.windowWidth*devicePixelRatio,this.canvas.height=this.canvasHeight*devicePixelRatio,this.ctx.scale(devicePixelRatio,devicePixelRatio),this.canvas.style.width=this.windowWidth+"px",this.canvas.style.height=this.canvasHeight+"px",this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}else console.log("canvas not ready")},draw:function(t){console.log("draw",t),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=0,n=0,a=Object.entries(this.canvasVis);n<a.length;n++){var s=Object(q["a"])(a[n],2),i=(s[0],s[1]);i.draw&&(i.function(this.track,this.padding-t,this.width,e,i.height,this.ctx),e+=this.visSpaceBetween+i.height)}},zoom:function(){console.log("zooming"),this.zoomed=!this.zoomed,this.redraw()},redraw:function(){var t=this.seeker/1e3*this.width/this.analysis.track.duration,e=this.canvasWidth/2;this.draw(this.zoomed?t-e:0)},seekerChanged:function(t,e){this.zoomed&&this.redraw()},transform:function(){this.ctx.save(),this.ctx.translate(.5*this.width,.5*this.canvasHeight),this.ctx.scale(2,2),this.ctx.drawImage(this.canvas,.5*-this.width,.5*-this.canvasHeight),this.ctx.restore()},clickedCluster:function(t,e){console.log("playing cluster",t);var n=this.track.clusters[t].length,a=(Math.floor(Math.random()*n),e);ee(a),this.$store.commit("setSeeker",1e3*a.start)},clickedSegment:function(t){ee(t),this.$store.commit("setSeeker",1e3*t.start)},clickedTSNE:function(t){var e=t.offsetX/this.tsneSize*2-1,n=t.offsetY/this.tsneSize*2-1,a=this.track.getClosestSegment([e,n]);this.clickedSegment(a)},playingSegment:function(t){return this.$store.getters.playing&&this.seeker/1e3>=t.start&&this.seeker/1e3<t.start+t.duration-.01},canvasHeightChanged:function(t,e){console.log("CanvasHeight change")},canvasVisChanged:function(){this.canvasVis.ssm.draw&&this.drawSSM()}}},Ve=Pe,Fe=(n("8aeb"),n("132d")),Me=n("a722"),De=n("0fd9"),Le=n("2fa4"),Ie=n("b73d"),Be=Object(c["a"])(Ve,Bt,$t,!1,null,null,null),$e=Be.exports;u()(Be,{VBtn:x["a"],VIcon:Fe["a"],VLayout:Me["a"],VRow:De["a"],VSpacer:Le["a"],VSwitch:Ie["a"]});var ze=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"player"},[n("div",{staticClass:"d-flex justify-center pa-4"},[t.$store.state.playerReady?n("div",[n("v-hover",{scopedSlots:t._u([{key:"default",fn:function(e){var a=e.hover;return[n("v-btn",{attrs:{elevation:a?5:0,outlined:"",fab:""},on:{click:t.playPause}},[n("v-icon",{attrs:{large:""}},[t._v("mdi-"+t._s(t.playing?"pause":"play"))])],1)]}}],null,!1,2020131878)})],1):t._e(),t.$store.state.playerReady?t._e():n("div",[n("v-progress-circular",{attrs:{indeterminate:"",size:"56"}})],1)]),t.$store.state.loadingTrack?t._e():n("div",{attrs:{id:"timeseeker"}},[n("svg",{staticClass:"waveform",attrs:{height:t.verticalScale},on:{click:t.clickedSVG}},[t._l(t.track.getSegments(),(function(e,a){return n("rect",{key:a,staticClass:"loudnessBlock",attrs:{width:e.duration*t.scale,height:t.loudness(e.loudness_max)*t.verticalScale,x:t.padding+e.start*t.scale,y:t.verticalScale-t.loudness(e.loudness_max)*t.verticalScale,fill:e.start+e.duration/2<t.$store.state.seeker/1e3?"grey":t.baseColor}})})),n("rect",{attrs:{x:t.padding+t.seeker/1e3*t.scale-1,y:0,width:2,height:t.verticalScale,fill:"#1DB954"}})],2)]),t.$store.state.loadingTrack?n("div",[n("v-progress-linear",{attrs:{indeterminate:"",color:"success"}})],1):t._e()])},We=[],Ue={inject:["theme"],props:["padding"],data:function(){return{verticalScale:50,windowWidth:window.innerWidth,hover:0,ending:!1}},beforeCreate:function(){var t=this;ce(P,(function(e){return t.stateChanged(e)})),ae().then((function(){t.$store.commit("playerReady",!0)}))},mounted:function(){},computed:{track:function(){return this.$store.getters.selectedTrack},baseColor:function(){return this.theme.isDark?"white":"black"},scale:function(){return this.$store.getters.loadingTrack?0:this.width/this.track.getAnalysisDuration()},width:function(){return this.windowWidth-2*this.padding},duration:function(){return this.$store.getters.loadingTrack?0:Math.round(1e3*this.track.getAnalysisDuration())},playing:function(){return this.$store.getters.playing},seeker:function(){return this.$store.getters.seeker}},watch:{track:"trackChanged"},methods:{clickedSVG:function(t){var e=Math.min(Math.max(0,t.clientX-this.padding)/this.width,1),n=e*this.duration;this.$store.commit("setSeeker",n),Zt(this.seeker)},trackChanged:function(t,e){var n=this;this.reset().then((function(){Yt(n.track.getUri(),0),n.$store.commit("setSeeker",0)}))},resume:function(){var t=this;this.playing||Xt(this.seeker).then((function(){t.$store.commit("setPlaying",!0),t.interval=setInterval((function(){return t.seekerTimer(33)}),33)}))},pause:function(){this.playing&&(Qt(),this.$store.commit("setPlaying",!1),clearInterval(this.interval))},playPause:function(){this.playing?this.pause():this.resume()},reset:function(){var t=this;return Object(D["a"])(M.a.mark((function e(){return M.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.ending=!1,e.abrupt("return",Qt().then((function(){t.$store.commit("setSeeker",0),clearInterval(t.interval),t.$store.commit("setPlaying",!1)})).catch((function(t){return console.log(t)})));case 2:case"end":return e.stop()}}),e)})))()},clickedTimeSeeker:function(){Zt(this.seekTime)},seekerTimer:function(t){var e=new Date,n=t;this.lastTimePoll&&(n=e-this.lastTimePoll),this.lastTimePoll=e,this.seekTime+=n,this.$store.state.seeker+=n},loudness:function(t){return nt(t)},stateChanged:function(t){if(this.playing){t.current_track;var e=t.position;t.duration;this.$store.commit("setSeeker",e),this.ending&&0===t.position&&this.reset(),!this.ending&&t.duration-t.position<500&&(this.ending=!0)}}},components:{}},Ne=Ue,He=(n("6131"),n("ce87")),Ge=n("490a"),Ye=n("8e36"),qe=Object(c["a"])(Ne,ze,We,!1,null,null,null),Xe=qe.exports;u()(qe,{VBtn:x["a"],VHover:He["a"],VIcon:Fe["a"],VProgressCircular:Ge["a"],VProgressLinear:Ye["a"]});var Je={name:"Home",data:function(){return{searchQuery:"",volume:.75,prevVolume:.75,padding:50}},computed:{user:function(){return this.$store.getters.user},trackList:function(){return this.$store.getters.trackList},selectedIndex:function(){return this.$store.getters.selectedIndex},selectedTrack:function(){return this.$store.getters.selectedTrack},seeker:function(){return this.$store.getters.seeker}},watch:{selectedIndex:function(t,e){},selectedTrack:function(t,e){console.log("We have ".concat(t.getName()," selected!"))},volume:function(t,e){ie(Math.pow(this.volume,2))}},components:{TrackSelector:Lt,Visualization:$e,Player:Xe},beforeCreate:function(){console.log("Initializing app"),xt()},methods:{search:function(){jt(this.searchQuery)},selectedTrackChanged:function(){console.log("selected track",this.trackList[this.selected].name),this.getAnalsysisFor(this.selected)},getAnalsysisFor:function(t){var e=this.trackList[t].id;this.trackAnalysis.has(e)||(this.analysisReady=!1,console.log("Getting analysis for: ",this.trackList[t].name))},getVolumeIcon:function(t){return t>.6?"mdi-volume-high":t>.2?"mdi-volume-medium":t>0?"mdi-volume-low":"mdi-volume-off"},clickVolume:function(){this.volume>0?(this.prevVolume=this.volume,this.volume=0):this.volume=this.prevVolume}}},Qe=Je,Ke=(n("cccb"),n("40dc")),Ze=n("a523"),tn=n("ba0d"),en=n("8654"),nn=n("2a7f"),an=Object(c["a"])(Qe,p,g,!1,null,null,null),sn=an.exports;u()(an,{VAppBar:Ke["a"],VBtn:x["a"],VContainer:Ze["a"],VIcon:Fe["a"],VSlider:tn["a"],VSpacer:Le["a"],VTextField:en["a"],VToolbarTitle:nn["a"]});var rn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"callback"})},on=[],cn=(n("2b3d"),{name:"Callback",components:{},beforeCreate:function(){var t=this,e=new URLSearchParams(window.location.search),n=e.get("code");W(n).then((function(){t.$router.push("/home")}))}}),ln=cn,un=(n("1aec"),Object(c["a"])(ln,rn,on,!1,null,null,null)),hn=un.exports,dn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login"},[n("v-container",{attrs:{"fill-height":""}},[n("v-layout",{attrs:{"align-center":""}},[n("v-card",{staticClass:"mx-auto elevation-15"},[n("v-card-title",{staticClass:"justify-center"},[t._v("Music Structure Visualizer")]),n("v-card-subtitle",{staticClass:"text-center"},[t._v(" Visualize the structure of music in your own library! ")]),n("v-card-text",{staticClass:"text-center"},[t._v(" Logging in with spotify enables the app to play music using your spotify account. ")]),n("v-card-actions",[n("v-btn",{staticClass:"mx-auto",attrs:{color:"success"},on:{click:t.spotifyAuthorize}},[t._v("Log in with Spotify")])],1)],1)],1)],1)],1)},fn=[],mn={name:"Login",components:{},methods:{spotifyAuthorize:function(){window.location.href="https://music-structure.herokuapp.com/api/spotify/login"}}},pn=mn,gn=(n("d6db"),Object(c["a"])(pn,dn,fn,!1,null,null,null)),vn=gn.exports;u()(gn,{VBtn:x["a"],VCard:T["a"],VCardActions:R["a"],VCardSubtitle:R["b"],VCardText:R["c"],VCardTitle:R["d"],VContainer:Ze["a"],VLayout:Me["a"]}),a["a"].use(m["a"]);var yn=[{path:"/",name:"Login",component:vn},{path:"/home",name:"Home",component:sn,beforeEnter:function(t,e,n){N()?n():n("/")}},{path:"/callback",name:"Callback",component:hn}],bn=new m["a"]({mode:"history",base:"/",routes:yn}),kn=bn,wn=n("f309");a["a"].use(wn["a"]);var Sn=new wn["a"]({theme:{dark:!0,themes:{light:{primary:"#1DB954",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#1DB954",warning:"#FFC107"},dark:{primary:"#1DB954",success:"#1DB954"}}}});a["a"].config.productionTip=!1,new a["a"]({router:kn,vuetify:Sn,store:lt,render:function(t){return t(f)}}).$mount("#app")},"5ced":function(t,e,n){},6131:function(t,e,n){"use strict";var a=n("2f67"),s=n.n(a);s.a},"6e94":function(t,e,n){},"85ec":function(t,e,n){},"8ade":function(t,e,n){"use strict";var a=n("9bd1"),s=n.n(a);s.a},"8aeb":function(t,e,n){"use strict";var a=n("6e94"),s=n.n(a);s.a},"9bd1":function(t,e,n){},cccb:function(t,e,n){"use strict";var a=n("5ced"),s=n.n(a);s.a},d6db:function(t,e,n){"use strict";var a=n("e67a"),s=n.n(a);s.a},d917:function(t,e,n){},e67a:function(t,e,n){}});
//# sourceMappingURL=app.e0201361.js.map