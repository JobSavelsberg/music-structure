{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?0f16","webpack:///./src/views/Callback.vue?e81a","webpack:///./src/App.vue?c168","webpack:///src/App.vue","webpack:///./src/App.vue?3359","webpack:///./src/App.vue?2667","webpack:///./src/views/Home.vue?34dd","webpack:///./src/components/TrackSelector.vue?a75a","webpack:///./src/components/Album.vue?c0ec","webpack:///src/components/Album.vue","webpack:///./src/components/Album.vue?ef28","webpack:///./src/components/Album.vue?aeb0","webpack:///./src/app/authentication.js","webpack:///./src/app/audioUtil.js","webpack:///./src/app/Segment.js","webpack:///./src/app/similarity.js","webpack:///./src/store/index.js","webpack:///./src/app/workers/workers.js","webpack:///./src/app/Features.js","webpack:///./src/app/SSM.js","webpack:///./src/app/Track.js","webpack:///./src/app/app.js","webpack:///src/components/TrackSelector.vue","webpack:///./src/components/TrackSelector.vue?635c","webpack:///./src/components/TrackSelector.vue","webpack:///./src/components/Visualization.vue?302d","webpack:///./src/app/player.js","webpack:///./src/app/vis.js","webpack:///./src/app/webGL.js","webpack:///src/components/Visualization.vue","webpack:///./src/components/Visualization.vue?6d7e","webpack:///./src/components/Visualization.vue?0ab9","webpack:///./src/components/Player.vue?7e1a","webpack:///src/components/Player.vue","webpack:///./src/components/Player.vue?5c64","webpack:///./src/components/Player.vue?d892","webpack:///src/views/Home.vue","webpack:///./src/views/Home.vue?f458","webpack:///./src/views/Home.vue?1dce","webpack:///./src/views/Callback.vue?7a86","webpack:///src/views/Callback.vue","webpack:///./src/views/Callback.vue?2a5f","webpack:///./src/views/Callback.vue?7303","webpack:///./src/views/Login.vue?46de","webpack:///src/views/Login.vue","webpack:///./src/views/Login.vue?3a4e","webpack:///./src/views/Login.vue?0b6d","webpack:///./src/router/index.js","webpack:///./src/plugins/vuetify.js","webpack:///./src/main.js","webpack:///./src/components/Player.vue?1a7f","webpack:///./src/components/Album.vue?fd95","webpack:///./src/components/Visualization.vue?6ce7","webpack:///./src/views/Home.vue?9878","webpack:///./src/views/Login.vue?b712"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","this","oldJsonpFunction","slice","_vm","_h","$createElement","_c","_self","attrs","staticRenderFns","component","VApp","staticClass","_v","on","$event","preventDefault","search","model","callback","$$v","searchQuery","expression","getVolumeIcon","volume","clickVolume","trackList","padding","nativeOn","onScroll","selected","_l","track","index","scopedSlots","_u","fn","ref","active","toggle","trackData","albumSize","class","style","directives","rawName","clicked","imgSize","album","images","imgIndex","url","_s","artists","VBtn","VCard","VCardActions","VCardText","VImg","Ripple","token","refreshToken","api","axios","baseURL","withCredentials","requestFirstToken","code","a","post","then","res","access_token","window","sessionStorage","setItem","expires_in","Date","getTime","toString","catch","err","console","log","isAuthorized","undefined","getItem","d3","require","circleOfFifths","noteColor","scaleLinear","domain","interpolate","interpolateHcl","range","rgb","Math","PI","TWO_PI","OFFSET","tonality","pitches","x","y","energy","angle","radius","cos","sin","atan2","sqrt","tonalVectorColor","color","hsl","saturation","min","hex","loudness","db","max","Segment","segment","start","duration","loudness_start","loudness_max","loudness_max_time","loudness_end","processedPitch","processedPitchSmooth","Error","forEach","pitch","audioUtil","tonalityAngle","tonalityRadius","tonalityEnergy","minDuration","decay","shortness","percussiony","calculateTransposedPitches","prevSegment","nextSegment","biggest","totalBiggest","processedTimbre","timbre","timbres","timbresScaled","pitchesTransposed","Array","duration_ms","concat","cluster","coord","tsneCoord","cosine","b","adotv","amag","bmag","euclidianDistance","squaredDistance","dist","diff","Vue","use","Vuex","ssm","Store","state","user","selectedIndex","seeker","playerState","loadingTrack","playerReady","playing","tsneReady","ssmReady","clusterReady","mutations","setSeeker","time_ms","setUser","setPlayerState","addToTrackList","addToTrackListIndex","addToTrackListFront","unshift","clearTrackList","setSelectedIndex","setPlaying","incrementSeeker","increment","ready","actions","getters","selectedTrack","id","Features","segments","sampleRate","fill","pitchesFlat","tonalEnergy","tonalRadius","tonalAngle","sampleDuration","sampleAmount","ceil","calculateMaxMin","processSegments","sampleFeatures","timbreMax","getOriginalTimbres","timbreMin","timbreBiggest","abs","timbreTotalBiggest","raw","getLoudnessFeatures","processPitch","processTimbre","processed","processPitchSmooth","clusterSelection","tsneSelection","sample","timeLeft","initSampleFeatures","addFeaturesScaled","divideFeatures","remainingSegmentDuration","setFeaturesScaled","featureName","sampled","scalar","divisor","init","Worker","type","startSSM","features","featureLength","options","Promise","resolve","reject","useSampled","blurTime","threshold","getId","postMessage","segmentObjects","timestamp","onmessage","event","calculate","allPitches","size","pitchAmount","SegmentI","sim","CLUSTERAMOUNT","Track","createSegmentObjects","getAnalysisDuration","tsne","calculateSSM","analysisData","beforessmtime","SSM","finishTime","workers","store","commit","clusterIndexes","setCluster","clusters","setTimeout","coords","setTSNECoord","minDist","Infinity","closestSegment","analysis","process","artist","uri","bars","beats","tatums","getPitches","map","getTimbres","setAnalysis","json","createWithAnalysis","spotify","SpotifyWebApi","allTracks","Map","initialize","setAccessToken","auth","getMe","router","getMyTopTracks","limit","offset","tracks","loadTracksFromSpotify","items","selectTrackAtIndex","getAnalysis","keepCurrentTrack","has","set","hasAnalysis","getAudioAnalysisForTrack","query","results","props","components","computed","watch","mounted","methods","VSlideGroup","VSlideItem","playerRef","canvasVis","rawPitch","$set","rawTimbre","rawRhythm","zoom","clickedVis","_e","zoomed","canvasWidth","scale","canvasHeight","deviceId","trackIsLoaded","nextTrackURI","nexStartPosition","playingSegment","setTrack","trackUri","startPosition","resume","position","seek","play","device_id","uris","position_ms","pause","time","playSegment","deviceIdSet","timeWas","wait","setInterval","clearInterval","setVolume","waitForSpotifyWebPlaybackSDKToLoad","Spotify","onSpotifyWebPlaybackSDKReady","stateChangedCallback","Player","getOAuthToken","cb","addListener","message","error","current_track","track_window","connect","zeroOneColor","interpolator","pitchColor","greyScaleColor","timbreColor","rainbowColor","diverging","renderRawPitch","left","width","yOffset","height","ctx","getSegments","segmentHeight","segmentWidth","fillStyle","fillRect","renderPercussionPitch","segmentIndex","renderRawTimbre","getProcessedTimbre","renderRawRhythm","getBars","bar","confidence","getBeats","beat","getTatums","tatum","renderTonality","renderSSM","segmentA","getSegment","segmentB","getSSM","pow","gl","program","bufferSize","canvas","getContext","alert","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","vertexShaderText","fragmentShaderText","compileShader","getShaderParameter","COMPILE_STATUS","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","validateProgram","VALIDATE_STATUS","ssmVertices","ssmIndeces","topleft","bottomleft","indexBuffer","createBuffer","bindBuffer","ELEMENT_ARRAY_BUFFER","bufferData","Uint16Array","STATIC_DRAW","rectangleVertexBufferObject","ARRAY_BUFFER","Float32Array","vertAttribLocation","getAttribLocation","vertexAttribPointer","FLOAT","FALSE","BYTES_PER_ELEMENT","enableVertexAttribArray","getProgramInfoLog","getProgramInfoLof","getShaderInfoLog","setSSMDataArray","halfDuration","st","pos","top","right","bottom","drawSSM","useProgram","drawArrays","TRIANGLES","join","VIcon","VLayout","VRow","VSpacer","VSwitch","$store","hover","playPause","verticalScale","clickedSVG","baseColor","VHover","VProgressCircular","VProgressLinear","prevVolume","TrackSelector","Visualization","beforeCreate","selectedTrackChanged","getAnalsysisFor","trackAnalysis","selectedTrackId","analysisReady","VAppBar","VContainer","VSlider","VTextField","VToolbarTitle","VToolbar","spotifyAuthorize","VCardSubtitle","VCardTitle","VueRouter","routes","path","Login","Home","beforeEnter","to","from","next","Callback","base","Vuetify","theme","dark","themes","light","primary","secondary","accent","info","success","warning","config","productionTip","vuetify","render","h","App","$mount"],"mappings":"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","file":"js/app.e0201361.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = this[\"webpackJsonp\"] = this[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Callback.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Callback.vue?vue&type=style&index=0&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',{attrs:{\"id\":\"app\",\"dark\":true}},[_c('router-view')],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <v-app id=\"app\" :dark=\"true\">\r\n        <router-view />\r\n    </v-app>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: \"App\",\r\n\r\n    components: {},\r\n    beforeCreate() {\r\n        window.onSpotifyWebPlaybackSDKReady = () => {\r\n            console.log(\"The Web Playback SDK is ready. We have access to Spotify.Player\");\r\n            console.log(window.Spotify.Player);\r\n        };\r\n    },\r\n    data: () => ({\r\n        //\r\n    }),\r\n    mounted: function() {\r\n        let elHtml = document.getElementsByTagName(\"html\")[0];\r\n        elHtml.style.overflowY = \"auto\";\r\n    },\r\n    destroyed: function() {\r\n        let elHtml = document.getElementsByTagName(\"html\")[0];\r\n        elHtml.style.overflowY = null;\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n:not(input):not(textarea),\r\n:not(input):not(textarea)::after,\r\n:not(input):not(textarea)::before {\r\n    -webkit-user-select: none;\r\n    user-select: none;\r\n    cursor: default;\r\n}\r\ninput,\r\nbutton,\r\ntextarea,\r\n:focus {\r\n    outline: none;\r\n}\r\n</style>\r\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=3ea81b09&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\ninstallComponents(component, {VApp})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"home\"},[_c('v-app-bar',{attrs:{\"dark\":\"\"}},[_c('v-toolbar-title',[_vm._v(\"Music Structure Visualizer\")]),_c('v-spacer'),_c('form',{on:{\"submit\":function($event){$event.preventDefault();return _vm.search($event)}}},[_c('v-text-field',{attrs:{\"hide-details\":\"\",\"append-icon\":\"mdi-magnify\",\"single-line\":\"\",\"rounded\":\"\",\"dense\":\"\",\"filled\":\"\"},model:{value:(_vm.searchQuery),callback:function ($$v) {_vm.searchQuery=$$v},expression:\"searchQuery\"}})],1),_c('div',{staticClass:\"volumeSlider\"},[_c('v-container',[_c('v-slider',{attrs:{\"prepend-icon\":_vm.getVolumeIcon(_vm.volume),\"min\":0,\"max\":1,\"step\":0.02},on:{\"click:prepend\":_vm.clickVolume},model:{value:(_vm.volume),callback:function ($$v) {_vm.volume=$$v},expression:\"volume\"}})],1)],1),_c('v-btn',{attrs:{\"icon\":\"\"}},[_c('v-icon',[_vm._v(\"mdi-heart\")])],1),_c('v-btn',{attrs:{\"icon\":\"\"}},[_c('v-icon',[_vm._v(\"mdi-dots-vertical\")])],1)],1),_c('TrackSelector',{attrs:{\"tracks\":_vm.trackList,\"album-size\":120}}),_c('Player',{attrs:{\"padding\":_vm.padding}}),_c('Visualization',{attrs:{\"padding\":_vm.padding}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('v-slide-group',{staticClass:\"pt-2\",attrs:{\"center-active\":\"\",\"mandatory\":\"\"},nativeOn:{\"scroll\":function($event){return _vm.onScroll($event)}},model:{value:(_vm.selected),callback:function ($$v) {_vm.selected=$$v},expression:\"selected\"}},_vm._l((_vm.tracks),function(track,index){return _c('v-slide-item',{key:index,staticClass:\"mx-2 my-1\",scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar active = ref.active;\nvar toggle = ref.toggle;\nreturn [_c('Album',{attrs:{\"album\":track.trackData,\"imgSize\":active ? _vm.albumSize*1.5 : _vm.albumSize,\"active\":active},on:{\"clicked\":toggle}})]}}],null,true)})}),1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-card',{class:_vm.active ? 'elevation-3' : 'elevation-0',style:(_vm.cardStyle)},[_c('div',{directives:[{name:\"ripple\",rawName:\"v-ripple\"}],staticClass:\"track\",on:{\"click\":_vm.clicked}},[_c('v-img',{attrs:{\"height\":_vm.imgSize,\"width\":_vm.imgSize,\"src\":_vm.album.album.images[_vm.imgIndex].url}}),_c('v-card-text',{staticClass:\"pl-2 py-0 pt-1 ml-0 my-0\"},[_c('div',{staticClass:\"text-subtitle-2 text--primary text-truncate \"},[_vm._v(_vm._s(_vm.album.name))])])],1),_c('v-card-actions',{staticClass:\"pl-0 py-0 ml-0 my-0\"},[_c('v-btn',{staticClass:\"artistButton\",attrs:{\"text\":\"\",\"color\":\"grey\",\"small\":\"\"}},[_c('span',{staticClass:\"artistButtonText text-caption text-truncate\",style:({ 'max-width': this.imgSize - 12 + 'px' })},[_vm._v(\" \"+_vm._s(_vm.album.artists[0].name)+\" \")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <v-card :style=\"cardStyle\" :class=\"active ? 'elevation-3' : 'elevation-0'\">\r\n        <div class=\"track\" v-ripple @click=\"clicked\">\r\n            <v-img :height=\"imgSize\" :width=\"imgSize\" :src=\"album.album.images[imgIndex].url\"></v-img>\r\n            <v-card-text class=\"pl-2 py-0 pt-1 ml-0 my-0\">\r\n                <div class=\"text-subtitle-2 text--primary text-truncate \">{{ album.name }}</div>\r\n            </v-card-text>\r\n        </div>\r\n        <v-card-actions class=\"pl-0 py-0 ml-0 my-0\">\r\n            <v-btn class=\"artistButton\" text color=\"grey\" small>\r\n                <span\r\n                    class=\"artistButtonText text-caption text-truncate\"\r\n                    :style=\"{ 'max-width': this.imgSize - 12 + 'px' }\"\r\n                >\r\n                    {{ album.artists[0].name }}\r\n                </span>\r\n            </v-btn>\r\n        </v-card-actions>\r\n    </v-card>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    props: [\"album\", \"imgSize\", \"active\"],\r\n    data() {\r\n        return {};\r\n    },\r\n    mounted() {},\r\n    computed: {\r\n        imgIndex() {\r\n            if (this.size <= this.album.album.images[2].height) return 2;\r\n            if (this.size <= this.album.album.images[1].height) return 1;\r\n            return 0;\r\n        },\r\n        cardStyle() {\r\n            return {\r\n                width: this.imgSize + \"px\",\r\n                height: this.imgSize + 55 + \"px\",\r\n            };\r\n        },\r\n    },\r\n    methods: {\r\n        clicked() {\r\n            this.$emit(\"clicked\");\r\n        },\r\n    },\r\n};\r\n</script>\r\n\r\n<style>\r\n.track:hover {\r\n    cursor: grabbing;\r\n}\r\n.artistButton {\r\n    text-transform: none !important;\r\n}\r\n.artistButtonText {\r\n    margin-left: -3px;\r\n    margin-right: 0px;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Album.vue?vue&type=template&id=c8638f58&\"\nimport script from \"./Album.vue?vue&type=script&lang=js&\"\nexport * from \"./Album.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Album.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VImg } from 'vuetify/lib/components/VImg';\ninstallComponents(component, {VBtn,VCard,VCardActions,VCardText,VImg})\n\n\n/* vuetify-loader */\nimport installDirectives from \"!../../node_modules/vuetify-loader/lib/runtime/installDirectives.js\"\nimport Ripple from 'vuetify/lib/directives/ripple'\ninstallDirectives(component, {Ripple})\n","import axios from \"axios\";\r\n\r\nconst port = process.env.SERVER_PORT || 5000;\r\nconst url = (process.env.VUE_APP_HOST_URL || \"http://localhost\" + \":\" + port) + \"/api\";\r\nconst api = axios.create({\r\n    baseURL: url,\r\n    withCredentials: false,\r\n});\r\n\r\nexport let token;\r\nlet tokenTimestamp;\r\nlet expiresIn;\r\nlet refreshToken;\r\n\r\nexport async function requestFirstToken(code) {\r\n    await api\r\n        .post(\"spotify/token\", {\r\n            code: code,\r\n        })\r\n        .then((res) => {\r\n            token = res.data.access_token;\r\n            window.sessionStorage.setItem(\"token\", token);\r\n            expiresIn = res.data.expires_in;\r\n            window.sessionStorage.setItem(\"tokenTimestamp\", new Date().getTime().toString());\r\n            refreshToken = res.data.expires_in;\r\n            window.sessionStorage.setItem(\"refreshToken\", refreshToken);\r\n        })\r\n        .catch((err) => {\r\n            console.log(err);\r\n        });\r\n}\r\n\r\nexport async function requestRefreshToken() {\r\n    await api\r\n        .post(\"spotify/token\", {\r\n            refresh_token: refreshToken,\r\n        })\r\n        .then((res) => {\r\n            token = res.data.access_token;\r\n            window.sessionStorage.setItem(\"token\", token);\r\n            expiresIn = res.data.expires_in;\r\n            window.sessionStorage.setItem(\"tokenTimestamp\", new Date().getTime().toString());\r\n            refreshToken = res.data.expires_in;\r\n            window.sessionStorage.setItem(\"refreshToken\", refreshToken);\r\n        })\r\n        .catch((err) => {\r\n            console.log(err);\r\n        });\r\n}\r\n\r\nexport function isAuthorized() {\r\n    if (token === undefined) {\r\n        const t = window.sessionStorage.getItem(\"token\");\r\n        const e = window.sessionStorage.getItem(\"tokenTimestamp\");\r\n        const r = window.sessionStorage.getItem(\"refreshToken\");\r\n        if (t) {\r\n            token = t;\r\n            // TODO: check if token is expired, if so renew\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n","const d3 = require(\"d3\");\r\nexport const circleOfFifths = [0, 7, 2, 9, 4, 11, 6, 1, 8, 3, 10, 5]; // Starting from C=0\r\nexport const noteNames = [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"];\r\n\r\n//https://www.vectorstock.com/royalty-free-vector/color-wheel-spectrum-scheme-selection-color-vector-25483441\r\nexport const noteColor = d3\r\n    .scaleLinear()\r\n    .domain([\r\n        0,\r\n        1 / 12,\r\n        2 / 12,\r\n        2.8 / 12,\r\n        3.8 / 12,\r\n        4.3 / 12,\r\n        5.3 / 12,\r\n        6.8 / 12,\r\n        8 / 12,\r\n        8.8 / 12,\r\n        9.3 / 12,\r\n        10.5 / 12,\r\n        1,\r\n    ])\r\n    .interpolate(d3.interpolateHcl)\r\n    .range([\r\n        d3.rgb(\"#FE0000\"),\r\n        d3.rgb(\"#FF7300\"),\r\n        d3.rgb(\"#FFAA01\"),\r\n        d3.rgb(\"#FFD300\"),\r\n        d3.rgb(\"#FFFF01\"),\r\n        d3.rgb(\"#9FEE00\"),\r\n        d3.rgb(\"#01CC00\"),\r\n        d3.rgb(\"#009899\"),\r\n        d3.rgb(\"#1241AB\"),\r\n        d3.rgb(\"#3914B1\"),\r\n        d3.rgb(\"#7209AC\"),\r\n        d3.rgb(\"#CD0174\"),\r\n        d3.rgb(\"#FE0000\"),\r\n    ]);\r\n\r\nexport function getNoteName(i) {\r\n    return noteNames[i];\r\n}\r\n\r\nvar DEGREES_PER_RADIAN = 180 / Math.PI;\r\nvar RADIANS_PER_DEGREE = Math.PI / 180;\r\nvar TWO_PI = 2 * Math.PI;\r\nvar OFFSET = (3 * Math.PI) / 2; // full cycle is 2pi\r\n\r\nexport function tonality(pitches) {\r\n    let x = 0;\r\n    let y = 0;\r\n    let energy = 0;\r\n    for (let i = 0; i < 12; i++) {\r\n        const angle = (-circleOfFifths[i] / 12.0) * TWO_PI + OFFSET;\r\n        const radius = pitches[i]; // Between 0 and 1\r\n        energy += radius / 12;\r\n        x += radius * Math.cos(angle);\r\n        y += radius * Math.sin(angle);\r\n    }\r\n\r\n    const angle = (Math.atan2(x, y) + Math.PI) / TWO_PI;\r\n    const radius = Math.sqrt(x * x + y * y);\r\n    return [angle, radius, energy];\r\n}\r\n\r\nexport function tonalVectorColor(pitches) {\r\n    const [angle, radius, energy] = tonality(pitches);\r\n\r\n    //const color = d3.color(d3.interpolateSinebow((angle+OFFSET)%1.0));\r\n    const color = d3.hsl(noteColor(angle));\r\n    const saturation = Math.min((radius * 3) / (energy * 12), 1); // 3 because chord usually minimally 3 tones\r\n    color.s = saturation;\r\n    return color.hex();\r\n}\r\n\r\nexport function loudness(db) {\r\n    const l = Math.max(0, 60 + db) / 60;\r\n    return l * l;\r\n}\r\n\r\nexport function logCompression(value, gamma = 1) {\r\n    return Math.log(1 + gamma * value) / Math.log(gamma);\r\n}\r\n","import * as audioUtil from \"./audioUtil\";\r\n\r\nexport default class Segment {\r\n    segment = null;\r\n    start = 0;\r\n    duration = 0;\r\n    loudness_start = 0;\r\n    loudness_max_time = 0;\r\n    loudness_max = 0;\r\n    loudness_end = 0;\r\n\r\n    pitches = [];\r\n    pitchesTransposed = [];\r\n    timbres = [];\r\n    timbresScaled = [];\r\n\r\n    cluster = -1;\r\n    tsneCoord = [0, 0];\r\n\r\n    tonalityAngle = 0; // [0,1] Angle of vector on circle of fifths\r\n    tonalityRadius = 0; // [0,1] Radius of vector on circle of fifths, low value means very dissonant or atonal\r\n    tonalityEnergy = 0; // [0,1] Total energy of all the pitches, high energy means lots of notes played at the same time\r\n\r\n    percussiony = 0; // [0,1] segments larger than .15\r\n\r\n    constructor(segment) {\r\n        this.segment = segment;\r\n        this.start = segment.start;\r\n        this.duration = segment.duration;\r\n        this.loudness_start = segment.loudness_start;\r\n        this.loudness_max = segment.loudness_max;\r\n        this.loudness_max_time = segment.loudness_max_time;\r\n        this.loudness_end = segment.loudness_end;\r\n    }\r\n\r\n    processedPitch = false;\r\n    processPitch() {\r\n        if (this.processedPitch) return;\r\n        if (this.processedPitchSmooth) throw Error(\"processed pitchSmooth before setting initial pitch\");\r\n        this.segment.pitches.forEach((pitch, i) => {\r\n            this.pitches.push(pitch); //audioUtil.logCompression(pitch, GAMMA));\r\n        });\r\n        [this.tonalityAngle, this.tonalityRadius, this.tonalityEnergy] = audioUtil.tonality(this.pitches);\r\n\r\n        const minDuration = 0.2;\r\n        const decay = 0.5;\r\n        const shortness = this.duration < minDuration ? 1 : decay - (this.duration - 0.15);\r\n        this.percussiony = Math.min(1, (1 - this.tonalityRadius) * this.tonalityEnergy * 2) * shortness;\r\n        this.calculateTransposedPitches();\r\n        this.processedPitch = true;\r\n    }\r\n\r\n    processedPitchSmooth = false;\r\n    processPitchSmooth(prevSegment, nextSegment) {\r\n        if (this.processedPitchSmooth) return;\r\n        if (!this.processedPitch) throw Error(\"processed pitchSmooth called before setting initial pitch\");\r\n\r\n        for (let p = 0; p < this.pitches.length; p++) {\r\n            this.pitches[p] =\r\n                (1 - this.percussiony) * this.pitches[p] +\r\n                (this.percussiony * (prevSegment.pitches[p] + nextSegment.pitches[p])) / 2;\r\n        }\r\n        this.processedPitchSmooth = true;\r\n    }\r\n\r\n    processedTimbre = false;\r\n    processTimbre(min, max, biggest, totalBiggest) {\r\n        if (this.processedTimbre) return;\r\n        this.segment.timbre.forEach((timbre, i) => {\r\n            this.timbres.push(timbre / totalBiggest);\r\n        });\r\n        this.segment.timbre.forEach((timbre, i) => {\r\n            this.timbresScaled.push(timbre / biggest[i]);\r\n        });\r\n        this.processedTimbre = true;\r\n    }\r\n\r\n    calculateTransposedPitches() {\r\n        for (let p = 0; p < 12; p++) {\r\n            this.pitchesTransposed.push(new Array(12));\r\n            for (let i = 0; i < 12; i++) {\r\n                this.pitchesTransposed[p][i] = this.pitches[(i + p) % 12];\r\n            }\r\n        }\r\n    }\r\n\r\n    getPitches() {\r\n        return this.pitches;\r\n    }\r\n    getTimbres() {\r\n        return this.timbres;\r\n    }\r\n    getDuration() {\r\n        return this.duration_ms;\r\n    }\r\n    getStart() {\r\n        return this.start;\r\n    }\r\n    getOriginalTimbres() {\r\n        return this.segment.timbre;\r\n    }\r\n    getFeatures() {\r\n        return this.pitches.concat(this.timbres);\r\n    }\r\n    setCluster(i) {\r\n        this.cluster = i;\r\n    }\r\n    setTSNECoord(coord) {\r\n        this.tsneCoord = coord;\r\n    }\r\n    getTonalEnergy() {\r\n        return this.tonalityEnergy;\r\n    }\r\n    getTonalAngle() {\r\n        return this.tonalityAngle;\r\n    }\r\n    getLoudnessFeatures() {\r\n        return [\r\n            audioUtil.loudness(this.loudness_start),\r\n            audioUtil.loudness(this.loudness_max),\r\n            this.loudness_max_time,\r\n            audioUtil.loudness(this.loudness_end),\r\n        ];\r\n    }\r\n}\r\n","export const measures = {\r\n    EUCLIDIAN: \"euclidian\",\r\n    MANHATTAN: \"manhattan\",\r\n    COSINE: \"cosine\",\r\n};\r\n\r\nexport function cosine(a, b) {\r\n    var adotv = 0;\r\n    var amag = 0;\r\n    var bmag = 0;\r\n    for (var i = 0; i < a.length; i++) {\r\n        adotv += a[i] * b[i];\r\n        amag += a[i] * a[i];\r\n        bmag += b[i] * b[i];\r\n    }\r\n    amag = Math.sqrt(amag);\r\n    bmag = Math.sqrt(bmag);\r\n    return adotv / (amag * bmag);\r\n}\r\n\r\nexport function manhattanDistance(a, b) {\r\n    let dist = 0;\r\n    for (let i = 0; i < a.length; i++) {\r\n        dist += Math.abs(a[i] - b[i]);\r\n    }\r\n    return dist;\r\n}\r\n// Manhattan distance scaled back to [0,1]\r\nexport function manhattan(a, b, range) {\r\n    return 1 - this.manhattanDistance(a, b) / range;\r\n}\r\n\r\nexport function euclidianDistance(a, b) {\r\n    return Math.sqrt(squaredDistance(a, b));\r\n}\r\nexport function maxEuclidianDistance(length, range) {\r\n    return Math.sqrt(range * range * length);\r\n}\r\nexport function euclidian(a, b, maxDist) {\r\n    return 1 - euclidianDistance(a, b) / maxDist;\r\n}\r\n\r\nexport function squaredDistance(a, b) {\r\n    let dist = 0;\r\n    for (let i = 0; i < a.length; i++) {\r\n        const diff = a[i] - b[i];\r\n        dist += diff * diff;\r\n    }\r\n    return dist;\r\n}\r\n","import Vue from 'vue'\nimport Vuex from 'vuex'\nimport Track from '../app/Track'\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({\n  state: {\n    user: Object,\n    trackList: [],\n    selectedIndex: -1,\n    seeker: 0,\n    playerState: null,\n    loadingTrack: true,\n    playerReady: false,\n    playing: false,\n    // For every worker we need a global ready variable\n    tsneReady: false,\n    ssmReady: false,\n    clusterReady: false,\n\n  },\n  mutations: {\n    setSeeker(state, time_ms){\n      state.seeker = time_ms;\n    },\n    setUser(state, user){\n      console.log(\"setting user to\", user);\n      state.user = user;\n    },\n    setPlayerState(state, playerState){\n      state.playerState = playerState;\n    },\n    loadingTrack(state, loadingTrack){\n      state.loadingTrack = loadingTrack;\n    },\n    playerReady(state, playerReady){\n      state.playerReady = playerReady\n    },\n    addToTrackList(state, track){\n      state.trackList.push(track);\n    },\n    addToTrackListIndex(state, index, track){\n      state.trackList.splice(index, 0, track);\n    },\n    addToTrackListFront(state, track){\n      state.trackList.unshift(track);\n    },\n    clearTrackList(state){\n      state.trackList = [];\n    },\n    setSelectedIndex(state, index){\n      state.selectedIndex = index;\n    },\n    setPlaying(state, playing){\n      state.playing = playing;\n    },\n    incrementSeeker(state, increment){\n      state.seeker += increment;\n    },\n    tsneReady(state, ready){\n      state.tsneReady = ready;\n    },\n    clusterReady(state, ready){\n      state.clusterReady = ready;\n    },\n    ssmReady(state, ready){\n      state.ssmReady = ready;\n    }\n  },\n  actions: {\n\n  },\n  getters: {\n    seeker(state){\n      return state.seeker;\n    },\n    selectedIndex(state){\n      return state.selectedIndex;\n    },\n    selectedTrack(state){\n      return state.trackList[state.selectedIndex];\n    },\n    user(state) {\n      return state.user;\n    },\n    track(state, id) {\n      return state.trackList[id];\n    },\n    trackList(state){\n      return state.trackList;\n    },\n    playerState(state){\n      return state.playerState;\n    },\n    playing(state){\n      return state.playing;\n    },\n    tsneReady(state){\n      return state.tsneReady;\n    },\n    clusterReady(state){\n      return state.clusterReady;\n    },\n    ssmReady(state){\n      return state.ssmReady;\n    }\n  },\n  modules: {\n  }\n})\n","export let ssm;\r\nexport let cluster;\r\nexport let tsne;\r\n\r\nexport async function init() {\r\n    ssm = new Worker(\"/ssmWorker.js\", { type: \"module\" });\r\n    cluster = new Worker(\"./tsneWorker\", { type: \"module\" });\r\n    tsne = new Worker(\"clusterWorker.js\", { type: \"module\" });\r\n}\r\n\r\nexport async function startSSM(track, features, featureLength, options) {\r\n    return new Promise((resolve, reject) => {\r\n        const sampled = options.useSampled | false;\r\n        const blurTime = options.blurTime | 4;\r\n        const threshold = options.threshold | 0.5;\r\n        const id = track.getId();\r\n        ssm.postMessage({\r\n            features: features,\r\n            featureLength: featureLength,\r\n            segmentObjects: track.segments,\r\n            id,\r\n            timestamp: new Date(),\r\n            sampled,\r\n            blurTime,\r\n            threshold,\r\n        });\r\n        ssm.onmessage = (event) => {\r\n            const result = event.data;\r\n            if (result.id === id) {\r\n                resolve(result);\r\n            }\r\n        };\r\n    });\r\n}\r\n","export default class Features {\r\n    timbreMax = new Array(12).fill(0);\r\n    timbreMin = new Array(12).fill(0);\r\n    timbreBiggest = new Array(12).fill(0);\r\n    timbreTotalBiggest = 0;\r\n\r\n    segments;\r\n    raw = { pitches: [], timbres: [], loudness: [] };\r\n    processed = {\r\n        pitches: [],\r\n        pitchesFlat: [],\r\n        timbres: [],\r\n        loudness: [],\r\n        tonalEnergy: [],\r\n        tonalRadius: [],\r\n        tonalAngle: [],\r\n    };\r\n\r\n    ssmSelection = [];\r\n    clusterSelection = [];\r\n    tsneSelection = [];\r\n\r\n    sampleDuration = 0;\r\n    sampleAmount = 0;\r\n    sampled = {};\r\n\r\n    constructor(segments, sampleRate, duration) {\r\n        this.segments = segments;\r\n        this.sampleDuration = 1 / sampleRate;\r\n        this.duration = duration;\r\n        this.sampleAmount = Math.ceil(duration / sampleRate);\r\n        console.log(\"Sample amount:\", this.sampleAmount);\r\n        this.calculateMaxMin();\r\n        this.processSegments();\r\n        this.sampleFeatures();\r\n    }\r\n\r\n    /**\r\n     * The values calculated in this function are used to scale the raw features\r\n     */\r\n    calculateMaxMin() {\r\n        this.segments.forEach((segment, index) => {\r\n            for (let i = 0; i < 12; i++) {\r\n                this.timbreMax[i] = Math.max(this.timbreMax[i], segment.getOriginalTimbres()[i]);\r\n                this.timbreMin[i] = Math.min(this.timbreMin[i], segment.getOriginalTimbres()[i]);\r\n            }\r\n        });\r\n        for (let i = 0; i < 12; i++) {\r\n            this.timbreBiggest[i] = Math.max(Math.abs(this.timbreMax[i]), Math.abs(this.timbreMin[i]));\r\n            this.timbreTotalBiggest = Math.max(this.timbreTotalBiggest, this.timbreBiggest[i]);\r\n        }\r\n    }\r\n\r\n    processSegments() {\r\n        this.segments.forEach((s, i) => {\r\n            this.raw.pitches = s.segment.pitches;\r\n            this.raw.timbres = s.segment.timbres;\r\n            this.raw.loudness = s.getLoudnessFeatures();\r\n            s.processPitch();\r\n            s.processTimbre(this.timbreMin, this.timbreMax, this.timbreBiggest, this.timbreTotalBiggest);\r\n            this.processed.pitches.push(s.pitches);\r\n            for (const pitch of s.pitches) {\r\n                this.processed.pitchesFlat.push(pitch);\r\n            }\r\n            this.processed.timbres.push(s.timbres);\r\n            this.processed.tonalEnergy.push(s.tonalityEnergy);\r\n            this.processed.tonalRadius.push(s.tonalityRadius);\r\n            this.processed.tonalAngle.push(s.tonalityAngle);\r\n            this.processed.loudness.push(s.getLoudnessFeatures());\r\n        });\r\n\r\n        for (let i = 0; i < this.segments.length; i++) {\r\n            // Try to remove percussion from pitch features\r\n            if (i > 0 && i < this.segments.length - 1) {\r\n                this.segments[i].processPitchSmooth(this.segments[i - 1], this.segments[i + 1]);\r\n            }\r\n\r\n            // Create feature selections\r\n            this.clusterSelection.push([\r\n                ...this.processed.timbres[i],\r\n                this.processed.tonalEnergy[i],\r\n                this.processed.tonalRadius[i],\r\n                ...this.processed.loudness[i],\r\n            ]);\r\n            this.tsneSelection.push([\r\n                ...this.processed.timbres[i],\r\n                this.processed.tonalEnergy[i],\r\n                this.processed.tonalRadius[i],\r\n                ...this.processed.loudness[i],\r\n            ]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Turn processed features into evenly discretized features int\r\n     */\r\n    sampleFeatures() {\r\n        console.log(\"sampling features\");\r\n        let sample = 0;\r\n        let timeLeft = this.sampleDuration;\r\n        // moving to next sample\r\n        this.initSampleFeatures();\r\n        for (let i = 0; i < this.segments.length; i++) {\r\n            const segment = this.segments[i];\r\n            let duration = segment.duration;\r\n\r\n            this.addFeaturesScaled(sample, i, duration);\r\n\r\n            if (duration > timeLeft) {\r\n                // Add remaining segment and divide\r\n                this.addFeaturesScaled(sample, i, timeLeft);\r\n                this.divideFeatures(sample, this.sampleDuration - timeLeft);\r\n\r\n                // If we reached the end of all samples we quit\r\n                if (sample + 1 >= this.sampleAmount) {\r\n                    break;\r\n                }\r\n                // Start next sample with remaining segment, and subtract remaining segment duration from timeLeft\r\n\r\n                sample++;\r\n                const remainingSegmentDuration = duration - timeLeft;\r\n                this.addFeaturesScaled(sample, i, remainingSegmentDuration);\r\n                timeLeft = this.sampleDuration - remainingSegmentDuration;\r\n            } else {\r\n                // If the segment fits in the sample\r\n                this.setFeaturesScaled(sample, i, duration);\r\n                timeLeft -= duration;\r\n            }\r\n        }\r\n\r\n        this.divideFeatures(sample, this.sampleDuration - timeLeft);\r\n    }\r\n\r\n    initSampleFeatures() {\r\n        for (const featureName in this.processed) {\r\n            this.sampled[featureName] = new Array(this.sampleAmount).fill(0);\r\n            if (this.processed[featureName][0].length) {\r\n                for (let s = 0; s < this.sampleAmount; s++) {\r\n                    this.sampled[featureName][s] = new Array(this.processed[featureName][0].length).fill(0);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    setFeaturesScaled(sample, index, scalar) {\r\n        for (const featureName in this.processed) {\r\n            if (this.processed[featureName][sample].length) {\r\n                for (let i = 0; i < this.processed[featureName][sample].length; i++) {\r\n                    this.sampled[featureName][sample][i] = this.processed[featureName][index][i] * scalar;\r\n                }\r\n            } else {\r\n                this.sampled[featureName][sample] = this.processed[featureName][index] * scalar;\r\n            }\r\n        }\r\n    }\r\n\r\n    addFeaturesScaled(sample, index, scalar) {\r\n        for (const featureName in this.processed) {\r\n            if (this.processed[featureName][sample].length) {\r\n                for (let i = 0; i < this.processed[featureName][sample].length; i++) {\r\n                    this.sampled[featureName][sample][i] += this.processed[featureName][index][i] * scalar;\r\n                }\r\n            } else {\r\n                this.sampled[featureName][sample] += this.processed[featureName][index] * scalar;\r\n            }\r\n        }\r\n    }\r\n\r\n    divideFeatures(sample, divisor) {\r\n        for (const featureName in this.sampled) {\r\n            if (this.sampled[featureName][sample].length) {\r\n                for (let i = 0; i < this.sampled[featureName][sample].length; i++) {\r\n                    this.sampled[featureName][sample][i] /= divisor;\r\n                }\r\n            } else {\r\n                this.sampled[featureName][sample] /= divisor;\r\n            }\r\n        }\r\n    }\r\n}\r\n","import * as sim from \"./similarity\";\r\nimport * as audioUtil from \"./audioUtil\";\r\n\r\nexport async function calculate(segmentObjects, allPitches) {\r\n    const size = segmentObjects.length;\r\n    const ssm = new Array(12);\r\n    const pitchAmount = allPitches ? 12 : 1;\r\n    for (let p = 0; p < pitchAmount; p++) {\r\n        ssm[p] = new Array(size);\r\n        for (let i = 0; i < size; i++) {\r\n            const SegmentI = segmentObjects[i];\r\n            ssm[p][i] = new Array(size - i);\r\n            for (let j = i; j < size; j++) {\r\n                ssm[p][i][j - i] = new Array(2);\r\n                ssm[p][i][j - i][0] = sim.cosine(SegmentI.pitches, segmentObjects[j].pitchesTransposed[p]);\r\n                ssm[p][i][j - i][1] = sim.cosine(SegmentI.timbresScaled, segmentObjects[j].timbresScaled);\r\n            }\r\n        }\r\n    }\r\n\r\n    return ssm;\r\n}\r\n\r\nexport function enhance(segmentObjects, ssm, blurTime) {\r\n    if (blurTime === 0) {\r\n        return ssm;\r\n    }\r\n    //const tempoDifferences = [.66, .81, 1, 1.22, 1.5];\r\n    const tempoDifferences = [1];\r\n    const size = segmentObjects.length;\r\n    const ssmCollection = [];\r\n    for (const tempoDifference of tempoDifferences) {\r\n        ssmCollection.push(enhanceOneDirection(segmentObjects, ssm, blurTime, 1, tempoDifference));\r\n        ssmCollection.push(enhanceOneDirection(segmentObjects, ssm, blurTime, -1, tempoDifference));\r\n    }\r\n\r\n    const maxSSM = new Array(size);\r\n    for (let i = 0; i < size; i++) {\r\n        maxSSM[i] = new Array(size - i);\r\n        for (let j = i; j < size; j++) {\r\n            const ssmCollectionValuesPitch = [];\r\n            const ssmCollectionValuesTimbre = [];\r\n            ssmCollection.forEach((ssm) => {\r\n                ssmCollectionValuesPitch.push(ssm[i][j - i][0]);\r\n                ssmCollectionValuesTimbre.push(ssm[i][j - i][1]);\r\n            });\r\n            maxSSM[i][j - i] = new Array(2);\r\n            maxSSM[i][j - i][0] = Math.max.apply(Math, ssmCollectionValuesPitch);\r\n            maxSSM[i][j - i][1] = Math.max.apply(Math, ssmCollectionValuesTimbre);\r\n        }\r\n    }\r\n    return maxSSM;\r\n}\r\n\r\nexport function enhanceOneDirection(segmentObjects, ssm, blurTime, direction, tempoDifference) {\r\n    const size = segmentObjects.length;\r\n    const enhancedSSM = new Array(size);\r\n    const iStart = direction > 0 ? 0 : size - 1;\r\n    const iEnd = direction > 0 ? size : -1;\r\n    for (let i = iStart; i !== iEnd; i += direction) {\r\n        enhancedSSM[i] = new Array(size - i);\r\n        const jStart = direction > 0 ? i : size - 1;\r\n        const jEnd = direction > 0 ? size : i - 1;\r\n        for (let j = jStart; j !== jEnd; j += direction) {\r\n            enhancedSSM[i][j - i] = new Array(2);\r\n            enhancedSSM[i][j - i][0] = 0;\r\n            enhancedSSM[i][j - i][1] = 0;\r\n\r\n            let timeLeft = blurTime;\r\n            let scorePitch = 0;\r\n            let scoreTimbre = 0;\r\n            let offsetI = 0;\r\n            let offsetJ = 0;\r\n            let pathI = i;\r\n            let pathJ = j;\r\n            while (timeLeft > 0) {\r\n                const iRemain = segmentObjects[pathI].duration - offsetI;\r\n                const jRemain = segmentObjects[pathJ].duration * tempoDifference - offsetJ;\r\n                const duration = Math.min(iRemain, jRemain);\r\n\r\n                timeLeft -= duration;\r\n\r\n                scorePitch += duration * ssm[pathI][pathJ - pathI][0];\r\n                scoreTimbre += duration * ssm[pathI][pathJ - pathI][1];\r\n\r\n                if (iRemain < jRemain) {\r\n                    // Going to cell on right\r\n                    pathI += direction;\r\n                    if (pathI >= size || pathI < 0 || pathJ - pathI < 0) {\r\n                        break;\r\n                    }\r\n                    offsetJ += iRemain;\r\n                    offsetI = 0;\r\n                } else if (jRemain < iRemain) {\r\n                    // Going to cell on bottom\r\n                    pathJ += direction;\r\n                    if (pathJ >= size || pathJ < 0 || pathJ - pathI < 0) {\r\n                        break;\r\n                    }\r\n                    offsetI += jRemain;\r\n                    offsetJ = 0;\r\n                } else {\r\n                    // Going to bottom-right diagonal cell\r\n                    pathI += direction;\r\n                    pathJ += direction;\r\n                    if (pathI >= size || pathJ >= size || pathI < 0 || pathJ < 0 || pathJ - pathI < 0) {\r\n                        break;\r\n                    }\r\n                    offsetI = 0;\r\n                    offsetJ = 0;\r\n                }\r\n            }\r\n            enhancedSSM[i][j - i][0] = scorePitch / (blurTime - timeLeft);\r\n            enhancedSSM[i][j - i][1] = scoreTimbre / (blurTime - timeLeft);\r\n        }\r\n    }\r\n    return enhancedSSM;\r\n}\r\n/*\r\nexport function enhance(segmentObjects, ssm, blurTime){\r\n    const enhancedSSMRev = new Array(size);\r\n    for (let i = size-1; i >= 0; i--) {\r\n        enhancedSSMRev[i] = new Array(size - i);\r\n        for (let j = size-1; j >= i; j--) {\r\n            enhancedSSMRev[i][j-i] = new Array(2);\r\n            enhancedSSMRev[i][j-i][0] = 0;\r\n            enhancedSSMRev[i][j-i][1] = 0;\r\n\r\n            let timeLeft = blurTime \r\n            let scorePitch = 0\r\n            let scoreTimbre = 0;\r\n            let offsetI = 0\r\n            let offsetJ = 0\r\n            let pathI = i;\r\n            let pathJ = j;\r\n            while(timeLeft > 0){\r\n                const iRemain = segmentObjects[pathI].duration - offsetI;\r\n                const jRemain = segmentObjects[pathJ].duration - offsetJ;\r\n                const duration = Math.min(iRemain, jRemain);\r\n\r\n                timeLeft -= duration\r\n\r\n                scorePitch +=  duration * ssm[pathI][pathJ-pathI][0]\r\n                scoreTimbre +=  duration * ssm[pathI][pathJ-pathI][1]\r\n                \r\n                if(iRemain < jRemain){ // Going to cell on left\r\n                    pathI--;\r\n                    if(pathI < 0){\r\n                        break;\t\r\n                    }\r\n                    offsetJ += iRemain;\r\n                    offsetI = 0;\r\n                }else if(jRemain < iRemain){ // Going to cell on top\r\n                    pathJ--;\r\n                    if(pathJ < 0){\r\n                        break;\t\r\n                    }\r\n                    offsetI += jRemain;\r\n                    offsetJ = 0;\r\n                }else{ // Going to top-left diagonal cell\r\n                    pathI+=direction; pathJ+=direction;\r\n                    if(pathI < 0 || pathJ < 0){\r\n                        break;\t\r\n                    }\r\n                    offsetJ = 0;\r\n                    offsetI = 0;\r\n                }\r\n            }\r\n            enhancedSSMRev[i][j-i][0] = scorePitch / (blurTime-timeLeft)\r\n            enhancedSSMRev[i][j-i][1] = scoreTimbre / (blurTime-timeLeft)\r\n        }\r\n    }\r\n\r\n}*/\r\n\r\nexport function threshold(ssm, threshold) {\r\n    const size = ssm.length;\r\n    const thresholdSSM = new Array(size);\r\n    for (let i = 0; i < size; i++) {\r\n        thresholdSSM[i] = new Array(size - i);\r\n        for (let j = i; j < size; j++) {\r\n            thresholdSSM[i][j - i] = new Array(2);\r\n            thresholdSSM[i][j - i][0] = audioUtil.logCompression(\r\n                Math.max(ssm[i][j - i][0] - threshold, 0) / (1 - threshold),\r\n                10\r\n            );\r\n            thresholdSSM[i][j - i][1] = audioUtil.logCompression(\r\n                Math.max(ssm[i][j - i][1] - threshold, 0) / (1 - threshold),\r\n                10\r\n            );\r\n        }\r\n    }\r\n    return thresholdSSM;\r\n}\r\n","import Segment from \"./Segment\";\r\nimport * as sim from \"./similarity\";\r\nimport store from \"../store\";\r\nimport Features from \"./Features\";\r\nimport * as workers from \"./workers/workers\";\r\nimport * as SSM from \"./SSM\";\r\nconst GAMMA = 1.7;\r\nconst CLUSTERAMOUNT = 10;\r\nconst sampleRate = 1; // 1 sample per second\r\nexport default class Track {\r\n    trackData = null;\r\n    analysisData = null;\r\n    segments = [];\r\n    ssm = null;\r\n\r\n    features;\r\n\r\n    processed = false;\r\n\r\n    clusters = new Array(CLUSTERAMOUNT).fill([]);\r\n\r\n    process() {\r\n        this.createSegmentObjects(); // create extended objects holding more info\r\n        this.features = new Features(this.segments, 1, this.getAnalysisDuration());\r\n        this.tsne();\r\n        this.cluster();\r\n        this.calculateSSM();\r\n        this.processed = true;\r\n    }\r\n\r\n    createSegmentObjects() {\r\n        console.log(\"Creating segmentObjects\");\r\n        this.analysisData.segments.forEach((segment) => {\r\n            this.segments.push(new Segment(segment));\r\n        });\r\n        console.log(\"Created segmentObjects\");\r\n    }\r\n\r\n    /**\r\n     * Self similarity matrix, takes a few seconds so async is needed\r\n     */\r\n    calculateSSM() {\r\n        const beforessmtime = new Date();\r\n        const ssm = SSM.calculate(this.segments, false).then(() => {\r\n            console.log(ssm);\r\n            const finishTime = new Date() - beforessmtime;\r\n            console.log(\"Time it took to finish JS\", finishTime);\r\n        });\r\n        console.log(\"Ello\");\r\n\r\n        console.log(\"starting SSMWorker\");\r\n        //store.commit(\"ssmReady\", false);\r\n        workers.startSSM(this, this.features.processed.pitchesFlat, 12, { useSampled: false }).then((result) => {\r\n            console.log(result);\r\n            this.ssm = ssm;\r\n            store.commit(\"ssmReady\", true);\r\n            console.log(\"ssm Done\");\r\n        });\r\n    }\r\n\r\n    cluster() {\r\n        console.log(\"starting Clusterworker\");\r\n        /*clusterWorker.terminate();\r\n        clusterWorker.send({ features: this.features.clusterSelection, minK: 2, maxK: 10, tries: 4 }).then((result) => {\r\n            this.updateClusters(result);\r\n            console.log(\"clustering done\");\r\n        });*/\r\n    }\r\n    updateClusters(clusterIndexes) {\r\n        store.commit(\"clusterReady\", false);\r\n        clusterIndexes.forEach((cluster, index) => {\r\n            this.segments[index].setCluster(cluster);\r\n            this.clusters[cluster].push(this.segments[index]);\r\n        });\r\n        window.setTimeout(store.commit(\"clusterReady\", true), 1);\r\n    }\r\n\r\n    tsne() {\r\n        console.log(\"starting tsneWorker\");\r\n        /*tsneWorker.terminate();\r\n        tsneWorker.send({ features: this.features.tsneSelection }).then((result) => {\r\n            this.updateTSNECoords(result);\r\n        });\r\n\r\n        tsneWorker.receive((result) => {\r\n            this.updateTSNECoords(result);\r\n        });*/\r\n    }\r\n    //updateAmountPer100ms = 100;\r\n    updateTSNECoords(coords) {\r\n        store.commit(\"tsneReady\", false);\r\n        for (let i = 0; i < this.segments.length; i++) {\r\n            this.segments[i].setTSNECoord(coords[i]);\r\n        }\r\n        window.setTimeout(store.commit(\"tsneReady\", true), 1);\r\n    }\r\n\r\n    getClosestSegment(coord) {\r\n        let minDist = Infinity;\r\n        let closestSegment = null;\r\n        this.segments.forEach((segment) => {\r\n            const dist = sim.euclidianDistance(coord, segment.tsneCoord);\r\n            if (dist < minDist) {\r\n                minDist = dist;\r\n                closestSegment = segment;\r\n            }\r\n        });\r\n        return closestSegment;\r\n    }\r\n\r\n    constructor(trackData) {\r\n        this.trackData = trackData;\r\n    }\r\n    static createWithAnalysis(trackData, analysisData) {\r\n        const track = new Track(trackData);\r\n        track.setAnalysis(analysisData);\r\n        return track;\r\n    }\r\n\r\n    static fromJSON(json) {\r\n        return this.createWithAnalysis(json.trackData, json.analysisData);\r\n    }\r\n\r\n    // Works with JSON.stringify!\r\n    toJSON() {\r\n        return {\r\n            trackData: this.trackData,\r\n            analysisData: this.analysisData,\r\n        };\r\n    }\r\n\r\n    getId() {\r\n        return this.trackData.id;\r\n    }\r\n    hasAnalysis() {\r\n        return this.analysisData !== null && this.segments.length > 0;\r\n    }\r\n    getAnalysis() {\r\n        return this.analysisData;\r\n    }\r\n    setAnalysis(analysis) {\r\n        if (!this.processed) {\r\n            this.analysisData = analysis;\r\n            console.log(\"processing\");\r\n            this.process();\r\n            console.log(\"processed\");\r\n        }\r\n    }\r\n    getName() {\r\n        return this.trackData.name;\r\n    }\r\n    getArtist() {\r\n        return this.trackData.artist;\r\n    }\r\n    getUri() {\r\n        return this.trackData.uri;\r\n    }\r\n    getSegments() {\r\n        return this.segments;\r\n    }\r\n    getSegment(i) {\r\n        return this.segments[i];\r\n    }\r\n    getSSM() {\r\n        return this.ssm;\r\n    }\r\n    getSSMValue(i, j) {\r\n        return this.ssm[i][i - j];\r\n    }\r\n    getBars() {\r\n        return this.analysisData.bars;\r\n    }\r\n    getBeats() {\r\n        return this.analysisData.beats;\r\n    }\r\n    getTatums() {\r\n        return this.analysisData.tatums;\r\n    }\r\n    getProcessedPitch(i) {\r\n        return this.segments[i].getPitches();\r\n    }\r\n    getProcessedPitches() {\r\n        return this.segments.map((segment) => segment.getPitches());\r\n    }\r\n    getProcessedTimbre(i) {\r\n        return this.segments[i].getTimbres();\r\n    }\r\n    getProcessedTimbres() {\r\n        return this.segments.map((segment) => segment.getTimbres());\r\n    }\r\n    getAnalysisDuration() {\r\n        return this.analysisData.track.duration;\r\n    }\r\n}\r\n","import * as SpotifyWebApi from \"spotify-web-api-js\";\r\nimport * as auth from \"./authentication\";\r\nimport Track from \"./Track\";\r\nimport store from \"./../store\"; // path to your Vuex store\r\nimport router from \"../router\";\r\nimport * as workers from \"./workers/workers\";\r\n\r\nexport const spotify = new SpotifyWebApi();\r\n\r\nconst allTracks = new Map();\r\n\r\n// Initialize spotify access, load tracks from local storage, get user data\r\nexport async function initialize() {\r\n    workers.init().then(() => console.log(\"Initialized Workers!\"));\r\n\r\n    //Track.initWorkers();\r\n    //loadAllTracks();\r\n    console.log(\"Got tracks from local storage: \", allTracks);\r\n\r\n    spotify.setAccessToken(auth.token);\r\n    spotify\r\n        .getMe()\r\n        .then((data) => {\r\n            store.commit(\"setUser\", data);\r\n        })\r\n        .catch((err) => {\r\n            router.push(\"/\");\r\n        });\r\n    spotify\r\n        .getMyTopTracks({ limit: 50, offset: 0 })\r\n        .then((tracks) => {\r\n            loadTracksFromSpotify(tracks.items, false);\r\n            selectTrackAtIndex(0);\r\n        })\r\n        .catch((err) => console.log(err));\r\n}\r\n\r\nexport async function selectTrackAtIndex(index) {\r\n    store.commit(\"loadingTrack\", true);\r\n    store.commit(\"tsneReady\", false);\r\n    store.commit(\"clusterReady\", false);\r\n    store.commit(\"ssmReady\", false);\r\n    return getAnalysis(store.getters.trackList[index]).then(() => {\r\n        console.log(\"Getting analysis and everything done, now setting selected index\");\r\n        store.commit(\"loadingTrack\", false);\r\n        store.commit(\"setSelectedIndex\", index);\r\n    });\r\n}\r\n\r\n// Save tracks to local storage\r\nexport function saveAllTracks() {\r\n    localStorage.allTracks = JSON.stringify(Array.from(allTracks.entries()));\r\n}\r\n\r\n// Save tracks to local storage\r\nexport function loadAllTracks() {\r\n    if (localStorage.allTracks) {\r\n        const allTracksArray = JSON.parse(localStorage.allTracks);\r\n        allTracksArray.forEach((trackArray) => {\r\n            const track = Track.createWithAnalysis(trackArray[1].trackData, trackArray[1].analysisData);\r\n            allTracks.set(trackArray[0], track);\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Load tracks from spotify api result\r\n */\r\n\r\nfunction loadTracksFromSpotify(tracks, keepCurrentTrack) {\r\n    const selectedTrack = store.getters.selectedTrack;\r\n    store.commit(\"clearTrackList\");\r\n    tracks.forEach((trackData) => {\r\n        if (allTracks.has(trackData.id)) {\r\n            store.commit(\"addToTrackList\", allTracks.get(trackData.id));\r\n        } else {\r\n            const track = new Track(trackData);\r\n            allTracks.set(trackData.id, track);\r\n            store.commit(\"addToTrackList\", track);\r\n        }\r\n    });\r\n    if (keepCurrentTrack) {\r\n        store.commit(\"addToTrackListFront\", selectedTrack);\r\n        store.commit(\"setSelectedIndex\", 0);\r\n    } else {\r\n        selectTrackAtIndex(0);\r\n    }\r\n}\r\n\r\nexport async function getAnalysis(track) {\r\n    if (track.hasAnalysis()) return track.getAnalysis();\r\n    return spotify\r\n        .getAudioAnalysisForTrack(track.getId())\r\n        .then((analysis) => {\r\n            console.log(\"Got analysis from api\");\r\n            track.setAnalysis(analysis);\r\n            console.log(\"Track has done everything with analysis\");\r\n        })\r\n        .catch((err) => {\r\n            console.log(err);\r\n        });\r\n}\r\n\r\nexport async function search(query) {\r\n    spotify\r\n        .search(query, [\"track\"])\r\n        .then((results) => {\r\n            loadTracksFromSpotify(results.tracks.items, true);\r\n        })\r\n        .catch((err) => {\r\n            console.log(err);\r\n        });\r\n}\r\n","<template>\r\n    <div>\r\n        <v-slide-group\r\n            v-model=\"selected\"\r\n            center-active\r\n            class=\"pt-2\"\r\n            v-on:scroll.native=\"onScroll\"\r\n            mandatory\r\n        >\r\n            <v-slide-item\r\n                v-for=\"(track, index) in tracks\"\r\n                :key=\"index\"\r\n                v-slot:default=\"{ active, toggle }\"\r\n                class=\"mx-2 my-1\"\r\n            >\r\n                <Album :album=\"track.trackData\" :imgSize=\"active ? albumSize*1.5 : albumSize\" :active=\"active\" @clicked=\"toggle\"/>\r\n            </v-slide-item>\r\n        </v-slide-group>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport Album from \"../components/Album\"\r\nimport * as app from \"../app/app\"\r\n\r\nexport default {\r\n  name: 'TrackSelector',\r\n  props: [\r\n      'tracks',\r\n      'albumSize'\r\n  ],\r\n  components: {\r\n      Album\r\n  },\r\n  data(){\r\n      return {\r\n          selected: 0,\r\n      }\r\n  },\r\n  computed:{\r\n      selectedFromStore(){\r\n          return this.$store.getters.selectedIndex;\r\n      }\r\n  },\r\n  watch: {\r\n      selected: 'selectedChanged',\r\n      selectedFromStore: 'selectedFromStoreChanged'\r\n  },\r\n  mounted () {\r\n  },\r\n  methods:{\r\n        selectedChanged(newIndex, oldIndex){\r\n            app.selectTrackAtIndex(newIndex);\r\n        },\r\n        selectedFromStoreChanged(newIndex, oldIndex){\r\n            this.selected = newIndex;\r\n        }\r\n  }\r\n};\r\n</script>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TrackSelector.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TrackSelector.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TrackSelector.vue?vue&type=template&id=55b03592&\"\nimport script from \"./TrackSelector.vue?vue&type=script&lang=js&\"\nexport * from \"./TrackSelector.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VSlideGroup } from 'vuetify/lib/components/VSlideGroup';\nimport { VSlideItem } from 'vuetify/lib/components/VSlideGroup';\ninstallComponents(component, {VSlideGroup,VSlideItem})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"d-flex pa-2\"},[_c('v-row',[_c('v-layout',{staticClass:\"ml-10\"},[_c('v-switch',{staticClass:\"mx-5\",attrs:{\"label\":\"Raw Pitch Data\",\"hide-details\":\"\"},model:{value:(_vm.canvasVis.rawPitch.draw),callback:function ($$v) {_vm.$set(_vm.canvasVis.rawPitch, \"draw\", $$v)},expression:\"canvasVis.rawPitch.draw\"}}),_c('v-switch',{staticClass:\"mx-5\",attrs:{\"label\":\"Raw Timbre Data\",\"hide-details\":\"\"},model:{value:(_vm.canvasVis.rawTimbre.draw),callback:function ($$v) {_vm.$set(_vm.canvasVis.rawTimbre, \"draw\", $$v)},expression:\"canvasVis.rawTimbre.draw\"}}),_c('v-switch',{staticClass:\"mx-5\",attrs:{\"label\":\"Rhythm Data\",\"hide-details\":\"\"},model:{value:(_vm.canvasVis.rawRhythm.draw),callback:function ($$v) {_vm.$set(_vm.canvasVis.rawRhythm, \"draw\", $$v)},expression:\"canvasVis.rawRhythm.draw\"}}),_c('v-switch',{staticClass:\"mx-5\",attrs:{\"label\":\"Tonality\",\"hide-details\":\"\"},model:{value:(_vm.canvasVis.tonality.draw),callback:function ($$v) {_vm.$set(_vm.canvasVis.tonality, \"draw\", $$v)},expression:\"canvasVis.tonality.draw\"}}),_c('v-switch',{staticClass:\"mx-5\",attrs:{\"label\":\"Similarity Matrix\",\"hide-details\":\"\"},model:{value:(_vm.canvasVis.ssm.draw),callback:function ($$v) {_vm.$set(_vm.canvasVis.ssm, \"draw\", $$v)},expression:\"canvasVis.ssm.draw\"}})],1),_c('v-spacer'),_c('v-btn',{staticClass:\"mr-10\",attrs:{\"color\":\"primary\",\"fab\":\"\",\"dark\":\"\",\"small\":\"\"},on:{\"click\":_vm.zoom}},[_c('v-icon',[_vm._v(\"mdi-magnify-plus-outline\")])],1)],1)],1),_c('div',{staticClass:\"vis\",on:{\"click\":_vm.clickedVis}},[(!_vm.loadingTrack)?_c('svg',{staticClass:\"visSeeker\"},[_c('rect',{attrs:{\"x\":this.zoomed ? this.padding + this.canvasWidth / 2 : _vm.padding + (this.seeker / 1000.0) * _vm.scale - 1,\"y\":0,\"width\":2,\"height\":_vm.canvasHeight,\"fill\":\"#ffffff\",\"opacity\":0.5}})]):_vm._e(),_c('canvas',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.loadingTrack),expression:\"!loadingTrack\"}],ref:\"visCanvas\",staticClass:\"visCanvas pa-0 ma-0\",attrs:{\"id\":\"visCanvas\"}}),_c('canvas',{staticClass:\"visCanvas pa-0 ma-0\",attrs:{\"id\":\"gl-canvas\"}})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { spotify } from \"../app/app\";\r\nimport store from \"../store\";\r\n\r\nexport let deviceId = null;\r\nlet playerRef;\r\nlet trackIsLoaded = false;\r\nlet currentTrackURI = \"\";\r\nlet nextTrackURI = \"\";\r\nlet nexStartPosition = 0;\r\nlet playingSegment = null;\r\nexport async function setTrack(trackUri, startPosition) {\r\n    nextTrackURI = trackUri;\r\n    nexStartPosition = startPosition;\r\n}\r\n\r\nexport async function resume(position) {\r\n    if (deviceId) {\r\n        if (trackIsLoaded && nextTrackURI === \"\") {\r\n            seek(position);\r\n            return playerRef\r\n                .resume()\r\n                .then(() => {\r\n                    store.commit(\"setPlaying\", true);\r\n                })\r\n                .catch((err) => {\r\n                    console.log(err);\r\n                });\r\n        } else {\r\n            // Start new track\r\n            return spotify\r\n                .play({ device_id: deviceId, uris: [nextTrackURI], position_ms: position || nexStartPosition })\r\n                .then(() => {\r\n                    trackIsLoaded = true;\r\n                    currentTrackURI = nextTrackURI;\r\n                    nextTrackURI = \"\";\r\n                    nexStartPosition = 0;\r\n                    store.commit(\"setPlaying\", true);\r\n                })\r\n                .catch((err) => {\r\n                    console.log(err);\r\n                });\r\n        }\r\n    }\r\n}\r\n\r\nexport async function pause() {\r\n    if (deviceId && trackIsLoaded) {\r\n        return playerRef\r\n            .pause()\r\n            .then(() => {\r\n                store.commit(\"setPlaying\", false);\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            });\r\n    }\r\n}\r\n\r\nexport async function seek(time) {\r\n    if (deviceId && trackIsLoaded) {\r\n        return playerRef.seek(time).catch((err) => {\r\n            console.log(err);\r\n        });\r\n    }\r\n}\r\n\r\nexport async function playSegment(segment) {\r\n    console.log(\"playing segment\", segment);\r\n    resume(segment.start * 1000).then(() => {\r\n        playingSegment = segment;\r\n        window.setTimeout(() => {\r\n            if (playingSegment === segment) {\r\n                pause();\r\n            }\r\n        }, segment.duration * 1000);\r\n    });\r\n}\r\n\r\nexport async function deviceIdSet() {\r\n    return new Promise((resolve, reject) => {\r\n        let timeWas = new Date();\r\n        let wait = setInterval(function() {\r\n            if (deviceId !== null) {\r\n                console.log(\"resolved after\", new Date() - timeWas, \"ms\");\r\n                clearInterval(wait);\r\n                resolve();\r\n            } else if (new Date() - timeWas > 10000) {\r\n                // Timeout\r\n                console.log(\"rejected after\", new Date() - timeWas, \"ms\");\r\n                clearInterval(wait);\r\n                reject();\r\n            }\r\n        }, 20);\r\n    });\r\n}\r\n\r\nexport function setVolume(volume) {\r\n    if (playerRef) {\r\n        playerRef.setVolume(volume);\r\n    }\r\n}\r\n\r\nasync function waitForSpotifyWebPlaybackSDKToLoad() {\r\n    console.log(\"waiting\");\r\n    return new Promise((resolve) => {\r\n        if (window.Spotify) {\r\n            resolve(window.Spotify);\r\n        } else {\r\n            window.onSpotifyWebPlaybackSDKReady = () => {\r\n                resolve(window.Spotify);\r\n            };\r\n        }\r\n    });\r\n}\r\n\r\nexport async function initialize(token, stateChangedCallback) {\r\n    waitForSpotifyWebPlaybackSDKToLoad().then(() => {\r\n        playerRef = new window.Spotify.Player({\r\n            name: \"Music Structure Visualizer\",\r\n            getOAuthToken: (cb) => {\r\n                cb(token);\r\n            },\r\n            volume: 0.5,\r\n        });\r\n\r\n        // Error handling\r\n        playerRef.addListener(\"initialization_error\", ({ message }) => {\r\n            console.error(message);\r\n        });\r\n        playerRef.addListener(\"authentication_error\", ({ message }) => {\r\n            console.error(message);\r\n        });\r\n        playerRef.addListener(\"account_error\", ({ message }) => {\r\n            console.error(message);\r\n        });\r\n        playerRef.addListener(\"playback_error\", ({ message }) => {\r\n            console.error(message);\r\n        });\r\n        // Playback status updates\r\n        playerRef.addListener(\"player_state_changed\", ({ position, duration, track_window: { current_track } }) => {\r\n            stateChangedCallback({ current_track, position, duration });\r\n        });\r\n\r\n        // Ready\r\n        playerRef.addListener(\"ready\", ({ device_id }) => {\r\n            deviceId = device_id;\r\n            console.log(\"Ready with Device ID\", device_id);\r\n        });\r\n\r\n        // Not Ready\r\n        playerRef.addListener(\"not_ready\", ({ device_id }) => {\r\n            console.log(\"Device ID has gone offline\", device_id);\r\n        });\r\n\r\n        // Connect to the player!\r\n        playerRef\r\n            .connect()\r\n            .then(() => {\r\n                console.log(\"Connected succesfully!!!\");\r\n            })\r\n            .catch((err) => {\r\n                console.log(\"Could not connect\");\r\n            });\r\n    });\r\n}\r\n","import * as d3 from 'd3';\r\nimport * as audioUtil from './audioUtil'\r\n\r\nexport const zeroOneColor = d3.scaleSequential().domain([0,1]).interpolator(d3.interpolateViridis);\r\nexport const pitchColor = zeroOneColor;\r\nexport const greyScaleColor = d3.scaleSequential().domain([1,0]).interpolator(d3.interpolateGreys);\r\nexport const timbreColor = d3.scaleSequential().domain([-1,1]).interpolator(d3.interpolateViridis);\r\nexport const rainbowColor = d3.scaleSequential().domain([0, 11]).interpolator(d3.interpolateRainbow);\r\nexport const diverging = d3.scaleDiverging().domain([-1, 0, 1]).interpolator(d3.interpolateRdBu);\r\n\r\nexport function renderRawPitch(track, left, width, yOffset, height, ctx){\r\n    const scale = width/track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment)=>{\r\n        for(let i = 0; i < 12; i++){\r\n            const x=left+segment.start*scale;\r\n            const segmentHeight=height/12-2;\r\n            const y=yOffset+(11-i)*(segmentHeight+2);\r\n            const segmentWidth=segment.duration*scale; \r\n            ctx.fillStyle = pitchColor(segment.segment.pitches[i]);\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        }\r\n    })\r\n}\r\n\r\nexport function renderPercussionPitch(track, left, width, yOffset, height, ctx){\r\n    const scale = width/track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment, segmentIndex)=>{\r\n        const x=left+segment.start*scale;\r\n        const segmentHeight=height/3-2;\r\n        let y=yOffset+0*(segmentHeight+2);\r\n        const segmentWidth=segment.duration*scale; \r\n        ctx.fillStyle = pitchColor(segment.tonalityEnergy*2-.5);\r\n        ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        y=yOffset+1*(segmentHeight+2);\r\n        ctx.fillStyle = pitchColor(1-segment.tonalityRadius);\r\n        ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        y=yOffset+2*(segmentHeight+2);\r\n        ctx.fillStyle = segment.duration > 0.15 ? pitchColor(0) : pitchColor(segment.percussiony);\r\n        ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n    })\r\n}\r\n\r\nexport function renderProcessedPitch(track, left, width, yOffset, height, ctx){\r\n    const scale = width/track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment)=>{\r\n        for(let i = 0; i < 12; i++){\r\n            const x=left+segment.start*scale;\r\n            const segmentHeight=height/12-2;\r\n            const y=yOffset+(11-i)*(segmentHeight+2);\r\n            const segmentWidth=segment.duration*scale; \r\n            ctx.fillStyle = pitchColor(segment.pitches[i]);\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        }\r\n    })\r\n}\r\nexport function renderRawTimbre(track, left, width, yOffset, height, ctx){\r\n    const scale = width/track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment, segmentIndex)=>{\r\n        for(let i = 0; i < 12; i++){\r\n            const x=left+segment.start*scale;\r\n            const segmentHeight=height/12-2;\r\n            const y=yOffset+(11-i)*(segmentHeight+2);\r\n            const segmentWidth=segment.duration*scale; \r\n            ctx.fillStyle = diverging(track.getProcessedTimbre(segmentIndex)[i]);\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n        }\r\n    })\r\n}\r\n\r\nexport function renderRawRhythm(track, left, width, yOffset, height, ctx){\r\n    const scale = width/track.getAnalysis().track.duration;\r\n    track.getBars().forEach((bar)=>{\r\n        const x=left+bar.start*scale;\r\n        const y=yOffset;\r\n        ctx.fillStyle = greyScaleColor(0.3+bar.confidence);\r\n        ctx.fillRect(x, y, 1, height/3);\r\n    });\r\n    track.getBeats().forEach((beat)=>{\r\n        const x=left+beat.start*scale;\r\n        const y=yOffset+height/3;\r\n        ctx.fillStyle = greyScaleColor(0.3+beat.confidence);\r\n        ctx.fillRect(x, y, 1, height/3);\r\n    });\r\n    track.getTatums().forEach((tatum)=>{\r\n        const x=left+tatum.start*scale;\r\n        const y=yOffset + height/3*2;\r\n        ctx.fillStyle = greyScaleColor(0.3+tatum.confidence);\r\n        ctx.fillRect(x, y, 1, height/3);\r\n    });\r\n}\r\n\r\nexport function renderTonality(track, left, width, yOffset, height, ctx){\r\n    const scale = width/track.getAnalysis().track.duration;\r\n    track.getSegments().forEach((segment)=>{\r\n            const x=left+segment.start*scale;\r\n            const segmentHeight=height;\r\n            const y=yOffset;\r\n            const segmentWidth=segment.duration*scale; \r\n            ctx.fillStyle = audioUtil.tonalVectorColor(segment.pitches);\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n    })\r\n}\r\n\r\n\r\n\r\nexport function renderSSM(track, left, width, yOffset, height, ctx){\r\n    console.log(\"Rendering ssm...\")\r\n    const scale = height/track.getAnalysis().track.duration;\r\n    const size = track.getSegments().length;\r\n    for(let i = 0; i < size; i++){\r\n        for(let j = i; j < size; j++){\r\n            const segmentA = track.getSegment(i)\r\n            const segmentB = track.getSegment(j)\r\n\r\n            const pitch = track.getSSM()[i][j-i][0];\r\n\r\n            ctx.fillStyle = greyScaleColor(Math.pow(pitch,4));\r\n\r\n            const x=left+segmentA.start*scale;\r\n            const segmentWidth=segmentA.duration*scale; \r\n\r\n            const y=yOffset+segmentB.start*scale;\r\n            const segmentHeight=segmentB.duration*scale;\r\n            if(!segmentHeight){\r\n                return;\r\n            }\r\n            ctx.fillRect(x, y, segmentWidth, segmentHeight);\r\n\r\n            const timbre = track.getSSM()[i][j-i][1];\r\n\r\n            ctx.fillStyle = greyScaleColor(Math.pow(timbre,5));\r\n            ctx.fillRect(y+left-yOffset, x-left+yOffset, segmentHeight, segmentWidth);\r\n        }\r\n    }\r\n}","let gl;\r\nlet program;\r\nlet bufferSize = 0;\r\nexport function init(canvas) {\r\n    gl = canvas.getContext(\"webgl2\");\r\n\r\n    if (!gl) {\r\n        console.log(\"WebGL not supported, falling back on experimental WebGL\");\r\n        gl = canvas.getContext(\"experimental-webgl2\");\r\n        if (!gl) alert(\"Your browser does not support WebGL\");\r\n    }\r\n\r\n    gl.clearColor(0.2, 0.2, 0.2, 1.0);\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n    let vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n    let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n\r\n    gl.shaderSource(vertexShader, vertexShaderText);\r\n    gl.shaderSource(fragmentShader, fragmentShaderText);\r\n\r\n    gl.compileShader(vertexShader);\r\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\r\n        console.error(\"ERROR compiling vertex shader!\", gl.getShaderInfoLog(vertexShader));\r\n        return;\r\n    }\r\n    gl.compileShader(fragmentShader);\r\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\r\n        console.error(\"ERROR compiling fragment shader!\", gl.getShaderInfoLog(fragmentShader));\r\n        return;\r\n    }\r\n\r\n    program = gl.createProgram();\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n        console.error(\"ERROR linking program!\", gl.getProgramInfoLof(program));\r\n        return;\r\n    }\r\n\r\n    gl.validateProgram(program);\r\n    if (!gl.getProgramParameter(program, gl.VALIDATE_STATUS)) {\r\n        console.error(\"ERROR validating program!\", gl.getProgramInfoLog(program));\r\n        return;\r\n    }\r\n\r\n    const size = 10;\r\n    const ssmVertices = [];\r\n    for (let y = 0; y < size; y++) {\r\n        for (let x = 0; x < size; x++) {\r\n            ssmVertices.push(x * 0.1, y * 0.1, (y * size + x) / (size * size));\r\n        }\r\n        ssmVertices.push(size * 0.1, y * 0.1, 0); // .1 is duration of segment(i)\r\n    }\r\n    for (let x = 0; x < size; x++) {\r\n        ssmVertices.push(x * 0.1, size * 0.1, 0); // size * 0.1 in reality is segment(size-1).start + segment(size-1).duration\r\n    }\r\n    ssmVertices.push(size * 0.1, size * 0.1, 0); // size * 0.1 in reality is segment(size-1).start + segment(size-1).duration\r\n\r\n    // Fill the current element array buffer with data\r\n    const ssmIndeces = [];\r\n    for (let y = 0; y < size; y++) {\r\n        for (let x = 0; x < size; x++) {\r\n            // 1 rect = 2 triangles counterclockwise divided by backward slash \\\r\n            const topleft = y * (size + 1) + x;\r\n            const bottomleft = (y + 1) * (size + 1) + x;\r\n            ssmIndeces.push(bottomleft, bottomleft + 1, topleft);\r\n            ssmIndeces.push(bottomleft + 1, topleft + 1, topleft);\r\n        }\r\n    }\r\n    // create the buffer\r\n    const indexBuffer = gl.createBuffer();\r\n    // make this buffer the current 'ELEMENT_ARRAY_BUFFER'\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(ssmIndeces), gl.STATIC_DRAW);\r\n\r\n    const rectangleVertexBufferObject = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, rectangleVertexBufferObject);\r\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(ssmVertices), gl.STATIC_DRAW);\r\n\r\n    const vertAttribLocation = gl.getAttribLocation(program, \"vert\");\r\n    gl.vertexAttribPointer(\r\n        vertAttribLocation,\r\n        3, // Number of elements per attribute (x, y, value)\r\n        gl.FLOAT, // Type of element\r\n        gl.FALSE, // data normalized\r\n        3 * Float32Array.BYTES_PER_ELEMENT, // Size of one vertex\r\n        0 // Offset from beginning of single vertex\r\n    );\r\n    gl.enableVertexAttribArray(vertAttribLocation);\r\n\r\n    bufferSize = size * size * 6;\r\n}\r\n\r\nexport function clear() {\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n}\r\n\r\nexport function setSSMDataArray(track) {\r\n    const segments = track.segmentObjects;\r\n    const ssm = track.ssm;\r\n    const size = segments.length;\r\n    console.log(\"Number of segments: \", size);\r\n\r\n    const halfDuration = track.getAnalysisDuration() / 2;\r\n    function st(pos) {\r\n        return pos / halfDuration - 1;\r\n    } // Scale and translate\r\n\r\n    const ssmVertices = [];\r\n\r\n    for (let y = 0; y < size; y++) {\r\n        for (let x = 0; x < size; x++) {\r\n            const value = Math.pow(y >= x ? ssm[x][y - x][0] : ssm[y][x - y - 1][1], 4);\r\n            const left = st(segments[x].start);\r\n            const top = -st(segments[y].start);\r\n            const right = st(segments[x].start + segments[x].duration);\r\n            const bottom = -st(segments[y].start + segments[y].duration);\r\n            ssmVertices.push(\r\n                left,\r\n                top,\r\n                value,\r\n                left,\r\n                bottom,\r\n                value,\r\n                right,\r\n                top,\r\n                value,\r\n                right,\r\n                top,\r\n                value,\r\n                left,\r\n                bottom,\r\n                value,\r\n                right,\r\n                bottom,\r\n                value\r\n            );\r\n        }\r\n    }\r\n\r\n    const rectangleVertexBufferObject = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, rectangleVertexBufferObject);\r\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(ssmVertices), gl.STATIC_DRAW);\r\n\r\n    const vertAttribLocation = gl.getAttribLocation(program, \"vert\");\r\n    gl.vertexAttribPointer(\r\n        vertAttribLocation,\r\n        3, // Number of elements per attribute (x, y, value)\r\n        gl.FLOAT, // Type of element\r\n        gl.FALSE, // data normalized\r\n        3 * Float32Array.BYTES_PER_ELEMENT, // Size of one vertex\r\n        0 // Offset from beginning of single vertex\r\n    );\r\n    gl.enableVertexAttribArray(vertAttribLocation);\r\n    bufferSize = size * size * 6;\r\n    console.log(\"Created buffer of size:\", bufferSize);\r\n}\r\n\r\nexport function setSSMData(track) {\r\n    const segments = track.segmentObjects;\r\n    const ssm = track.ssm;\r\n    const size = segments.length;\r\n    console.log(\"Number of segments: \", size);\r\n\r\n    const halfDuration = track.getAnalysisDuration() / 2;\r\n    function st(pos) {\r\n        return pos / halfDuration - 1;\r\n    } // Scale and translate\r\n\r\n    const end = st(segments[size - 1].start + segments[size - 1].duration);\r\n    const ssmVertices = [];\r\n\r\n    for (let y = 0; y < size; y++) {\r\n        for (let x = 0; x < size; x++) {\r\n            const value = Math.min(1, x >= y ? ssm[y][x - y][0] : 0);\r\n            ssmVertices.push(st(segments[x].start), st(segments[y].start), 1);\r\n        }\r\n        ssmVertices.push(end, st(segments[y].start), 0); // .1 is duration of segment(i)\r\n    }\r\n    for (let x = 0; x < size; x++) {\r\n        ssmVertices.push(st(segments[x].start), end, 0); // size * 0.1 in reality is segment(size-1).start + segment(size-1).duration\r\n    }\r\n    ssmVertices.push(end, end, 0); // size * 0.1 in reality is segment(size-1).start + segment(size-1).duration\r\n\r\n    // Fill the current element array buffer with data\r\n    const ssmIndeces = [];\r\n    for (let y = 0; y < size; y++) {\r\n        for (let x = 0; x < size; x++) {\r\n            // 1 rect = 2 triangles counterclockwise divided by backward slash \\\r\n            const topleft = y * (size + 1) + x;\r\n            const bottomleft = (y + 1) * (size + 1) + x;\r\n            ssmIndeces.push(bottomleft, bottomleft + 1, topleft);\r\n            ssmIndeces.push(bottomleft + 1, topleft + 1, topleft);\r\n        }\r\n    }\r\n    // create the buffer\r\n    const indexBuffer = gl.createBuffer();\r\n    // make this buffer the current 'ELEMENT_ARRAY_BUFFER'\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(ssmIndeces), gl.STATIC_DRAW);\r\n\r\n    const rectangleVertexBufferObject = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, rectangleVertexBufferObject);\r\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(ssmVertices), gl.STATIC_DRAW);\r\n\r\n    const vertAttribLocation = gl.getAttribLocation(program, \"vert\");\r\n    gl.vertexAttribPointer(\r\n        vertAttribLocation,\r\n        3, // Number of elements per attribute (x, y, value)\r\n        gl.FLOAT, // Type of element\r\n        gl.FALSE, // data normalized\r\n        3 * Float32Array.BYTES_PER_ELEMENT, // Size of one vertex\r\n        0 // Offset from beginning of single vertex\r\n    );\r\n    gl.enableVertexAttribArray(vertAttribLocation);\r\n    bufferSize = size * size * 6;\r\n}\r\n\r\nexport function drawSSM() {\r\n    //Main render loop\r\n\r\n    gl.useProgram(program);\r\n    //gl.drawElements(gl.TRIANGLES, bufferSize, gl.UNSIGNED_SHORT, 0);\r\n    gl.drawArrays(gl.TRIANGLES, 0, bufferSize);\r\n}\r\n\r\nconst vertexShaderText = [\r\n    \"#version 300 es\",\r\n    \"precision mediump float;\",\r\n    \"\",\r\n    \"in vec3 vert;\",\r\n    \"flat out float color;\",\r\n    \"\",\r\n    \"void main()\",\r\n    \"{\",\r\n    \" gl_Position = vec4(vert.xy, 0.0, 1.0);\",\r\n    \" color = vert.z;\",\r\n    \"}\",\r\n].join(\"\\n\");\r\n\r\nconst fragmentShaderText = [\r\n    \"#version 300 es\",\r\n    \"precision mediump float;\",\r\n    \"\",\r\n    \"flat in float color;\",\r\n    \"out vec4 fragColor;\",\r\n    \"void main()\",\r\n    \"{\",\r\n    \" fragColor = vec4(color, color, color, 1.0);\",\r\n    \"}\",\r\n].join(\"\\n\");\r\n","<template>\r\n    <div>\r\n        <div class=\"d-flex pa-2\">\r\n            <v-row>\r\n                <v-layout class=\"ml-10\">\r\n                    <v-switch\r\n                        v-model=\"canvasVis.rawPitch.draw\"\r\n                        label=\"Raw Pitch Data\"\r\n                        class=\"mx-5\"\r\n                        hide-details\r\n                    ></v-switch>\r\n                    <v-switch\r\n                        v-model=\"canvasVis.rawTimbre.draw\"\r\n                        label=\"Raw Timbre Data\"\r\n                        class=\"mx-5\"\r\n                        hide-details\r\n                    ></v-switch>\r\n                    <v-switch\r\n                        v-model=\"canvasVis.rawRhythm.draw\"\r\n                        label=\"Rhythm Data\"\r\n                        class=\"mx-5\"\r\n                        hide-details\r\n                    ></v-switch>\r\n                    <v-switch v-model=\"canvasVis.tonality.draw\" label=\"Tonality\" class=\"mx-5\" hide-details></v-switch>\r\n                    <v-switch\r\n                        v-model=\"canvasVis.ssm.draw\"\r\n                        label=\"Similarity Matrix\"\r\n                        class=\"mx-5\"\r\n                        hide-details\r\n                    ></v-switch>\r\n                </v-layout>\r\n                <v-spacer />\r\n                <v-btn color=\"primary\" fab dark small class=\"mr-10\" @click=\"zoom\">\r\n                    <v-icon>mdi-magnify-plus-outline</v-icon>\r\n                </v-btn>\r\n            </v-row>\r\n        </div>\r\n        <div class=\"vis\" @click=\"clickedVis\">\r\n            <svg v-if=\"!loadingTrack\" class=\"visSeeker\">\r\n                <rect\r\n                    :x=\"\r\n                        this.zoomed ? this.padding + this.canvasWidth / 2 : padding + (this.seeker / 1000.0) * scale - 1\r\n                    \"\r\n                    :y=\"0\"\r\n                    :width=\"2\"\r\n                    :height=\"canvasHeight\"\r\n                    fill=\"#ffffff\"\r\n                    :opacity=\"0.5\"\r\n                />\r\n            </svg>\r\n            <canvas v-show=\"!loadingTrack\" id=\"visCanvas\" ref=\"visCanvas\" class=\"visCanvas pa-0 ma-0\"></canvas>\r\n            <!--<svg v-if=\"!loadingTrack\" class=\"svgContainer\">\r\n        <g v-if=\"drawClusters\">\r\n          <rect\r\n            v-for=\"(segment, index) in segments\"\r\n            :key=\"index\"\r\n            :x=\"padding+segment.start*scale\"\r\n            :y=\"segment.cluster*10\"\r\n            :width=\"segment.duration*scale\"\r\n            :height=\"10\"\r\n            :fill=\"clusterColor(segment.cluster)\"\r\n            @click=\"clickedCluster(segment.cluster, segment)\"\r\n          />\r\n        </g>\r\n      </svg>\r\n      <svg\r\n        v-if=\"!loadingTrack && $store.state.tsneReady\"\r\n        class=\"tsneContainer\"\r\n        @click=\"clickedTSNE\"\r\n        :style=\"`height: ${tsneSize+padding}px; left: ${padding}`\"\r\n      >\r\n        <circle\r\n          v-for=\"(segment, index) in segments\"\r\n          :key=\"index\"\r\n          :class=\"playingSegment(segment) ? 'segmentCirclePlaying' : 'segmentCircle'\"\r\n          :r=\"(2+Math.min(2,segment.duration)*5) * (playingSegment(segment) ? 3: 1)\"\r\n          :cx=\"(segment.tsneCoord[0]+1)*tsneSize/2\"\r\n          :cy=\"(segment.tsneCoord[1]+1)*tsneSize/2\"\r\n          :fill=\"playingSegment(segment)? 'white': clusterColor(segment.cluster)\"\r\n          @click=\"clickedSegment(segment)\"\r\n        />\r\n      </svg>-->\r\n            <canvas id=\"gl-canvas\" class=\"visCanvas pa-0 ma-0\"></canvas>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as d3 from \"d3\";\r\nimport * as audioUtil from \"../app/audioUtil\";\r\n\r\nimport * as player from \"../app/player\";\r\nimport * as app from \"../app/app\";\r\nimport * as vis from \"../app/vis\";\r\nimport Segment from \"../app/Segment\";\r\nimport * as webGL from \"../app/webGL\";\r\n\r\nconst d3ClusterColor = d3.scaleOrdinal(d3.schemeCategory10);\r\nexport default {\r\n    props: [\"padding\"],\r\n    data() {\r\n        return {\r\n            canvas: null,\r\n            ctx: null,\r\n            hover: 0,\r\n            windowWidth: window.innerWidth,\r\n            spotifyVisualizer: null,\r\n            power: 1,\r\n            zoomed: false,\r\n            scaleX: 4,\r\n            visSpaceBetween: 5,\r\n            drawClusters: true,\r\n            canvasVis: {\r\n                rawPitch: { draw: true, height: 150, function: vis.renderRawPitch },\r\n                percussionPitch: {\r\n                    draw: false,\r\n                    height: 30,\r\n                    function: vis.renderPercussionPitch,\r\n                },\r\n                rawTimbre: { draw: true, height: 150, function: vis.renderRawTimbre },\r\n                ssm: {\r\n                    draw: false,\r\n                    height: window.innerWidth - this.padding * 2,\r\n                    function: vis.renderSSM,\r\n                },\r\n                tonality: { draw: true, height: 25, function: vis.renderTonality },\r\n                rawRhythm: { draw: true, height: 30, function: vis.renderRawRhythm },\r\n            },\r\n        };\r\n    },\r\n    computed: {\r\n        track() {\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        analysis() {\r\n            return this.track.getAnalysis();\r\n        },\r\n        segments() {\r\n            return this.track.getSegments();\r\n        },\r\n        scale() {\r\n            return this.width / this.analysis.track.duration;\r\n        },\r\n        width() {\r\n            return this.windowWidth * (this.zoomed ? this.scaleX : 1) - this.padding * 2;\r\n        },\r\n        canvasWidth() {\r\n            return this.windowWidth - this.padding * 2;\r\n        },\r\n        tsneSize() {\r\n            return this.canvasWidth / 2;\r\n        },\r\n        canvasHeight() {\r\n            let height = 0;\r\n            for (const [key, vis] of Object.entries(this.canvasVis)) {\r\n                height += vis.draw ? this.visSpaceBetween + vis.height : 0;\r\n            }\r\n            return height;\r\n        },\r\n        loadingTrack() {\r\n            return this.$store.state.loadingTrack;\r\n        },\r\n        duration() {\r\n            return Math.round(this.track.getAnalysis().track.duration * 1000);\r\n        },\r\n        seeker() {\r\n            return this.$store.state.seeker;\r\n        },\r\n    },\r\n    watch: {\r\n        loadingTrack: \"loadingTrackChanged\",\r\n        seeker: \"seekerChanged\",\r\n        canvasHeight: \"canvasHeightChanged\",\r\n        canvasVis: {\r\n            deep: true,\r\n            handler(newVis, oldVis) {\r\n                this.canvasVisChanged(newVis, oldVis);\r\n            },\r\n        },\r\n    },\r\n    mounted() {\r\n        window.addEventListener(\"resize\", () => {\r\n            this.windowWidth = window.innerWidth;\r\n            //this.setupCanvas(document.getElementById(\"visCanvas\"));\r\n            //this.draw(0);\r\n        });\r\n        this.webGLSetup();\r\n        //this.setupCanvas(document.getElementById(\"visCanvas\"));\r\n        //this.draw(0);\r\n    },\r\n    methods: {\r\n        webGLSetup() {\r\n            const glCanvas = document.getElementById(\"gl-canvas\");\r\n            glCanvas.width = this.windowWidth;\r\n            glCanvas.height = this.windowWidth;\r\n            webGL.init(glCanvas);\r\n        },\r\n        drawSSM() {\r\n            console.log(\"Drawing SSM\");\r\n            webGL.clear();\r\n            webGL.setSSMDataArray(this.track);\r\n            webGL.drawSSM();\r\n        },\r\n        clickedVis(event) {\r\n            console.log(event);\r\n            if (event.srcElement.id === \"visCanvas\" && event.offsetY <= this.canvasHeight) {\r\n                const posX = Math.min(Math.max(0, event.clientX - this.padding) / this.width, 1);\r\n                const ms = posX * this.duration;\r\n                this.$store.commit(\"setSeeker\", ms);\r\n                player.seek(ms);\r\n            }\r\n        },\r\n        loudness(db) {\r\n            return audioUtil.loudness(db);\r\n        },\r\n        pitchColorRange(value) {\r\n            return vis.pitchColor(value);\r\n        },\r\n        timbreColorRange(value) {\r\n            return vis.timbreColor(value);\r\n        },\r\n        rainbowColorRange(value) {\r\n            return vis.rainbowColor(value);\r\n        },\r\n        clusterColor(cluster) {\r\n            return d3ClusterColor(cluster);\r\n        },\r\n        loadingTrackChanged(newVal, oldVal) {\r\n            if (this.loadingTrack) {\r\n                this.canvasVis.ssm.draw = false;\r\n            } else {\r\n                //this.draw(0);\r\n            }\r\n        },\r\n        setupCanvas(canvas) {\r\n            if (!canvas) {\r\n                console.log(\"canvas not ready\");\r\n                return;\r\n            }\r\n            console.log(\"canvas ready: draw()\");\r\n            this.canvas = canvas;\r\n            this.ctx = canvas.getContext(\"2d\");\r\n\r\n            // get current size of the canvas\r\n            let rect = canvas.getBoundingClientRect();\r\n\r\n            // increase the actual size of our canvas\r\n            this.canvas.width = this.windowWidth * devicePixelRatio;\r\n            this.canvas.height = this.canvasHeight * devicePixelRatio;\r\n\r\n            // ensure all drawing operations are scaled\r\n            this.ctx.scale(devicePixelRatio, devicePixelRatio);\r\n\r\n            // scale everything down using CSS\r\n            this.canvas.style.width = this.windowWidth + \"px\";\r\n            this.canvas.style.height = this.canvasHeight + \"px\";\r\n\r\n            this.ctx.webkitImageSmoothingEnabled = false;\r\n            this.ctx.mozImageSmoothingEnabled = false;\r\n            this.ctx.imageSmoothingEnabled = false;\r\n\r\n            //this.draw();\r\n        },\r\n        draw(xOffset) {\r\n            console.log(\"draw\", xOffset);\r\n            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n            let y = 0;\r\n\r\n            for (const [key, vis] of Object.entries(this.canvasVis)) {\r\n                if (vis.draw) {\r\n                    vis.function(this.track, this.padding - xOffset, this.width, y, vis.height, this.ctx);\r\n                    y += this.visSpaceBetween + vis.height;\r\n                }\r\n            }\r\n        },\r\n        zoom() {\r\n            console.log(\"zooming\");\r\n            //this.transform();\r\n            this.zoomed = !this.zoomed;\r\n            this.redraw();\r\n        },\r\n        redraw() {\r\n            const xOffset = ((this.seeker / 1000.0) * this.width) / this.analysis.track.duration;\r\n            const offsetToMiddle = this.canvasWidth / 2;\r\n            this.draw(this.zoomed ? xOffset - offsetToMiddle : 0);\r\n        },\r\n        seekerChanged(newSeek, oldSeek) {\r\n            if (this.zoomed) {\r\n                this.redraw();\r\n            }\r\n        },\r\n        transform() {\r\n            this.ctx.save();\r\n            this.ctx.translate(this.width * 0.5, this.canvasHeight * 0.5);\r\n            this.ctx.scale(2, 2);\r\n            this.ctx.drawImage(this.canvas, -this.width * 0.5, -this.canvasHeight * 0.5);\r\n            this.ctx.restore();\r\n        },\r\n        clickedCluster(clusterIndex, segment) {\r\n            console.log(\"playing cluster\", clusterIndex);\r\n            let totalDuration = 0;\r\n            const clusterSize = this.track.clusters[clusterIndex].length;\r\n            const randomSegmentIndex = Math.floor(Math.random() * clusterSize);\r\n            const randomSegment = segment; //this.track.clusters[clusterIndex][randomSegmentIndex];\r\n            player.playSegment(randomSegment);\r\n            this.$store.commit(\"setSeeker\", randomSegment.start * 1000);\r\n        },\r\n        clickedSegment(segment) {\r\n            player.playSegment(segment);\r\n            this.$store.commit(\"setSeeker\", segment.start * 1000);\r\n        },\r\n        clickedTSNE(event) {\r\n            const x = (event.offsetX / this.tsneSize) * 2 - 1;\r\n            const y = (event.offsetY / this.tsneSize) * 2 - 1;\r\n            const segment = this.track.getClosestSegment([x, y]);\r\n            this.clickedSegment(segment);\r\n        },\r\n        playingSegment(segment) {\r\n            return (\r\n                this.$store.getters.playing &&\r\n                this.seeker / 1000 >= segment.start &&\r\n                this.seeker / 1000 < segment.start + segment.duration - 0.01\r\n            );\r\n        },\r\n        canvasHeightChanged(newHeight, oldHeight) {\r\n            console.log(\"CanvasHeight change\");\r\n            //this.setupCanvas(this.canvas);\r\n            //this.draw(0);\r\n        },\r\n        canvasVisChanged() {\r\n            //this.setupCanvas(this.canvas);\r\n            //this.draw(0);\r\n            if (this.canvasVis.ssm.draw) {\r\n                this.drawSSM();\r\n            }\r\n        },\r\n    },\r\n};\r\n</script>\r\n<style>\r\n.vis {\r\n    padding-top: 10px;\r\n    position: relative;\r\n}\r\n.visCanvas {\r\n    image-rendering: optimizeSpeed;\r\n    image-rendering: -moz-crisp-edges;\r\n    image-rendering: -webkit-optimize-contrast;\r\n    image-rendering: -o-crisp-edges;\r\n    image-rendering: crisp-edges;\r\n    -ms-interpolation-mode: nearest-neighbor;\r\n}\r\n.visSeeker {\r\n    position: absolute;\r\n    z-index: 3;\r\n    width: 100%;\r\n    overflow: visible;\r\n}\r\n.svgContainer {\r\n    position: relative;\r\n    padding-top: 10px;\r\n    background-color: \"white\";\r\n    top: 0px;\r\n    left: 0px;\r\n    z-index: 2;\r\n    height: 100%;\r\n    width: 100%;\r\n    overflow: visible;\r\n}\r\n.tsneContainer {\r\n    display: block;\r\n    position: relative;\r\n    background-color: \"white\";\r\n    top: 0px;\r\n    left: 0px;\r\n    bottom: 0;\r\n    z-index: 2;\r\n    margin: 0;\r\n    padding: 0;\r\n    width: 100%;\r\n    overflow: visible;\r\n}\r\n\r\n.segmentCircle {\r\n    transition: r 1.5s ease-out, fill 1.5s ease-out; /*, cx 1s ease, cy 1s ease;*/\r\n}\r\n.segmentCirclePlaying {\r\n    transition: r 0.1s ease-in, fill 0.1s ease-in;\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Visualization.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Visualization.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Visualization.vue?vue&type=template&id=bfa2d788&\"\nimport script from \"./Visualization.vue?vue&type=script&lang=js&\"\nexport * from \"./Visualization.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Visualization.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VSwitch } from 'vuetify/lib/components/VSwitch';\ninstallComponents(component, {VBtn,VIcon,VLayout,VRow,VSpacer,VSwitch})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"player\"},[_c('div',{staticClass:\"d-flex justify-center pa-4\"},[(_vm.$store.state.playerReady)?_c('div',[_c('v-hover',{scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar hover = ref.hover;\nreturn [_c('v-btn',{attrs:{\"elevation\":hover ? 5 : 0,\"outlined\":\"\",\"fab\":\"\"},on:{\"click\":_vm.playPause}},[_c('v-icon',{attrs:{\"large\":\"\"}},[_vm._v(\"mdi-\"+_vm._s(_vm.playing ? 'pause' : 'play'))])],1)]}}],null,false,2020131878)})],1):_vm._e(),(!_vm.$store.state.playerReady)?_c('div',[_c('v-progress-circular',{attrs:{\"indeterminate\":\"\",\"size\":\"56\"}})],1):_vm._e()]),(!_vm.$store.state.loadingTrack)?_c('div',{attrs:{\"id\":\"timeseeker\"}},[_c('svg',{staticClass:\"waveform\",attrs:{\"height\":_vm.verticalScale},on:{\"click\":_vm.clickedSVG}},[_vm._l((_vm.track.getSegments()),function(segment,index){return _c('rect',{key:index,staticClass:\"loudnessBlock\",attrs:{\"width\":segment.duration*_vm.scale,\"height\":(_vm.loudness(segment.loudness_max))*_vm.verticalScale,\"x\":_vm.padding+segment.start*_vm.scale,\"y\":_vm.verticalScale-_vm.loudness(segment.loudness_max)*_vm.verticalScale,\"fill\":segment.start+segment.duration/2 < _vm.$store.state.seeker/1000 ? 'grey' : _vm.baseColor}})}),_c('rect',{attrs:{\"x\":_vm.padding+((_vm.seeker/1000.0)*_vm.scale)-1,\"y\":0,\"width\":2,\"height\":_vm.verticalScale,\"fill\":\"#1DB954\"}})],2)]):_vm._e(),(_vm.$store.state.loadingTrack)?_c('div',[_c('v-progress-linear',{attrs:{\"indeterminate\":\"\",\"color\":\"success\"}})],1):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"player\">\r\n        <div class=\"d-flex justify-center pa-4\">\r\n            <div v-if=\"$store.state.playerReady\" >\r\n                <v-hover v-slot:default=\"{ hover }\" >\r\n                    <v-btn :elevation=\"hover ? 5 : 0\" outlined fab @click=\"playPause\" >\r\n                        <v-icon large>mdi-{{playing ? 'pause' : 'play'}}</v-icon>\r\n                    </v-btn>\r\n                </v-hover>\r\n            </div>\r\n            <div v-if=\"!$store.state.playerReady\">\r\n                <v-progress-circular\r\n                    indeterminate\r\n                    size=56\r\n                ></v-progress-circular>\r\n            </div>\r\n        </div>\r\n        <div id=\"timeseeker\" v-if=\"!$store.state.loadingTrack\">\r\n            <svg class=\"waveform\" :height=\"verticalScale\" @click=\"clickedSVG\">\r\n                <rect v-for=\"(segment, index) in track.getSegments()\"\r\n                    class=\"loudnessBlock\"\r\n                    :key=\"index\"\r\n                    :width=\"segment.duration*scale\" \r\n                    :height=\"(loudness(segment.loudness_max))*verticalScale\"\r\n                    :x=\"padding+segment.start*scale\"\r\n                    :y=\"verticalScale-loudness(segment.loudness_max)*verticalScale\"\r\n                    :fill=\"segment.start+segment.duration/2 < $store.state.seeker/1000 ? 'grey' : baseColor\"\r\n                />\r\n                <rect\r\n                    :x=\"padding+((seeker/1000.0)*scale)-1\"\r\n                    :y=\"0\"\r\n                    :width=\"2\"\r\n                    :height=\"verticalScale\"\r\n                    fill=\"#1DB954\"\r\n                />\r\n            </svg>\r\n        </div>\r\n        <div v-if=\"$store.state.loadingTrack\">\r\n            <v-progress-linear\r\n                indeterminate\r\n                color=\"success\"\r\n            ></v-progress-linear>\r\n         </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport * as player from \"../app/player\"\r\nimport * as app from \"../app/app\"\r\nimport * as auth from '../app/authentication';\r\nimport * as audioUtil from '../app/audioUtil'\r\nimport Track from \"../app/Track\"\r\nimport {spotify} from '../app/app';\r\n\r\nexport default {\r\n    inject: ['theme'],\r\n    props:[\r\n        'padding',\r\n    ],\r\n    data () {\r\n        return {\r\n            verticalScale: 50,\r\n            windowWidth: window.innerWidth,\r\n            hover: 0,\r\n            ending: false,\r\n        }\r\n    },\r\n    beforeCreate () {\r\n        player.initialize(auth.token, (newState) => this.stateChanged(newState));\r\n        player.deviceIdSet().then(()=>{ \r\n            this.$store.commit('playerReady', true);\r\n        })\r\n    },\r\n    mounted(){\r\n        \r\n    },\r\n    computed: {\r\n        track(){\r\n            return this.$store.getters.selectedTrack;\r\n        },\r\n        baseColor(){\r\n            return this.theme.isDark ? 'white' : 'black'\r\n        },\r\n        scale(){\r\n            if(this.$store.getters.loadingTrack){\r\n                return 0;\r\n            }\r\n            return this.width/this.track.getAnalysisDuration();\r\n        },\r\n        width(){\r\n            return this.windowWidth - this.padding*2;\r\n        },\r\n        duration(){\r\n            if(this.$store.getters.loadingTrack){\r\n                return 0;\r\n            }\r\n            return Math.round(this.track.getAnalysisDuration()*1000);\r\n        },\r\n        playing(){\r\n            return this.$store.getters.playing;\r\n        },\r\n        seeker(){\r\n            return this.$store.getters.seeker;\r\n        }\r\n    },\r\n    watch: {\r\n        track: 'trackChanged',\r\n    },\r\n    methods: {\r\n        clickedSVG(event){\r\n            const posX = Math.min(Math.max(0,event.clientX-this.padding)/this.width, 1);\r\n            const ms = posX*this.duration;\r\n            this.$store.commit('setSeeker', ms);\r\n            player.seek(this.seeker);\r\n        },\r\n        trackChanged(newTrack, oldTrack){\r\n            this.reset().then(()=>{\r\n                player.setTrack(this.track.getUri(), 0);\r\n                this.$store.commit('setSeeker', 0);\r\n            });\r\n        },\r\n        resume () {\r\n            if(!this.playing){\r\n                player.resume(this.seeker).then(() => {\r\n                    this.$store.commit('setPlaying', true);\r\n                    this.interval = setInterval(() => this.seekerTimer(33), 33);\r\n                });\r\n            }\r\n        },\r\n        pause () {\r\n            if(this.playing){\r\n                player.pause();\r\n                this.$store.commit('setPlaying', false);\r\n                clearInterval(this.interval);\r\n            }\r\n        },\r\n        playPause () {\r\n            this.playing ? this.pause() : this.resume();\r\n        },\r\n        async reset(){\r\n            this.ending = false;\r\n            return player.pause().then(() => {\r\n                this.$store.commit('setSeeker', 0);\r\n                clearInterval(this.interval);\r\n                this.$store.commit('setPlaying', false);\r\n            }).catch((err) => console.log(err));\r\n        },\r\n        clickedTimeSeeker () {\r\n            player.seek(this.seekTime);\r\n        \r\n        },\r\n        seekerTimer(increment){\r\n            const now = new Date();\r\n            let elapsed = increment\r\n            if(this.lastTimePoll){\r\n                elapsed = now-this.lastTimePoll;\r\n            }\r\n            this.lastTimePoll = now;\r\n            this.seekTime+=elapsed;\r\n            this.$store.state.seeker+=elapsed;\r\n        },\r\n        loudness(db){\r\n            return audioUtil.loudness(db);\r\n        },\r\n        stateChanged(state){\r\n            if(this.playing){\r\n                const {current_track, position, duration} = state;\r\n                this.$store.commit('setSeeker', position);\r\n\r\n                // if state gotten at the end, assume it is a stop and reset when next state position is 0\r\n                if(this.ending && state.position === 0){\r\n                    this.reset();\r\n                }\r\n                if(!this.ending && (state.duration - state.position) < 500){\r\n                    this.ending = true;\r\n                }\r\n                \r\n            }\r\n\r\n        }\r\n    },\r\n    components:{\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n.waveform{\r\n  overflow: visible;\r\n  width: 100%;\r\n  height: 100%;\r\n  cursor: pointer;\r\n}\r\n.loudnessBlock{\r\n    transition: fill 200ms ease;\r\n    cursor: pointer\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Player.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Player.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Player.vue?vue&type=template&id=797175ce&\"\nimport script from \"./Player.vue?vue&type=script&lang=js&\"\nexport * from \"./Player.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Player.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VHover } from 'vuetify/lib/components/VHover';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VProgressCircular } from 'vuetify/lib/components/VProgressCircular';\nimport { VProgressLinear } from 'vuetify/lib/components/VProgressLinear';\ninstallComponents(component, {VBtn,VHover,VIcon,VProgressCircular,VProgressLinear})\n","<template>\r\n  <div class=\"home\">\r\n    <v-app-bar dark>\r\n      <v-toolbar-title>Music Structure Visualizer</v-toolbar-title>\r\n\r\n      <v-spacer></v-spacer>\r\n\r\n      <form v-on:submit.prevent=\"search\">\r\n        <v-text-field\r\n          v-model=\"searchQuery\"\r\n          hide-details\r\n          append-icon=\"mdi-magnify\"\r\n          single-line\r\n          rounded\r\n          dense\r\n          filled\r\n        ></v-text-field>\r\n      </form>\r\n      <div class=\"volumeSlider\">\r\n        <v-container>\r\n          <v-slider\r\n            @click:prepend=\"clickVolume\"\r\n            :prepend-icon=\"getVolumeIcon(volume)\"\r\n            v-model=\"volume\"\r\n            :min=\"0\"\r\n            :max=\"1\"\r\n            :step=\"0.02\"\r\n          ></v-slider>\r\n        </v-container>\r\n      </div>\r\n\r\n      <v-btn icon>\r\n        <v-icon>mdi-heart</v-icon>\r\n      </v-btn>\r\n      <v-btn icon>\r\n        <v-icon>mdi-dots-vertical</v-icon>\r\n      </v-btn>\r\n    </v-app-bar>\r\n    <TrackSelector :tracks=\"trackList\" :album-size=\"120\" />\r\n    <Player :padding=\"padding\" />\r\n    <Visualization :padding=\"padding\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport TrackSelector from \"../components/TrackSelector\";\r\nimport Visualization from \"../components/Visualization\";\r\nimport Player from \"../components/Player\";\r\nimport * as app from \"../app/app\";\r\nimport * as auth from \"../app/authentication\";\r\nimport * as player from \"../app/player\";\r\n\r\nexport default {\r\n  name: \"Home\",\r\n  data() {\r\n    return {\r\n      searchQuery: \"\",\r\n      volume: 0.75,\r\n      prevVolume: 0.75,\r\n      padding: 50,\r\n    };\r\n  },\r\n  computed: {\r\n    user() {\r\n      return this.$store.getters.user;\r\n    },\r\n    trackList() {\r\n      return this.$store.getters.trackList;\r\n    },\r\n    selectedIndex() {\r\n      return this.$store.getters.selectedIndex;\r\n    },\r\n    selectedTrack() {\r\n      return this.$store.getters.selectedTrack;\r\n    },\r\n    seeker() {\r\n      return this.$store.getters.seeker;\r\n    },\r\n  },\r\n  watch: {\r\n    selectedIndex(newIndex, oldIndex) {\r\n      //console.log(`We have ${newVal} selected!`)\r\n    },\r\n    selectedTrack(newTrack, oldTrack) {\r\n      console.log(`We have ${newTrack.getName()} selected!`);\r\n    },\r\n    volume(newVol, oldVol) {\r\n      player.setVolume(Math.pow(this.volume, 2));\r\n    },\r\n  },\r\n  components: {\r\n    TrackSelector,\r\n    Visualization,\r\n    Player,\r\n  },\r\n  beforeCreate() {\r\n    console.log(\"Initializing app\")\r\n    app.initialize();\r\n  },\r\n  methods: {\r\n    search() {\r\n      app.search(this.searchQuery);\r\n    },\r\n    selectedTrackChanged() {\r\n      console.log(\"selected track\", this.trackList[this.selected].name);\r\n      this.getAnalsysisFor(this.selected);\r\n    },\r\n    getAnalsysisFor(index) {\r\n      const selectedTrackId = this.trackList[index].id;\r\n      if (!this.trackAnalysis.has(selectedTrackId)) {\r\n        this.analysisReady = false;\r\n        console.log(\"Getting analysis for: \", this.trackList[index].name);\r\n      }\r\n    },\r\n    getVolumeIcon(volume) {\r\n      if (volume > 0.6) return \"mdi-volume-high\";\r\n      if (volume > 0.2) return \"mdi-volume-medium\";\r\n      if (volume > 0) return \"mdi-volume-low\";\r\n      return \"mdi-volume-off\";\r\n    },\r\n    clickVolume() {\r\n      if (this.volume > 0) {\r\n        this.prevVolume = this.volume;\r\n        this.volume = 0;\r\n      } else {\r\n        this.volume = this.prevVolume;\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.volumeSlider {\r\n  height: 100%;\r\n  width: 10%;\r\n}\r\n.trackScroll {\r\n  /*overflow-x: auto;*/\r\n}\r\n.trackScroll::-webkit-scrollbar {\r\n  display: none;\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=2bf05ad4&\"\nimport script from \"./Home.vue?vue&type=script&lang=js&\"\nexport * from \"./Home.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Home.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAppBar } from 'vuetify/lib/components/VAppBar';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VSlider } from 'vuetify/lib/components/VSlider';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VAppBar,VBtn,VContainer,VIcon,VSlider,VSpacer,VTextField,VToolbarTitle})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"callback\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"callback\">\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { requestFirstToken } from \"../app/authentication\"\r\n\r\nexport default {\r\n  name: 'Callback',\r\n  components: {\r\n  },\r\n  beforeCreate () {\r\n      let params = new URLSearchParams(window.location.search);\r\n      let code = params.get('code')\r\n      requestFirstToken(code).then(()=>{\r\n        this.$router.push('/home');\r\n      })\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.callback{\r\n  height: 100%,\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Callback.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Callback.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Callback.vue?vue&type=template&id=e48c1e1c&\"\nimport script from \"./Callback.vue?vue&type=script&lang=js&\"\nexport * from \"./Callback.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Callback.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login\"},[_c('v-container',{attrs:{\"fill-height\":\"\"}},[_c('v-layout',{attrs:{\"align-center\":\"\"}},[_c('v-card',{staticClass:\"mx-auto elevation-15\"},[_c('v-card-title',{staticClass:\"justify-center\"},[_vm._v(\"Music Structure Visualizer\")]),_c('v-card-subtitle',{staticClass:\"text-center\"},[_vm._v(\" Visualize the structure of music in your own library! \")]),_c('v-card-text',{staticClass:\"text-center\"},[_vm._v(\" Logging in with spotify enables the app to play music using your spotify account. \")]),_c('v-card-actions',[_c('v-btn',{staticClass:\"mx-auto\",attrs:{\"color\":\"success\"},on:{\"click\":_vm.spotifyAuthorize}},[_vm._v(\"Log in with Spotify\")])],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"login\">\r\n        <v-container fill-height>\r\n            <v-layout align-center>\r\n                <v-card class=\"mx-auto elevation-15\">\r\n                    <v-card-title class=\"justify-center\">Music Structure Visualizer</v-card-title>\r\n                    <v-card-subtitle class=\"text-center\">\r\n                        Visualize the structure of music in your own library!\r\n                    </v-card-subtitle>\r\n                    <v-card-text class=\"text-center\">\r\n                        Logging in with spotify enables the app to play music using your spotify account.\r\n                    </v-card-text>\r\n                    <v-card-actions>\r\n                        <v-btn class=\"mx-auto\" color=\"success\" @click=\"spotifyAuthorize\">Log in with Spotify</v-btn>\r\n                    </v-card-actions>\r\n                </v-card>\r\n            </v-layout>\r\n        </v-container>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n\r\nexport default {\r\n  name: 'Login',\r\n  components: {\r\n  },\r\n  methods: {\r\n      spotifyAuthorize () {\r\n          window.location.href= process.env.VUE_APP_HOST_URL + \"/api/spotify/login\"\r\n      }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.login{\r\n    height: 100%\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Login.vue?vue&type=template&id=acb05ff4&\"\nimport script from \"./Login.vue?vue&type=script&lang=js&\"\nexport * from \"./Login.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Login.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardSubtitle } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCard,VCardActions,VCardSubtitle,VCardText,VCardTitle,VContainer,VLayout})\n","import Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport Home from '../views/Home.vue'\nimport Callback from '../views/Callback.vue'\nimport Login from '../views/Login.vue'\nimport * as app from '../app/app'\nimport * as auth from '../app/authentication'\n\nVue.use(VueRouter)\n\nconst routes = [\n  {\n    path: '/',\n    name: 'Login',\n    component: Login\n  },\n  {\n    path: '/home',\n    name: 'Home',\n    component: Home,\n    beforeEnter(to, from, next) {\n      if (auth.isAuthorized()) {\n        next();\n      }else{\n        next('/');\n      }\n    }\n  },\n  {\n    path: '/callback',\n    name: 'Callback',\n    component: Callback\n  },\n\n]\n\nconst router = new VueRouter({\n  mode: 'history',\n  base: process.env.BASE_URL,\n  routes\n})\n\nexport default router\n","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n    theme: {\n        dark: true,\n        themes:{\n            // Spotify green = 1DB954\n            // Spotify black = 191414\n            light: {\n                primary: '#1DB954',//'#1976D2',\n                secondary: '#424242',\n                accent: '#82B1FF',\n                error: '#FF5252',\n                info: '#2196F3',\n                success: '#1DB954',//'#4CAF50',\n                warning: '#FFC107',\n            },\n            dark: {\n                primary: '#1DB954',//'#1976D2',\n                success: '#1DB954',//'#4CAF50',\n            }\n        }\n    }\n});\n","import Vue from \"vue\";\r\nimport App from \"./App.vue\";\r\nimport router from \"./router\";\r\nimport vuetify from \"./plugins/vuetify\";\r\nimport store from \"./store\";\r\n/*import(\"./app/wasm/pkg\").then((lib) => {\r\n    console.log(`707 + 707 = ${lib.add(707, 707)}`);\r\n});*/\r\n\r\n/*let tries = 0;\r\nworker.onmessage = (event) => {\r\n    tries++;\r\n    console.log(\"Got back from worker\", JSON.stringify(event.data));\r\n    if (tries < 2) {\r\n        worker.postMessage({ message: \"Second try\", now: new Date() });\r\n    }\r\n};\r\n\r\nconsole.log(\"Sending message to worker\");\r\nworker.postMessage({ message: \"Are u awake?\", now: new Date() });\r\n*/\r\nVue.config.productionTip = false;\r\n\r\nnew Vue({\r\n    router,\r\n    vuetify,\r\n    store,\r\n    render: (h) => h(App),\r\n}).$mount(\"#app\");\r\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Player.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Player.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Visualization.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Visualization.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Login.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}