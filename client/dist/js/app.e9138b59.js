(function(e){function t(t){for(var s,r,o=t[0],c=t[1],l=t[2],u=0,h=[];u<o.length;u++)r=o[u],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&h.push(a[r][0]),a[r]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);f&&f(t);while(h.length)h.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],s=!0,r=1;r<n.length;r++){var o=n[r];0!==a[o]&&(s=!1)}s&&(i.splice(t--,1),e=l(l.s=n[0]))}return e}var s={},a={app:0},i=[];function r(e){return l.p+"js/"+({}[e]||e)+"."+{"chunk-789e6b41":"b067caa9"}[e]+".js"}var o={};var c={"8f23":function(){return{}}};function l(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.e=function(e){var t=[],n=a[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise((function(t,s){n=a[e]=[t,s]}));t.push(n[2]=s);var i,u=document.createElement("script");u.charset="utf-8",u.timeout=120,l.nc&&u.setAttribute("nonce",l.nc),u.src=r(e);var h=new Error;i=function(t){u.onerror=u.onload=null,clearTimeout(d);var n=a[e];if(0!==n){if(n){var s=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;h.message="Loading chunk "+e+" failed.\n("+s+": "+i+")",h.name="ChunkLoadError",h.type=s,h.request=i,n[1](h)}a[e]=void 0}};var d=setTimeout((function(){i({type:"timeout",target:u})}),12e4);u.onerror=u.onload=i,document.head.appendChild(u)}var f={"chunk-789e6b41":["8f23"]}[e]||[];return f.forEach((function(e){var n=o[e];if(n)t.push(n);else{var s,a=c[e](),i=fetch(l.p+""+{"8f23":"c6a751f503e9132013a5"}[e]+".module.wasm");if(a instanceof Promise&&"function"===typeof WebAssembly.compileStreaming)s=Promise.all([WebAssembly.compileStreaming(i),a]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"===typeof WebAssembly.instantiateStreaming)s=WebAssembly.instantiateStreaming(i,a);else{var r=i.then((function(e){return e.arrayBuffer()}));s=r.then((function(e){return WebAssembly.instantiate(e,a)}))}t.push(o[e]=s.then((function(t){return l.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},l.m=e,l.c=s,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)l.d(n,s,function(t){return e[t]}.bind(null,s));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/",l.oe=function(e){throw console.error(e),e},l.w={};var u=this["webpackJsonp"]=this["webpackJsonp"]||[],h=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var f=h;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var s=n("85ec"),a=n.n(s);a.a},"1aec":function(e,t,n){"use strict";var s=n("d917"),a=n.n(s);a.a},"2f67":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("d3b7"),n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{attrs:{id:"app",dark:!0}},[n("router-view")],1)},i=[],r={name:"App",components:{},beforeCreate:function(){window.onSpotifyWebPlaybackSDKReady=function(){console.log("The Web Playback SDK is ready. We have access to Spotify.Player"),console.log(window.Spotify.Player)}},data:function(){return{}},mounted:function(){var e=document.getElementsByTagName("html")[0];e.style.overflowY="auto"},destroyed:function(){var e=document.getElementsByTagName("html")[0];e.style.overflowY=null}},o=r,c=(n("034f"),n("2877")),l=n("6544"),u=n.n(l),h=n("7496"),d=Object(c["a"])(o,a,i,!1,null,null,null),f=d.exports;u()(d,{VApp:h["a"]});var m=n("8c4f"),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("v-app-bar",{attrs:{dark:""}},[n("v-toolbar-title",[e._v("Music Structure Visualizer")]),n("v-spacer"),n("form",{on:{submit:function(t){return t.preventDefault(),e.search(t)}}},[n("v-text-field",{attrs:{"hide-details":"","append-icon":"mdi-magnify","single-line":"",rounded:"",dense:"",filled:""},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}})],1),n("div",{staticClass:"volumeSlider"},[n("v-container",[n("v-slider",{attrs:{"prepend-icon":e.getVolumeIcon(e.volume),min:0,max:1,step:.02},on:{"click:prepend":e.clickVolume},model:{value:e.volume,callback:function(t){e.volume=t},expression:"volume"}})],1)],1),n("v-btn",{attrs:{icon:""}},[n("v-icon",[e._v("mdi-heart")])],1),n("v-btn",{attrs:{icon:""}},[n("v-icon",[e._v("mdi-dots-vertical")])],1)],1),n("TrackSelector",{attrs:{tracks:e.trackList,"album-size":120}}),n("Player",{attrs:{padding:e.padding}}),n("Visualization",{attrs:{padding:e.padding}})],1)},p=[],v=(n("b0c0"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-slide-group",{staticClass:"pt-2",attrs:{"center-active":"",mandatory:""},nativeOn:{scroll:function(t){return e.onScroll(t)}},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.tracks,(function(t,s){return n("v-slide-item",{key:s,staticClass:"mx-2 my-1",scopedSlots:e._u([{key:"default",fn:function(s){var a=s.active,i=s.toggle;return[n("Album",{attrs:{album:t.trackData,imgSize:a?1.5*e.albumSize:e.albumSize,active:a},on:{clicked:i}})]}}],null,!0)})})),1)],1)}),y=[],b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",{class:e.active?"elevation-3":"elevation-0",style:e.cardStyle},[n("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"track",on:{click:e.clicked}},[n("v-img",{attrs:{height:e.imgSize,width:e.imgSize,src:e.album.album.images[e.imgIndex].url}}),n("v-card-text",{staticClass:"pl-2 py-0 pt-1 ml-0 my-0"},[n("div",{staticClass:"text-subtitle-2 text--primary text-truncate "},[e._v(e._s(e.album.name))])])],1),n("v-card-actions",{staticClass:"pl-0 py-0 ml-0 my-0"},[n("v-btn",{staticClass:"artistButton",attrs:{text:"",color:"grey",small:""}},[n("span",{staticClass:"artistButtonText text-caption text-truncate",style:{"max-width":this.imgSize-12+"px"}},[e._v(" "+e._s(e.album.artists[0].name)+" ")])])],1)],1)},k=[],w={props:["album","imgSize","active"],data:function(){return{}},mounted:function(){},computed:{imgIndex:function(){return this.size<=this.album.album.images[2].height?2:this.size<=this.album.album.images[1].height?1:0},cardStyle:function(){return{width:this.imgSize+"px",height:this.imgSize+55+"px"}}},methods:{clicked:function(){this.$emit("clicked")}}},S=w,x=(n("8ade"),n("8336")),T=n("b0af"),C=n("99d9"),R=n("adda"),A=n("269a"),O=n.n(A),_=n("5607"),j=Object(c["a"])(S,b,k,!1,null,null,null),E=j.exports;u()(j,{VBtn:x["a"],VCard:T["a"],VCardActions:C["a"],VCardText:C["c"],VImg:R["a"]}),O()(j,{Ripple:_["a"]});n("4160"),n("a630"),n("4ec9"),n("ac1f"),n("3ca3"),n("841c"),n("159b"),n("ddb0");var P,V,M=n("a34a"),F=n.n(M),D=(n("96cf"),n("1da1")),L=n("be8d"),I=(n("25f0"),n("bc3a")),B=n.n(I),W="https://music-structure.herokuapp.com/api",$=B.a.create({baseURL:W,withCredentials:!1});function z(e){return N.apply(this,arguments)}function N(){return N=Object(D["a"])(F.a.mark((function e(t){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,$.post("spotify/token",{code:t}).then((function(e){P=e.data.access_token,window.sessionStorage.setItem("token",P),e.data.expires_in,window.sessionStorage.setItem("tokenTimestamp",(new Date).getTime().toString()),V=e.data.expires_in,window.sessionStorage.setItem("refreshToken",V)})).catch((function(e){console.log(e)}));case 2:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}function U(){if(void 0===P){var e=window.sessionStorage.getItem("token");window.sessionStorage.getItem("tokenTimestamp"),window.sessionStorage.getItem("refreshToken");return!!e&&(P=e,!0)}return!0}n("cb29"),n("d81d");var H=n("d4ec"),G=n("bee2"),Y=n("ade3"),q=(n("99af"),n("3835")),K=n("5698"),X=[0,7,2,9,4,11,6,1,8,3,10,5],J=K.scaleLinear().domain([0,1/12,2/12,2.8/12,3.8/12,4.3/12,5.3/12,6.8/12,8/12,8.8/12,.775,.875,1]).interpolate(K.interpolateHcl).range([K.rgb("#FE0000"),K.rgb("#FF7300"),K.rgb("#FFAA01"),K.rgb("#FFD300"),K.rgb("#FFFF01"),K.rgb("#9FEE00"),K.rgb("#01CC00"),K.rgb("#009899"),K.rgb("#1241AB"),K.rgb("#3914B1"),K.rgb("#7209AC"),K.rgb("#CD0174"),K.rgb("#FE0000")]);Math.PI,Math.PI;var Q=2*Math.PI,Z=3*Math.PI/2;function ee(e){for(var t=0,n=0,s=0,a=0;a<12;a++){var i=-X[a]/12*Q+Z,r=e[a];s+=r/12,t+=r*Math.cos(i),n+=r*Math.sin(i)}var o=(Math.atan2(t,n)+Math.PI)/Q,c=Math.sqrt(t*t+n*n);return[o,c,s]}function te(e){var t=ee(e),n=Object(q["a"])(t,3),s=n[0],a=n[1],i=n[2],r=K.hsl(J(s)),o=Math.min(3*a/(12*i),1);return r.s=o,r.hex()}function ne(e){var t=Math.max(0,60+e)/60;return t*t}var se=function(){function e(t){Object(H["a"])(this,e),Object(Y["a"])(this,"segment",null),Object(Y["a"])(this,"start",0),Object(Y["a"])(this,"duration",0),Object(Y["a"])(this,"loudness_start",0),Object(Y["a"])(this,"loudness_max_time",0),Object(Y["a"])(this,"loudness_max",0),Object(Y["a"])(this,"loudness_end",0),Object(Y["a"])(this,"pitches",[]),Object(Y["a"])(this,"pitchesTransposed",[]),Object(Y["a"])(this,"timbres",[]),Object(Y["a"])(this,"timbresScaled",[]),Object(Y["a"])(this,"cluster",-1),Object(Y["a"])(this,"tsneCoord",[0,0]),Object(Y["a"])(this,"tonalityAngle",0),Object(Y["a"])(this,"tonalityRadius",0),Object(Y["a"])(this,"tonalityEnergy",0),Object(Y["a"])(this,"percussiony",0),Object(Y["a"])(this,"processedPitch",!1),Object(Y["a"])(this,"processedPitchSmooth",!1),Object(Y["a"])(this,"processedTimbre",!1),this.segment=t,this.start=t.start,this.duration=t.duration,this.loudness_start=t.loudness_start,this.loudness_max=t.loudness_max,this.loudness_max_time=t.loudness_max_time,this.loudness_end=t.loudness_end}return Object(G["a"])(e,[{key:"processPitch",value:function(){var e=this;if(!this.processedPitch){if(this.processedPitchSmooth)throw Error("processed pitchSmooth before setting initial pitch");this.segment.pitches.forEach((function(t,n){e.pitches.push(t)}));var t=ee(this.pitches),n=Object(q["a"])(t,3);this.tonalityAngle=n[0],this.tonalityRadius=n[1],this.tonalityEnergy=n[2];var s=.2,a=.5,i=this.duration<s?1:a-(this.duration-.15);this.percussiony=Math.min(1,(1-this.tonalityRadius)*this.tonalityEnergy*2)*i,this.calculateTransposedPitches(),this.processedPitch=!0}}},{key:"processPitchSmooth",value:function(e,t){if(!this.processedPitchSmooth){if(!this.processedPitch)throw Error("processed pitchSmooth called before setting initial pitch");for(var n=0;n<this.pitches.length;n++)this.pitches[n]=(1-this.percussiony)*this.pitches[n]+this.percussiony*(e.pitches[n]+t.pitches[n])/2;this.processedPitchSmooth=!0}}},{key:"processTimbre",value:function(e,t,n,s){var a=this;this.processedTimbre||(this.segment.timbre.forEach((function(e,t){a.timbres.push(e/s)})),this.segment.timbre.forEach((function(e,t){a.timbresScaled.push(e/n[t])})),this.processedTimbre=!0)}},{key:"calculateTransposedPitches",value:function(){for(var e=0;e<12;e++){this.pitchesTransposed.push(new Array(12));for(var t=0;t<12;t++)this.pitchesTransposed[e][t]=this.pitches[(t+e)%12]}}},{key:"getPitches",value:function(){return this.pitches}},{key:"getTimbres",value:function(){return this.timbres}},{key:"getDuration",value:function(){return this.duration_ms}},{key:"getStart",value:function(){return this.start}},{key:"getOriginalTimbres",value:function(){return this.segment.timbre}},{key:"getFeatures",value:function(){return this.pitches.concat(this.timbres)}},{key:"setCluster",value:function(e){this.cluster=e}},{key:"setTSNECoord",value:function(e){this.tsneCoord=e}},{key:"getTonalEnergy",value:function(){return this.tonalityEnergy}},{key:"getTonalAngle",value:function(){return this.tonalityAngle}},{key:"getLoudnessFeatures",value:function(){return[ne(this.loudness_start),ne(this.loudness_max),this.loudness_max_time,ne(this.loudness_end)]}}]),e}();function ae(e,t){return Math.sqrt(ie(e,t))}function ie(e,t){for(var n=0,s=0;s<e.length;s++){var a=e[s]-t[s];n+=a*a}return n}var re,oe,ce,le,ue,he,de=n("929f"),fe=function(){return new Worker(n.p+"js/tsneWorker.2a61cec0.worker.js")},me=function(e){return oe.postMessage({type:"message",message:e})},ge=function(e){return oe.register(e)},pe=function(){re.terminate(),re=new fe,oe=new de["a"](re)},ve=function(){re=new fe({synchronizedStdio:!1}),oe=new de["a"](re)},ye={init:ve,send:me,receive:ge,terminate:pe},be=function(){return new Worker(n.p+"js/ssmWorker.e9d1c040.worker.js")},ke=function(e){return le.postMessage({type:"message",message:e})},we=function(e){return le.register(e)},Se=function(){ce.terminate(),ce=new be,le=new de["a"](ce)},xe=function(){ce=new be({synchronizedStdio:!1}),le=new de["a"](ce)},Te={init:xe,send:ke,receive:we,terminate:Se},Ce=function(){return new Worker(n.p+"js/clusterWorker.7a2f486b.worker.js")},Re=function(e){return he.postMessage({type:"message",message:e})},Ae=function(e){return he.register(e)},Oe=function(){ue.terminate(),ue=new Ce,he=new de["a"](ue)},_e=function(){ue=new Ce({synchronizedStdio:!1}),he=new de["a"](ue)},je={init:_e,send:Re,receive:Ae,terminate:Oe},Ee=(n("a434"),n("2f62"));s["a"].use(Ee["a"]);var Pe=new Ee["a"].Store({state:{user:Object,trackList:[],selectedIndex:-1,seeker:0,playerState:null,loadingTrack:!0,playerReady:!1,playing:!1,tsneReady:!1,ssmReady:!1,clusterReady:!1},mutations:{setSeeker:function(e,t){e.seeker=t},setUser:function(e,t){console.log("setting user to",t),e.user=t},setPlayerState:function(e,t){e.playerState=t},loadingTrack:function(e,t){e.loadingTrack=t},playerReady:function(e,t){e.playerReady=t},addToTrackList:function(e,t){e.trackList.push(t)},addToTrackListIndex:function(e,t,n){e.trackList.splice(t,0,n)},addToTrackListFront:function(e,t){e.trackList.unshift(t)},clearTrackList:function(e){e.trackList=[]},setSelectedIndex:function(e,t){e.selectedIndex=t},setPlaying:function(e,t){e.playing=t},incrementSeeker:function(e,t){e.seeker+=t},tsneReady:function(e,t){e.tsneReady=t},clusterReady:function(e,t){e.clusterReady=t},ssmReady:function(e,t){e.ssmReady=t}},actions:{},getters:{seeker:function(e){return e.seeker},selectedIndex:function(e){return e.selectedIndex},selectedTrack:function(e){return e.trackList[e.selectedIndex]},user:function(e){return e.user},track:function(e,t){return e.trackList[t]},trackList:function(e){return e.trackList},playerState:function(e){return e.playerState},playing:function(e){return e.playing},tsneReady:function(e){return e.tsneReady},clusterReady:function(e){return e.clusterReady},ssmReady:function(e){return e.ssmReady}},modules:{}}),Ve=n("2909"),Me=function(){function e(t,n,s){Object(H["a"])(this,e),Object(Y["a"])(this,"timbreMax",new Array(12).fill(0)),Object(Y["a"])(this,"timbreMin",new Array(12).fill(0)),Object(Y["a"])(this,"timbreBiggest",new Array(12).fill(0)),Object(Y["a"])(this,"timbreTotalBiggest",0),Object(Y["a"])(this,"segments",void 0),Object(Y["a"])(this,"raw",{pitches:[],timbres:[],loudness:[]}),Object(Y["a"])(this,"processed",{pitches:[],timbres:[],loudness:[],tonalEnergy:[],tonalRadius:[],tonalAngle:[]}),Object(Y["a"])(this,"clusterSelection",[]),Object(Y["a"])(this,"tsneSelection",[]),Object(Y["a"])(this,"sampleDuration",0),Object(Y["a"])(this,"sampleAmount",0),Object(Y["a"])(this,"sampled",{}),this.segments=t,this.sampleDuration=1/n,this.duration=s,this.sampleAmount=Math.ceil(s/n),console.log("Sample amount:",this.sampleAmount),this.calculateMaxMin(),this.processSegments(),this.sampleFeatures()}return Object(G["a"])(e,[{key:"calculateMaxMin",value:function(){var e=this;this.segments.forEach((function(t,n){for(var s=0;s<12;s++)e.timbreMax[s]=Math.max(e.timbreMax[s],t.getOriginalTimbres()[s]),e.timbreMin[s]=Math.min(e.timbreMin[s],t.getOriginalTimbres()[s])}));for(var t=0;t<12;t++)this.timbreBiggest[t]=Math.max(Math.abs(this.timbreMax[t]),Math.abs(this.timbreMin[t])),this.timbreTotalBiggest=Math.max(this.timbreTotalBiggest,this.timbreBiggest[t])}},{key:"processSegments",value:function(){var e=this;this.segments.forEach((function(t,n){e.raw.pitches=t.segment.pitches,e.raw.timbres=t.segment.timbres,e.raw.loudness=t.getLoudnessFeatures(),t.processPitch(),t.processTimbre(e.timbreMin,e.timbreMax,e.timbreBiggest,e.timbreTotalBiggest),e.processed.pitches.push(t.pitches),e.processed.timbres.push(t.timbres),e.processed.tonalEnergy.push(t.tonalityEnergy),e.processed.tonalRadius.push(t.tonalityRadius),e.processed.tonalAngle.push(t.tonalityAngle),e.processed.loudness.push(t.getLoudnessFeatures())}));for(var t=0;t<this.segments.length;t++)t>0&&t<this.segments.length-1&&this.segments[t].processPitchSmooth(this.segments[t-1],this.segments[t+1]),this.clusterSelection.push([].concat(Object(Ve["a"])(this.processed.timbres[t]),[this.processed.tonalEnergy[t],this.processed.tonalRadius[t]],Object(Ve["a"])(this.processed.loudness[t]))),this.tsneSelection.push([].concat(Object(Ve["a"])(this.processed.timbres[t]),[this.processed.tonalEnergy[t],this.processed.tonalRadius[t]],Object(Ve["a"])(this.processed.loudness[t])))}},{key:"sampleFeatures",value:function(){console.log("sampling features");var e=0,t=this.sampleDuration;this.initSampleFeatures();for(var n=0;n<this.segments.length;n++){var s=this.segments[n],a=s.duration;if(this.addFeaturesScaled(e,n,a),a>t){if(this.addFeaturesScaled(e,n,t),this.divideFeatures(e,this.sampleDuration-t),e+1>=this.sampleAmount)break;e++;var i=a-t;this.addFeaturesScaled(e,n,i),t=this.sampleDuration-i}else this.setFeaturesScaled(e,n,a),t-=a}this.divideFeatures(e,this.sampleDuration-t)}},{key:"initSampleFeatures",value:function(){for(var e in this.processed)if(this.sampled[e]=new Array(this.sampleAmount).fill(0),this.processed[e][0].length)for(var t=0;t<this.sampleAmount;t++)this.sampled[e][t]=new Array(this.processed[e][0].length).fill(0)}},{key:"setFeaturesScaled",value:function(e,t,n){for(var s in this.processed)if(this.processed[s][e].length)for(var a=0;a<this.processed[s][e].length;a++)this.sampled[s][e][a]=this.processed[s][t][a]*n;else this.sampled[s][e]=this.processed[s][t]*n}},{key:"addFeaturesScaled",value:function(e,t,n){for(var s in this.processed)if(this.processed[s][e].length)for(var a=0;a<this.processed[s][e].length;a++)this.sampled[s][e][a]+=this.processed[s][t][a]*n;else this.sampled[s][e]+=this.processed[s][t]*n}},{key:"divideFeatures",value:function(e,t){for(var n in this.sampled)if(this.sampled[n][e].length)for(var s=0;s<this.sampled[n][e].length;s++)this.sampled[n][e][s]/=t;else this.sampled[n][e]/=t}}]),e}(),Fe=10,De=function(){function e(t){Object(H["a"])(this,e),Object(Y["a"])(this,"trackData",null),Object(Y["a"])(this,"analysisData",null),Object(Y["a"])(this,"segments",[]),Object(Y["a"])(this,"ssm",null),Object(Y["a"])(this,"features",void 0),Object(Y["a"])(this,"processed",!1),Object(Y["a"])(this,"clusters",new Array(Fe).fill([])),this.trackData=t}return Object(G["a"])(e,[{key:"process",value:function(){this.createSegmentObjects(),this.features=new Me(this.segments,1,this.getAnalysisDuration()),this.tsne(),this.cluster(),this.calculateSSM(),this.processed=!0}},{key:"createSegmentObjects",value:function(){var e=this;console.log("Creating segmentObjects"),this.analysisData.segments.forEach((function(t){e.segments.push(new se(t))})),console.log("Created segmentObjects")}},{key:"calculateSSM",value:function(){console.log("starting SSMWorker"),Pe.commit("ssmReady",!1),Te.terminate();var e=this;Te.send({segmentObjects:this.segments,timeStamp:new Date}).then((function(t){e.ssm=t,Pe.commit("ssmReady",!0),console.log("ssm Done")}))}},{key:"cluster",value:function(){var e=this;console.log("starting Clusterworker"),je.terminate(),je.send({features:this.features.clusterSelection,minK:2,maxK:10,tries:4}).then((function(t){e.updateClusters(t),console.log("clustering done")}))}},{key:"updateClusters",value:function(e){var t=this;Pe.commit("clusterReady",!1),e.forEach((function(e,n){t.segments[n].setCluster(e),t.clusters[e].push(t.segments[n])})),window.setTimeout(Pe.commit("clusterReady",!0),1)}},{key:"tsne",value:function(){var e=this;console.log("starting tsneWorker"),ye.terminate(),ye.send({features:this.features.tsneSelection}).then((function(t){e.updateTSNECoords(t)})),ye.receive((function(t){e.updateTSNECoords(t)}))}},{key:"updateTSNECoords",value:function(e){Pe.commit("tsneReady",!1);for(var t=0;t<this.segments.length;t++)this.segments[t].setTSNECoord(e[t]);window.setTimeout(Pe.commit("tsneReady",!0),1)}},{key:"getClosestSegment",value:function(e){var t=1/0,n=null;return this.segments.forEach((function(s){var a=ae(e,s.tsneCoord);a<t&&(t=a,n=s)})),n}}]),Object(G["a"])(e,[{key:"toJSON",value:function(){return{trackData:this.trackData,analysisData:this.analysisData}}},{key:"getId",value:function(){return this.trackData.id}},{key:"hasAnalysis",value:function(){return null!==this.analysisData&&this.segments.length>0}},{key:"getAnalysis",value:function(){return this.analysisData}},{key:"setAnalysis",value:function(e){this.processed||(this.analysisData=e,console.log("processing"),this.process(),console.log("processed"))}},{key:"getName",value:function(){return this.trackData.name}},{key:"getArtist",value:function(){return this.trackData.artist}},{key:"getUri",value:function(){return this.trackData.uri}},{key:"getSegments",value:function(){return this.segments}},{key:"getSegment",value:function(e){return this.segments[e]}},{key:"getSSM",value:function(){return this.ssm}},{key:"getSSMValue",value:function(e,t){return this.ssm[e][e-t]}},{key:"getBars",value:function(){return this.analysisData.bars}},{key:"getBeats",value:function(){return this.analysisData.beats}},{key:"getTatums",value:function(){return this.analysisData.tatums}},{key:"getProcessedPitch",value:function(e){return this.segments[e].getPitches()}},{key:"getProcessedPitches",value:function(){return this.segments.map((function(e){return e.getPitches()}))}},{key:"getProcessedTimbre",value:function(e){return this.segments[e].getTimbres()}},{key:"getProcessedTimbres",value:function(){return this.segments.map((function(e){return e.getTimbres()}))}},{key:"getAnalysisDuration",value:function(){return this.analysisData.track.duration}}],[{key:"createWithAnalysis",value:function(t,n){var s=new e(t);return s.setAnalysis(n),s}},{key:"fromJSON",value:function(e){return this.createWithAnalysis(e.trackData,e.analysisData)}},{key:"initWorkers",value:function(){ye.init(),Te.init(),je.init()}}]),e}(),Le=new L,Ie=new Map;function Be(){return We.apply(this,arguments)}function We(){return We=Object(D["a"])(F.a.mark((function e(){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:De.initWorkers(),console.log("Got tracks from local storage: ",Ie),Le.setAccessToken(P),Le.getMe().then((function(e){Pe.commit("setUser",e)})).catch((function(e){Dn.push("/")})),Le.getMyTopTracks({limit:50,offset:0}).then((function(e){Ne(e.items,!1),$e(0)})).catch((function(e){return console.log(e)}));case 5:case"end":return e.stop()}}),e)}))),We.apply(this,arguments)}function $e(e){return ze.apply(this,arguments)}function ze(){return ze=Object(D["a"])(F.a.mark((function e(t){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return Pe.commit("loadingTrack",!0),Pe.commit("tsneReady",!1),Pe.commit("clusterReady",!1),Pe.commit("ssmReady",!1),e.abrupt("return",Ue(Pe.getters.trackList[t]).then((function(){console.log("Getting analysis and everything done, now setting selected index"),Pe.commit("loadingTrack",!1),Pe.commit("setSelectedIndex",t)})));case 5:case"end":return e.stop()}}),e)}))),ze.apply(this,arguments)}function Ne(e,t){var n=Pe.getters.selectedTrack;Pe.commit("clearTrackList"),e.forEach((function(e){if(Ie.has(e.id))Pe.commit("addToTrackList",Ie.get(e.id));else{var t=new De(e);Ie.set(e.id,t),Pe.commit("addToTrackList",t)}})),t?(Pe.commit("addToTrackListFront",n),Pe.commit("setSelectedIndex",0)):$e(0)}function Ue(e){return He.apply(this,arguments)}function He(){return He=Object(D["a"])(F.a.mark((function e(t){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.hasAnalysis()){e.next=2;break}return e.abrupt("return",t.getAnalysis());case 2:return e.abrupt("return",Le.getAudioAnalysisForTrack(t.getId()).then((function(e){console.log("Got analysis from api"),t.setAnalysis(e),console.log("Track has done everything with analysis")})).catch((function(e){console.log(e)})));case 3:case"end":return e.stop()}}),e)}))),He.apply(this,arguments)}function Ge(e){return Ye.apply(this,arguments)}function Ye(){return Ye=Object(D["a"])(F.a.mark((function e(t){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Le.search(t,["track"]).then((function(e){Ne(e.tracks.items,!0)})).catch((function(e){console.log(e)}));case 1:case"end":return e.stop()}}),e)}))),Ye.apply(this,arguments)}var qe={name:"TrackSelector",props:["tracks","albumSize"],components:{Album:E},data:function(){return{selected:0}},computed:{selectedFromStore:function(){return this.$store.getters.selectedIndex}},watch:{selected:"selectedChanged",selectedFromStore:"selectedFromStoreChanged"},mounted:function(){},methods:{selectedChanged:function(e,t){$e(e)},selectedFromStoreChanged:function(e,t){this.selected=e}}},Ke=qe,Xe=n("7efd"),Je=n("9dbe"),Qe=Object(c["a"])(Ke,v,y,!1,null,null,null),Ze=Qe.exports;u()(Qe,{VSlideGroup:Xe["a"],VSlideItem:Je["a"]});var et,tt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"d-flex pa-2"},[n("v-row",[n("v-layout",{staticClass:"ml-10"},[n("v-switch",{staticClass:"mx-5",attrs:{label:"Raw Pitch Data","hide-details":""},model:{value:e.canvasVis.rawPitch.draw,callback:function(t){e.$set(e.canvasVis.rawPitch,"draw",t)},expression:"canvasVis.rawPitch.draw"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Raw Timbre Data","hide-details":""},model:{value:e.canvasVis.rawTimbre.draw,callback:function(t){e.$set(e.canvasVis.rawTimbre,"draw",t)},expression:"canvasVis.rawTimbre.draw"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Rhythm Data","hide-details":""},model:{value:e.canvasVis.rawRhythm.draw,callback:function(t){e.$set(e.canvasVis.rawRhythm,"draw",t)},expression:"canvasVis.rawRhythm.draw"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Tonality","hide-details":""},model:{value:e.canvasVis.tonality.draw,callback:function(t){e.$set(e.canvasVis.tonality,"draw",t)},expression:"canvasVis.tonality.draw"}}),n("v-switch",{staticClass:"mx-5",attrs:{label:"Similarity Matrix","hide-details":""},model:{value:e.canvasVis.ssm.draw,callback:function(t){e.$set(e.canvasVis.ssm,"draw",t)},expression:"canvasVis.ssm.draw"}})],1),n("v-spacer"),n("v-btn",{staticClass:"mr-10",attrs:{color:"primary",fab:"",dark:"",small:""},on:{click:e.zoom}},[n("v-icon",[e._v("mdi-magnify-plus-outline")])],1)],1)],1),n("div",{staticClass:"vis",on:{click:e.clickedVis}},[e.loadingTrack?e._e():n("svg",{staticClass:"visSeeker"},[n("rect",{attrs:{x:this.zoomed?this.padding+this.canvasWidth/2:e.padding+this.seeker/1e3*e.scale-1,y:0,width:2,height:e.canvasHeight,fill:"#ffffff",opacity:.5}})]),n("canvas",{directives:[{name:"show",rawName:"v-show",value:!e.loadingTrack,expression:"!loadingTrack"}],ref:"visCanvas",staticClass:"visCanvas pa-0 ma-0",attrs:{id:"visCanvas"}}),n("canvas",{staticClass:"visCanvas pa-0 ma-0",attrs:{id:"gl-canvas"}})])])},nt=[],st=(n("4fad"),n("5698")),at=null,it=!1,rt="",ot=0,ct=null;function lt(e,t){return ut.apply(this,arguments)}function ut(){return ut=Object(D["a"])(F.a.mark((function e(t,n){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:rt=t,ot=n;case 2:case"end":return e.stop()}}),e)}))),ut.apply(this,arguments)}function ht(e){return dt.apply(this,arguments)}function dt(){return dt=Object(D["a"])(F.a.mark((function e(t){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!at){e.next=7;break}if(!it||""!==rt){e.next=6;break}return gt(t),e.abrupt("return",et.resume().then((function(){Pe.commit("setPlaying",!0)})).catch((function(e){console.log(e)})));case 6:return e.abrupt("return",Le.play({device_id:at,uris:[rt],position_ms:t||ot}).then((function(){it=!0,rt,rt="",ot=0,Pe.commit("setPlaying",!0)})).catch((function(e){console.log(e)})));case 7:case"end":return e.stop()}}),e)}))),dt.apply(this,arguments)}function ft(){return mt.apply(this,arguments)}function mt(){return mt=Object(D["a"])(F.a.mark((function e(){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!at||!it){e.next=2;break}return e.abrupt("return",et.pause().then((function(){Pe.commit("setPlaying",!1)})).catch((function(e){console.log(e)})));case 2:case"end":return e.stop()}}),e)}))),mt.apply(this,arguments)}function gt(e){return pt.apply(this,arguments)}function pt(){return pt=Object(D["a"])(F.a.mark((function e(t){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!at||!it){e.next=2;break}return e.abrupt("return",et.seek(t).catch((function(e){console.log(e)})));case 2:case"end":return e.stop()}}),e)}))),pt.apply(this,arguments)}function vt(e){return yt.apply(this,arguments)}function yt(){return yt=Object(D["a"])(F.a.mark((function e(t){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("playing segment",t),ht(1e3*t.start).then((function(){ct=t,window.setTimeout((function(){ct===t&&ft()}),1e3*t.duration)}));case 2:case"end":return e.stop()}}),e)}))),yt.apply(this,arguments)}function bt(){return kt.apply(this,arguments)}function kt(){return kt=Object(D["a"])(F.a.mark((function e(){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n=new Date,s=setInterval((function(){null!==at?(console.log("resolved after",new Date-n,"ms"),clearInterval(s),e()):new Date-n>1e4&&(console.log("rejected after",new Date-n,"ms"),clearInterval(s),t())}),20)})));case 1:case"end":return e.stop()}}),e)}))),kt.apply(this,arguments)}function wt(e){et&&et.setVolume(e)}function St(){return xt.apply(this,arguments)}function xt(){return xt=Object(D["a"])(F.a.mark((function e(){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("waiting"),e.abrupt("return",new Promise((function(e){window.Spotify?e(window.Spotify):window.onSpotifyWebPlaybackSDKReady=function(){e(window.Spotify)}})));case 2:case"end":return e.stop()}}),e)}))),xt.apply(this,arguments)}function Tt(e,t){return Ct.apply(this,arguments)}function Ct(){return Ct=Object(D["a"])(F.a.mark((function e(t,n){return F.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:St().then((function(){et=new window.Spotify.Player({name:"Music Structure Visualizer",getOAuthToken:function(e){e(t)},volume:.5}),et.addListener("initialization_error",(function(e){var t=e.message;console.error(t)})),et.addListener("authentication_error",(function(e){var t=e.message;console.error(t)})),et.addListener("account_error",(function(e){var t=e.message;console.error(t)})),et.addListener("playback_error",(function(e){var t=e.message;console.error(t)})),et.addListener("player_state_changed",(function(e){var t=e.position,s=e.duration,a=e.track_window.current_track;n({current_track:a,position:t,duration:s})})),et.addListener("ready",(function(e){var t=e.device_id;at=t,console.log("Ready with Device ID",t)})),et.addListener("not_ready",(function(e){var t=e.device_id;console.log("Device ID has gone offline",t)})),et.connect().then((function(){console.log("Connected succesfully!!!")})).catch((function(e){console.log("Could not connect")}))}));case 1:case"end":return e.stop()}}),e)}))),Ct.apply(this,arguments)}var Rt=st["scaleSequential"]().domain([0,1]).interpolator(st["interpolateViridis"]),At=Rt,Ot=st["scaleSequential"]().domain([1,0]).interpolator(st["interpolateGreys"]),_t=st["scaleSequential"]().domain([-1,1]).interpolator(st["interpolateViridis"]),jt=st["scaleSequential"]().domain([0,11]).interpolator(st["interpolateRainbow"]),Et=st["scaleDiverging"]().domain([-1,0,1]).interpolator(st["interpolateRdBu"]);function Pt(e,t,n,s,a,i){var r=n/e.getAnalysis().track.duration;e.getSegments().forEach((function(e){for(var n=0;n<12;n++){var o=t+e.start*r,c=a/12-2,l=s+(11-n)*(c+2),u=e.duration*r;i.fillStyle=At(e.segment.pitches[n]),i.fillRect(o,l,u,c)}}))}function Vt(e,t,n,s,a,i){var r=n/e.getAnalysis().track.duration;e.getSegments().forEach((function(e,n){var o=t+e.start*r,c=a/3-2,l=s+0*(c+2),u=e.duration*r;i.fillStyle=At(2*e.tonalityEnergy-.5),i.fillRect(o,l,u,c),l=s+1*(c+2),i.fillStyle=At(1-e.tonalityRadius),i.fillRect(o,l,u,c),l=s+2*(c+2),i.fillStyle=e.duration>.15?At(0):At(e.percussiony),i.fillRect(o,l,u,c)}))}function Mt(e,t,n,s,a,i){var r=n/e.getAnalysis().track.duration;e.getSegments().forEach((function(n,o){for(var c=0;c<12;c++){var l=t+n.start*r,u=a/12-2,h=s+(11-c)*(u+2),d=n.duration*r;i.fillStyle=Et(e.getProcessedTimbre(o)[c]),i.fillRect(l,h,d,u)}}))}function Ft(e,t,n,s,a,i){var r=n/e.getAnalysis().track.duration;e.getBars().forEach((function(e){var n=t+e.start*r,o=s;i.fillStyle=Ot(.3+e.confidence),i.fillRect(n,o,1,a/3)})),e.getBeats().forEach((function(e){var n=t+e.start*r,o=s+a/3;i.fillStyle=Ot(.3+e.confidence),i.fillRect(n,o,1,a/3)})),e.getTatums().forEach((function(e){var n=t+e.start*r,o=s+a/3*2;i.fillStyle=Ot(.3+e.confidence),i.fillRect(n,o,1,a/3)}))}function Dt(e,t,n,s,a,i){var r=n/e.getAnalysis().track.duration;e.getSegments().forEach((function(e){var n=t+e.start*r,o=a,c=s,l=e.duration*r;i.fillStyle=te(e.pitches),i.fillRect(n,c,l,o)}))}function Lt(e,t,n,s,a,i){console.log("Rendering ssm...");for(var r=a/e.getAnalysis().track.duration,o=e.getSegments().length,c=0;c<o;c++)for(var l=c;l<o;l++){var u=e.getSegment(c),h=e.getSegment(l),d=e.getSSM()[c][l-c][0];i.fillStyle=Ot(Math.pow(d,4));var f=t+u.start*r,m=u.duration*r,g=s+h.start*r,p=h.duration*r;if(!p)return;i.fillRect(f,g,m,p);var v=e.getSSM()[c][l-c][1];i.fillStyle=Ot(Math.pow(v,5)),i.fillRect(g+t-s,f-t+s,p,m)}}n("a15b"),n("cfc3"),n("84c3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7");var It,Bt,Wt=0;function $t(e){It=e.getContext("webgl2"),It||(console.log("WebGL not supported, falling back on experimental WebGL"),It=e.getContext("experimental-webgl2"),It||alert("Your browser does not support WebGL")),It.clearColor(.2,.2,.2,1),It.clear(It.COLOR_BUFFER_BIT|It.DEPTH_BUFFER_BIT);var t=It.createShader(It.VERTEX_SHADER),n=It.createShader(It.FRAGMENT_SHADER);if(It.shaderSource(t,Ht),It.shaderSource(n,Gt),It.compileShader(t),It.getShaderParameter(t,It.COMPILE_STATUS))if(It.compileShader(n),It.getShaderParameter(n,It.COMPILE_STATUS))if(Bt=It.createProgram(),It.attachShader(Bt,t),It.attachShader(Bt,n),It.linkProgram(Bt),It.getProgramParameter(Bt,It.LINK_STATUS))if(It.validateProgram(Bt),It.getProgramParameter(Bt,It.VALIDATE_STATUS)){for(var s=10,a=[],i=0;i<s;i++){for(var r=0;r<s;r++)a.push(.1*r,.1*i,(i*s+r)/(s*s));a.push(.1*s,.1*i,0)}for(var o=0;o<s;o++)a.push(.1*o,.1*s,0);a.push(.1*s,.1*s,0);for(var c=[],l=0;l<s;l++)for(var u=0;u<s;u++){var h=l*(s+1)+u,d=(l+1)*(s+1)+u;c.push(d,d+1,h),c.push(d+1,h+1,h)}var f=It.createBuffer();It.bindBuffer(It.ELEMENT_ARRAY_BUFFER,f),It.bufferData(It.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),It.STATIC_DRAW);var m=It.createBuffer();It.bindBuffer(It.ARRAY_BUFFER,m),It.bufferData(It.ARRAY_BUFFER,new Float32Array(a),It.STATIC_DRAW);var g=It.getAttribLocation(Bt,"vert");It.vertexAttribPointer(g,3,It.FLOAT,It.FALSE,3*Float32Array.BYTES_PER_ELEMENT,0),It.enableVertexAttribArray(g),Wt=s*s*6}else console.error("ERROR validating program!",It.getProgramInfoLog(Bt));else console.error("ERROR linking program!",It.getProgramInfoLof(Bt));else console.error("ERROR compiling fragment shader!",It.getShaderInfoLog(n));else console.error("ERROR compiling vertex shader!",It.getShaderInfoLog(t))}function zt(){It.clear(It.COLOR_BUFFER_BIT|It.DEPTH_BUFFER_BIT)}function Nt(e){var t=e.segmentObjects,n=e.ssm,s=t.length;console.log("Number of segments: ",s);var a=e.getAnalysisDuration()/2;function i(e){return e/a-1}for(var r=[],o=0;o<s;o++)for(var c=0;c<s;c++){var l=Math.pow(o>=c?n[c][o-c][0]:n[o][c-o-1][1],4),u=i(t[c].start),h=-i(t[o].start),d=i(t[c].start+t[c].duration),f=-i(t[o].start+t[o].duration);r.push(u,h,l,u,f,l,d,h,l,d,h,l,u,f,l,d,f,l)}var m=It.createBuffer();It.bindBuffer(It.ARRAY_BUFFER,m),It.bufferData(It.ARRAY_BUFFER,new Float32Array(r),It.STATIC_DRAW);var g=It.getAttribLocation(Bt,"vert");It.vertexAttribPointer(g,3,It.FLOAT,It.FALSE,3*Float32Array.BYTES_PER_ELEMENT,0),It.enableVertexAttribArray(g),Wt=s*s*6,console.log("Created buffer of size:",Wt)}function Ut(){It.useProgram(Bt),It.drawArrays(It.TRIANGLES,0,Wt)}var Ht=["#version 300 es","precision mediump float;","","in vec3 vert;","flat out float color;","","void main()","{"," gl_Position = vec4(vert.xy, 0.0, 1.0);"," color = vert.z;","}"].join("\n"),Gt=["#version 300 es","precision mediump float;","","flat in float color;","out vec4 fragColor;","void main()","{"," fragColor = vec4(color, color, color, 1.0);","}"].join("\n"),Yt=st["scaleOrdinal"](st["schemeCategory10"]),qt={props:["padding"],data:function(){return{canvas:null,ctx:null,hover:0,windowWidth:window.innerWidth,spotifyVisualizer:null,power:1,zoomed:!1,scaleX:4,visSpaceBetween:5,drawClusters:!0,canvasVis:{rawPitch:{draw:!0,height:150,function:Pt},percussionPitch:{draw:!1,height:30,function:Vt},rawTimbre:{draw:!0,height:150,function:Mt},ssm:{draw:!1,height:window.innerWidth-2*this.padding,function:Lt},tonality:{draw:!0,height:25,function:Dt},rawRhythm:{draw:!0,height:30,function:Ft}}}},computed:{track:function(){return this.$store.getters.selectedTrack},analysis:function(){return this.track.getAnalysis()},segments:function(){return this.track.getSegments()},scale:function(){return this.width/this.analysis.track.duration},width:function(){return this.windowWidth*(this.zoomed?this.scaleX:1)-2*this.padding},canvasWidth:function(){return this.windowWidth-2*this.padding},tsneSize:function(){return this.canvasWidth/2},canvasHeight:function(){for(var e=0,t=0,n=Object.entries(this.canvasVis);t<n.length;t++){var s=Object(q["a"])(n[t],2),a=(s[0],s[1]);e+=a.draw?this.visSpaceBetween+a.height:0}return e},loadingTrack:function(){return this.$store.state.loadingTrack},duration:function(){return Math.round(1e3*this.track.getAnalysis().track.duration)},seeker:function(){return this.$store.state.seeker}},watch:{loadingTrack:"loadingTrackChanged",seeker:"seekerChanged",canvasHeight:"canvasHeightChanged",canvasVis:{deep:!0,handler:function(e,t){this.canvasVisChanged(e,t)}}},mounted:function(){var e=this;window.addEventListener("resize",(function(){e.windowWidth=window.innerWidth})),this.webGLSetup()},methods:{webGLSetup:function(){var e=document.getElementById("gl-canvas");e.width=this.windowWidth,e.height=this.windowWidth,$t(e)},drawSSM:function(){console.log("Drawing SSM"),zt(),Nt(this.track),Ut()},clickedVis:function(e){if(console.log(e),"visCanvas"===e.srcElement.id&&e.offsetY<=this.canvasHeight){var t=Math.min(Math.max(0,e.clientX-this.padding)/this.width,1),n=t*this.duration;this.$store.commit("setSeeker",n),gt(n)}},loudness:function(e){return ne(e)},pitchColorRange:function(e){return At(e)},timbreColorRange:function(e){return _t(e)},rainbowColorRange:function(e){return jt(e)},clusterColor:function(e){return Yt(e)},loadingTrackChanged:function(e,t){this.loadingTrack&&(this.canvasVis.ssm.draw=!1)},setupCanvas:function(e){if(e){console.log("canvas ready: draw()"),this.canvas=e,this.ctx=e.getContext("2d");e.getBoundingClientRect();this.canvas.width=this.windowWidth*devicePixelRatio,this.canvas.height=this.canvasHeight*devicePixelRatio,this.ctx.scale(devicePixelRatio,devicePixelRatio),this.canvas.style.width=this.windowWidth+"px",this.canvas.style.height=this.canvasHeight+"px",this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}else console.log("canvas not ready")},draw:function(e){console.log("draw",e),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0,n=0,s=Object.entries(this.canvasVis);n<s.length;n++){var a=Object(q["a"])(s[n],2),i=(a[0],a[1]);i.draw&&(i.function(this.track,this.padding-e,this.width,t,i.height,this.ctx),t+=this.visSpaceBetween+i.height)}},zoom:function(){console.log("zooming"),this.zoomed=!this.zoomed,this.redraw()},redraw:function(){var e=this.seeker/1e3*this.width/this.analysis.track.duration,t=this.canvasWidth/2;this.draw(this.zoomed?e-t:0)},seekerChanged:function(e,t){this.zoomed&&this.redraw()},transform:function(){this.ctx.save(),this.ctx.translate(.5*this.width,.5*this.canvasHeight),this.ctx.scale(2,2),this.ctx.drawImage(this.canvas,.5*-this.width,.5*-this.canvasHeight),this.ctx.restore()},clickedCluster:function(e,t){console.log("playing cluster",e);var n=this.track.clusters[e].length,s=(Math.floor(Math.random()*n),t);vt(s),this.$store.commit("setSeeker",1e3*s.start)},clickedSegment:function(e){vt(e),this.$store.commit("setSeeker",1e3*e.start)},clickedTSNE:function(e){var t=e.offsetX/this.tsneSize*2-1,n=e.offsetY/this.tsneSize*2-1,s=this.track.getClosestSegment([t,n]);this.clickedSegment(s)},playingSegment:function(e){return this.$store.getters.playing&&this.seeker/1e3>=e.start&&this.seeker/1e3<e.start+e.duration-.01},canvasHeightChanged:function(e,t){console.log("CanvasHeight change")},canvasVisChanged:function(){this.canvasVis.ssm.draw&&this.drawSSM()}}},Kt=qt,Xt=(n("8aeb"),n("132d")),Jt=n("a722"),Qt=n("0fd9"),Zt=n("2fa4"),en=n("b73d"),tn=Object(c["a"])(Kt,tt,nt,!1,null,null,null),nn=tn.exports;u()(tn,{VBtn:x["a"],VIcon:Xt["a"],VLayout:Jt["a"],VRow:Qt["a"],VSpacer:Zt["a"],VSwitch:en["a"]});var sn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"player"},[n("div",{staticClass:"d-flex justify-center pa-4"},[e.$store.state.playerReady?n("div",[n("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var s=t.hover;return[n("v-btn",{attrs:{elevation:s?5:0,outlined:"",fab:""},on:{click:e.playPause}},[n("v-icon",{attrs:{large:""}},[e._v("mdi-"+e._s(e.playing?"pause":"play"))])],1)]}}],null,!1,2020131878)})],1):e._e(),e.$store.state.playerReady?e._e():n("div",[n("v-progress-circular",{attrs:{indeterminate:"",size:"56"}})],1)]),e.$store.state.loadingTrack?e._e():n("div",{attrs:{id:"timeseeker"}},[n("svg",{staticClass:"waveform",attrs:{height:e.verticalScale},on:{click:e.clickedSVG}},[e._l(e.track.getSegments(),(function(t,s){return n("rect",{key:s,staticClass:"loudnessBlock",attrs:{width:t.duration*e.scale,height:e.loudness(t.loudness_max)*e.verticalScale,x:e.padding+t.start*e.scale,y:e.verticalScale-e.loudness(t.loudness_max)*e.verticalScale,fill:t.start+t.duration/2<e.$store.state.seeker/1e3?"grey":e.baseColor}})})),n("rect",{attrs:{x:e.padding+e.seeker/1e3*e.scale-1,y:0,width:2,height:e.verticalScale,fill:"#1DB954"}})],2)]),e.$store.state.loadingTrack?n("div",[n("v-progress-linear",{attrs:{indeterminate:"",color:"success"}})],1):e._e()])},an=[],rn={inject:["theme"],props:["padding"],data:function(){return{verticalScale:50,windowWidth:window.innerWidth,hover:0,ending:!1}},beforeCreate:function(){var e=this;Tt(P,(function(t){return e.stateChanged(t)})),bt().then((function(){e.$store.commit("playerReady",!0)}))},mounted:function(){},computed:{track:function(){return this.$store.getters.selectedTrack},baseColor:function(){return this.theme.isDark?"white":"black"},scale:function(){return this.$store.getters.loadingTrack?0:this.width/this.track.getAnalysisDuration()},width:function(){return this.windowWidth-2*this.padding},duration:function(){return this.$store.getters.loadingTrack?0:Math.round(1e3*this.track.getAnalysisDuration())},playing:function(){return this.$store.getters.playing},seeker:function(){return this.$store.getters.seeker}},watch:{track:"trackChanged"},methods:{clickedSVG:function(e){var t=Math.min(Math.max(0,e.clientX-this.padding)/this.width,1),n=t*this.duration;this.$store.commit("setSeeker",n),gt(this.seeker)},trackChanged:function(e,t){var n=this;this.reset().then((function(){lt(n.track.getUri(),0),n.$store.commit("setSeeker",0)}))},resume:function(){var e=this;this.playing||ht(this.seeker).then((function(){e.$store.commit("setPlaying",!0),e.interval=setInterval((function(){return e.seekerTimer(33)}),33)}))},pause:function(){this.playing&&(ft(),this.$store.commit("setPlaying",!1),clearInterval(this.interval))},playPause:function(){this.playing?this.pause():this.resume()},reset:function(){var e=this;return Object(D["a"])(F.a.mark((function t(){return F.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.ending=!1,t.abrupt("return",ft().then((function(){e.$store.commit("setSeeker",0),clearInterval(e.interval),e.$store.commit("setPlaying",!1)})).catch((function(e){return console.log(e)})));case 2:case"end":return t.stop()}}),t)})))()},clickedTimeSeeker:function(){gt(this.seekTime)},seekerTimer:function(e){var t=new Date,n=e;this.lastTimePoll&&(n=t-this.lastTimePoll),this.lastTimePoll=t,this.seekTime+=n,this.$store.state.seeker+=n},loudness:function(e){return ne(e)},stateChanged:function(e){if(this.playing){e.current_track;var t=e.position;e.duration;this.$store.commit("setSeeker",t),this.ending&&0===e.position&&this.reset(),!this.ending&&e.duration-e.position<500&&(this.ending=!0)}}},components:{}},on=rn,cn=(n("6131"),n("ce87")),ln=n("490a"),un=n("8e36"),hn=Object(c["a"])(on,sn,an,!1,null,null,null),dn=hn.exports;u()(hn,{VBtn:x["a"],VHover:cn["a"],VIcon:Xt["a"],VProgressCircular:ln["a"],VProgressLinear:un["a"]});var fn={name:"Home",data:function(){return{searchQuery:"",volume:.75,prevVolume:.75,padding:50}},computed:{user:function(){return this.$store.getters.user},trackList:function(){return this.$store.getters.trackList},selectedIndex:function(){return this.$store.getters.selectedIndex},selectedTrack:function(){return this.$store.getters.selectedTrack},seeker:function(){return this.$store.getters.seeker}},watch:{selectedIndex:function(e,t){},selectedTrack:function(e,t){console.log("We have ".concat(e.getName()," selected!"))},volume:function(e,t){wt(Math.pow(this.volume,2))}},components:{TrackSelector:Ze,Visualization:nn,Player:dn},beforeCreate:function(){console.log("Initializing app"),Be()},methods:{search:function(){Ge(this.searchQuery)},selectedTrackChanged:function(){console.log("selected track",this.trackList[this.selected].name),this.getAnalsysisFor(this.selected)},getAnalsysisFor:function(e){var t=this.trackList[e].id;this.trackAnalysis.has(t)||(this.analysisReady=!1,console.log("Getting analysis for: ",this.trackList[e].name))},getVolumeIcon:function(e){return e>.6?"mdi-volume-high":e>.2?"mdi-volume-medium":e>0?"mdi-volume-low":"mdi-volume-off"},clickVolume:function(){this.volume>0?(this.prevVolume=this.volume,this.volume=0):this.volume=this.prevVolume}}},mn=fn,gn=(n("cccb"),n("40dc")),pn=n("a523"),vn=n("ba0d"),yn=n("8654"),bn=n("2a7f"),kn=Object(c["a"])(mn,g,p,!1,null,null,null),wn=kn.exports;u()(kn,{VAppBar:gn["a"],VBtn:x["a"],VContainer:pn["a"],VIcon:Xt["a"],VSlider:vn["a"],VSpacer:Zt["a"],VTextField:yn["a"],VToolbarTitle:bn["a"]});var Sn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"callback"})},xn=[],Tn=(n("2b3d"),{name:"Callback",components:{},beforeCreate:function(){var e=this,t=new URLSearchParams(window.location.search),n=t.get("code");z(n).then((function(){e.$router.push("/home")}))}}),Cn=Tn,Rn=(n("1aec"),Object(c["a"])(Cn,Sn,xn,!1,null,null,null)),An=Rn.exports,On=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login"},[n("v-container",{attrs:{"fill-height":""}},[n("v-layout",{attrs:{"align-center":""}},[n("v-card",{staticClass:"mx-auto elevation-15"},[n("v-card-title",{staticClass:"justify-center"},[e._v("Music Structure Visualizer")]),n("v-card-subtitle",{staticClass:"text-center"},[e._v(" Visualize the structure of music in your own library! ")]),n("v-card-text",{staticClass:"text-center"},[e._v(" Logging in with spotify enables the app to play music using your spotify account. ")]),n("v-card-actions",[n("v-btn",{staticClass:"mx-auto",attrs:{color:"success"},on:{click:e.spotifyAuthorize}},[e._v("Log in with Spotify")])],1)],1)],1)],1)],1)},_n=[],jn={name:"Login",components:{},methods:{spotifyAuthorize:function(){window.location.href="https://music-structure.herokuapp.com/api/spotify/login"}}},En=jn,Pn=(n("d6db"),Object(c["a"])(En,On,_n,!1,null,null,null)),Vn=Pn.exports;u()(Pn,{VBtn:x["a"],VCard:T["a"],VCardActions:C["a"],VCardSubtitle:C["b"],VCardText:C["c"],VCardTitle:C["d"],VContainer:pn["a"],VLayout:Jt["a"]}),s["a"].use(m["a"]);var Mn=[{path:"/",name:"Login",component:Vn},{path:"/home",name:"Home",component:wn,beforeEnter:function(e,t,n){U()?n():n("/")}},{path:"/callback",name:"Callback",component:An}],Fn=new m["a"]({mode:"history",base:"/",routes:Mn}),Dn=Fn,Ln=n("f309");s["a"].use(Ln["a"]);var In=new Ln["a"]({theme:{dark:!0,themes:{light:{primary:"#1DB954",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#1DB954",warning:"#FFC107"},dark:{primary:"#1DB954",success:"#1DB954"}}}}),Bn=function(){return new Worker(n.p+"js/my.worker.f341e2ed.worker.js")};n.e("chunk-789e6b41").then(n.bind(null,"55b9")).then((function(e){console.log("707 + 707 = ".concat(e.add(707,707)))}));var Wn=new Bn;Wn.onmessage=function(e){console.log("Got back from worker",JSON.stringify(e.data))},console.log("Sending message to worker"),Wn.postMessage({message:"Are u awake?",now:performance.now()}),s["a"].config.productionTip=!1,new s["a"]({router:Dn,vuetify:In,store:Pe,render:function(e){return e(f)}}).$mount("#app")},"5ced":function(e,t,n){},6131:function(e,t,n){"use strict";var s=n("2f67"),a=n.n(s);a.a},"6e94":function(e,t,n){},"85ec":function(e,t,n){},"8ade":function(e,t,n){"use strict";var s=n("9bd1"),a=n.n(s);a.a},"8aeb":function(e,t,n){"use strict";var s=n("6e94"),a=n.n(s);a.a},"9bd1":function(e,t,n){},cccb:function(e,t,n){"use strict";var s=n("5ced"),a=n.n(s);a.a},d6db:function(e,t,n){"use strict";var s=n("e67a"),a=n.n(s);a.a},d917:function(e,t,n){},e67a:function(e,t,n){}});
//# sourceMappingURL=app.e9138b59.js.map