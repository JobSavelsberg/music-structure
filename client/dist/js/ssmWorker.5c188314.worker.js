(function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s="349b")})({"349b":function(e,t,r){"use strict";r.r(t);let s=0;const o=0,n=1,i=2,a=3,l=4,c=[o,n,i,a,l],u=e=>!!e&&("object"===typeof e||"function"===typeof e)&&"function"===typeof e.then,f=e=>{const t={name:e.name,message:e.message};return"string"===typeof e.stack&&(t.stack=e.stack),"string"===typeof e.fileName&&(t.fileName=e.fileName),"number"===typeof e.columnNumber&&(t.columnNumber=e.columnNumber),"number"===typeof e.lineNumber&&(t.lineNumber=e.lineNumber),t},h=e=>{const t=new Error;return Object.assign(t,e)},p=e=>{console.error("Error in Worker:"),console.error(e)};class d{constructor(){this._callbacks=new Map,this._queryCallback=()=>{},this._onMessage=this._onMessage.bind(this)}register(e){this._queryCallback=e}_postMessage(e,t){throw new Error("Not implemented")}_postResponse(e,t,r,s){t?(p(t),this._postMessage([n,e,f(t)],s)):this._postMessage([n,e,null,r],s)}_handleQuery(e,t,r){try{const s=this._queryCallback(t,r);u(s)?s.then(t=>{this._postResponse(e,null,t,r)},t=>{this._postResponse(e,t,r)}):this._postResponse(e,null,s,r)}catch(s){this._postResponse(e,s)}}_onMessageCommon(e){const t=e.data;if(!Array.isArray(t)||t.length<3||t.length>4)return;if("number"!==typeof t[0]||c.indexOf(t[0])<0)throw new Error("Invalid messageID");const r=t[0];if("number"!==typeof t[1])throw new Error("Invalid messageID");const s=t[1];if(r!==o){if(r===n){if(null!==t[2]&&"object"!==typeof t[2])throw new Error("Invalid error");const e=null===t[2]?null:h(t[2]),r=t[3],o=this._callbacks.get(s);if(void 0===o)return;return this._callbacks.delete(s),void o(e,r)}return{message:t,type:r}}{const e=t[2];if("number"!==typeof t[3]&&void 0!==t[3])throw new Error("Invalid hostID");const r=t[3];this._handleQuery(s,e,r)}}}class m extends d{constructor(){super(),this._hosts=new Map,this._maxHostID=-1,"undefined"!==typeof SharedWorkerGlobalScope&&self instanceof SharedWorkerGlobalScope?(this._workerType="SharedWorker",self.addEventListener("connect",e=>{const t=e.ports[0];t.addEventListener("message",e=>this._onMessage(e)),t.start(),this._maxHostID+=1;const r=this._maxHostID;this._hosts.set(r,{port:t}),this._postMessage([i,-1,r],r)}),self.addEventListener("error",e=>{p(e.error);const t=this._hosts.keys().next().value;void 0!==t&&this._postMessage([l,-1,f(e.error)],t)})):(this._workerType="Worker",self.addEventListener("message",this._onMessage),this._postMessage([i,-1,0],0),self.addEventListener("error",e=>{p(e.error),this._postMessage([l,-1,f(e.error)])}))}_postMessage(e,t){if("SharedWorker"===this._workerType)this._hosts.forEach(({port:r},s)=>{void 0!==t&&t!==s||r.postMessage(e)});else{if("Worker"!==this._workerType)throw new Error("WTF");self.postMessage(e)}}postMessage(e,t){const r=(r,n)=>{const i=s;s+=1;const a=[o,i,e];this._callbacks.set(i,(e,t)=>{e?n(e):r(t)}),this._postMessage(a,t)};return new Promise((e,t)=>{r(e,t)})}_onMessage(e){const t=this._onMessageCommon(e);if(!t)return;const r=t.message,s=t.type;if(s===a){if("number"!==typeof r[2])throw new Error("Invalid hostID");const e=r[2];this._hosts.delete(e)}}}function _(e,t){for(var r=0,s=0,o=0,n=0;n<e.length;n++)r+=e[n]*t[n],s+=e[n]*e[n],o+=t[n]*t[n];return s=Math.sqrt(s),o=Math.sqrt(o),r/(s*o)}var g=new m;g.register((function(e){if("message"===e.type){for(var t=e.message.segmentObjects,r=t.length,s=new Array(r),o=0;o<r;o++){var n=t[o];s[o]=new Array(r-o);for(var i=o;i<r;i++)s[o][i-o]=new Array(2),s[o][i-o][0]=_(n.pitches,t[i].pitches),s[o][i-o][1]=_(n.timbres,t[i].timbres)}return s}}))}});
//# sourceMappingURL=ssmWorker.5c188314.worker.js.map